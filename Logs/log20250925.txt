2025-09-25 16:43:34.543 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-09-25 16:43:36.241 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-25 16:43:36.945 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-25 16:43:37.119 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-09-25 16:43:37.158 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 16:43:37.175 +03:00 [INF] Starting data seeding...
2025-09-25 16:43:37.222 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 16:43:37.915 +03:00 [INF] DB tables already exist. Exit install
2025-09-25 16:43:38.375 +03:00 [INF] Executed DbCommand (115ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-25 16:43:38.496 +03:00 [INF] Role 'Admin' already exists.
2025-09-25 16:43:38.655 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-25 16:43:38.662 +03:00 [INF] Role 'User' already exists.
2025-09-25 16:43:38.847 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 16:43:38.875 +03:00 [INF] Admin user not found. Creating...
2025-09-25 16:43:39.155 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-09-25 16:43:39.395 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 16:43:39.405 +03:00 [ERR] Failed to create admin user: Username 'Omargamal1132004@gmail.com' is already taken., Email 'Omargamal1132004@gmail.com' is already taken.
2025-09-25 16:43:41.222 +03:00 [INF] Now listening on: http://localhost:5069
2025-09-25 16:43:41.353 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-09-25 16:43:41.356 +03:00 [INF] Using the following options for SQL Server job storage:
2025-09-25 16:43:41.359 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-09-25 16:43:41.361 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-09-25 16:43:41.384 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 16:43:41.393 +03:00 [INF] Hosting environment: Development
2025-09-25 16:43:41.398 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-09-25 16:43:41.560 +03:00 [INF] Server mrrobot:12676:1f419b89 successfully announced in 165.8701 ms
2025-09-25 16:43:41.565 +03:00 [INF] Server mrrobot:12676:1f419b89 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-09-25 16:43:41.598 +03:00 [INF] Server mrrobot:12676:1f419b89 all the dispatchers started
2025-09-25 16:43:41.926 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-09-25 16:43:42.319 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 393.5892ms
2025-09-25 16:43:42.321 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-25 16:43:42.327 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-09-25 16:43:42.337 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 16:43:42.453 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 126.176ms
2025-09-25 16:43:42.478 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16504 application/javascript; charset=utf-8 140.6335ms
2025-09-25 16:43:42.556 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 234.8069ms
2025-09-25 16:43:42.695 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-09-25 16:43:42.994 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 298.8958ms
2025-09-25 16:43:54.337 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 1
2025-09-25 16:43:54.448 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:43:54.506 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`Description`, `c`.`DisplayOrder`, `c`.`IsActive`, `c`.`ModifiedAt`, `c`.`Name`
FROM `Categories` AS `c`
WHERE `c`.`DeletedAt` IS NOT NULL
2025-09-25 16:43:54.595 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 6
2025-09-25 16:43:54.595 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 5
2025-09-25 16:43:54.596 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 3
2025-09-25 16:43:54.606 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 2
2025-09-25 16:43:54.610 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 7
2025-09-25 16:43:54.611 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 4
2025-09-25 16:43:54.612 +03:00 [INF] Executed DbCommand (98ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:43:54.675 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:43:54.680 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:43:54.683 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:43:54.684 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 8
2025-09-25 16:43:54.712 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:43:54.727 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:43:54.732 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:43:54.776 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:43:54.808 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:43:54.825 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:43:54.842 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:43:54.860 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:43:54.876 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:43:54.893 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:43:54.927 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:43:55.011 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:43:55.012 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:43:55.012 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:43:55.013 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:43:55.016 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:43:55.034 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:43:55.054 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:43:55.089 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:43:58.066 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 9
2025-09-25 16:43:58.156 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:43:58.239 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:43:58.401 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:44:00.809 +03:00 [INF] Order 3 auto-expired and restock scheduled
2025-09-25 16:44:00.827 +03:00 [INF] Order 8 auto-expired and restock scheduled
2025-09-25 16:44:00.885 +03:00 [INF] Order 2 auto-expired and restock scheduled
2025-09-25 16:44:00.889 +03:00 [INF] Order 7 auto-expired and restock scheduled
2025-09-25 16:44:01.033 +03:00 [INF] Order 6 auto-expired and restock scheduled
2025-09-25 16:44:01.033 +03:00 [INF] Order 1 auto-expired and restock scheduled
2025-09-25 16:44:01.283 +03:00 [INF] Order 4 auto-expired and restock scheduled
2025-09-25 16:44:01.470 +03:00 [INF] Order 5 auto-expired and restock scheduled
2025-09-25 16:44:04.020 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 4
2025-09-25 16:44:04.077 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 8
2025-09-25 16:44:04.081 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 1
2025-09-25 16:44:04.176 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:04.188 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 6
2025-09-25 16:44:04.230 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 5
2025-09-25 16:44:04.232 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:04.235 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:04.334 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 3
2025-09-25 16:44:04.336 +03:00 [INF] Order 9 auto-expired and restock scheduled
2025-09-25 16:44:04.336 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:44:04.345 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:04.358 +03:00 [INF] Execute GetAll for entity OrderItem
2025-09-25 16:44:04.391 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:04.393 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:44:04.396 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:44:04.412 +03:00 [INF] Execute GetAll for entity OrderItem
2025-09-25 16:44:04.416 +03:00 [INF] Execute GetAll for entity OrderItem
2025-09-25 16:44:04.493 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:04.514 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:44:04.524 +03:00 [INF] Execute GetAll for entity OrderItem
2025-09-25 16:44:04.545 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-09-25 16:44:04.557 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:44:04.558 +03:00 [INF] Adding quantity for variant: 8
2025-09-25 16:44:04.567 +03:00 [INF] Execute GetAll for entity OrderItem
2025-09-25 16:44:04.575 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-09-25 16:44:04.576 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-09-25 16:44:04.582 +03:00 [INF] Adding quantity for variant: 8
2025-09-25 16:44:04.590 +03:00 [INF] Adding quantity for variant: 7
2025-09-25 16:44:04.659 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:44:04.676 +03:00 [INF] Execute GetAll for entity OrderItem
2025-09-25 16:44:04.679 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-09-25 16:44:04.683 +03:00 [INF] Adding quantity for variant: 7
2025-09-25 16:44:04.722 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-09-25 16:44:04.737 +03:00 [INF] Adding quantity for variant: 8
2025-09-25 16:44:04.747 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 7
2025-09-25 16:44:04.799 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:04.799 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:04.809 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:04.828 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-09-25 16:44:04.833 +03:00 [INF] Adding quantity for variant: 8
2025-09-25 16:44:04.867 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:04.880 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-25 16:44:04.885 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 8
2025-09-25 16:44:04.898 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-25 16:44:04.902 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:04.905 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 7
2025-09-25 16:44:04.970 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:04.993 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:05.045 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 2
2025-09-25 16:44:05.048 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:05.060 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:05.063 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:44:05.069 +03:00 [INF] Execute GetAll for entity OrderItem
2025-09-25 16:44:05.098 +03:00 [INF] Executed DbCommand (279ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-25 16:44:05.099 +03:00 [INF] Executed DbCommand (181ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-25 16:44:05.112 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 8
2025-09-25 16:44:05.119 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 7
2025-09-25 16:44:05.197 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:05.198 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:05.199 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:05.201 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:05.212 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:05.225 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-09-25 16:44:05.249 +03:00 [INF] Adding quantity for variant: 7
2025-09-25 16:44:05.268 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:05.299 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:05.301 +03:00 [INF] Executed DbCommand (336ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-25 16:44:05.311 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 8
2025-09-25 16:44:05.383 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:44:05.387 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:05.392 +03:00 [INF] Execute GetAll for entity OrderItem
2025-09-25 16:44:05.472 +03:00 [INF] Executed DbCommand (413ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-25 16:44:05.486 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 8
2025-09-25 16:44:05.548 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-09-25 16:44:05.552 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-25 16:44:05.555 +03:00 [INF] Adding quantity for variant: 8
2025-09-25 16:44:05.561 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 7
2025-09-25 16:44:05.567 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:05.587 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:05.599 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:05.642 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:05.700 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:05.865 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-25 16:44:05.870 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 8
2025-09-25 16:44:06.007 +03:00 [INF] Quantity for variant 8 increased by 1
2025-09-25 16:44:06.026 +03:00 [INF] Quantity for variant 7 increased by 1
2025-09-25 16:44:06.206 +03:00 [INF] Quantity for variant 8 increased by 1
2025-09-25 16:44:06.228 +03:00 [INF] Quantity for variant 7 increased by 1
2025-09-25 16:44:06.378 +03:00 [INF] Quantity for variant 8 increased by 1
2025-09-25 16:44:06.382 +03:00 [INF] Executed DbCommand (511ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:06.390 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:06.550 +03:00 [INF] Quantity for variant 8 increased by 1
2025-09-25 16:44:06.638 +03:00 [INF] Quantity for variant 7 increased by 1
2025-09-25 16:44:06.706 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:44:06.707 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:44:06.708 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:44:06.708 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:44:06.709 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:44:06.857 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:44:06.946 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:44:07.361 +03:00 [INF] Quantity for variant 8 increased by 1
2025-09-25 16:44:07.596 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:07.661 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:44:07.919 +03:00 [INF] Removed 11 cache entries for tags: [order]
2025-09-25 16:44:07.933 +03:00 [INF] Removed 11 cache entries for tags: [order]
2025-09-25 16:44:07.933 +03:00 [INF] Removed 11 cache entries for tags: [order]
2025-09-25 16:44:08.026 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:08.123 +03:00 [INF] Removed 11 cache entries for tags: [order]
2025-09-25 16:44:08.153 +03:00 [INF] Removed 11 cache entries for tags: [order]
2025-09-25 16:44:08.243 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:08.332 +03:00 [INF] Removed 11 cache entries for tags: [order]
2025-09-25 16:44:08.339 +03:00 [INF] Removed 11 cache entries for tags: [order]
2025-09-25 16:44:08.641 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:08.682 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:08.757 +03:00 [INF] Removed 11 cache entries for tags: [order]
2025-09-25 16:44:09.076 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:09.322 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:09.754 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:11.209 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:11.215 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:11.219 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:11.222 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:11.230 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:11.235 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:11.287 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:11.308 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:11.350 +03:00 [INF] Restocked inventory for order 4
2025-09-25 16:44:11.360 +03:00 [INF] Restocked inventory for order 5
2025-09-25 16:44:11.361 +03:00 [INF] Restocked inventory for order 1
2025-09-25 16:44:11.388 +03:00 [INF] Restocked inventory for order 6
2025-09-25 16:44:11.417 +03:00 [INF] Restocked inventory for order 8
2025-09-25 16:44:11.514 +03:00 [INF] Restocked inventory for order 3
2025-09-25 16:44:11.626 +03:00 [INF] Restocked inventory for order 7
2025-09-25 16:44:11.642 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:11.663 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:11.712 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 9
2025-09-25 16:44:11.870 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:12.056 +03:00 [INF] Executed DbCommand (95ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 16:44:12.056 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:12.073 +03:00 [INF] Execute GetAll for entity OrderItem
2025-09-25 16:44:12.249 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-09-25 16:44:12.257 +03:00 [INF] Adding quantity for variant: 7
2025-09-25 16:44:12.280 +03:00 [INF] Restocked inventory for order 2
2025-09-25 16:44:12.612 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-25 16:44:12.618 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 7
2025-09-25 16:44:12.702 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 16:44:12.769 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:13.198 +03:00 [INF] Removed 5 cache entries for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:13.220 +03:00 [INF] Removed 5 cache entries for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:13.220 +03:00 [INF] Removed 5 cache entries for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:13.229 +03:00 [INF] Removed 5 cache entries for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:13.240 +03:00 [INF] Removed 5 cache entries for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:13.304 +03:00 [INF] Removed 5 cache entries for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:13.308 +03:00 [INF] Removed 5 cache entries for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:13.434 +03:00 [INF] Removed 2 cache entries for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:13.683 +03:00 [INF] Removed 5 cache entries for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:13.710 +03:00 [INF] Quantity for variant 7 increased by 1
2025-09-25 16:44:13.910 +03:00 [INF] Removed 1 cache entries for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:14.011 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:44:14.386 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:14.390 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:14.541 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:14.671 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:14.688 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:14.689 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:14.692 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:14.896 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-25 16:44:15.030 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:15.033 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:15.186 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:15.311 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:15.334 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:15.354 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:15.355 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:15.683 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:16.179 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:16.190 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:16.193 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:16.198 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:16.372 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:16.453 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:16.602 +03:00 [INF] Removed 2 cache entries for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:16.604 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:16.605 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:16.824 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:16.836 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:16.839 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:16.842 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:16.969 +03:00 [INF] Removed 2 cache entries for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:17.016 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:17.036 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:17.101 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:17.249 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:17.273 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:17.359 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:17.922 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:18.004 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:18.181 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-25 16:44:18.182 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-25 16:44:18.194 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-25 16:44:18.336 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-25 16:44:18.494 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-25 16:44:18.499 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-25 16:44:18.570 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:44:18.570 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:44:18.636 +03:00 [INF] Restocked inventory for order 9
2025-09-25 16:44:18.653 +03:00 [INF] Executed DbCommand (153ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:44:18.660 +03:00 [INF] Executed DbCommand (89ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:44:18.790 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-25 16:44:18.800 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:44:18.880 +03:00 [INF] Executed DbCommand (148ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 16:44:19.734 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-25 16:44:19.787 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:19.802 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:19.807 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:19.858 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:19.932 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:20.002 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:20.010 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:20.018 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-25 16:44:20.022 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-25 16:44:20.024 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-25 16:44:20.078 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-25 16:44:20.084 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:20.149 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-25 16:44:20.223 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-25 16:44:20.228 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:20.232 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-25 16:44:20.514 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:20.660 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:20.914 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:21.008 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:21.346 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:21.448 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:21.606 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:22.041 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:22.975 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:23.012 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:23.016 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:23.129 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:23.199 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-25 16:44:23.204 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:23.206 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:23.356 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:23.448 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:23.448 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:23.790 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:23.853 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:23.857 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:24.002 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:24.002 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:24.083 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:24.369 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:24.385 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:24.389 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:24.440 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:24.441 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:24.464 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:24.517 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:24.730 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:24.755 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:24.801 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:24.886 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:25.017 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:25.031 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:25.035 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:25.054 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:25.086 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:25.111 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:25.163 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:25.397 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:25.446 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:25.531 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:25.558 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:25.700 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:26.203 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:26.205 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:26.434 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:26.465 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:26.738 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:26.846 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:26.853 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:26.875 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:27.079 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:27.110 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:27.342 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:27.383 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:27.417 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:27.492 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:27.520 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:27.876 +03:00 [INF] Executed DbCommand (94ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-25 16:44:27.979 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 16:44:27.986 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:27.987 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 16:44:28.036 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:28.048 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:28.063 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:28.118 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:28.144 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-25 16:44:28.197 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-25 16:44:28.369 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-25 16:44:28.369 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-25 16:44:28.425 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 16:44:28.493 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-25 16:44:28.590 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-25 16:44:28.672 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-25 16:44:28.688 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:28.694 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 16:44:28.712 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-25 16:44:28.725 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-25 16:44:28.772 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 16:44:28.888 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-25 16:44:28.940 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-25 16:44:29.211 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-25 16:44:29.436 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-25 16:44:29.817 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-25 16:44:30.035 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-25 16:44:30.051 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-25 16:44:30.116 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-25 16:44:30.267 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-25 16:44:30.332 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-25 16:44:30.349 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-25 16:44:30.506 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-25 16:44:30.513 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-25 16:44:30.566 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-25 16:44:30.726 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-25 16:44:30.731 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-25 16:44:30.982 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-25 16:44:31.030 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-25 16:44:31.163 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-25 16:44:31.207 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-25 16:44:31.253 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-25 16:44:31.352 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:31.385 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-25 16:44:31.392 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:31.681 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:31.912 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:31.984 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-25 16:44:31.988 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:32.001 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:32.036 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:32.063 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:32.211 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-25 16:44:32.211 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:32.212 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:32.331 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:32.396 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-25 16:44:32.566 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:32.616 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-25 16:44:32.649 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:32.708 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:32.863 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:32.868 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:33.000 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-25 16:44:33.219 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-25 16:44:33.302 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 16:44:33.953 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 22:25:57.834 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-09-25 22:25:59.685 +03:00 [INF] Executed DbCommand (94ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-25 22:26:00.417 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-25 22:26:00.615 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-09-25 22:26:00.647 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 22:26:00.674 +03:00 [INF] Starting data seeding...
2025-09-25 22:26:00.746 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 22:26:01.043 +03:00 [INF] DB tables already exist. Exit install
2025-09-25 22:26:01.595 +03:00 [INF] Executed DbCommand (139ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-25 22:26:01.698 +03:00 [INF] Role 'Admin' already exists.
2025-09-25 22:26:01.892 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-25 22:26:01.899 +03:00 [INF] Role 'User' already exists.
2025-09-25 22:26:02.093 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 22:26:02.102 +03:00 [INF] Admin user not found. Creating...
2025-09-25 22:26:02.436 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-09-25 22:26:02.694 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 22:26:02.706 +03:00 [ERR] Failed to create admin user: Username 'Omargamal1132004@gmail.com' is already taken., Email 'Omargamal1132004@gmail.com' is already taken.
2025-09-25 22:26:04.535 +03:00 [INF] Now listening on: http://localhost:5069
2025-09-25 22:26:04.726 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-09-25 22:26:04.748 +03:00 [INF] Using the following options for SQL Server job storage:
2025-09-25 22:26:04.829 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-09-25 22:26:04.833 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-09-25 22:26:04.872 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 22:26:04.897 +03:00 [INF] Hosting environment: Development
2025-09-25 22:26:04.905 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-09-25 22:26:05.061 +03:00 [INF] Server mrrobot:16244:08fada47 successfully announced in 164.2697 ms
2025-09-25 22:26:05.094 +03:00 [INF] Server mrrobot:16244:08fada47 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-09-25 22:26:05.468 +03:00 [INF] Server mrrobot:16244:08fada47 all the dispatchers started
2025-09-25 22:26:05.898 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-09-25 22:26:06.535 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 635.0701ms
2025-09-25 22:26:06.535 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-09-25 22:26:06.650 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 22:26:06.563 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-25 22:26:06.689 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 153.3135ms
2025-09-25 22:26:06.704 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 54.6419ms
2025-09-25 22:26:06.866 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 303.4025ms
2025-09-25 22:26:06.928 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-09-25 22:26:07.203 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 274.5748ms
2025-09-25 22:26:22.512 +03:00 [INF] Execution RecurringJobScheduler recovered from the Faulted state after 00:00:16.5904005 and is in the Running state now
2025-09-25 22:27:04.279 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/1 - multipart/form-data; boundary=--------------------------753745175695784784765830 175
2025-09-25 22:27:04.581 +03:00 [WRN] Failed to determine the https port for redirect.
2025-09-25 22:27:07.955 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:27:08.166 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:27:08.198 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-09-25 22:27:08.244 +03:00 [INF] Route matched with {action = "UpdatePaymentMethod", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdatePaymentMethod(Int32, E_Commerce.Services.PaymentMethodsServices.Updatepaymentmethoddto) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-09-25 22:27:08.454 +03:00 [INF] Starting UpdatePaymentMethod for ID 1 by user 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:27:08.853 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-25 22:27:08.947 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:27:35.780 +03:00 [INF] Updating payment method: Vias
2025-09-25 22:27:36.570 +03:00 [INF] Payment method updated successfully with ID 1
2025-09-25 22:27:46.354 +03:00 [INF] Execute AddAdminOpreationAsync
2025-09-25 22:27:46.373 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-09-25 22:27:46.444 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-09-25 22:27:54.104 +03:00 [INF] Admin operation logged for payment method update 1
2025-09-25 22:27:59.147 +03:00 [ERR] Failed executing DbCommand (299ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `PaymentMethods` SET `PaymentProviderId` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 22:27:59.719 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails ("Fashion_Site"."PaymentMethods", CONSTRAINT "FK_PaymentMethods_PaymentProviders_PaymentProviderId" FOREIGN KEY ("PaymentProviderId") REFERENCES "PaymentProviders" ("Id") ON DELETE CASCADE)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails ("Fashion_Site"."PaymentMethods", CONSTRAINT "FK_PaymentMethods_PaymentProviders_PaymentProviderId" FOREIGN KEY ("PaymentProviderId") REFERENCES "PaymentProviders" ("Id") ON DELETE CASCADE)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-25 22:28:20.037 +03:00 [ERR] Error occurred while updating payment method for ID 1 by user 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails ("Fashion_Site"."PaymentMethods", CONSTRAINT "FK_PaymentMethods_PaymentProviders_PaymentProviderId" FOREIGN KEY ("PaymentProviderId") REFERENCES "PaymentProviders" ("Id") ON DELETE CASCADE)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync()
   at E_Commerce.Services.PaymentMethodsServices.PaymentMethodsServices.UpdatePaymentMethod(Int32 id, Updatepaymentmethoddto paymentdto, String userid)
2025-09-25 22:28:21.099 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:28:21.152 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce) in 72897.3155ms
2025-09-25 22:28:21.184 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-09-25 22:28:21.226 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/1 - 500 225 application/json; charset=utf-8 76946.9764ms
2025-09-25 22:28:30.690 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentProvider?page=1&pageSize=10 - null null
2025-09-25 22:28:30.701 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:28:30.860 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:28:30.873 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentProviderController.GetAll (E-Commerce)'
2025-09-25 22:28:30.884 +03:00 [INF] Route matched with {action = "GetAll", controller = "PaymentProvider"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentProvidersServices.PaymentProviderDto]]]] GetAll(System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.PaymentProviderController (E-Commerce).
2025-09-25 22:28:30.907 +03:00 [INF] GetAll PaymentProviders | isDeleted: , Page: 1, PageSize: 10
2025-09-25 22:28:30.919 +03:00 [INF] Getting cache for key: paymentproviders__page1_size10
2025-09-25 22:28:31.149 +03:00 [WRN] Cache miss for key: paymentproviders__page1_size10
2025-09-25 22:28:31.154 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 22:28:31.360 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`DeletedAt` IS NOT NULL AS `IsDeleted`, COALESCE(`p`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt`, `p`.`ModifiedAt` AS `UpdatedAt`
FROM `PaymentProviders` AS `p`
ORDER BY `p`.`Id`
LIMIT @__p_1 OFFSET @__p_0
2025-09-25 22:28:32.317 +03:00 [INF] Fetched payment providers from DB and cached result.
2025-09-25 22:28:32.323 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.Services.PaymentProvidersServices.PaymentProviderDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:28:32.335 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentProviderController.GetAll (E-Commerce) in 1443.473ms
2025-09-25 22:28:32.337 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentProviderController.GetAll (E-Commerce)'
2025-09-25 22:28:32.339 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentProvider?page=1&pageSize=10 - 200 220 application/json; charset=utf-8 1649.2699ms
2025-09-25 22:29:01.576 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/1 - multipart/form-data; boundary=--------------------------607110052702666274409723 292
2025-09-25 22:29:01.631 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:29:01.785 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:29:01.793 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-09-25 22:29:01.804 +03:00 [INF] Route matched with {action = "UpdatePaymentMethod", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdatePaymentMethod(Int32, E_Commerce.Services.PaymentMethodsServices.Updatepaymentmethoddto) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-09-25 22:29:01.825 +03:00 [INF] Starting UpdatePaymentMethod for ID 1 by user 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:29:02.066 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-25 22:29:02.147 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:29:03.803 +03:00 [INF] Updating payment method: Vias
2025-09-25 22:29:03.810 +03:00 [INF] Payment method updated successfully with ID 1
2025-09-25 22:29:03.818 +03:00 [INF] Execute AddAdminOpreationAsync
2025-09-25 22:29:03.819 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-09-25 22:29:03.822 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-09-25 22:29:06.849 +03:00 [INF] Admin operation logged for payment method update 1
2025-09-25 22:29:07.015 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (Size = 4000), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `PaymentMethods` SET `IntegrationId` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 22:29:08.161 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:29:08.167 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce) in 6359.1053ms
2025-09-25 22:29:08.176 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-09-25 22:29:08.184 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/1 - 200 122 application/json; charset=utf-8 6607.5216ms
2025-09-25 22:32:01.121 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - null null
2025-09-25 22:32:01.128 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:32:01.287 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:32:01.292 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-09-25 22:32:01.302 +03:00 [INF] Route matched with {action = "GetAll", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentMethodsServices.PaymentMethodDto]]]] GetAll(System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-09-25 22:32:01.310 +03:00 [INF] Admin requested GetAll PaymentMethods | isActive: , isDeleted: , Page: 1, PageSize: 10
2025-09-25 22:32:01.319 +03:00 [INF] Getting cache for key: paymentmethods___page1_size10
2025-09-25 22:32:01.538 +03:00 [WRN] Cache miss for key: paymentmethods___page1_size10
2025-09-25 22:32:01.540 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-25 22:32:01.766 +03:00 [INF] Executed DbCommand (100ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM `PaymentMethods` AS `p`
2025-09-25 22:32:02.009 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`IsActive`, `p`.`PaymentProviderId`, `p`.`Method`
FROM `PaymentMethods` AS `p`
ORDER BY `p`.`Id`
LIMIT @__p_1 OFFSET @__p_0
2025-09-25 22:32:02.959 +03:00 [INF] Fetched payment methods from DB and cached result.
2025-09-25 22:32:02.963 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.Services.PaymentMethodsServices.PaymentMethodDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:32:02.974 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce) in 1667.1306ms
2025-09-25 22:32:02.976 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-09-25 22:32:02.978 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - 200 618 application/json; charset=utf-8 1856.8296ms
2025-09-25 22:32:48.076 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-09-25 22:32:48.090 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 14.0292ms
2025-09-25 22:32:48.166 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-09-25 22:32:48.196 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 30.6278ms
2025-09-25 22:32:48.211 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-25 22:32:48.221 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 22:32:48.232 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 20.4728ms
2025-09-25 22:32:48.262 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 40.3455ms
2025-09-25 22:32:48.826 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-09-25 22:32:49.006 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 179.087ms
2025-09-25 22:32:52.230 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - null null
2025-09-25 22:32:52.349 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:32:52.513 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:32:52.518 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-09-25 22:32:52.528 +03:00 [INF] Route matched with {action = "GetAll", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentMethodsServices.PaymentMethodDto]]]] GetAll(System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-09-25 22:32:52.533 +03:00 [INF] Admin requested GetAll PaymentMethods | isActive: , isDeleted: , Page: 1, PageSize: 10
2025-09-25 22:32:52.544 +03:00 [INF] Getting cache for key: paymentmethods___page1_size10
2025-09-25 22:32:52.758 +03:00 [INF] Cache hit for key: paymentmethods___page1_size10
2025-09-25 22:32:52.782 +03:00 [INF] Fetched payment methods from cache with key paymentmethods___page1_size10
2025-09-25 22:32:52.789 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.Services.PaymentMethodsServices.PaymentMethodDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:32:52.792 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce) in 260.2553ms
2025-09-25 22:32:52.795 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-09-25 22:32:52.798 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - 200 618 application/json; charset=utf-8 567.7028ms
2025-09-25 22:32:59.541 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/1 - multipart/form-data; boundary=--------------------------256995977473763996416278 292
2025-09-25 22:32:59.898 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:33:00.068 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:33:00.076 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-09-25 22:33:00.092 +03:00 [INF] Route matched with {action = "UpdatePaymentMethod", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdatePaymentMethod(Int32, E_Commerce.Services.PaymentMethodsServices.Updatepaymentmethoddto) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-09-25 22:33:00.097 +03:00 [INF] Starting UpdatePaymentMethod for ID 1 by user 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:33:00.331 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-25 22:33:00.460 +03:00 [INF] Executed DbCommand (126ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:33:02.268 +03:00 [INF] Updating payment method: Vias
2025-09-25 22:33:02.275 +03:00 [INF] Payment method updated successfully with ID 1
2025-09-25 22:33:02.278 +03:00 [INF] Execute AddAdminOpreationAsync
2025-09-25 22:33:02.282 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-09-25 22:33:02.284 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-09-25 22:33:03.047 +03:00 [INF] Admin operation logged for payment method update 1
2025-09-25 22:33:03.212 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 22:33:04.290 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:33:04.300 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce) in 4204.4687ms
2025-09-25 22:33:04.332 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-09-25 22:33:04.348 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/1 - 200 122 application/json; charset=utf-8 4806.2315ms
2025-09-25 22:33:11.291 +03:00 [INF] Removing cache by tag: Paymentmethodcache
2025-09-25 22:33:11.991 +03:00 [INF] Removed 1 cache entries for tag: Paymentmethodcache
2025-09-25 22:33:13.067 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - null null
2025-09-25 22:33:13.075 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:33:13.232 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:33:13.242 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-09-25 22:33:13.245 +03:00 [INF] Route matched with {action = "GetAll", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentMethodsServices.PaymentMethodDto]]]] GetAll(System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-09-25 22:33:13.249 +03:00 [INF] Admin requested GetAll PaymentMethods | isActive: , isDeleted: , Page: 1, PageSize: 10
2025-09-25 22:33:13.255 +03:00 [INF] Getting cache for key: paymentmethods___page1_size10
2025-09-25 22:33:13.401 +03:00 [INF] Execution Worker recovered from the Faulted state after 00:07:07.4793142 and is in the Running state now
2025-09-25 22:33:13.474 +03:00 [WRN] Cache miss for key: paymentmethods___page1_size10
2025-09-25 22:33:13.478 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-25 22:33:13.644 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM `PaymentMethods` AS `p`
2025-09-25 22:33:13.811 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`IsActive`, `p`.`PaymentProviderId`, `p`.`Method`, COALESCE(`p`.`IntegrationId`, '')
FROM `PaymentMethods` AS `p`
ORDER BY `p`.`Id`
LIMIT @__p_1 OFFSET @__p_0
2025-09-25 22:33:14.761 +03:00 [INF] Fetched payment methods from DB and cached result.
2025-09-25 22:33:14.764 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.Services.PaymentMethodsServices.PaymentMethodDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:33:14.773 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce) in 1524.0708ms
2025-09-25 22:33:14.776 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-09-25 22:33:14.780 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - 200 618 application/json; charset=utf-8 1712.5744ms
2025-09-25 22:33:21.558 +03:00 [INF] Setting cache for key: paymentmethods___page1_size10
2025-09-25 22:33:21.792 +03:00 [INF] Cache set successfully for key: paymentmethods___page1_size10 with tags: [Paymentmethodcache]
2025-09-25 22:33:39.960 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-09-25 22:33:41.851 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-25 22:33:42.562 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-25 22:33:42.739 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-09-25 22:33:42.758 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 22:33:42.768 +03:00 [INF] Starting data seeding...
2025-09-25 22:33:42.794 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 22:33:42.983 +03:00 [INF] DB tables already exist. Exit install
2025-09-25 22:33:43.466 +03:00 [INF] Executed DbCommand (121ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-25 22:33:43.542 +03:00 [INF] Role 'Admin' already exists.
2025-09-25 22:33:43.698 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-25 22:33:43.706 +03:00 [INF] Role 'User' already exists.
2025-09-25 22:33:43.887 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 22:33:43.897 +03:00 [INF] Admin user not found. Creating...
2025-09-25 22:33:44.159 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-09-25 22:33:44.416 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 22:33:44.426 +03:00 [ERR] Failed to create admin user: Username 'Omargamal1132004@gmail.com' is already taken., Email 'Omargamal1132004@gmail.com' is already taken.
2025-09-25 22:33:45.676 +03:00 [INF] Now listening on: http://localhost:5069
2025-09-25 22:33:45.840 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-09-25 22:33:45.996 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-09-25 22:33:46.483 +03:00 [INF] Using the following options for SQL Server job storage:
2025-09-25 22:33:46.890 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-09-25 22:33:46.900 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-09-25 22:33:46.934 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 22:33:46.964 +03:00 [INF] Hosting environment: Development
2025-09-25 22:33:46.969 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-09-25 22:33:47.110 +03:00 [INF] Server mrrobot:23748:762eccf3 successfully announced in 169.325 ms
2025-09-25 22:33:47.149 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 1102.1114ms
2025-09-25 22:33:47.152 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 22:33:47.152 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-09-25 22:33:47.155 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-25 22:33:47.159 +03:00 [INF] Server mrrobot:23748:762eccf3 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-09-25 22:33:47.171 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 18.8759ms
2025-09-25 22:33:47.180 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 27.7929ms
2025-09-25 22:33:47.243 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 87.8571ms
2025-09-25 22:33:47.297 +03:00 [INF] Server mrrobot:23748:762eccf3 all the dispatchers started
2025-09-25 22:33:47.459 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-09-25 22:33:47.755 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 295.587ms
2025-09-25 22:37:22.854 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/1 - multipart/form-data; boundary=--------------------------337151496218733077166378 292
2025-09-25 22:37:22.908 +03:00 [WRN] Failed to determine the https port for redirect.
2025-09-25 22:37:23.138 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:37:23.366 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:37:23.383 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-09-25 22:37:23.437 +03:00 [INF] Route matched with {action = "UpdatePaymentMethod", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdatePaymentMethod(Int32, E_Commerce.Services.PaymentMethodsServices.Updatepaymentmethoddto) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-09-25 22:37:23.572 +03:00 [INF] Starting UpdatePaymentMethod for ID 1 by user 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:37:23.832 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-25 22:37:23.928 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:37:23.973 +03:00 [INF] Updating payment method: Vias
2025-09-25 22:37:23.980 +03:00 [INF] Payment method updated successfully with ID 1
2025-09-25 22:37:23.983 +03:00 [INF] Execute AddAdminOpreationAsync
2025-09-25 22:37:23.987 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-09-25 22:37:24.067 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-09-25 22:37:24.070 +03:00 [INF] Admin operation logged for payment method update 1
2025-09-25 22:37:24.383 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 22:37:25.605 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:37:25.638 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce) in 2193.9172ms
2025-09-25 22:37:25.689 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-09-25 22:37:25.707 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/1 - 200 122 application/json; charset=utf-8 2853.5498ms
2025-09-25 22:37:32.012 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - null null
2025-09-25 22:37:32.148 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:37:32.314 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:37:32.319 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-09-25 22:37:32.328 +03:00 [INF] Route matched with {action = "GetAll", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentMethodsServices.PaymentMethodDto]]]] GetAll(System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-09-25 22:37:32.350 +03:00 [INF] Admin requested GetAll PaymentMethods | isActive: , isDeleted: , Page: 1, PageSize: 10
2025-09-25 22:37:32.357 +03:00 [INF] Getting cache for key: paymentmethods___page1_size10
2025-09-25 22:37:32.583 +03:00 [WRN] Cache miss for key: paymentmethods___page1_size10
2025-09-25 22:37:32.586 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-25 22:37:32.781 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM `PaymentMethods` AS `p`
2025-09-25 22:37:33.002 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`IsActive`, `p`.`PaymentProviderId`, `p`.`Method`, COALESCE(`p`.`IntegrationId`, '')
FROM `PaymentMethods` AS `p`
ORDER BY `p`.`Id`
LIMIT @__p_1 OFFSET @__p_0
2025-09-25 22:37:33.949 +03:00 [INF] Fetched payment methods from DB and cached result.
2025-09-25 22:37:33.953 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.Services.PaymentMethodsServices.PaymentMethodDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:37:33.965 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce) in 1632.9041ms
2025-09-25 22:37:33.967 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-09-25 22:37:33.970 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - 200 689 application/json; charset=utf-8 1961.378ms
2025-09-25 22:38:32.475 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Order?page=1&pageSize=10 - null null
2025-09-25 22:38:32.486 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:38:32.642 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:38:32.652 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.GetOrders (E-Commerce)'
2025-09-25 22:38:32.659 +03:00 [INF] Route matched with {action = "GetOrders", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.DtoModels.OrderDtos.OrderListDto]]]] GetOrders(System.String, System.Nullable`1[System.Boolean], Int32, Int32, System.Nullable`1[E_Commerce.Enums.OrderStatus]) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-25 22:38:32.954 +03:00 [INF] Executing GetOrders: role: True, userId: , deleted: , page: 1, size: 10, status: 
2025-09-25 22:38:32.966 +03:00 [INF] Filtering orders - UserId: null, Deleted: null, Page: 1, PageSize: 10, Status: null, IsAdmin: true
2025-09-25 22:38:32.976 +03:00 [INF] Getting cache for key: order:filter:user:all_deleted:all_page:1_size:10_status:all_IsAdmin:False
2025-09-25 22:38:33.198 +03:00 [WRN] Cache miss for key: order:filter:user:all_deleted:all_page:1_size:10_status:all_IsAdmin:False
2025-09-25 22:38:33.201 +03:00 [INF] Execute GetAll for entity Order
2025-09-25 22:38:33.415 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`OrderNumber`, `t0`.`Name`, `t`.`Status`, `t`.`Total`, `t`.`CreatedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`CustomerId`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Total`
    FROM `Orders` AS `o`
    ORDER BY `o`.`CreatedAt` DESC
    LIMIT @__p_1 OFFSET @__p_0
) AS `t`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t0` ON `t`.`CustomerId` = `t0`.`Id`
ORDER BY `t`.`CreatedAt` DESC
2025-09-25 22:38:34.358 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.OrderDtos.OrderListDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:38:34.372 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.GetOrders (E-Commerce) in 1701.4196ms
2025-09-25 22:38:34.466 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.GetOrders (E-Commerce)'
2025-09-25 22:38:34.487 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Order?page=1&pageSize=10 - 200 1739 application/json; charset=utf-8 2012.0283ms
2025-09-25 22:38:47.514 +03:00 [INF] 1 servers were removed due to timeout
2025-09-25 22:38:56.175 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json 182
2025-09-25 22:38:56.288 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:38:56.452 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:38:56.492 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-25 22:38:56.519 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-25 22:38:56.594 +03:00 [INF] Executing CreatePayment for order: ORD-20250925174613-1772
2025-09-25 22:38:56.608 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250925174613-1772 by user 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:38:56.858 +03:00 [INF] Getting order by number: ORD-20250925174613-1772
2025-09-25 22:38:56.948 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-25 22:38:57.094 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 22:38:57.114 +03:00 [INF] Getting payment method ID for enum "Wallet"
2025-09-25 22:38:57.116 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-25 22:38:57.201 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-25 22:38:57.208 +03:00 [INF] Found payment method ID 3 for enum "Wallet"
2025-09-25 22:38:57.211 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 3
2025-09-25 22:38:57.300 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:38:57.321 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 22:38:57.409 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-25 22:38:57.424 +03:00 [INF] Executing GetTokenAsync
2025-09-25 22:38:57.436 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-25 22:38:57.441 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-25 22:38:58.165 +03:00 [INF] Received HTTP response headers after 716.2052ms - 403
2025-09-25 22:38:58.171 +03:00 [INF] End processing HTTP request after 736.098ms - 403
2025-09-25 22:38:59.104 +03:00 [ERR] PayMob - Failed to retrieve auth token. Status: "Forbidden", Response: {"detail":"incorrect credentials"}
2025-09-25 22:38:59.107 +03:00 [ERR] Failed to get token for payment link generation
2025-09-25 22:38:59.110 +03:00 [ERR] Failed to get payment link for order 10: Authentication failed
2025-09-25 22:38:59.208 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:38:59.252 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 2725.6799ms
2025-09-25 22:38:59.317 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-25 22:38:59.356 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 400 204 application/json; charset=utf-8 3181.4087ms
2025-09-25 22:40:33.686 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentProvider?page=1&pageSize=10 - null null
2025-09-25 22:40:33.693 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:40:33.850 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:40:33.856 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentProviderController.GetAll (E-Commerce)'
2025-09-25 22:40:33.862 +03:00 [INF] Route matched with {action = "GetAll", controller = "PaymentProvider"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentProvidersServices.PaymentProviderDto]]]] GetAll(System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.PaymentProviderController (E-Commerce).
2025-09-25 22:40:33.875 +03:00 [INF] GetAll PaymentProviders | isDeleted: , Page: 1, PageSize: 10
2025-09-25 22:40:33.888 +03:00 [INF] Getting cache for key: paymentproviders__page1_size10
2025-09-25 22:40:34.106 +03:00 [WRN] Cache miss for key: paymentproviders__page1_size10
2025-09-25 22:40:34.127 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 22:40:34.295 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`DeletedAt` IS NOT NULL AS `IsDeleted`, COALESCE(`p`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt`, `p`.`ModifiedAt` AS `UpdatedAt`
FROM `PaymentProviders` AS `p`
ORDER BY `p`.`Id`
LIMIT @__p_1 OFFSET @__p_0
2025-09-25 22:40:35.237 +03:00 [INF] Fetched payment providers from DB and cached result.
2025-09-25 22:40:35.241 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.Services.PaymentProvidersServices.PaymentProviderDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:40:35.248 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentProviderController.GetAll (E-Commerce) in 1375.2894ms
2025-09-25 22:40:35.255 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentProviderController.GetAll (E-Commerce)'
2025-09-25 22:40:35.257 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentProvider?page=1&pageSize=10 - 200 220 application/json; charset=utf-8 1570.5189ms
2025-09-25 22:40:45.029 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentProvider/1 - null null
2025-09-25 22:40:45.229 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:40:45.395 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:40:45.410 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentProviderController.GetById (E-Commerce)'
2025-09-25 22:40:45.430 +03:00 [INF] Route matched with {action = "GetById", controller = "PaymentProvider"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.Services.PaymentProvidersServices.PaymentProviderDto]]] GetById(Int32, System.Nullable`1[System.Boolean]) on controller E_Commerce.Controllers.PaymentProviderController (E-Commerce).
2025-09-25 22:40:45.447 +03:00 [INF] Getting cache for key: paymentprovider_id_1_isDelete_
2025-09-25 22:40:45.670 +03:00 [WRN] Cache miss for key: paymentprovider_id_1_isDelete_
2025-09-25 22:40:45.674 +03:00 [INF] Querying DB for payment provider with ID 1
2025-09-25 22:40:45.677 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 22:40:45.843 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__8__locals1_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`DeletedAt` IS NOT NULL AS `IsDeleted`, COALESCE(`p`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt`, `p`.`ModifiedAt` AS `UpdatedAt`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Id` = @__8__locals1_id_0
LIMIT 1
2025-09-25 22:40:46.770 +03:00 [INF] Payment provider with ID 1 cached successfully.
2025-09-25 22:40:46.773 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.Services.PaymentProvidersServices.PaymentProviderDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:40:46.780 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentProviderController.GetById (E-Commerce) in 1338.0236ms
2025-09-25 22:40:46.789 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentProviderController.GetById (E-Commerce)'
2025-09-25 22:40:46.838 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentProvider/1 - 200 218 application/json; charset=utf-8 1808.4033ms
2025-09-25 22:40:52.151 +03:00 [INF] Setting cache for key: paymentprovider_id_1_isDelete_
2025-09-25 22:40:52.409 +03:00 [INF] Cache set successfully for key: paymentprovider_id_1_isDelete_ with tags: [PaymentProviderCache]
2025-09-25 22:43:02.784 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/PaymentProvider/1 - multipart/form-data; boundary=--------------------------603479976482519181643840 436
2025-09-25 22:43:02.793 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:43:02.959 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:43:02.976 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentProviderController.Update (E-Commerce)'
2025-09-25 22:43:02.995 +03:00 [INF] Route matched with {action = "Update", controller = "PaymentProvider"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] Update(Int32, E_Commerce.Services.PaymentProvidersServices.UpdatePaymentProviderDto) on controller E_Commerce.Controllers.PaymentProviderController (E-Commerce).
2025-09-25 22:43:03.261 +03:00 [INF] Executing GetByIdAsync for entity PaymentProvider with ID: 1
2025-09-25 22:43:03.350 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`ApiEndpoint`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Hmac`, `p`.`IframeId`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PrivateKey`, `p`.`Provider`, `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:43:03.389 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 22:43:03.488 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__ToLower_0='?' (Size = 50), @__id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `PaymentProviders` AS `p`
    WHERE ((LOWER(`p`.`Name`) = @__ToLower_0) AND (`p`.`Id` <> @__id_1)) AND `p`.`DeletedAt` IS NULL)
2025-09-25 22:43:03.497 +03:00 [INF] Execute AddAdminOpreationAsync
2025-09-25 22:43:03.499 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-09-25 22:43:03.505 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-09-25 22:43:03.685 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p6='?' (DbType = Int32), @p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime), @p3='?' (Size = 50), @p4='?' (DbType = Int32), @p5='?' (Size = 500), @p7='?' (Size = 255), @p8='?' (DbType = DateTime), @p9='?' (DbType = DateTime), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (DbType = DateTime), @p13='?' (DbType = Int32), @p14='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `PaymentProviders` SET `ApiEndpoint` = @p0, `IframeId` = @p1, `ModifiedAt` = @p2, `Name` = @p3, `Provider` = @p4, `PublicKey` = @p5
WHERE `Id` = @p6;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 22:43:04.795 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:43:04.799 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentProviderController.Update (E-Commerce) in 1789.023ms
2025-09-25 22:43:04.810 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentProviderController.Update (E-Commerce)'
2025-09-25 22:43:04.814 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/PaymentProvider/1 - 200 122 application/json; charset=utf-8 2029.3664ms
2025-09-25 22:43:06.654 +03:00 [INF] Removing cache by tag: PaymentProviderCache
2025-09-25 22:43:07.530 +03:00 [INF] Removed 2 cache entries for tag: PaymentProviderCache
2025-09-25 22:43:18.668 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json 182
2025-09-25 22:43:18.778 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:43:18.941 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:43:18.998 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-25 22:43:19.013 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-25 22:43:19.028 +03:00 [INF] Executing CreatePayment for order: ORD-20250925174613-1772
2025-09-25 22:43:19.029 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250925174613-1772 by user 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:43:19.262 +03:00 [INF] Getting order by number: ORD-20250925174613-1772
2025-09-25 22:43:19.342 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-25 22:43:19.425 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 22:43:19.432 +03:00 [INF] Getting payment method ID for enum "Wallet"
2025-09-25 22:43:19.433 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-25 22:43:19.514 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-25 22:43:19.526 +03:00 [INF] Found payment method ID 3 for enum "Wallet"
2025-09-25 22:43:19.528 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 3
2025-09-25 22:43:19.609 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:43:19.616 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 22:43:19.695 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-25 22:43:19.703 +03:00 [ERR] PayMob API key not found in database
2025-09-25 22:43:20.628 +03:00 [ERR] Failed to get token for payment link generation
2025-09-25 22:43:20.632 +03:00 [ERR] Failed to get payment link for order 10: Authentication failed
2025-09-25 22:43:20.716 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:43:20.723 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 1697.947ms
2025-09-25 22:43:20.727 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-25 22:43:20.729 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 400 204 application/json; charset=utf-8 2060.9668ms
2025-09-25 22:46:25.798 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 10
2025-09-25 22:46:25.997 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:46:26.093 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 22:46:26.286 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 22:46:31.998 +03:00 [INF] Order 10 auto-expired and restock scheduled
2025-09-25 22:46:33.065 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 22:46:33.292 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 22:46:33.308 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 10
2025-09-25 22:46:33.370 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 22:46:33.471 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:46:33.475 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 22:46:33.501 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 22:46:33.632 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 22:46:33.640 +03:00 [INF] Execute GetAll for entity OrderItem
2025-09-25 22:46:33.788 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 22:46:33.802 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-09-25 22:46:33.821 +03:00 [INF] Adding quantity for variant: 3
2025-09-25 22:46:33.944 +03:00 [INF] Removed 1 cache entries for tags: [order]
2025-09-25 22:46:34.015 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 22:46:34.124 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 22:46:34.132 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-25 22:46:34.151 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 3
2025-09-25 22:46:34.243 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:46:34.432 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 22:46:35.283 +03:00 [INF] Quantity for variant 3 increased by 1
2025-09-25 22:46:35.587 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 22:46:36.866 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-25 22:46:37.237 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 22:46:40.213 +03:00 [INF] Restocked inventory for order 10
2025-09-25 22:46:43.181 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 22:46:43.297 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-25 22:46:43.513 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-25 22:46:43.619 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 22:47:43.850 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-09-25 22:47:43.873 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 23.1374ms
2025-09-25 22:47:43.910 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-09-25 22:47:43.919 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 8.659ms
2025-09-25 22:47:43.920 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-25 22:47:43.929 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 22:47:43.938 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.662ms
2025-09-25 22:47:43.948 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 27.8688ms
2025-09-25 22:47:44.741 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-09-25 22:47:44.981 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 239.5289ms
2025-09-25 22:47:54.563 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentProvider/1 - null null
2025-09-25 22:47:54.573 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:47:54.728 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:47:54.736 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentProviderController.GetById (E-Commerce)'
2025-09-25 22:47:54.746 +03:00 [INF] Route matched with {action = "GetById", controller = "PaymentProvider"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.Services.PaymentProvidersServices.PaymentProviderDto]]] GetById(Int32, System.Nullable`1[System.Boolean]) on controller E_Commerce.Controllers.PaymentProviderController (E-Commerce).
2025-09-25 22:47:54.761 +03:00 [INF] Getting cache for key: paymentprovider_id_1_isDelete_
2025-09-25 22:47:54.980 +03:00 [WRN] Cache miss for key: paymentprovider_id_1_isDelete_
2025-09-25 22:47:54.984 +03:00 [INF] Querying DB for payment provider with ID 1
2025-09-25 22:47:54.986 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 22:47:55.153 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__8__locals1_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`DeletedAt` IS NOT NULL AS `IsDeleted`, COALESCE(`p`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt`, `p`.`ModifiedAt` AS `UpdatedAt`, `p`.`ApiEndpoint`, `p`.`Hmac`, `p`.`IframeId`, `p`.`PrivateKey`, `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Id` = @__8__locals1_id_0
LIMIT 1
2025-09-25 22:47:56.088 +03:00 [INF] Payment provider with ID 1 cached successfully.
2025-09-25 22:47:56.090 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.Services.PaymentProvidersServices.PaymentProviderDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:47:56.094 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentProviderController.GetById (E-Commerce) in 1340.9367ms
2025-09-25 22:47:56.096 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentProviderController.GetById (E-Commerce)'
2025-09-25 22:47:56.098 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentProvider/1 - 200 236 application/json; charset=utf-8 1535.2717ms
2025-09-25 22:47:57.909 +03:00 [INF] Setting cache for key: paymentprovider_id_1_isDelete_
2025-09-25 22:47:58.162 +03:00 [INF] Cache set successfully for key: paymentprovider_id_1_isDelete_ with tags: [PaymentProviderCache]
2025-09-25 22:48:18.581 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-09-25 22:48:20.227 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-25 22:48:20.932 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-25 22:48:21.108 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-09-25 22:48:21.130 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 22:48:21.151 +03:00 [INF] Starting data seeding...
2025-09-25 22:48:21.175 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 22:48:21.365 +03:00 [INF] DB tables already exist. Exit install
2025-09-25 22:48:21.812 +03:00 [INF] Executed DbCommand (105ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-25 22:48:21.874 +03:00 [INF] Role 'Admin' already exists.
2025-09-25 22:48:22.033 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-25 22:48:22.055 +03:00 [INF] Role 'User' already exists.
2025-09-25 22:48:22.235 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 22:48:22.261 +03:00 [INF] Admin user not found. Creating...
2025-09-25 22:48:22.523 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-09-25 22:48:22.770 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 22:48:22.780 +03:00 [ERR] Failed to create admin user: Username 'Omargamal1132004@gmail.com' is already taken., Email 'Omargamal1132004@gmail.com' is already taken.
2025-09-25 22:48:24.029 +03:00 [INF] Now listening on: http://localhost:5069
2025-09-25 22:48:24.154 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-09-25 22:48:24.265 +03:00 [INF] Using the following options for SQL Server job storage:
2025-09-25 22:48:24.269 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-09-25 22:48:24.272 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-09-25 22:48:24.461 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 22:48:24.485 +03:00 [INF] Hosting environment: Development
2025-09-25 22:48:24.489 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-09-25 22:48:24.564 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-09-25 22:48:24.635 +03:00 [INF] Server mrrobot:2676:74ddc422 successfully announced in 160.8135 ms
2025-09-25 22:48:24.678 +03:00 [INF] Server mrrobot:2676:74ddc422 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-09-25 22:48:24.819 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 254.9418ms
2025-09-25 22:48:25.084 +03:00 [INF] Server mrrobot:2676:74ddc422 all the dispatchers started
2025-09-25 22:48:25.462 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-09-25 22:48:25.569 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 108.198ms
2025-09-25 22:48:25.610 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-25 22:48:25.623 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 22:48:25.629 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.9053ms
2025-09-25 22:48:25.676 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 66.2196ms
2025-09-25 22:48:26.016 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-09-25 22:48:26.254 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 237.9077ms
2025-09-25 22:49:17.028 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentProvider/1 - null null
2025-09-25 22:49:17.035 +03:00 [WRN] Failed to determine the https port for redirect.
2025-09-25 22:49:17.216 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:49:17.422 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:49:17.435 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentProviderController.GetById (E-Commerce)'
2025-09-25 22:49:17.466 +03:00 [INF] Route matched with {action = "GetById", controller = "PaymentProvider"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.Services.PaymentProvidersServices.PaymentProviderDto]]] GetById(Int32, System.Nullable`1[System.Boolean]) on controller E_Commerce.Controllers.PaymentProviderController (E-Commerce).
2025-09-25 22:49:17.572 +03:00 [INF] Getting cache for key: paymentprovider_id_1_isDelete_
2025-09-25 22:49:17.792 +03:00 [INF] Cache hit for key: paymentprovider_id_1_isDelete_
2025-09-25 22:49:17.812 +03:00 [INF] Payment provider with ID 1 fetched from cache.
2025-09-25 22:49:17.836 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.Services.PaymentProvidersServices.PaymentProviderDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:49:17.869 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentProviderController.GetById (E-Commerce) in 394.9414ms
2025-09-25 22:49:17.900 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentProviderController.GetById (E-Commerce)'
2025-09-25 22:49:17.907 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentProvider/1 - 200 336 application/json; charset=utf-8 879.3699ms
2025-09-25 22:50:47.979 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/PaymentProvider/1 - multipart/form-data; boundary=--------------------------194078283519593943385479 908
2025-09-25 22:50:48.053 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:50:48.213 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:50:48.268 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentProviderController.Update (E-Commerce)'
2025-09-25 22:50:48.276 +03:00 [INF] Route matched with {action = "Update", controller = "PaymentProvider"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] Update(Int32, E_Commerce.Services.PaymentProvidersServices.UpdatePaymentProviderDto) on controller E_Commerce.Controllers.PaymentProviderController (E-Commerce).
2025-09-25 22:50:48.585 +03:00 [INF] Executing GetByIdAsync for entity PaymentProvider with ID: 1
2025-09-25 22:50:48.673 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`ApiEndpoint`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Hmac`, `p`.`IframeId`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PrivateKey`, `p`.`Provider`, `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:50:48.715 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 22:50:48.840 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__ToLower_0='?' (Size = 50), @__id_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `PaymentProviders` AS `p`
    WHERE ((LOWER(`p`.`Name`) = @__ToLower_0) AND (`p`.`Id` <> @__id_1)) AND `p`.`DeletedAt` IS NULL)
2025-09-25 22:50:48.852 +03:00 [INF] Execute AddAdminOpreationAsync
2025-09-25 22:50:48.857 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-09-25 22:50:48.922 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-09-25 22:50:49.222 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p5='?' (DbType = Int32), @p0='?' (Size = 100), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime), @p3='?' (Size = 50), @p4='?' (DbType = Int32), @p6='?' (Size = 255), @p7='?' (DbType = DateTime), @p8='?' (DbType = DateTime), @p9='?' (Size = 4000), @p10='?' (Size = 4000), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `PaymentProviders` SET `ApiEndpoint` = @p0, `IframeId` = @p1, `ModifiedAt` = @p2, `Name` = @p3, `Provider` = @p4
WHERE `Id` = @p5;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 22:50:50.405 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:50:50.413 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentProviderController.Update (E-Commerce) in 2133.4212ms
2025-09-25 22:50:50.420 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentProviderController.Update (E-Commerce)'
2025-09-25 22:50:50.426 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/PaymentProvider/1 - 200 122 application/json; charset=utf-8 2446.5048ms
2025-09-25 22:50:51.871 +03:00 [INF] Removing cache by tag: PaymentProviderCache
2025-09-25 22:50:52.528 +03:00 [INF] Removed 1 cache entries for tag: PaymentProviderCache
2025-09-25 22:50:57.411 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentProvider/1 - null null
2025-09-25 22:50:57.588 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:50:57.746 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:50:57.759 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentProviderController.GetById (E-Commerce)'
2025-09-25 22:50:57.762 +03:00 [INF] Route matched with {action = "GetById", controller = "PaymentProvider"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.Services.PaymentProvidersServices.PaymentProviderDto]]] GetById(Int32, System.Nullable`1[System.Boolean]) on controller E_Commerce.Controllers.PaymentProviderController (E-Commerce).
2025-09-25 22:50:57.776 +03:00 [INF] Getting cache for key: paymentprovider_id_1_isDelete_
2025-09-25 22:50:58.006 +03:00 [WRN] Cache miss for key: paymentprovider_id_1_isDelete_
2025-09-25 22:50:58.008 +03:00 [INF] Querying DB for payment provider with ID 1
2025-09-25 22:50:58.010 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 22:50:58.214 +03:00 [INF] Executed DbCommand (97ms) [Parameters=[@__8__locals1_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`DeletedAt` IS NOT NULL AS `IsDeleted`, COALESCE(`p`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt`, `p`.`ModifiedAt` AS `UpdatedAt`, `p`.`ApiEndpoint`, `p`.`Hmac`, `p`.`IframeId`, `p`.`PrivateKey`, `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Id` = @__8__locals1_id_0
LIMIT 1
2025-09-25 22:50:59.255 +03:00 [INF] Payment provider with ID 1 cached successfully.
2025-09-25 22:50:59.260 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.Services.PaymentProvidersServices.PaymentProviderDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:50:59.267 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentProviderController.GetById (E-Commerce) in 1492.3452ms
2025-09-25 22:50:59.296 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentProviderController.GetById (E-Commerce)'
2025-09-25 22:50:59.360 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentProvider/1 - 200 641 application/json; charset=utf-8 1949.9805ms
2025-09-25 22:51:02.010 +03:00 [INF] Setting cache for key: paymentprovider_id_1_isDelete_
2025-09-25 22:51:02.239 +03:00 [INF] Cache set successfully for key: paymentprovider_id_1_isDelete_ with tags: [PaymentProviderCache]
2025-09-25 22:51:22.785 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json 182
2025-09-25 22:51:22.795 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:51:22.953 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:51:22.961 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-25 22:51:22.973 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-25 22:51:23.256 +03:00 [INF] Executing CreatePayment for order: ORD-20250925174613-1772
2025-09-25 22:51:23.268 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250925174613-1772 by user 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:51:23.517 +03:00 [INF] Getting order by number: ORD-20250925174613-1772
2025-09-25 22:51:23.603 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-25 22:51:23.739 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 22:51:23.745 +03:00 [WRN] Order 10 is not eligible for payment. Current status: "PaymentExpired"
2025-09-25 22:51:23.838 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:51:23.845 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 866.6001ms
2025-09-25 22:51:23.877 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-25 22:51:23.909 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 400 266 application/json; charset=utf-8 1123.2114ms
2025-09-25 22:51:48.997 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 62
2025-09-25 22:51:49.008 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:51:49.164 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:51:49.173 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-25 22:51:49.188 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-25 22:51:49.205 +03:00 [INF] Executing AddItemToCart for product ID: 6
2025-09-25 22:51:49.219 +03:00 [INF] Adding item to cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9, product: 6
2025-09-25 22:51:49.541 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 22:51:49.549 +03:00 [INF] Execute GetAll for entity Product
2025-09-25 22:51:49.725 +03:00 [INF] Executed DbCommand (95ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-09-25 22:51:49.825 +03:00 [INF] Executing NotFoundObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:51:49.828 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 632.8186ms
2025-09-25 22:51:49.842 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-25 22:51:49.846 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 404 239 application/json; charset=utf-8 848.5644ms
2025-09-25 22:51:56.810 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 62
2025-09-25 22:51:56.833 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:51:56.996 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:51:57.005 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-25 22:51:57.007 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-25 22:51:57.014 +03:00 [INF] Executing AddItemToCart for product ID: 3
2025-09-25 22:51:57.016 +03:00 [INF] Adding item to cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9, product: 3
2025-09-25 22:51:57.324 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 22:51:57.332 +03:00 [INF] Execute GetAll for entity Product
2025-09-25 22:51:57.416 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-09-25 22:51:57.437 +03:00 [INF] Retrieving cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:51:57.560 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-25 22:51:57.668 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Cart WHERE Id = @p0 FOR UPDATE
2025-09-25 22:51:57.676 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-09-25 22:51:57.709 +03:00 [INF] CartItem added successfully (pending save)
2025-09-25 22:51:57.722 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-25 22:51:57.726 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-25 22:51:57.746 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-25 22:51:58.886 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (DbType = Int32), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`, `RowVersion`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 22:51:59.052 +03:00 [INF] Removing cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:51:59.480 +03:00 [INF] Cache removed successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:51:59.483 +03:00 [INF] Item added to cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9, product: 3
2025-09-25 22:51:59.485 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:51:59.487 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 2474.5708ms
2025-09-25 22:51:59.491 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-25 22:51:59.496 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 2687.9953ms
2025-09-25 22:52:03.588 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 1
2025-09-25 22:52:03.756 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:52:03.918 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-25 22:52:07.129 +03:00 [INF] Removing cache by tag: cart
2025-09-25 22:52:07.774 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-09-25 22:52:14.149 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - null 0
2025-09-25 22:52:14.163 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:52:14.323 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:52:14.330 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-25 22:52:14.338 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-25 22:52:14.360 +03:00 [INF] Executing CheckOut
2025-09-25 22:52:14.373 +03:00 [INF] Checkout of cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:52:14.378 +03:00 [INF] Retrieving cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:52:14.536 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-25 22:52:14.732 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-25 22:52:14.738 +03:00 [INF] Removing cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:52:14.741 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:52:14.743 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 399.9251ms
2025-09-25 22:52:14.746 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-25 22:52:14.748 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - 200 122 application/json; charset=utf-8 598.7118ms
2025-09-25 22:52:15.163 +03:00 [INF] Cache removed successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:52:20.937 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json 42
2025-09-25 22:52:20.944 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:52:21.101 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:52:21.108 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-25 22:52:21.113 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-25 22:52:21.129 +03:00 [INF] Executing CreateOrder
2025-09-25 22:52:21.147 +03:00 [INF] Creating order from cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:52:21.461 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 22:52:21.547 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-25 22:52:21.559 +03:00 [INF] Checking if address 31 exists for customer: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:52:21.644 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-09-25 22:52:21.726 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:52:21.731 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 613.6153ms
2025-09-25 22:52:21.735 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-25 22:52:21.742 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 400 204 application/json; charset=utf-8 804.3628ms
2025-09-25 22:52:26.470 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json 41
2025-09-25 22:52:26.630 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:52:26.783 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:52:26.788 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-25 22:52:26.790 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-25 22:52:26.795 +03:00 [INF] Executing CreateOrder
2025-09-25 22:52:26.796 +03:00 [INF] Creating order from cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:52:27.100 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 22:52:27.183 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-25 22:52:27.189 +03:00 [INF] Checking if address 1 exists for customer: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:52:27.267 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-09-25 22:52:27.281 +03:00 [INF] Getting cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:52:27.289 +03:00 [INF] Getting cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:52:27.505 +03:00 [WRN] Cache miss for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:52:27.584 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-25 22:52:27.589 +03:00 [INF] Execute GetAll for entity Cart
2025-09-25 22:52:27.737 +03:00 [INF] Executed DbCommand (92ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-09-25 22:52:27.748 +03:00 [INF] Setting cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:52:27.995 +03:00 [INF] Cache set successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9 with tags: [cart]
2025-09-25 22:52:28.005 +03:00 [INF] Execute GetAll for entity ProductVariant
2025-09-25 22:52:28.110 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE `p`.`Id` = 3
2025-09-25 22:52:28.199 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-09-25 22:52:28.208 +03:00 [INF] Executing CreateAsync for entity Order
2025-09-25 22:52:28.217 +03:00 [INF] Order added successfully (pending save)
2025-09-25 22:52:28.393 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = Decimal), @p13='?' (DbType = Int32), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal), @p16='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `RestockedAt`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`, `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 22:52:28.484 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-09-25 22:52:28.512 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-09-25 22:52:28.526 +03:00 [INF] Removing 1 from variant: 3
2025-09-25 22:52:28.607 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity - @p0 WHERE Id = @p1 AND Quantity >= @p0
2025-09-25 22:52:28.622 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 3
2025-09-25 22:52:28.710 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:52:29.718 +03:00 [INF] Clearing cart: 1
2025-09-25 22:52:29.802 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-09-25 22:52:29.811 +03:00 [INF] Cart 1 cleared successfully
2025-09-25 22:52:29.991 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 8) (DbType = Binary), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = Decimal), @p11='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0 AND `RowVersion` IS NULL;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 22:52:30.161 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-25 22:52:30.163 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-25 22:52:30.165 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-25 22:52:30.167 +03:00 [INF] Execute GetAll for entity Order
2025-09-25 22:52:30.227 +03:00 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-09-25 22:52:30.423 +03:00 [INF] Executed DbCommand (101ms) [Parameters=[@__createdOrder_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`DeletedAt`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`Id0`, `t0`.`Id1`, `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`, `t1`.`Status`, `t1`.`Amount`, `t1`.`CreatedAt`, `t1`.`Id`, `t1`.`PaymentDate`, `t1`.`PaymentMethodId`, `t1`.`PaymentProviderId`, `t1`.`Name`, `t1`.`Id0`, `t0`.`c`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t0`.`AdditionalNotes`, `t0`.`AddressType`, `t0`.`City`, `t0`.`Country`, `t0`.`CreatedAt0`, `t0`.`CustomerId`, `t0`.`StreetAddress`, `t0`.`State`, `t0`.`PhoneNumber0`, `t0`.`IsDefault`, `t0`.`ModifiedAt0`, `t0`.`PostalCode`, `t2`.`Id`, `t2`.`CreatedAt`, `t2`.`ModifiedAt`, `t2`.`Quantity`, `t2`.`UnitPrice`, `t2`.`TotalPrice`, `t2`.`OrderedAt`, `t2`.`Id0`, `t2`.`Name`, `t2`.`Price`, `t2`.`IsActive`, `t2`.`FinalPrice`, `t2`.`DiscountPrecentage`, `t2`.`MainImageUrl`, `t2`.`Id1`, `t2`.`Color`, `t2`.`CreatedAt0`, `t2`.`ModifiedAt0`, `t2`.`Size`, `t2`.`DeletedAt`, `t2`.`Length`, `t2`.`Waist`, `t2`.`Id2`, `t2`.`Id3`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`DeletedAt`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`, `c`.`Id` AS `Id1`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt` AS `CreatedAt0`, `c`.`CustomerId`, `c`.`StreetAddress`, `c`.`State`, `c`.`PhoneNumber` AS `PhoneNumber0`, `c`.`IsDefault`, `c`.`ModifiedAt` AS `ModifiedAt0`, `c`.`PostalCode`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    INNER JOIN `CustomerAddresses` AS `c` ON `o`.`CustomerAddressId` = `c`.`Id`
    WHERE `o`.`Id` = @__createdOrder_Id_0
    LIMIT 1
) AS `t0`
LEFT JOIN `Payments` AS `p` ON `t0`.`Id` = `p`.`OrderId`
LEFT JOIN (
    SELECT `p0`.`Status`, `p0`.`Amount`, `p0`.`CreatedAt`, `p0`.`Id`, `p0`.`PaymentDate`, `p0`.`PaymentMethodId`, `p0`.`PaymentProviderId`, `p1`.`Name`, `p1`.`Id` AS `Id0`, `p0`.`OrderId`
    FROM `Payments` AS `p0`
    INNER JOIN `PaymentMethods` AS `p1` ON `p0`.`PaymentMethodId` = `p1`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p2`.`Id` AS `Id0`, `p2`.`Name`, `p2`.`Price`, `p2`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p2`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p2`.`Price`))
        ELSE `p2`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p2`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p3`.`Color`, COALESCE(`p3`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p3`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p3`.`Size`, `p3`.`DeletedAt`, COALESCE(`p3`.`Length`, 0) AS `Length`, COALESCE(`p3`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p3`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p2` ON `o0`.`ProductId` = `p2`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p2`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p3` ON `o0`.`ProductVariantId` = `p3`.`Id`
) AS `t2` ON `t0`.`Id` = `t2`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`, `p`.`Id`, `t1`.`Id`, `t1`.`Id0`, `t2`.`Id`, `t2`.`Id0`, `t2`.`Id2`
2025-09-25 22:52:31.583 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-25 22:52:31.946 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 22:52:35.260 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-25 22:52:35.477 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-25 22:52:35.885 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:52:35.934 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 9140.4115ms
2025-09-25 22:52:35.940 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-25 22:52:35.945 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 201 1843 application/json; charset=utf-8 9475.1754ms
2025-09-25 22:53:25.191 +03:00 [INF] 1 servers were removed due to timeout
2025-09-25 22:53:32.264 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json 182
2025-09-25 22:53:32.269 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:53:32.428 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:53:32.437 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-25 22:53:32.440 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-25 22:53:32.450 +03:00 [INF] Executing CreatePayment for order: ORD-20250925195228-1890
2025-09-25 22:53:32.453 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250925195228-1890 by user 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:53:32.686 +03:00 [INF] Getting order by number: ORD-20250925195228-1890
2025-09-25 22:53:32.767 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-25 22:53:32.852 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 22:53:32.862 +03:00 [INF] Getting payment method ID for enum "Wallet"
2025-09-25 22:53:32.865 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-25 22:53:32.956 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-25 22:53:32.965 +03:00 [INF] Found payment method ID 3 for enum "Wallet"
2025-09-25 22:53:32.970 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 3
2025-09-25 22:53:33.053 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:53:33.094 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 22:53:33.179 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-25 22:53:33.188 +03:00 [INF] Executing GetTokenAsync
2025-09-25 22:53:33.193 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-25 22:53:33.202 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-25 22:53:34.349 +03:00 [INF] Received HTTP response headers after 1140.3381ms - 201
2025-09-25 22:53:34.356 +03:00 [INF] End processing HTTP request after 1164.1213ms - 201
2025-09-25 22:53:34.363 +03:00 [INF] Successfully retrieved PayMob token
2025-09-25 22:53:34.445 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 22:53:34.460 +03:00 [INF] Getting address by ID: 1
2025-09-25 22:53:34.554 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-25 22:53:34.603 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-25 22:53:34.606 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-25 22:53:34.821 +03:00 [INF] Received HTTP response headers after 210.1735ms - 201
2025-09-25 22:53:34.826 +03:00 [INF] End processing HTTP request after 223.6146ms - 201
2025-09-25 22:53:34.839 +03:00 [INF] Successfully created PayMob order: 391383289 for local order: ORD-20250925195228-1890
2025-09-25 22:53:34.842 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-25 22:53:34.924 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-25 22:53:34.928 +03:00 [INF] Using integration ID: 5236287 for payment method: "Wallet"
2025-09-25 22:53:34.932 +03:00 [INF] https://last-update-vjh1.vercel.app/orders
2025-09-25 22:53:34.937 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 391383289, Amount: 108000
2025-09-25 22:53:34.943 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-25 22:53:34.948 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-25 22:53:35.192 +03:00 [INF] Received HTTP response headers after 242.3527ms - 201
2025-09-25 22:53:35.197 +03:00 [INF] End processing HTTP request after 253.5117ms - 201
2025-09-25 22:53:35.200 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-25 22:53:35.202 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-25 22:53:35.206 +03:00 [INF] Payment key generated successfully for Order ID: 391383289
2025-09-25 22:53:35.209 +03:00 [INF] Successfully generated payment key for order: ORD-20250925195228-1890
2025-09-25 22:53:35.217 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payments/pay
2025-09-25 22:53:35.222 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payments/pay
2025-09-25 22:53:35.811 +03:00 [INF] Received HTTP response headers after 584.9185ms - 200
2025-09-25 22:53:35.815 +03:00 [INF] End processing HTTP request after 598.3745ms - 200
2025-09-25 22:53:35.821 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-25 22:53:35.856 +03:00 [INF] Payment added successfully (pending save)
2025-09-25 22:53:36.043 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 22:53:36.136 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-25 22:53:36.141 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-25 22:53:36.143 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-25 22:53:36.303 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 22:53:36.459 +03:00 [INF] Payment created successfully with ID 1
2025-09-25 22:53:37.382 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:53:37.388 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 4941.1889ms
2025-09-25 22:53:37.406 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-25 22:53:37.441 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 200 621 application/json; charset=utf-8 5176.612ms
2025-09-25 22:54:02.053 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json 182
2025-09-25 22:54:02.060 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:54:02.216 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:54:02.226 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-25 22:54:02.229 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-25 22:54:02.261 +03:00 [INF] Executing CreatePayment for order: ORD-20250925195228-1890
2025-09-25 22:54:02.264 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250925195228-1890 by user 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:54:02.499 +03:00 [INF] Getting order by number: ORD-20250925195228-1890
2025-09-25 22:54:02.581 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-25 22:54:02.665 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 22:54:02.673 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-25 22:54:02.676 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-25 22:54:02.755 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-25 22:54:02.761 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-25 22:54:02.766 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-25 22:54:02.845 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:54:02.852 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 22:54:02.932 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-25 22:54:02.948 +03:00 [INF] Executing GetTokenAsync
2025-09-25 22:54:02.950 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-25 22:54:02.956 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-25 22:54:03.180 +03:00 [INF] Received HTTP response headers after 217.0692ms - 201
2025-09-25 22:54:03.183 +03:00 [INF] End processing HTTP request after 232.792ms - 201
2025-09-25 22:54:03.185 +03:00 [INF] Successfully retrieved PayMob token
2025-09-25 22:54:03.270 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 22:54:03.277 +03:00 [INF] Getting address by ID: 1
2025-09-25 22:54:03.365 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-25 22:54:03.375 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-25 22:54:03.378 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-25 22:54:03.583 +03:00 [INF] Received HTTP response headers after 203.0319ms - 422
2025-09-25 22:54:03.588 +03:00 [INF] End processing HTTP request after 213.8557ms - 422
2025-09-25 22:54:04.502 +03:00 [ERR] Failed to create order in PayMob. Status: "UnprocessableEntity", Error: {"message":"duplicate"}
2025-09-25 22:54:04.505 +03:00 [ERR] Failed to create order in PayMob for OrderId: ORD-20250925195228-1890
2025-09-25 22:54:04.507 +03:00 [ERR] Failed to get payment link for order 11: Failed to create payment order
2025-09-25 22:54:04.586 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:54:04.591 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 2356.1054ms
2025-09-25 22:54:04.599 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-25 22:54:04.615 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 400 222 application/json; charset=utf-8 2561.1962ms
2025-09-25 22:54:50.539 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 62
2025-09-25 22:54:50.545 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:54:50.702 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:54:50.707 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-25 22:54:50.708 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-25 22:54:50.712 +03:00 [INF] Executing AddItemToCart for product ID: 3
2025-09-25 22:54:50.713 +03:00 [INF] Adding item to cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9, product: 3
2025-09-25 22:54:51.016 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 22:54:51.025 +03:00 [INF] Execute GetAll for entity Product
2025-09-25 22:54:51.119 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-09-25 22:54:51.203 +03:00 [INF] Retrieving cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:54:51.297 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-25 22:54:51.541 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Cart WHERE Id = @p0 FOR UPDATE
2025-09-25 22:54:51.548 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-09-25 22:54:51.550 +03:00 [INF] CartItem added successfully (pending save)
2025-09-25 22:54:51.552 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-25 22:54:51.554 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-25 22:54:51.559 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-25 22:54:52.632 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (DbType = Int32), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`, `RowVersion`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 22:54:52.815 +03:00 [INF] Removing cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:54:53.240 +03:00 [INF] Cache removed successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:54:53.243 +03:00 [INF] Item added to cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9, product: 3
2025-09-25 22:54:53.246 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:54:53.250 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 2538.861ms
2025-09-25 22:54:53.254 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-25 22:54:53.257 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 2718.3682ms
2025-09-25 22:54:53.848 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 1
2025-09-25 22:54:54.041 +03:00 [INF] Executed DbCommand (106ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:54:54.467 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-25 22:54:55.382 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - null 0
2025-09-25 22:54:55.400 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:54:55.562 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:54:55.583 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-25 22:54:55.585 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-25 22:54:55.609 +03:00 [INF] Executing CheckOut
2025-09-25 22:54:55.617 +03:00 [INF] Checkout of cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:54:55.638 +03:00 [INF] Retrieving cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:54:55.805 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-25 22:54:55.962 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-25 22:54:55.969 +03:00 [INF] Removing cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:54:55.972 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:54:55.979 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 370.5231ms
2025-09-25 22:54:55.982 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-25 22:54:55.984 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - 200 122 application/json; charset=utf-8 602.0866ms
2025-09-25 22:54:56.394 +03:00 [INF] Cache removed successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:54:58.405 +03:00 [INF] Removing cache by tag: cart
2025-09-25 22:54:58.619 +03:00 [WRN] No cache entries found for tag: cart
2025-09-25 22:55:03.564 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json 41
2025-09-25 22:55:03.912 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:55:04.070 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:55:04.077 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-25 22:55:04.078 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-25 22:55:04.083 +03:00 [INF] Executing CreateOrder
2025-09-25 22:55:04.085 +03:00 [INF] Creating order from cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:55:04.428 +03:00 [INF] Executed DbCommand (101ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 22:55:04.701 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-25 22:55:04.706 +03:00 [INF] Checking if address 1 exists for customer: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:55:04.784 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-09-25 22:55:04.789 +03:00 [INF] Getting cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:55:04.793 +03:00 [INF] Getting cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:55:05.008 +03:00 [WRN] Cache miss for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:55:05.087 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-25 22:55:05.094 +03:00 [INF] Execute GetAll for entity Cart
2025-09-25 22:55:05.184 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-09-25 22:55:05.212 +03:00 [INF] Setting cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:55:05.495 +03:00 [INF] Cache set successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9 with tags: [cart]
2025-09-25 22:55:05.578 +03:00 [INF] Execute GetAll for entity ProductVariant
2025-09-25 22:55:05.660 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE `p`.`Id` = 3
2025-09-25 22:55:05.741 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-09-25 22:55:05.748 +03:00 [INF] Executing CreateAsync for entity Order
2025-09-25 22:55:05.751 +03:00 [INF] Order added successfully (pending save)
2025-09-25 22:55:05.912 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = Decimal), @p13='?' (DbType = Int32), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal), @p16='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `RestockedAt`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`, `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 22:55:05.994 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-09-25 22:55:05.999 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-09-25 22:55:06.001 +03:00 [INF] Removing 1 from variant: 3
2025-09-25 22:55:06.080 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity - @p0 WHERE Id = @p1 AND Quantity >= @p0
2025-09-25 22:55:06.087 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 3
2025-09-25 22:55:06.164 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:55:07.091 +03:00 [INF] Clearing cart: 1
2025-09-25 22:55:07.170 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-09-25 22:55:07.178 +03:00 [INF] Cart 1 cleared successfully
2025-09-25 22:55:07.333 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 8) (DbType = Binary), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = Decimal), @p11='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0 AND `RowVersion` IS NULL;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 22:55:07.491 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-25 22:55:07.494 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-25 22:55:07.498 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-25 22:55:07.501 +03:00 [INF] Execute GetAll for entity Order
2025-09-25 22:55:07.671 +03:00 [INF] Executed DbCommand (92ms) [Parameters=[@__createdOrder_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`DeletedAt`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`Id0`, `t0`.`Id1`, `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`, `t1`.`Status`, `t1`.`Amount`, `t1`.`CreatedAt`, `t1`.`Id`, `t1`.`PaymentDate`, `t1`.`PaymentMethodId`, `t1`.`PaymentProviderId`, `t1`.`Name`, `t1`.`Id0`, `t0`.`c`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t0`.`AdditionalNotes`, `t0`.`AddressType`, `t0`.`City`, `t0`.`Country`, `t0`.`CreatedAt0`, `t0`.`CustomerId`, `t0`.`StreetAddress`, `t0`.`State`, `t0`.`PhoneNumber0`, `t0`.`IsDefault`, `t0`.`ModifiedAt0`, `t0`.`PostalCode`, `t2`.`Id`, `t2`.`CreatedAt`, `t2`.`ModifiedAt`, `t2`.`Quantity`, `t2`.`UnitPrice`, `t2`.`TotalPrice`, `t2`.`OrderedAt`, `t2`.`Id0`, `t2`.`Name`, `t2`.`Price`, `t2`.`IsActive`, `t2`.`FinalPrice`, `t2`.`DiscountPrecentage`, `t2`.`MainImageUrl`, `t2`.`Id1`, `t2`.`Color`, `t2`.`CreatedAt0`, `t2`.`ModifiedAt0`, `t2`.`Size`, `t2`.`DeletedAt`, `t2`.`Length`, `t2`.`Waist`, `t2`.`Id2`, `t2`.`Id3`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`DeletedAt`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`, `c`.`Id` AS `Id1`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt` AS `CreatedAt0`, `c`.`CustomerId`, `c`.`StreetAddress`, `c`.`State`, `c`.`PhoneNumber` AS `PhoneNumber0`, `c`.`IsDefault`, `c`.`ModifiedAt` AS `ModifiedAt0`, `c`.`PostalCode`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    INNER JOIN `CustomerAddresses` AS `c` ON `o`.`CustomerAddressId` = `c`.`Id`
    WHERE `o`.`Id` = @__createdOrder_Id_0
    LIMIT 1
) AS `t0`
LEFT JOIN `Payments` AS `p` ON `t0`.`Id` = `p`.`OrderId`
LEFT JOIN (
    SELECT `p0`.`Status`, `p0`.`Amount`, `p0`.`CreatedAt`, `p0`.`Id`, `p0`.`PaymentDate`, `p0`.`PaymentMethodId`, `p0`.`PaymentProviderId`, `p1`.`Name`, `p1`.`Id` AS `Id0`, `p0`.`OrderId`
    FROM `Payments` AS `p0`
    INNER JOIN `PaymentMethods` AS `p1` ON `p0`.`PaymentMethodId` = `p1`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p2`.`Id` AS `Id0`, `p2`.`Name`, `p2`.`Price`, `p2`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p2`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p2`.`Price`))
        ELSE `p2`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p2`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p3`.`Color`, COALESCE(`p3`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p3`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p3`.`Size`, `p3`.`DeletedAt`, COALESCE(`p3`.`Length`, 0) AS `Length`, COALESCE(`p3`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p3`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p2` ON `o0`.`ProductId` = `p2`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p2`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p3` ON `o0`.`ProductVariantId` = `p3`.`Id`
) AS `t2` ON `t0`.`Id` = `t2`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`, `p`.`Id`, `t1`.`Id`, `t1`.`Id0`, `t2`.`Id`, `t2`.`Id0`, `t2`.`Id2`
2025-09-25 22:55:09.741 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-25 22:55:09.948 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 22:55:10.050 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 22:55:10.168 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-25 22:55:11.907 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 22:55:12.334 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 22:55:13.113 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 22:55:13.123 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-25 22:55:13.152 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:55:13.162 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 9079.8355ms
2025-09-25 22:55:13.167 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-25 22:55:13.169 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 201 1843 application/json; charset=utf-8 9605.2831ms
2025-09-25 22:55:13.340 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-25 22:55:13.462 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-25 22:55:13.503 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 22:55:13.652 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 22:55:13.680 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-25 22:55:13.764 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 22:55:14.204 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 22:55:14.427 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 22:55:15.613 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 22:55:16.262 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 22:55:29.305 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json 182
2025-09-25 22:55:29.311 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:55:29.469 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:55:29.476 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-25 22:55:29.478 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-25 22:55:29.486 +03:00 [INF] Executing CreatePayment for order: ORD-20250925195505-3184
2025-09-25 22:55:29.491 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250925195505-3184 by user 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:55:29.722 +03:00 [INF] Getting order by number: ORD-20250925195505-3184
2025-09-25 22:55:29.804 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-25 22:55:29.888 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 22:55:29.898 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-25 22:55:29.900 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-25 22:55:29.979 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-25 22:55:29.988 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-25 22:55:29.993 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-25 22:55:30.073 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:55:30.079 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 22:55:30.162 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-25 22:55:30.170 +03:00 [INF] Executing GetTokenAsync
2025-09-25 22:55:30.172 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-25 22:55:30.178 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-25 22:55:30.757 +03:00 [INF] Received HTTP response headers after 574.3826ms - 201
2025-09-25 22:55:30.762 +03:00 [INF] End processing HTTP request after 589.8432ms - 201
2025-09-25 22:55:30.767 +03:00 [INF] Successfully retrieved PayMob token
2025-09-25 22:55:30.847 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 22:55:30.855 +03:00 [INF] Getting address by ID: 1
2025-09-25 22:55:30.939 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-25 22:55:30.947 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-25 22:55:30.950 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-25 22:55:31.156 +03:00 [INF] Received HTTP response headers after 201.9099ms - 201
2025-09-25 22:55:31.159 +03:00 [INF] End processing HTTP request after 211.3831ms - 201
2025-09-25 22:55:31.162 +03:00 [INF] Successfully created PayMob order: 391384316 for local order: ORD-20250925195505-3184
2025-09-25 22:55:31.166 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-25 22:55:31.245 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-25 22:55:31.253 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-25 22:55:31.256 +03:00 [INF] https://last-update-vjh1.vercel.app/orders
2025-09-25 22:55:31.259 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 391384316, Amount: 108000
2025-09-25 22:55:31.262 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-25 22:55:31.266 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-25 22:55:31.487 +03:00 [INF] Received HTTP response headers after 218.2178ms - 201
2025-09-25 22:55:31.492 +03:00 [INF] End processing HTTP request after 230.4714ms - 201
2025-09-25 22:55:31.497 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-25 22:55:31.499 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-25 22:55:31.501 +03:00 [INF] Payment key generated successfully for Order ID: 391384316
2025-09-25 22:55:31.503 +03:00 [INF] Successfully generated payment key for order: ORD-20250925195505-3184
2025-09-25 22:55:31.506 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 22:55:31.588 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-25 22:55:31.596 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-25 22:55:31.598 +03:00 [INF] Payment added successfully (pending save)
2025-09-25 22:55:31.755 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 22:55:31.845 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-25 22:55:31.848 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-25 22:55:31.850 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-25 22:55:32.007 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 22:55:32.165 +03:00 [INF] Payment created successfully with ID 2
2025-09-25 22:55:33.104 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:55:33.108 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 3623.4488ms
2025-09-25 22:55:33.117 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-25 22:55:33.130 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 200 1485 application/json; charset=utf-8 3825.2342ms
2025-09-25 22:55:38.336 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json 182
2025-09-25 22:55:38.344 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 22:55:38.499 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 22:55:38.536 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-25 22:55:38.578 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-25 22:55:38.587 +03:00 [INF] Executing CreatePayment for order: ORD-20250925195505-3184
2025-09-25 22:55:38.604 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250925195505-3184 by user 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 22:55:38.842 +03:00 [INF] Getting order by number: ORD-20250925195505-3184
2025-09-25 22:55:38.923 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-25 22:55:39.006 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 22:55:39.016 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-25 22:55:39.018 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-25 22:55:39.096 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-25 22:55:39.104 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-25 22:55:39.106 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-25 22:55:39.185 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 22:55:39.196 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 22:55:39.273 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-25 22:55:39.280 +03:00 [INF] Executing GetTokenAsync
2025-09-25 22:55:39.282 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-25 22:55:39.285 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-25 22:55:39.797 +03:00 [INF] Received HTTP response headers after 510.3006ms - 201
2025-09-25 22:55:39.802 +03:00 [INF] End processing HTTP request after 519.9504ms - 201
2025-09-25 22:55:39.812 +03:00 [INF] Successfully retrieved PayMob token
2025-09-25 22:55:39.895 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 22:55:39.917 +03:00 [INF] Getting address by ID: 1
2025-09-25 22:55:39.999 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-25 22:55:40.004 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-25 22:55:40.006 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-25 22:55:40.204 +03:00 [INF] Received HTTP response headers after 192.4754ms - 422
2025-09-25 22:55:40.209 +03:00 [INF] End processing HTTP request after 204.7795ms - 422
2025-09-25 22:55:41.121 +03:00 [ERR] Failed to create order in PayMob. Status: "UnprocessableEntity", Error: {"message":"duplicate"}
2025-09-25 22:55:41.124 +03:00 [ERR] Failed to create order in PayMob for OrderId: ORD-20250925195505-3184
2025-09-25 22:55:41.126 +03:00 [ERR] Failed to get payment link for order 12: Failed to create payment order
2025-09-25 22:55:41.203 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:55:41.208 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 2622.0669ms
2025-09-25 22:55:41.330 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-25 22:55:41.333 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 400 222 application/json; charset=utf-8 2996.4008ms
2025-09-25 23:02:23.224 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-09-25 23:02:23.239 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 14.8406ms
2025-09-25 23:02:23.276 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-09-25 23:02:23.278 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-25 23:02:23.282 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 23:02:23.283 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 6.889ms
2025-09-25 23:02:23.296 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 14.0675ms
2025-09-25 23:02:23.304 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 26.2547ms
2025-09-25 23:02:23.855 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-09-25 23:02:23.980 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 124.2964ms
2025-09-25 23:02:40.535 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-09-25 23:02:42.310 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-25 23:02:43.020 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-25 23:02:43.201 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-09-25 23:02:43.223 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 23:02:43.236 +03:00 [INF] Starting data seeding...
2025-09-25 23:02:43.264 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 23:02:43.468 +03:00 [INF] DB tables already exist. Exit install
2025-09-25 23:02:43.919 +03:00 [INF] Executed DbCommand (105ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-25 23:02:43.983 +03:00 [INF] Role 'Admin' already exists.
2025-09-25 23:02:44.142 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-25 23:02:44.152 +03:00 [INF] Role 'User' already exists.
2025-09-25 23:02:44.325 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 23:02:44.333 +03:00 [INF] Admin user not found. Creating...
2025-09-25 23:02:44.588 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-09-25 23:02:44.870 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 23:02:44.880 +03:00 [ERR] Failed to create admin user: Username 'Omargamal1132004@gmail.com' is already taken., Email 'Omargamal1132004@gmail.com' is already taken.
2025-09-25 23:02:46.152 +03:00 [INF] Now listening on: http://localhost:5069
2025-09-25 23:02:46.255 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-09-25 23:02:46.291 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-09-25 23:02:46.346 +03:00 [INF] Using the following options for SQL Server job storage:
2025-09-25 23:02:46.349 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-09-25 23:02:46.357 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-09-25 23:02:46.477 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 23:02:46.507 +03:00 [INF] Hosting environment: Development
2025-09-25 23:02:46.652 +03:00 [INF] Server mrrobot:19620:3807419c successfully announced in 168.0405 ms
2025-09-25 23:02:46.695 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 440.6118ms
2025-09-25 23:02:46.713 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-09-25 23:02:46.723 +03:00 [INF] Server mrrobot:19620:3807419c is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-09-25 23:02:46.855 +03:00 [INF] Server mrrobot:19620:3807419c all the dispatchers started
2025-09-25 23:02:46.939 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-09-25 23:02:47.010 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 70.5417ms
2025-09-25 23:02:47.116 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-25 23:02:47.129 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 23:02:47.205 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 89.0693ms
2025-09-25 23:02:47.212 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 83.0786ms
2025-09-25 23:02:48.200 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-09-25 23:02:48.432 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 232.6938ms
2025-09-25 23:03:04.465 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 62
2025-09-25 23:03:04.472 +03:00 [WRN] Failed to determine the https port for redirect.
2025-09-25 23:03:04.600 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 23:03:04.800 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 23:03:04.815 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-25 23:03:04.837 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-25 23:03:04.957 +03:00 [INF] Executing AddItemToCart for product ID: 3
2025-09-25 23:03:04.967 +03:00 [INF] Adding item to cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9, product: 3
2025-09-25 23:03:05.319 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 23:03:05.328 +03:00 [INF] Execute GetAll for entity Product
2025-09-25 23:03:05.564 +03:00 [INF] Executed DbCommand (87ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-09-25 23:03:05.574 +03:00 [INF] Retrieving cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:03:05.698 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-25 23:03:05.824 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Cart WHERE Id = @p0 FOR UPDATE
2025-09-25 23:03:05.844 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-09-25 23:03:05.906 +03:00 [INF] CartItem added successfully (pending save)
2025-09-25 23:03:05.911 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-25 23:03:05.914 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-25 23:03:05.940 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-25 23:03:07.227 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (DbType = Int32), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`, `RowVersion`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 23:03:07.426 +03:00 [INF] Removing cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:03:07.898 +03:00 [INF] Cache removed successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:03:07.929 +03:00 [INF] Item added to cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9, product: 3
2025-09-25 23:03:07.954 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 23:03:08.022 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 3162.0024ms
2025-09-25 23:03:08.067 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-25 23:03:08.073 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 3608.2555ms
2025-09-25 23:03:09.483 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 1
2025-09-25 23:03:09.656 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-09-25 23:03:09.821 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-25 23:03:11.661 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - null 0
2025-09-25 23:03:11.823 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 23:03:11.986 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 23:03:11.991 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-25 23:03:11.996 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-25 23:03:12.003 +03:00 [INF] Executing CheckOut
2025-09-25 23:03:12.010 +03:00 [INF] Checkout of cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:03:12.012 +03:00 [INF] Retrieving cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:03:12.174 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-25 23:03:12.337 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-25 23:03:12.341 +03:00 [INF] Removing cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:03:12.345 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 23:03:12.348 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 348.9541ms
2025-09-25 23:03:12.351 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-25 23:03:12.365 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - 200 122 application/json; charset=utf-8 704.9628ms
2025-09-25 23:03:12.787 +03:00 [INF] Cache removed successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:03:13.847 +03:00 [INF] Removing cache by tag: cart
2025-09-25 23:03:14.065 +03:00 [WRN] No cache entries found for tag: cart
2025-09-25 23:03:20.117 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json 41
2025-09-25 23:03:20.332 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 23:03:20.505 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 23:03:20.512 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-25 23:03:20.549 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-25 23:03:20.875 +03:00 [INF] Executing CreateOrder
2025-09-25 23:03:20.883 +03:00 [INF] Creating order from cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:03:21.344 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 23:03:21.428 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-25 23:03:21.434 +03:00 [INF] Checking if address 1 exists for customer: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:03:21.514 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-09-25 23:03:21.525 +03:00 [INF] Getting cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:03:21.530 +03:00 [INF] Getting cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:03:21.748 +03:00 [WRN] Cache miss for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:03:21.825 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-25 23:03:21.829 +03:00 [INF] Execute GetAll for entity Cart
2025-09-25 23:03:21.994 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-09-25 23:03:22.012 +03:00 [INF] Setting cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:03:22.294 +03:00 [INF] Cache set successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9 with tags: [cart]
2025-09-25 23:03:22.299 +03:00 [INF] Execute GetAll for entity ProductVariant
2025-09-25 23:03:22.399 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE `p`.`Id` = 3
2025-09-25 23:03:22.486 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-09-25 23:03:22.491 +03:00 [INF] Executing CreateAsync for entity Order
2025-09-25 23:03:22.540 +03:00 [INF] Order added successfully (pending save)
2025-09-25 23:03:22.716 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = Decimal), @p13='?' (DbType = Int32), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal), @p16='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `RestockedAt`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`, `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 23:03:22.805 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-09-25 23:03:22.830 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-09-25 23:03:22.834 +03:00 [INF] Removing 1 from variant: 3
2025-09-25 23:03:22.913 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity - @p0 WHERE Id = @p1 AND Quantity >= @p0
2025-09-25 23:03:22.918 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 3
2025-09-25 23:03:23.004 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 23:03:23.957 +03:00 [INF] Clearing cart: 1
2025-09-25 23:03:24.041 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-09-25 23:03:24.052 +03:00 [INF] Cart 1 cleared successfully
2025-09-25 23:03:24.228 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 8) (DbType = Binary), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = Decimal), @p11='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0 AND `RowVersion` IS NULL;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 23:03:24.393 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-25 23:03:24.395 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-25 23:03:24.399 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-25 23:03:24.402 +03:00 [INF] Execute GetAll for entity Order
2025-09-25 23:03:24.654 +03:00 [INF] Executed DbCommand (91ms) [Parameters=[@__createdOrder_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`DeletedAt`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`Id0`, `t0`.`Id1`, `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`, `t1`.`Status`, `t1`.`Amount`, `t1`.`CreatedAt`, `t1`.`Id`, `t1`.`PaymentDate`, `t1`.`PaymentMethodId`, `t1`.`PaymentProviderId`, `t1`.`Name`, `t1`.`Id0`, `t0`.`c`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t0`.`AdditionalNotes`, `t0`.`AddressType`, `t0`.`City`, `t0`.`Country`, `t0`.`CreatedAt0`, `t0`.`CustomerId`, `t0`.`StreetAddress`, `t0`.`State`, `t0`.`PhoneNumber0`, `t0`.`IsDefault`, `t0`.`ModifiedAt0`, `t0`.`PostalCode`, `t2`.`Id`, `t2`.`CreatedAt`, `t2`.`ModifiedAt`, `t2`.`Quantity`, `t2`.`UnitPrice`, `t2`.`TotalPrice`, `t2`.`OrderedAt`, `t2`.`Id0`, `t2`.`Name`, `t2`.`Price`, `t2`.`IsActive`, `t2`.`FinalPrice`, `t2`.`DiscountPrecentage`, `t2`.`MainImageUrl`, `t2`.`Id1`, `t2`.`Color`, `t2`.`CreatedAt0`, `t2`.`ModifiedAt0`, `t2`.`Size`, `t2`.`DeletedAt`, `t2`.`Length`, `t2`.`Waist`, `t2`.`Id2`, `t2`.`Id3`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`DeletedAt`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`, `c`.`Id` AS `Id1`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt` AS `CreatedAt0`, `c`.`CustomerId`, `c`.`StreetAddress`, `c`.`State`, `c`.`PhoneNumber` AS `PhoneNumber0`, `c`.`IsDefault`, `c`.`ModifiedAt` AS `ModifiedAt0`, `c`.`PostalCode`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    INNER JOIN `CustomerAddresses` AS `c` ON `o`.`CustomerAddressId` = `c`.`Id`
    WHERE `o`.`Id` = @__createdOrder_Id_0
    LIMIT 1
) AS `t0`
LEFT JOIN `Payments` AS `p` ON `t0`.`Id` = `p`.`OrderId`
LEFT JOIN (
    SELECT `p0`.`Status`, `p0`.`Amount`, `p0`.`CreatedAt`, `p0`.`Id`, `p0`.`PaymentDate`, `p0`.`PaymentMethodId`, `p0`.`PaymentProviderId`, `p1`.`Name`, `p1`.`Id` AS `Id0`, `p0`.`OrderId`
    FROM `Payments` AS `p0`
    INNER JOIN `PaymentMethods` AS `p1` ON `p0`.`PaymentMethodId` = `p1`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p2`.`Id` AS `Id0`, `p2`.`Name`, `p2`.`Price`, `p2`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p2`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p2`.`Price`))
        ELSE `p2`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p2`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p3`.`Color`, COALESCE(`p3`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p3`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p3`.`Size`, `p3`.`DeletedAt`, COALESCE(`p3`.`Length`, 0) AS `Length`, COALESCE(`p3`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p3`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p2` ON `o0`.`ProductId` = `p2`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p2`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p3` ON `o0`.`ProductVariantId` = `p3`.`Id`
) AS `t2` ON `t0`.`Id` = `t2`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`, `p`.`Id`, `t1`.`Id`, `t1`.`Id0`, `t2`.`Id`, `t2`.`Id0`, `t2`.`Id2`
2025-09-25 23:03:27.545 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-25 23:03:27.912 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 23:03:30.095 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 23:03:30.105 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 23:03:30.151 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 9591.5823ms
2025-09-25 23:03:30.156 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-25 23:03:30.162 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 201 1842 application/json; charset=utf-8 10045.2632ms
2025-09-25 23:03:30.314 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-25 23:03:30.422 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-25 23:03:30.423 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 23:03:30.426 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 23:03:30.435 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 23:03:30.572 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 23:03:30.651 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-25 23:03:30.876 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 23:03:31.124 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 23:03:31.132 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 23:03:31.264 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 23:03:33.293 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-25 23:03:33.514 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-25 23:03:33.626 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 23:03:34.273 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 23:07:47.067 +03:00 [INF] 1 servers were removed due to timeout
2025-09-25 23:20:41.732 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-09-25 23:20:43.467 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-25 23:20:44.192 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-25 23:20:44.374 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-09-25 23:20:44.395 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 23:20:44.407 +03:00 [INF] Starting data seeding...
2025-09-25 23:20:44.434 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 23:20:44.623 +03:00 [INF] DB tables already exist. Exit install
2025-09-25 23:20:45.060 +03:00 [INF] Executed DbCommand (103ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-25 23:20:45.119 +03:00 [INF] Role 'Admin' already exists.
2025-09-25 23:20:45.279 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-25 23:20:45.296 +03:00 [INF] Role 'User' already exists.
2025-09-25 23:20:45.482 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 23:20:45.495 +03:00 [INF] Admin user not found. Creating...
2025-09-25 23:20:45.759 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-09-25 23:20:45.996 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 23:20:46.008 +03:00 [ERR] Failed to create admin user: Username 'Omargamal1132004@gmail.com' is already taken., Email 'Omargamal1132004@gmail.com' is already taken.
2025-09-25 23:20:47.385 +03:00 [INF] Now listening on: http://localhost:5069
2025-09-25 23:20:47.553 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-09-25 23:20:47.689 +03:00 [INF] Using the following options for SQL Server job storage:
2025-09-25 23:20:47.721 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-09-25 23:20:47.726 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-09-25 23:20:47.741 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 23:20:47.753 +03:00 [INF] Hosting environment: Development
2025-09-25 23:20:47.757 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-09-25 23:20:47.906 +03:00 [INF] Server mrrobot:7432:7c042469 successfully announced in 158.6412 ms
2025-09-25 23:20:47.916 +03:00 [INF] Server mrrobot:7432:7c042469 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-09-25 23:20:48.073 +03:00 [INF] Server mrrobot:7432:7c042469 all the dispatchers started
2025-09-25 23:23:41.901 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-25 23:23:42.648 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-25 23:23:42.825 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-09-25 23:23:42.847 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 23:23:42.856 +03:00 [INF] Starting data seeding...
2025-09-25 23:23:42.889 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 23:23:43.078 +03:00 [INF] DB tables already exist. Exit install
2025-09-25 23:23:43.514 +03:00 [INF] Executed DbCommand (105ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-25 23:23:43.585 +03:00 [INF] Role 'Admin' already exists.
2025-09-25 23:23:43.775 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-25 23:23:43.781 +03:00 [INF] Role 'User' already exists.
2025-09-25 23:23:43.953 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 23:23:44.031 +03:00 [INF] Admin user Omargamal1132004@gmail.com already exists.
2025-09-25 23:23:44.190 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 23:23:44.195 +03:00 [INF] Admin user Og4381146@gmail.com not found. Creating...
2025-09-25 23:23:44.443 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-09-25 23:23:44.607 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 23:23:44.911 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (Size = 4000), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (Size = 13), @p7='?' (Size = 256), @p8='?' (DbType = Boolean), @p9='?' (DbType = Int32), @p10='?' (DbType = Int32), @p11='?' (DbType = DateTime), @p12='?' (DbType = Boolean), @p13='?' (DbType = DateTimeOffset), @p14='?' (Size = 4000), @p15='?' (Size = 256), @p16='?' (Size = 256), @p17='?' (Size = 4000), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (Size = 4000), @p21='?' (DbType = Boolean), @p22='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
INSERT INTO `AspNetUsers` (`Id`, `AccessFailedCount`, `Age`, `ConcurrencyStamp`, `CreateAt`, `DeletedAt`, `Discriminator`, `Email`, `EmailConfirmed`, `Gender`, `ImageId`, `LastVisit`, `LockoutEnabled`, `LockoutEnd`, `Name`, `NormalizedEmail`, `NormalizedUserName`, `PasswordHash`, `PhoneNumber`, `PhoneNumberConfirmed`, `SecurityStamp`, `TwoFactorEnabled`, `UserName`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22);
2025-09-25 23:23:45.102 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedRoleName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedRoleName_0
LIMIT 2
2025-09-25 23:23:45.285 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__p_0='?' (Size = 255), @__p_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`UserId`, `a`.`RoleId`
FROM `AspNetUserRoles` AS `a`
WHERE (`a`.`UserId` = @__p_0) AND (`a`.`RoleId` = @__p_1)
LIMIT 1
2025-09-25 23:23:45.445 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__normalizedRoleName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedRoleName_0
LIMIT 2
2025-09-25 23:23:45.616 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-09-25 23:23:45.780 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 23:23:46.166 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (Size = 255), @p23='?' (Size = 255), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32), @p4='?' (Size = 4000), @p24='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = DateTime), @p7='?' (Size = 256), @p8='?' (DbType = Boolean), @p9='?' (DbType = Int32), @p10='?' (DbType = Int32), @p11='?' (DbType = DateTime), @p12='?' (DbType = Boolean), @p13='?' (DbType = DateTimeOffset), @p14='?' (Size = 4000), @p15='?' (Size = 256), @p16='?' (Size = 256), @p17='?' (Size = 4000), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (Size = 4000), @p21='?' (DbType = Boolean), @p22='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `AspNetUserRoles` (`RoleId`, `UserId`)
VALUES (@p0, @p1);
UPDATE `AspNetUsers` SET `AccessFailedCount` = @p2, `Age` = @p3, `ConcurrencyStamp` = @p4, `CreateAt` = @p5, `DeletedAt` = @p6, `Email` = @p7, `EmailConfirmed` = @p8, `Gender` = @p9, `ImageId` = @p10, `LastVisit` = @p11, `LockoutEnabled` = @p12, `LockoutEnd` = @p13, `Name` = @p14, `NormalizedEmail` = @p15, `NormalizedUserName` = @p16, `PasswordHash` = @p17, `PhoneNumber` = @p18, `PhoneNumberConfirmed` = @p19, `SecurityStamp` = @p20, `TwoFactorEnabled` = @p21, `UserName` = @p22
WHERE `Id` = @p23 AND `ConcurrencyStamp` = @p24;
SELECT ROW_COUNT();
2025-09-25 23:23:46.283 +03:00 [INF] Admin user Og4381146@gmail.com created and assigned to 'Admin' role.
2025-09-25 23:23:46.501 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 23:23:46.667 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__adminEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Email` = @__adminEmail_0)
LIMIT 1
2025-09-25 23:23:46.676 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 23:23:46.907 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__ToLower_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `PaymentProviders` AS `p`
    WHERE (LOWER(`p`.`Name`) = @__ToLower_0) AND `p`.`DeletedAt` IS NULL)
2025-09-25 23:23:46.914 +03:00 [WRN] Payment provider with name 'Paymob' already exists
2025-09-25 23:23:46.917 +03:00 [WRN] Failed to ensure payment provider 'Paymob'.
2025-09-25 23:23:46.962 +03:00 [INF] Data seeding completed successfully.
2025-09-25 23:23:48.273 +03:00 [INF] Now listening on: http://localhost:5069
2025-09-25 23:23:48.394 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-09-25 23:23:48.635 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-09-25 23:23:49.082 +03:00 [INF] Using the following options for SQL Server job storage:
2025-09-25 23:23:49.135 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-09-25 23:23:49.160 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-09-25 23:23:49.213 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 23:23:49.274 +03:00 [INF] Hosting environment: Development
2025-09-25 23:23:49.343 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-09-25 23:23:49.367 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 732.945ms
2025-09-25 23:23:49.387 +03:00 [INF] Server mrrobot:8644:29a3a6cb successfully announced in 165.7507 ms
2025-09-25 23:23:49.442 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-09-25 23:23:49.455 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-25 23:23:49.651 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 23:23:49.675 +03:00 [INF] Server mrrobot:8644:29a3a6cb is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-09-25 23:23:49.691 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 249.1074ms
2025-09-25 23:23:49.739 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 88.334ms
2025-09-25 23:23:49.751 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 296.3224ms
2025-09-25 23:23:50.048 +03:00 [INF] Server mrrobot:8644:29a3a6cb all the dispatchers started
2025-09-25 23:23:50.050 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-09-25 23:23:50.386 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 336.8542ms
2025-09-25 23:24:12.958 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 62
2025-09-25 23:24:12.967 +03:00 [WRN] Failed to determine the https port for redirect.
2025-09-25 23:24:13.087 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 23:24:13.277 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 23:24:13.291 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-25 23:24:13.312 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-25 23:24:13.425 +03:00 [INF] Executing AddItemToCart for product ID: 3
2025-09-25 23:24:13.435 +03:00 [INF] Adding item to cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9, product: 3
2025-09-25 23:24:13.755 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 23:24:13.767 +03:00 [INF] Execute GetAll for entity Product
2025-09-25 23:24:13.925 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-09-25 23:24:13.934 +03:00 [INF] Retrieving cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:14.076 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-25 23:24:14.192 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Cart WHERE Id = @p0 FOR UPDATE
2025-09-25 23:24:14.202 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-09-25 23:24:14.263 +03:00 [INF] CartItem added successfully (pending save)
2025-09-25 23:24:14.267 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-25 23:24:14.270 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-25 23:24:14.297 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-25 23:24:15.460 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (DbType = Int32), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`, `RowVersion`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 23:24:15.642 +03:00 [INF] Removing cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:16.083 +03:00 [INF] Cache removed successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:16.086 +03:00 [INF] Item added to cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9, product: 3
2025-09-25 23:24:16.100 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 23:24:16.130 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 2798.2265ms
2025-09-25 23:24:16.144 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-25 23:24:16.150 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 3191.8479ms
2025-09-25 23:24:19.736 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - null 0
2025-09-25 23:24:19.750 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 23:24:19.905 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 23:24:19.910 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-25 23:24:19.917 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-25 23:24:19.926 +03:00 [INF] Executing CheckOut
2025-09-25 23:24:19.930 +03:00 [INF] Checkout of cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:19.932 +03:00 [INF] Retrieving cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:20.089 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-25 23:24:20.249 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-25 23:24:20.255 +03:00 [INF] Removing cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:20.258 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 23:24:20.261 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 339.3716ms
2025-09-25 23:24:20.263 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-25 23:24:20.266 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - 200 122 application/json; charset=utf-8 529.9246ms
2025-09-25 23:24:20.692 +03:00 [INF] Cache removed successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:22.959 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 1
2025-09-25 23:24:23.121 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-09-25 23:24:23.281 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-25 23:24:27.198 +03:00 [INF] Removing cache by tag: cart
2025-09-25 23:24:27.411 +03:00 [WRN] No cache entries found for tag: cart
2025-09-25 23:24:28.256 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json 41
2025-09-25 23:24:28.265 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 23:24:28.423 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 23:24:28.430 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-25 23:24:28.437 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderAfterCreatedto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-25 23:24:28.634 +03:00 [INF] Executing CreateOrder
2025-09-25 23:24:28.645 +03:00 [INF] Creating order from cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:28.958 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 23:24:29.079 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-25 23:24:29.085 +03:00 [INF] Checking if address 1 exists for customer: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:29.166 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-09-25 23:24:29.176 +03:00 [INF] Getting cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:29.180 +03:00 [INF] Getting cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:29.396 +03:00 [WRN] Cache miss for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:29.478 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-25 23:24:29.485 +03:00 [INF] Execute GetAll for entity Cart
2025-09-25 23:24:29.622 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-09-25 23:24:29.642 +03:00 [INF] Setting cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:29.911 +03:00 [INF] Cache set successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9 with tags: [cart]
2025-09-25 23:24:29.996 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderAfterCreatedto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 23:24:30.006 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 1563.6652ms
2025-09-25 23:24:30.011 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-25 23:24:30.016 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 400 236 application/json; charset=utf-8 1760.059ms
2025-09-25 23:24:40.249 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - null 0
2025-09-25 23:24:40.406 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 23:24:40.669 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 23:24:40.674 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-25 23:24:40.676 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-25 23:24:40.700 +03:00 [INF] Executing CheckOut
2025-09-25 23:24:40.702 +03:00 [INF] Checkout of cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:40.703 +03:00 [INF] Retrieving cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:40.860 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-25 23:24:41.028 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-25 23:24:41.032 +03:00 [INF] Removing cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:41.036 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 23:24:41.048 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 368.1955ms
2025-09-25 23:24:41.157 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-25 23:24:41.194 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - 200 122 application/json; charset=utf-8 937.8758ms
2025-09-25 23:24:41.462 +03:00 [INF] Cache removed successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:45.688 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json 41
2025-09-25 23:24:45.694 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 23:24:45.851 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 23:24:45.856 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-25 23:24:45.858 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderAfterCreatedto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-25 23:24:45.869 +03:00 [INF] Executing CreateOrder
2025-09-25 23:24:45.872 +03:00 [INF] Creating order from cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:46.187 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 23:24:46.271 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-25 23:24:46.277 +03:00 [INF] Checking if address 1 exists for customer: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:46.356 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-09-25 23:24:46.362 +03:00 [INF] Getting cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:46.365 +03:00 [INF] Getting cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:46.579 +03:00 [WRN] Cache miss for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:46.657 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-25 23:24:46.661 +03:00 [INF] Execute GetAll for entity Cart
2025-09-25 23:24:46.751 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-09-25 23:24:46.760 +03:00 [INF] Setting cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:24:46.977 +03:00 [INF] Cache set successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9 with tags: [cart]
2025-09-25 23:24:46.986 +03:00 [INF] Execute GetAll for entity ProductVariant
2025-09-25 23:24:47.089 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE `p`.`Id` = 3
2025-09-25 23:24:47.176 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-09-25 23:24:47.186 +03:00 [INF] Executing CreateAsync for entity Order
2025-09-25 23:24:47.230 +03:00 [INF] Order added successfully (pending save)
2025-09-25 23:24:47.402 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = Decimal), @p13='?' (DbType = Int32), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal), @p16='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `RestockedAt`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`, `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 23:24:47.493 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-09-25 23:24:47.517 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-09-25 23:24:47.523 +03:00 [INF] Removing 1 from variant: 3
2025-09-25 23:24:47.603 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity - @p0 WHERE Id = @p1 AND Quantity >= @p0
2025-09-25 23:24:47.609 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 3
2025-09-25 23:24:47.691 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 23:24:48.623 +03:00 [INF] Clearing cart: 1
2025-09-25 23:24:48.707 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-09-25 23:24:48.716 +03:00 [INF] Cart 1 cleared successfully
2025-09-25 23:24:48.894 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 8) (DbType = Binary), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = Decimal), @p11='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0 AND `RowVersion` IS NULL;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 23:24:49.061 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-25 23:24:49.062 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-25 23:24:49.069 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-25 23:24:51.173 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-25 23:24:51.540 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 23:24:53.849 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 23:24:54.062 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-25 23:24:54.180 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 23:24:54.197 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 23:24:54.200 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-25 23:24:54.208 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 23:24:54.419 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-25 23:24:54.605 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 23:24:54.624 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderAfterCreatedto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 23:24:54.645 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 8780.9562ms
2025-09-25 23:24:54.647 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-25 23:24:54.649 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 201 179 application/json; charset=utf-8 8960.5128ms
2025-09-25 23:24:54.843 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 23:24:54.844 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 23:24:57.008 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-25 23:24:57.223 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-25 23:24:57.388 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 23:24:57.572 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 23:24:58.025 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 23:24:58.209 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 23:28:50.104 +03:00 [INF] 2 servers were removed due to timeout
2025-09-25 23:30:49.177 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-25 23:30:49.931 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-25 23:30:50.106 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-09-25 23:30:50.125 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 23:30:50.134 +03:00 [INF] Starting data seeding...
2025-09-25 23:30:50.159 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 23:30:50.347 +03:00 [INF] DB tables already exist. Exit install
2025-09-25 23:30:50.818 +03:00 [INF] Executed DbCommand (112ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-25 23:30:50.880 +03:00 [INF] Role 'Admin' already exists.
2025-09-25 23:30:51.038 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-25 23:30:51.046 +03:00 [INF] Role 'User' already exists.
2025-09-25 23:30:51.228 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 23:30:51.305 +03:00 [INF] Admin user Omargamal1132004@gmail.com already exists.
2025-09-25 23:30:51.463 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 23:30:51.469 +03:00 [INF] Admin user Og4381146@gmail.com already exists.
2025-09-25 23:30:51.624 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-25 23:30:51.792 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__adminEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Email` = @__adminEmail_0)
LIMIT 1
2025-09-25 23:30:51.803 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 23:30:52.025 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__ToLower_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `PaymentProviders` AS `p`
    WHERE (LOWER(`p`.`Name`) = @__ToLower_0) AND `p`.`DeletedAt` IS NULL)
2025-09-25 23:30:52.038 +03:00 [WRN] Payment provider with name 'Paymob' already exists
2025-09-25 23:30:52.106 +03:00 [WRN] Failed to ensure payment provider 'Paymob'.
2025-09-25 23:30:52.119 +03:00 [INF] Data seeding completed successfully.
2025-09-25 23:30:53.315 +03:00 [INF] Now listening on: http://localhost:5069
2025-09-25 23:30:53.436 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-09-25 23:30:53.439 +03:00 [INF] Using the following options for SQL Server job storage:
2025-09-25 23:30:53.442 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-09-25 23:30:53.444 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-09-25 23:30:53.459 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 23:30:53.476 +03:00 [INF] Hosting environment: Development
2025-09-25 23:30:53.484 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-09-25 23:30:53.539 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-09-25 23:30:53.627 +03:00 [INF] Server mrrobot:25272:bcc77bee successfully announced in 160.6792 ms
2025-09-25 23:30:53.758 +03:00 [INF] Server mrrobot:25272:bcc77bee is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-09-25 23:30:53.885 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 346.8553ms
2025-09-25 23:30:53.930 +03:00 [INF] Server mrrobot:25272:bcc77bee all the dispatchers started
2025-09-25 23:30:54.101 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-09-25 23:30:54.109 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 8.8011ms
2025-09-25 23:30:54.130 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 23:30:54.141 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 10.1263ms
2025-09-25 23:30:54.203 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-25 23:30:54.278 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 74.9587ms
2025-09-25 23:30:55.659 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-09-25 23:30:55.815 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 156.313ms
2025-09-25 23:31:03.923 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 62
2025-09-25 23:31:03.930 +03:00 [WRN] Failed to determine the https port for redirect.
2025-09-25 23:31:04.045 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 23:31:04.233 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 23:31:04.245 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-25 23:31:04.265 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-25 23:31:04.377 +03:00 [INF] Executing AddItemToCart for product ID: 3
2025-09-25 23:31:04.391 +03:00 [INF] Adding item to cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9, product: 3
2025-09-25 23:31:04.723 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 23:31:04.735 +03:00 [INF] Execute GetAll for entity Product
2025-09-25 23:31:04.881 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-09-25 23:31:04.897 +03:00 [INF] Retrieving cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:31:05.024 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-25 23:31:05.135 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Cart WHERE Id = @p0 FOR UPDATE
2025-09-25 23:31:05.147 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-09-25 23:31:05.210 +03:00 [INF] CartItem added successfully (pending save)
2025-09-25 23:31:05.216 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-25 23:31:05.220 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-25 23:31:05.242 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-25 23:31:06.469 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (DbType = Int32), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`, `RowVersion`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 23:31:06.673 +03:00 [INF] Removing cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:31:07.118 +03:00 [INF] Cache removed successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:31:07.120 +03:00 [INF] Item added to cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9, product: 3
2025-09-25 23:31:07.134 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 23:31:07.156 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 2880.1843ms
2025-09-25 23:31:07.169 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-25 23:31:07.176 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 3252.881ms
2025-09-25 23:31:16.534 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 1
2025-09-25 23:31:16.539 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - null 0
2025-09-25 23:31:16.550 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 23:31:16.695 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-09-25 23:31:16.710 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 23:31:16.725 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-25 23:31:16.744 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-25 23:31:16.755 +03:00 [INF] Executing CheckOut
2025-09-25 23:31:16.760 +03:00 [INF] Checkout of cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:31:16.770 +03:00 [INF] Retrieving cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:31:16.869 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-25 23:31:16.933 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-25 23:31:17.095 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-25 23:31:17.104 +03:00 [INF] Removing cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:31:17.109 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 23:31:17.116 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 365.4883ms
2025-09-25 23:31:17.122 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-25 23:31:17.125 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - 200 122 application/json; charset=utf-8 586.2362ms
2025-09-25 23:31:17.532 +03:00 [INF] Cache removed successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:31:20.815 +03:00 [INF] Removing cache by tag: cart
2025-09-25 23:31:21.030 +03:00 [WRN] No cache entries found for tag: cart
2025-09-25 23:31:23.746 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json 41
2025-09-25 23:31:23.755 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-25 23:31:23.910 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-25 23:31:23.918 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-25 23:31:23.924 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderAfterCreatedto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-25 23:31:24.144 +03:00 [INF] Executing CreateOrder
2025-09-25 23:31:24.155 +03:00 [INF] Creating order from cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:31:24.472 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-25 23:31:24.560 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-25 23:31:24.569 +03:00 [INF] Checking if address 1 exists for customer: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:31:24.652 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-09-25 23:31:24.674 +03:00 [INF] Getting cart for user: 356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:31:24.682 +03:00 [INF] Getting cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:31:24.900 +03:00 [WRN] Cache miss for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:31:24.984 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-25 23:31:25.023 +03:00 [INF] Execute GetAll for entity Cart
2025-09-25 23:31:25.232 +03:00 [INF] Executed DbCommand (89ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-09-25 23:31:25.246 +03:00 [INF] Setting cache for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9
2025-09-25 23:31:25.512 +03:00 [INF] Cache set successfully for key: cart:user:356a1f90-f249-4f61-9df0-6b4e1e4ff2c9 with tags: [cart]
2025-09-25 23:31:25.517 +03:00 [INF] Execute GetAll for entity ProductVariant
2025-09-25 23:31:25.620 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE `p`.`Id` = 3
2025-09-25 23:31:25.708 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-09-25 23:31:25.715 +03:00 [INF] Executing CreateAsync for entity Order
2025-09-25 23:31:25.762 +03:00 [INF] Order added successfully (pending save)
2025-09-25 23:31:25.941 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = Decimal), @p13='?' (DbType = Int32), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal), @p16='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `RestockedAt`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`, `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-25 23:31:26.033 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-09-25 23:31:26.057 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-09-25 23:31:26.062 +03:00 [INF] Removing 1 from variant: 3
2025-09-25 23:31:26.142 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity - @p0 WHERE Id = @p1 AND Quantity >= @p0
2025-09-25 23:31:26.147 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 3
2025-09-25 23:31:26.235 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 23:31:28.148 +03:00 [INF] Clearing cart: 1
2025-09-25 23:31:28.233 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-09-25 23:31:28.241 +03:00 [INF] Cart 1 cleared successfully
2025-09-25 23:31:28.425 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 8) (DbType = Binary), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = Decimal), @p11='?' (DbType = Decimal), @p13='?' (DbType = Int32), @p12='?' (DbType = Boolean), @p14='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0 AND `RowVersion` IS NULL;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

UPDATE `ProductVariants` SET `IsActive` = @p12
WHERE `Id` = @p13 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `ProductVariants`
WHERE ROW_COUNT() = 1 AND `Id` = @p13;
2025-09-25 23:31:28.597 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-25 23:31:28.600 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-25 23:31:28.603 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-25 23:31:34.127 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderAfterCreatedto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 23:31:34.151 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 10220.3248ms
2025-09-25 23:31:34.154 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-25 23:31:34.158 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 201 179 application/json; charset=utf-8 10411.5042ms
2025-09-25 23:31:34.329 +03:00 [INF] Execute GetAll for entity ProductVariant
2025-09-25 23:31:34.495 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE (`p`.`ProductId` = @__productId_0) AND `p`.`DeletedAt` IS NULL
2025-09-25 23:31:34.641 +03:00 [INF] Executing GetByIdAsync for entity Product with ID: 3
2025-09-25 23:31:34.822 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
FROM `Products` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 23:31:35.536 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = Boolean), @p1='?' (DbType = DateTime), @p3='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `IsActive` = @p0, `ModifiedAt` = @p1
WHERE `Id` = @p2 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p2;
2025-09-25 23:31:37.330 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-25 23:31:37.489 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 23:31:37.490 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 23:31:37.504 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 23:31:37.506 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 23:31:37.559 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 23:31:37.642 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 23:31:37.718 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-25 23:31:37.891 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 23:31:37.919 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 23:31:38.146 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 23:31:38.155 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 23:31:38.213 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 23:31:38.317 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 23:31:40.667 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-25 23:31:40.882 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-25 23:31:40.883 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-25 23:31:41.102 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-25 23:31:41.108 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-25 23:31:41.113 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 23:31:41.191 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-25 23:31:41.333 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-25 23:31:41.406 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-25 23:31:41.759 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 23:31:42.243 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 23:31:42.887 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 23:35:54.178 +03:00 [INF] 1 servers were removed due to timeout
2025-09-25 23:54:35.850 +03:00 [INF] Starting CheckAndUpdatePaymentStatusAsync for payment 1
2025-09-25 23:54:36.084 +03:00 [INF] Executing GetByIdAsync for entity Payment with ID: 1
2025-09-25 23:54:36.172 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-25 23:54:36.285 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Payments WHERE Id = @p0 FOR UPDATE
2025-09-25 23:54:36.296 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-25 23:54:36.381 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-25 23:54:36.389 +03:00 [INF] Executing GetTokenAsync
2025-09-25 23:54:36.395 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-25 23:54:36.403 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-25 23:54:37.124 +03:00 [INF] Received HTTP response headers after 716.3861ms - 201
2025-09-25 23:54:37.132 +03:00 [INF] End processing HTTP request after 738.2913ms - 201
2025-09-25 23:54:37.139 +03:00 [INF] Successfully retrieved PayMob token
2025-09-25 23:54:37.150 +03:00 [INF] Start processing HTTP request GET https://accept.paymob.com/api/ecommerce/orders/391383289
2025-09-25 23:54:37.155 +03:00 [INF] Sending HTTP request GET https://accept.paymob.com/api/ecommerce/orders/391383289
2025-09-25 23:54:37.362 +03:00 [INF] Received HTTP response headers after 203.3661ms - 200
2025-09-25 23:54:37.368 +03:00 [INF] End processing HTTP request after 217.4282ms - 200
2025-09-25 23:54:38.453 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p3='?' (Size = 8) (DbType = Binary), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Payments` SET `ModifiedAt` = @p0, `Status` = @p1
WHERE `Id` = @p2 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = @p2;
2025-09-25 23:54:39.908 +03:00 [INF] Execute UpdateOrderAfterPaid_id:11_to status:"PaymentExpired"
2025-09-25 23:54:40.142 +03:00 [INF] Execute GetAll for entity Order
2025-09-25 23:54:40.243 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CancelledAt`, `t`.`CreatedAt`, `t`.`CustomerAddressId`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`DeliveredAt`, `t`.`DiscountAmount`, `t`.`ModifiedAt`, `t`.`Notes`, `t`.`OrderNumber`, `t`.`RestockedAt`, `t`.`RowVersion`, `t`.`ShippedAt`, `t`.`ShippingCost`, `t`.`Status`, `t`.`Subtotal`, `t`.`TaxAmount`, `t`.`Total`, `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`DeletedAt`, `o0`.`ModifiedAt`, `o0`.`OrderId`, `o0`.`OrderedAt`, `o0`.`ProductId`, `o0`.`ProductVariantId`, `o0`.`Quantity`, `o0`.`TotalPrice`, `o0`.`UnitPrice`
FROM (
    SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
    FROM `Orders` AS `o`
    WHERE `o`.`Id` = @__orderId_0
    LIMIT 1
) AS `t`
LEFT JOIN `OrderItem` AS `o0` ON `t`.`Id` = `o0`.`OrderId`
ORDER BY `t`.`Id`
2025-09-25 23:54:40.327 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 23:54:40.486 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-25 23:54:40.651 +03:00 [ERR] An error occurred using a transaction.
2025-09-25 23:54:41.266 +03:00 [INF] Removing cache by tags: [order]
2025-09-25 23:54:41.483 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-25 23:54:41.650 +03:00 [WRN] Failed to process the job '1588': an exception occurred. Retry attempt 1 of 10 will be performed in 00:00:25.
System.InvalidOperationException: Already committed or rolled back.
   at MySqlConnector.MySqlTransaction.VerifyValid() in /_/src/MySqlConnector/MySqlTransaction.cs:line 287
   at MySqlConnector.MySqlTransaction.RollbackAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlTransaction.cs:line 65
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.RollbackAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.RollbackAsync(CancellationToken cancellationToken)
   at E_Commerce.Services.Order.OrderCommandService.UpdateOrderAfterPaid(Int32 orderId, OrderStatus orderStatus) in D:\project_fashion\E-Commerce-API-main\Services\OrderServices\OrderCommandService.cs:line 357
   at E_Commerce.Services.Order.OrderCommandService.UpdateOrderAfterPaid(Int32 orderId, OrderStatus orderStatus) in D:\project_fashion\E-Commerce-API-main\Services\OrderServices\OrderCommandService.cs:line 360
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-09-25 23:54:41.798 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-25 23:54:42.226 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-25 23:54:42.722 +03:00 [INF] Removing cache by tags: [Product, Productwithdata, ProductList]
2025-09-25 23:54:43.201 +03:00 [INF] Payment 1 updated to "Failed"
2025-09-25 23:54:43.365 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata, ProductList]
2025-09-25 23:54:43.666 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 23:54:44.316 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct, collectionlist]
2025-09-25 23:54:44.571 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 23:54:45.210 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata, subcategorylist]
2025-09-25 23:54:52.246 +03:00 [INF] Execute UpdateOrderAfterPaid_id:11_to status:"PaymentExpired"
2025-09-25 23:54:52.479 +03:00 [INF] Execute GetAll for entity Order
2025-09-25 23:54:52.565 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CancelledAt`, `t`.`CreatedAt`, `t`.`CustomerAddressId`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`DeliveredAt`, `t`.`DiscountAmount`, `t`.`ModifiedAt`, `t`.`Notes`, `t`.`OrderNumber`, `t`.`RestockedAt`, `t`.`RowVersion`, `t`.`ShippedAt`, `t`.`ShippingCost`, `t`.`Status`, `t`.`Subtotal`, `t`.`TaxAmount`, `t`.`Total`, `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`DeletedAt`, `o0`.`ModifiedAt`, `o0`.`OrderId`, `o0`.`OrderedAt`, `o0`.`ProductId`, `o0`.`ProductVariantId`, `o0`.`Quantity`, `o0`.`TotalPrice`, `o0`.`UnitPrice`
FROM (
    SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
    FROM `Orders` AS `o`
    WHERE `o`.`Id` = @__orderId_0
    LIMIT 1
) AS `t`
LEFT JOIN `OrderItem` AS `o0` ON `t`.`Id` = `o0`.`OrderId`
ORDER BY `t`.`Id`
2025-09-25 23:54:52.649 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-25 23:54:52.707 +03:00 [WRN] Invalid status transition from "PaymentExpired" to "PaymentExpired"
