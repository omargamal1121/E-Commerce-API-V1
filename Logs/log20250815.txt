2025-08-15 10:05:40.559 +03:00 [INF] DB tables already exist. Exit install
2025-08-15 10:05:42.315 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-15 10:05:43.357 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-15 10:05:44.037 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-15 10:05:44.240 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-15 10:05:44.268 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-15 10:05:44.287 +03:00 [INF] Starting data seeding...
2025-08-15 10:05:44.326 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-15 10:05:44.904 +03:00 [INF] Executed DbCommand (116ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-15 10:05:44.982 +03:00 [INF] Role 'Admin' already exists.
2025-08-15 10:05:45.134 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-15 10:05:45.138 +03:00 [INF] Role 'User' already exists.
2025-08-15 10:05:45.446 +03:00 [INF] Executed DbCommand (203ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-15 10:05:45.545 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-15 10:05:45.547 +03:00 [INF] Data seeding completed successfully.
2025-08-15 10:05:47.650 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-15 10:05:47.754 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-15 10:05:47.757 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-15 10:05:47.759 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-15 10:05:47.761 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-15 10:05:47.791 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-15 10:05:47.797 +03:00 [INF] Hosting environment: Development
2025-08-15 10:05:47.799 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-15 10:05:47.965 +03:00 [INF] Server mrrobot:9356:1f139814 successfully announced in 165.1977 ms
2025-08-15 10:05:47.980 +03:00 [INF] Server mrrobot:9356:1f139814 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-15 10:05:48.077 +03:00 [INF] Server mrrobot:9356:1f139814 all the dispatchers started
2025-08-15 10:05:48.656 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-15 10:05:49.062 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 407.9115ms
2025-08-15 10:05:49.213 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-15 10:05:49.234 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-15 10:05:49.418 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-15 10:05:49.439 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 225.1768ms
2025-08-15 10:05:49.462 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16504 application/javascript; charset=utf-8 44.295ms
2025-08-15 10:05:49.575 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 341.4365ms
2025-08-15 10:05:49.669 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-15 10:05:50.097 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 428.3877ms
2025-08-15 10:06:00.313 +03:00 [ERR] Failed to send welcome email to omar112: The specified string is not in the form required for an e-mail address.
2025-08-15 10:06:00.465 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`Description`, `c`.`DisplayOrder`, `c`.`IsActive`, `c`.`ModifiedAt`, `c`.`Name`
FROM `Categories` AS `c`
WHERE `c`.`DeletedAt` IS NOT NULL
2025-08-15 10:06:00.935 +03:00 [WRN] Failed to process the job '170': an exception occurred. Retry attempt 10 of 10 will be performed in 01:51:56.
System.FormatException: The specified string is not in the form required for an e-mail address.
   at System.Net.Mail.MailAddressParser.TryReadCfwsAndThrowIfIncomplete(String data, Int32 index, Int32& outIndex, Boolean throwExceptionIfFail)
   at System.Net.Mail.MailAddressParser.TryParseDomain(String data, Int32& index, String& domain, Boolean throwExceptionIfFail)
   at System.Net.Mail.MailAddressParser.TryParseAddress(String data, Boolean expectMultipleAddresses, Int32& index, ParseAddressInfo& parseAddressInfo, Boolean throwExceptionIfFail)
   at System.Net.Mail.MailAddressParser.ParseMultipleAddresses(String data)
   at System.Net.Mail.MailAddressCollection.ParseValue(String addresses)
   at E_Commerce.Services.EmailServices.EmailSender.SendEmailAsync(String email, String subject, String htmlMessage) in D:\project_fashion\E-Commerce-API-main\Services\EmailServices\EmailSender.cs:line 37
   at E_Commerce.Services.EmailServices.AccountEmailService.SendWelcomeEmailAsync(String email, String username) in D:\project_fashion\E-Commerce-API-main\Services\EmailServices\AccountEmailService.cs:line 258
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-08-15 10:09:05.939 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Enums/PaymentStatus - null null
2025-08-15 10:09:05.956 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-15 10:09:08.154 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:09:08.167 +03:00 [INF] No cached response available for this request.
2025-08-15 10:09:08.177 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.EnumsController.GetPaymentStatuse (E-Commerce)'
2025-08-15 10:09:08.198 +03:00 [INF] Route matched with {action = "GetPaymentStatuse", controller = "Enums"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.DtoModels.EnumDtos.EnumDto]]] GetPaymentStatuse() on controller E_Commerce.Controllers.EnumsController (E-Commerce).
2025-08-15 10:09:08.218 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.EnumDtos.EnumDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:09:08.249 +03:00 [INF] Executed action E_Commerce.Controllers.EnumsController.GetPaymentStatuse (E-Commerce) in 37.5987ms
2025-08-15 10:09:08.251 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.EnumsController.GetPaymentStatuse (E-Commerce)'
2025-08-15 10:09:08.258 +03:00 [INF] The response could not be cached for this request.
2025-08-15 10:09:08.261 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Enums/PaymentStatus - 200 250 application/json; charset=utf-8 2321.6602ms
2025-08-15 10:09:25.281 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Enums/Sizes - null null
2025-08-15 10:09:25.294 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:09:25.301 +03:00 [INF] No cached response available for this request.
2025-08-15 10:09:25.305 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.EnumsController.GetSizes (E-Commerce)'
2025-08-15 10:09:25.311 +03:00 [INF] Route matched with {action = "GetSizes", controller = "Enums"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.DtoModels.EnumDtos.EnumDto]]] GetSizes() on controller E_Commerce.Controllers.EnumsController (E-Commerce).
2025-08-15 10:09:25.322 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.EnumDtos.EnumDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:09:25.326 +03:00 [INF] Executed action E_Commerce.Controllers.EnumsController.GetSizes (E-Commerce) in 8.4478ms
2025-08-15 10:09:25.336 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.EnumsController.GetSizes (E-Commerce)'
2025-08-15 10:09:25.338 +03:00 [INF] The response could not be cached for this request.
2025-08-15 10:09:25.341 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Enums/Sizes - 200 207 application/json; charset=utf-8 59.6841ms
2025-08-15 10:09:54.717 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-15 10:09:54.748 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 30.6449ms
2025-08-15 10:09:54.807 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-15 10:09:54.808 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-15 10:09:54.814 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 7.0817ms
2025-08-15 10:09:54.814 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-15 10:09:54.825 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 17.2425ms
2025-08-15 10:09:54.829 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16504 application/javascript; charset=utf-8 14.9713ms
2025-08-15 10:09:55.058 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-15 10:09:55.339 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 280.1864ms
2025-08-15 10:10:02.954 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Enums/Sizes - null null
2025-08-15 10:10:02.963 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:10:02.967 +03:00 [INF] No cached response available for this request.
2025-08-15 10:10:02.972 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.EnumsController.GetSizes (E-Commerce)'
2025-08-15 10:10:02.979 +03:00 [INF] Route matched with {action = "GetSizes", controller = "Enums"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.DtoModels.EnumDtos.EnumDto]]] GetSizes() on controller E_Commerce.Controllers.EnumsController (E-Commerce).
2025-08-15 10:10:02.997 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.EnumDtos.EnumDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:10:03.006 +03:00 [INF] Executed action E_Commerce.Controllers.EnumsController.GetSizes (E-Commerce) in 18.7322ms
2025-08-15 10:10:03.009 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.EnumsController.GetSizes (E-Commerce)'
2025-08-15 10:10:03.013 +03:00 [INF] The response could not be cached for this request.
2025-08-15 10:10:03.014 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Enums/Sizes - 200 263 application/json; charset=utf-8 59.4332ms
2025-08-15 10:11:10.005 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Account/login - application/json-patch+json 70
2025-08-15 10:11:10.014 +03:00 [INF] CORS policy execution successful.
2025-08-15 10:11:10.034 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:11:10.039 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce)'
2025-08-15 10:11:10.055 +03:00 [INF] Route matched with {action = "LoginAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.TokenDtos.TokensDto]]] LoginAsync(E_Commerce.DtoModels.AccountDtos.LoginDTo) on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-15 10:11:10.395 +03:00 [INF] In LoginAsync Method 
2025-08-15 10:11:10.701 +03:00 [INF] Executed DbCommand (151ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-15 10:11:10.816 +03:00 [INF] ðŸ” Generating Access Token for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:11:10.822 +03:00 [INF] ðŸ” Generating Access Token for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:11:11.093 +03:00 [INF] Executed DbCommand (113ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-08-15 10:11:11.258 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-15 10:11:11.555 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p22='?' (Size = 255), @p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p23='?' (Size = 4000), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 256), @p6='?' (DbType = Boolean), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = DateTime), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTimeOffset), @p13='?' (Size = 4000), @p14='?' (Size = 256), @p15='?' (Size = 256), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = Boolean), @p19='?' (Size = 4000), @p20='?' (DbType = Boolean), @p21='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `AspNetUsers` SET `AccessFailedCount` = @p0, `Age` = @p1, `ConcurrencyStamp` = @p2, `CreateAt` = @p3, `DeletedAt` = @p4, `Email` = @p5, `EmailConfirmed` = @p6, `Gender` = @p7, `ImageId` = @p8, `ImageId1` = @p9, `LastVisit` = @p10, `LockoutEnabled` = @p11, `LockoutEnd` = @p12, `Name` = @p13, `NormalizedEmail` = @p14, `NormalizedUserName` = @p15, `PasswordHash` = @p16, `PhoneNumber` = @p17, `PhoneNumberConfirmed` = @p18, `SecurityStamp` = @p19, `TwoFactorEnabled` = @p20, `UserName` = @p21
WHERE `Id` = @p22 AND `ConcurrencyStamp` = @p23;
SELECT ROW_COUNT();
2025-08-15 10:11:11.781 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-08-15 10:11:11.920 +03:00 [INF] âœ… Access Token generated successfully for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:11:11.927 +03:00 [INF] ðŸ”‘ Generating Refresh Token for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:11:11.938 +03:00 [INF] âœ… RefreshToken generated and stored for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:11:11.972 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.TokenDtos.TokensDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 10:11:11.981 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce) in 1920.4572ms
2025-08-15 10:11:11.984 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce)'
2025-08-15 10:11:11.988 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Account/login - 200 1251 application/json; charset=utf-8 1982.7566ms
2025-08-15 10:11:45.827 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Enums/PaymentMethods - null null
2025-08-15 10:11:45.879 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:11:46.059 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:11:46.066 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.EnumsController.GetPaymentMethod (E-Commerce)'
2025-08-15 10:11:46.071 +03:00 [INF] Route matched with {action = "GetPaymentMethod", controller = "Enums"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.DtoModels.EnumDtos.EnumDto]]] GetPaymentMethod() on controller E_Commerce.Controllers.EnumsController (E-Commerce).
2025-08-15 10:11:46.078 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.EnumDtos.EnumDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:11:46.081 +03:00 [INF] Executed action E_Commerce.Controllers.EnumsController.GetPaymentMethod (E-Commerce) in 6.8359ms
2025-08-15 10:11:46.085 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.EnumsController.GetPaymentMethod (E-Commerce)'
2025-08-15 10:11:46.087 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Enums/PaymentMethods - 200 221 application/json; charset=utf-8 259.3861ms
2025-08-15 10:12:06.308 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Order/customer?page=1&pageSize=10 - null null
2025-08-15 10:12:06.317 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:12:06.471 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:12:06.486 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.GetCustomerOrders (E-Commerce)'
2025-08-15 10:12:06.495 +03:00 [INF] Route matched with {action = "GetCustomerOrders", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.DtoModels.OrderDtos.OrderListDto]]]] GetCustomerOrders(Int32, Int32) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 10:12:06.526 +03:00 [INF] Executing GetCustomerOrders with pagination: page 1, size 10
2025-08-15 10:12:06.533 +03:00 [INF] Getting orders for customer: d1c4400e-e5cc-4af0-919e-8b1fded727fe, Page: 1, PageSize: 10, IsDeleted: false
2025-08-15 10:12:06.543 +03:00 [INF] Getting cache for key: order_customer_d1c4400e-e5cc-4af0-919e-8b1fded727fe_deleted_False_page_1_size_10
2025-08-15 10:12:06.550 +03:00 [WRN] Cache miss for key: order_customer_d1c4400e-e5cc-4af0-919e-8b1fded727fe_deleted_False_page_1_size_10
2025-08-15 10:12:06.554 +03:00 [INF] Execute GetAll for entity Order
2025-08-15 10:12:06.761 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__8__locals1_userId_0='?' (Size = 255), @__p_2='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`OrderNumber`, `t0`.`Name`, `t`.`Status`, `t`.`Total`, `t`.`CreatedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`CustomerId`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Total`
    FROM `Orders` AS `o`
    WHERE (`o`.`CustomerId` = @__8__locals1_userId_0) AND `o`.`DeletedAt` IS NULL
    ORDER BY `o`.`CreatedAt` DESC
    LIMIT @__p_2 OFFSET @__p_1
) AS `t`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t0` ON `t`.`CustomerId` = `t0`.`Id`
ORDER BY `t`.`CreatedAt` DESC
2025-08-15 10:12:07.674 +03:00 [INF] Successfully retrieved 2 orders for customer d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:12:07.679 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.OrderDtos.OrderListDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:12:07.686 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.GetCustomerOrders (E-Commerce) in 1184.3551ms
2025-08-15 10:12:07.689 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.GetCustomerOrders (E-Commerce)'
2025-08-15 10:12:07.691 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Order/customer?page=1&pageSize=10 - 200 456 application/json; charset=utf-8 1382.5769ms
2025-08-15 10:12:11.302 +03:00 [INF] Setting cache for key: order_customer_d1c4400e-e5cc-4af0-919e-8b1fded727fe_deleted_False_page_1_size_10
2025-08-15 10:12:11.331 +03:00 [INF] Cache set successfully for key: order_customer_d1c4400e-e5cc-4af0-919e-8b1fded727fe_deleted_False_page_1_size_10 with tags: [order]
2025-08-15 10:12:11.338 +03:00 [INF] Successfully cached order list with key: order_customer_d1c4400e-e5cc-4af0-919e-8b1fded727fe_deleted_False_page_1_size_10
2025-08-15 10:12:33.637 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Order/number/ORD-20250812003536-9219 - null null
2025-08-15 10:12:33.716 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:12:33.887 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:12:33.896 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce)'
2025-08-15 10:12:33.906 +03:00 [INF] Route matched with {action = "GetOrderByNumber", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderDto]]] GetOrderByNumber(System.String) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 10:12:33.912 +03:00 [INF] Executing GetOrderByNumber for number: ORD-20250812003536-9219
2025-08-15 10:12:33.922 +03:00 [INF] Getting order by number: ORD-20250812003536-9219 for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe, IsAdmin: false
2025-08-15 10:12:33.926 +03:00 [INF] Getting cache for key: order_orderNumber_ORD-20250812003536-9219_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe_admin_False
2025-08-15 10:12:33.929 +03:00 [WRN] Cache miss for key: order_orderNumber_ORD-20250812003536-9219_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe_admin_False
2025-08-15 10:12:33.941 +03:00 [INF] Checking if order ORD-20250812003536-9219 exists for user d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:12:34.094 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__ordernumber_0='?' (Size = 50), @__userid_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE ((`o`.`OrderNumber` = @__ordernumber_0) AND (`o`.`CustomerId` = @__userid_1)) AND `o`.`DeletedAt` IS NULL)
2025-08-15 10:12:34.102 +03:00 [INF] Execute GetAll for entity Order
2025-08-15 10:12:34.414 +03:00 [INF] Executed DbCommand (114ms) [Parameters=[@__8__locals1_orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`, `t0`.`c0`, `t0`.`CreatedAt0`, `t0`.`ModifiedAt0`, `t0`.`CustomerId`, `t0`.`PaymentMethodId`, `t0`.`c1`, `t0`.`CreatedAt1`, `t0`.`ModifiedAt1`, `t0`.`Name0`, `t0`.`PaymentProviderId`, `t0`.`c2`, `t0`.`CreatedAt2`, `t0`.`ModifiedAt2`, `t0`.`Name1`, `t0`.`Amount`, `t0`.`PaymentDate`, `t0`.`OrderId`, `t0`.`DeletedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`, `p`.`Id` IS NULL AS `c0`, `p`.`Id` AS `Id1`, `p`.`CreatedAt` AS `CreatedAt0`, `p`.`ModifiedAt` AS `ModifiedAt0`, `p`.`CustomerId`, `p`.`PaymentMethodId`, `p0`.`Id` IS NULL AS `c1`, `p0`.`Id` AS `Id2`, `p0`.`CreatedAt` AS `CreatedAt1`, `p0`.`ModifiedAt` AS `ModifiedAt1`, `p0`.`Name` AS `Name0`, `p`.`PaymentProviderId`, `p1`.`Id` IS NULL AS `c2`, `p1`.`Id` AS `Id3`, `p1`.`CreatedAt` AS `CreatedAt2`, `p1`.`ModifiedAt` AS `ModifiedAt2`, `p1`.`Name` AS `Name1`, `p`.`Amount`, `p`.`PaymentDate`, `p`.`OrderId`, `p`.`DeletedAt`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    LEFT JOIN `Payments` AS `p` ON `o`.`Id` = `p`.`OrderId`
    LEFT JOIN `PaymentMethods` AS `p0` ON `p`.`PaymentMethodId` = `p0`.`Id`
    LEFT JOIN `PaymentProviders` AS `p1` ON `p`.`PaymentProviderId` = `p1`.`Id`
    WHERE `o`.`OrderNumber` = @__8__locals1_orderNumber_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p2`.`Id` AS `Id0`, `p2`.`Name`, `p2`.`Price`, `p2`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p2`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p2`.`Price`))
        ELSE `p2`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p2`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p3`.`Color`, COALESCE(`p3`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p3`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p3`.`Size`, `p3`.`DeletedAt`, COALESCE(`p3`.`Length`, 0) AS `Length`, COALESCE(`p3`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p3`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p2` ON `o0`.`ProductId` = `p2`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p2`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p3` ON `o0`.`ProductVariantId` = `p3`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-08-15 10:12:35.361 +03:00 [INF] Order ORD-20250812003536-9219 retrieved successfully for user d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:12:35.366 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 10:12:35.388 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce) in 1479.8779ms
2025-08-15 10:12:35.393 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce)'
2025-08-15 10:12:35.394 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Order/number/ORD-20250812003536-9219 - 200 1953 application/json; charset=utf-8 1757.7084ms
2025-08-15 10:12:42.304 +03:00 [INF] Setting cache for key: order_orderNumber_ORD-20250812003536-9219_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe_admin_False
2025-08-15 10:12:42.337 +03:00 [INF] Cache set successfully for key: order_orderNumber_ORD-20250812003536-9219_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe_admin_False with tags: [order]
2025-08-15 10:12:42.342 +03:00 [INF] Successfully cached order with key: order_orderNumber_ORD-20250812003536-9219_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe_admin_False
2025-08-15 10:14:11.116 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json-patch+json 62
2025-08-15 10:14:11.119 +03:00 [INF] CORS policy execution successful.
2025-08-15 10:14:11.123 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:14:11.276 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:14:11.286 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-15 10:14:11.293 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-15 10:14:11.315 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-15 10:14:11.330 +03:00 [INF] Adding item to cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe, product: 1
2025-08-15 10:14:11.673 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-15 10:14:11.685 +03:00 [INF] Execute GetAll for entity Product
2025-08-15 10:14:11.799 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__itemDto_ProductId_0='?' (DbType = Int32), @__itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-08-15 10:14:11.818 +03:00 [INF] Retrieving cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:14:11.936 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-15 10:14:11.985 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-08-15 10:14:12.050 +03:00 [INF] CartItem added successfully (pending save)
2025-08-15 10:14:12.056 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-15 10:14:12.058 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-15 10:14:12.091 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-15 10:14:12.327 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (Size = 255), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (DbType = DateTime), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:14:12.517 +03:00 [INF] Removing cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:14:12.535 +03:00 [INF] Cache removed successfully for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:14:12.539 +03:00 [INF] Item added to cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe, product: 1
2025-08-15 10:14:12.545 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:14:12.554 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 1252.8332ms
2025-08-15 10:14:12.560 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-15 10:14:12.562 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 1446.3878ms
2025-08-15 10:14:22.299 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart - null null
2025-08-15 10:14:22.306 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:14:22.458 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:14:22.463 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-15 10:14:22.469 +03:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CartDtos.CartDto]]] GetCart() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-15 10:14:22.480 +03:00 [INF] Executing GetCart
2025-08-15 10:14:22.486 +03:00 [INF] Getting cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:14:22.491 +03:00 [INF] Getting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:14:22.496 +03:00 [WRN] Cache miss for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:14:22.648 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 10:14:22.657 +03:00 [INF] Execute GetAll for entity Cart
2025-08-15 10:14:22.857 +03:00 [INF] Executed DbCommand (87ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-15 10:14:22.884 +03:00 [INF] Setting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:14:22.894 +03:00 [INF] Cache set successfully for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe with tags: [cart]
2025-08-15 10:14:22.902 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CartDtos.CartDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 10:14:22.917 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.GetCart (E-Commerce) in 438.9993ms
2025-08-15 10:14:22.925 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-15 10:14:22.927 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart - 200 982 application/json; charset=utf-8 627.6973ms
2025-08-15 10:15:25.899 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json-patch+json 63
2025-08-15 10:15:25.902 +03:00 [INF] CORS policy execution successful.
2025-08-15 10:15:25.904 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:15:26.066 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:15:26.073 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 10:15:26.082 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 10:15:26.103 +03:00 [INF] Executing CreateOrderFromCart
2025-08-15 10:15:26.115 +03:00 [INF] Creating order from cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:15:26.425 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-15 10:15:26.506 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 10:15:26.517 +03:00 [INF] Checking if address 1 exists for customer: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:15:26.600 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-15 10:15:26.608 +03:00 [INF] Getting cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:15:26.610 +03:00 [INF] Getting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:15:26.619 +03:00 [INF] Cache hit for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:15:26.633 +03:00 [INF] Cache hit for cart user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:15:26.716 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-15 10:15:26.720 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-15 10:15:26.770 +03:00 [INF] Order added successfully (pending save)
2025-08-15 10:15:26.946 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:15:27.032 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-15 10:15:27.063 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-15 10:15:27.067 +03:00 [INF] Clearing cart: 2
2025-08-15 10:15:27.151 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-15 10:15:27.161 +03:00 [INF] Cart 2 cleared successfully
2025-08-15 10:15:27.165 +03:00 [INF] Removing cache by tag: cart
2025-08-15 10:15:27.173 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-15 10:15:27.339 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:15:27.426 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-15 10:15:27.431 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-15 10:15:27.452 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-15 10:15:27.462 +03:00 [INF] Starting CreatePaymentMethod for user d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:15:27.542 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-15 10:15:27.556 +03:00 [INF] Getting payment method ID for enum "Wallet"
2025-08-15 10:15:27.560 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 10:15:27.649 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 10:15:27.655 +03:00 [INF] Found payment method ID 2 for enum "Wallet"
2025-08-15 10:15:27.689 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-15 10:15:27.772 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-15 10:15:27.821 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-15 10:15:27.902 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-15 10:15:27.913 +03:00 [INF] Executing GetTokenAsync
2025-08-15 10:15:28.744 +03:00 [INF] Successfully retrieved PayMob token
2025-08-15 10:15:28.750 +03:00 [INF] Getting address by ID: 1
2025-08-15 10:15:28.845 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 10:15:29.556 +03:00 [INF] Successfully created PayMob order: 370817292 for local order: 4
2025-08-15 10:15:29.561 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 10:15:29.640 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-08-15 10:15:29.647 +03:00 [INF] Using integration ID: 5236287 for payment method: "Wallet"
2025-08-15 10:15:29.652 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 370817292, Amount: 10000
2025-08-15 10:15:30.170 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-15 10:15:30.173 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-08-15 10:15:30.176 +03:00 [INF] Payment key generated successfully for Order ID: 370817292
2025-08-15 10:15:30.180 +03:00 [INF] Successfully generated payment key for order: 4
2025-08-15 10:15:30.182 +03:00 [INF] Payment Key generated successfully for Paymob order: 370817292
2025-08-15 10:15:30.186 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-15 10:15:30.264 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-15 10:15:30.271 +03:00 [INF] Executing CreateAsync for entity Payment
2025-08-15 10:15:30.303 +03:00 [INF] Payment added successfully (pending save)
2025-08-15 10:15:30.495 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 100), @p11='?' (DbType = DateTime), @p12='?' (DbType = DateTime), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (DbType = Int32), @p17='?' (DbType = DateTime), @p18='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:15:30.581 +03:00 [INF] Payment created successfully with ID 3
2025-08-15 10:15:30.585 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-15 10:15:30.586 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-15 10:15:30.589 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-15 10:15:30.742 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:15:31.778 +03:00 [INF] Execute GetAll for entity Order
2025-08-15 10:15:31.996 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[@__createdOrder_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`, `t0`.`c0`, `t0`.`CreatedAt0`, `t0`.`ModifiedAt0`, `t0`.`CustomerId`, `t0`.`PaymentMethodId`, `t0`.`c1`, `t0`.`CreatedAt1`, `t0`.`ModifiedAt1`, `t0`.`Name0`, `t0`.`PaymentProviderId`, `t0`.`c2`, `t0`.`CreatedAt2`, `t0`.`ModifiedAt2`, `t0`.`Name1`, `t0`.`Amount`, `t0`.`PaymentDate`, `t0`.`OrderId`, `t0`.`DeletedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`, `p`.`Id` IS NULL AS `c0`, `p`.`Id` AS `Id1`, `p`.`CreatedAt` AS `CreatedAt0`, `p`.`ModifiedAt` AS `ModifiedAt0`, `p`.`CustomerId`, `p`.`PaymentMethodId`, `p0`.`Id` IS NULL AS `c1`, `p0`.`Id` AS `Id2`, `p0`.`CreatedAt` AS `CreatedAt1`, `p0`.`ModifiedAt` AS `ModifiedAt1`, `p0`.`Name` AS `Name0`, `p`.`PaymentProviderId`, `p1`.`Id` IS NULL AS `c2`, `p1`.`Id` AS `Id3`, `p1`.`CreatedAt` AS `CreatedAt2`, `p1`.`ModifiedAt` AS `ModifiedAt2`, `p1`.`Name` AS `Name1`, `p`.`Amount`, `p`.`PaymentDate`, `p`.`OrderId`, `p`.`DeletedAt`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    LEFT JOIN `Payments` AS `p` ON `o`.`Id` = `p`.`OrderId`
    LEFT JOIN `PaymentMethods` AS `p0` ON `p`.`PaymentMethodId` = `p0`.`Id`
    LEFT JOIN `PaymentProviders` AS `p1` ON `p`.`PaymentProviderId` = `p1`.`Id`
    WHERE `o`.`Id` = @__createdOrder_Id_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p2`.`Id` AS `Id0`, `p2`.`Name`, `p2`.`Price`, `p2`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p2`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p2`.`Price`))
        ELSE `p2`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p2`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p3`.`Color`, COALESCE(`p3`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p3`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p3`.`Size`, `p3`.`DeletedAt`, COALESCE(`p3`.`Length`, 0) AS `Length`, COALESCE(`p3`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p3`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p2` ON `o0`.`ProductId` = `p2`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p2`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p3` ON `o0`.`ProductVariantId` = `p3`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-08-15 10:15:32.006 +03:00 [INF] Removing cache by tag: order
2025-08-15 10:15:32.012 +03:00 [INF] Removed 2 cache entries for tag: order
2025-08-15 10:15:32.018 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 10:15:32.030 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 5942.2729ms
2025-08-15 10:15:32.033 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 10:15:32.036 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 201 3115 application/json; charset=utf-8 6137.0403ms
2025-08-15 10:16:14.500 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json-patch+json 62
2025-08-15 10:16:14.507 +03:00 [INF] CORS policy execution successful.
2025-08-15 10:16:14.510 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:16:14.658 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:16:14.665 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-15 10:16:14.668 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-15 10:16:14.677 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-15 10:16:14.679 +03:00 [INF] Adding item to cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe, product: 1
2025-08-15 10:16:14.979 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-15 10:16:14.985 +03:00 [INF] Execute GetAll for entity Product
2025-08-15 10:16:15.066 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__itemDto_ProductId_0='?' (DbType = Int32), @__itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-08-15 10:16:15.073 +03:00 [INF] Retrieving cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:16:15.154 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-15 10:16:15.162 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-08-15 10:16:15.165 +03:00 [INF] CartItem added successfully (pending save)
2025-08-15 10:16:15.167 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-15 10:16:15.169 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-15 10:16:15.172 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-15 10:16:15.326 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (Size = 255), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (DbType = DateTime), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:16:15.478 +03:00 [INF] Removing cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:16:15.483 +03:00 [INF] Cache removed successfully for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:16:15.488 +03:00 [INF] Item added to cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe, product: 1
2025-08-15 10:16:15.490 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:16:15.494 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 819.5447ms
2025-08-15 10:16:15.501 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-15 10:16:15.502 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 1002.504ms
2025-08-15 10:16:29.352 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Enums/PaymentMethods - null null
2025-08-15 10:16:29.359 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:16:29.513 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:16:29.529 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.EnumsController.GetPaymentMethod (E-Commerce)'
2025-08-15 10:16:29.531 +03:00 [INF] Route matched with {action = "GetPaymentMethod", controller = "Enums"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.DtoModels.EnumDtos.EnumDto]]] GetPaymentMethod() on controller E_Commerce.Controllers.EnumsController (E-Commerce).
2025-08-15 10:16:29.535 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.EnumDtos.EnumDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:16:29.540 +03:00 [INF] Executed action E_Commerce.Controllers.EnumsController.GetPaymentMethod (E-Commerce) in 5.0992ms
2025-08-15 10:16:29.549 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.EnumsController.GetPaymentMethod (E-Commerce)'
2025-08-15 10:16:29.555 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Enums/PaymentMethods - 200 221 application/json; charset=utf-8 202.868ms
2025-08-15 10:16:37.720 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json-patch+json 63
2025-08-15 10:16:37.727 +03:00 [INF] CORS policy execution successful.
2025-08-15 10:16:37.730 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:16:37.878 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:16:37.884 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 10:16:37.888 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 10:16:37.899 +03:00 [INF] Executing CreateOrderFromCart
2025-08-15 10:16:37.900 +03:00 [INF] Creating order from cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:16:38.194 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-15 10:16:38.273 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 10:16:38.280 +03:00 [INF] Checking if address 1 exists for customer: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:16:38.357 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-15 10:16:38.366 +03:00 [INF] Getting cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:16:38.368 +03:00 [INF] Getting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:16:38.372 +03:00 [WRN] Cache miss for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:16:38.447 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 10:16:38.455 +03:00 [INF] Execute GetAll for entity Cart
2025-08-15 10:16:38.544 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-15 10:16:38.553 +03:00 [INF] Setting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:16:38.556 +03:00 [INF] Cache set successfully for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe with tags: [cart]
2025-08-15 10:16:38.633 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-15 10:16:38.641 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-15 10:16:38.643 +03:00 [INF] Order added successfully (pending save)
2025-08-15 10:16:38.793 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:16:38.874 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-15 10:16:38.876 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-15 10:16:38.877 +03:00 [INF] Clearing cart: 2
2025-08-15 10:16:38.953 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-15 10:16:38.962 +03:00 [INF] Cart 2 cleared successfully
2025-08-15 10:16:38.964 +03:00 [INF] Removing cache by tag: cart
2025-08-15 10:16:38.967 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-15 10:16:39.117 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:16:39.201 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-15 10:16:39.207 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-15 10:16:39.213 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-15 10:16:39.219 +03:00 [INF] Starting CreatePaymentMethod for user d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:16:39.300 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-15 10:16:39.313 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-08-15 10:16:39.320 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 10:16:39.401 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 10:16:39.411 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-08-15 10:16:39.416 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-08-15 10:16:39.495 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-15 10:16:39.505 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-15 10:16:39.583 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-15 10:16:39.594 +03:00 [INF] Executing GetTokenAsync
2025-08-15 10:16:40.418 +03:00 [INF] Successfully retrieved PayMob token
2025-08-15 10:16:40.421 +03:00 [INF] Getting address by ID: 1
2025-08-15 10:16:40.506 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 10:16:41.015 +03:00 [INF] Successfully created PayMob order: 370817516 for local order: 5
2025-08-15 10:16:41.020 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 10:16:41.098 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-08-15 10:16:41.106 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-08-15 10:16:41.109 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 370817516, Amount: 10000
2025-08-15 10:16:41.776 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-15 10:16:41.780 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-08-15 10:16:41.782 +03:00 [INF] Payment key generated successfully for Order ID: 370817516
2025-08-15 10:16:41.784 +03:00 [INF] Successfully generated payment key for order: 5
2025-08-15 10:16:41.787 +03:00 [INF] Payment Key generated successfully for Paymob order: 370817516
2025-08-15 10:16:41.789 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-15 10:16:41.865 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-15 10:16:41.872 +03:00 [INF] Executing CreateAsync for entity Payment
2025-08-15 10:16:41.875 +03:00 [INF] Payment added successfully (pending save)
2025-08-15 10:16:42.025 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 100), @p11='?' (DbType = DateTime), @p12='?' (DbType = DateTime), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (DbType = Int32), @p17='?' (DbType = DateTime), @p18='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:16:42.106 +03:00 [INF] Payment created successfully with ID 4
2025-08-15 10:16:42.109 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-15 10:16:42.112 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-15 10:16:42.115 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-15 10:16:42.265 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:16:43.304 +03:00 [INF] Execute GetAll for entity Order
2025-08-15 10:16:43.471 +03:00 [INF] Executed DbCommand (91ms) [Parameters=[@__createdOrder_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`, `t0`.`c0`, `t0`.`CreatedAt0`, `t0`.`ModifiedAt0`, `t0`.`CustomerId`, `t0`.`PaymentMethodId`, `t0`.`c1`, `t0`.`CreatedAt1`, `t0`.`ModifiedAt1`, `t0`.`Name0`, `t0`.`PaymentProviderId`, `t0`.`c2`, `t0`.`CreatedAt2`, `t0`.`ModifiedAt2`, `t0`.`Name1`, `t0`.`Amount`, `t0`.`PaymentDate`, `t0`.`OrderId`, `t0`.`DeletedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`, `p`.`Id` IS NULL AS `c0`, `p`.`Id` AS `Id1`, `p`.`CreatedAt` AS `CreatedAt0`, `p`.`ModifiedAt` AS `ModifiedAt0`, `p`.`CustomerId`, `p`.`PaymentMethodId`, `p0`.`Id` IS NULL AS `c1`, `p0`.`Id` AS `Id2`, `p0`.`CreatedAt` AS `CreatedAt1`, `p0`.`ModifiedAt` AS `ModifiedAt1`, `p0`.`Name` AS `Name0`, `p`.`PaymentProviderId`, `p1`.`Id` IS NULL AS `c2`, `p1`.`Id` AS `Id3`, `p1`.`CreatedAt` AS `CreatedAt2`, `p1`.`ModifiedAt` AS `ModifiedAt2`, `p1`.`Name` AS `Name1`, `p`.`Amount`, `p`.`PaymentDate`, `p`.`OrderId`, `p`.`DeletedAt`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    LEFT JOIN `Payments` AS `p` ON `o`.`Id` = `p`.`OrderId`
    LEFT JOIN `PaymentMethods` AS `p0` ON `p`.`PaymentMethodId` = `p0`.`Id`
    LEFT JOIN `PaymentProviders` AS `p1` ON `p`.`PaymentProviderId` = `p1`.`Id`
    WHERE `o`.`Id` = @__createdOrder_Id_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p2`.`Id` AS `Id0`, `p2`.`Name`, `p2`.`Price`, `p2`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p2`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p2`.`Price`))
        ELSE `p2`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p2`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p3`.`Color`, COALESCE(`p3`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p3`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p3`.`Size`, `p3`.`DeletedAt`, COALESCE(`p3`.`Length`, 0) AS `Length`, COALESCE(`p3`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p3`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p2` ON `o0`.`ProductId` = `p2`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p2`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p3` ON `o0`.`ProductVariantId` = `p3`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-08-15 10:16:43.482 +03:00 [INF] Removing cache by tag: order
2025-08-15 10:16:43.486 +03:00 [WRN] No cache entries found for tag: order
2025-08-15 10:16:43.489 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 10:16:43.495 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 5597.132ms
2025-08-15 10:16:43.500 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 10:16:43.502 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 201 3106 application/json; charset=utf-8 5781.5371ms
2025-08-15 10:18:26.473 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Order/number/ORD-20250815071638-5553 - null null
2025-08-15 10:18:26.481 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:18:26.980 +03:00 [INF] Executed DbCommand (208ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:18:26.988 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce)'
2025-08-15 10:18:26.992 +03:00 [INF] Route matched with {action = "GetOrderByNumber", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderDto]]] GetOrderByNumber(System.String) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 10:18:27.002 +03:00 [INF] Executing GetOrderByNumber for number: ORD-20250815071638-5553
2025-08-15 10:18:27.005 +03:00 [INF] Getting order by number: ORD-20250815071638-5553 for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe, IsAdmin: false
2025-08-15 10:18:27.009 +03:00 [INF] Getting cache for key: order_orderNumber_ORD-20250815071638-5553_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe_admin_False
2025-08-15 10:18:27.017 +03:00 [WRN] Cache miss for key: order_orderNumber_ORD-20250815071638-5553_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe_admin_False
2025-08-15 10:18:27.021 +03:00 [INF] Checking if order ORD-20250815071638-5553 exists for user d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:18:27.328 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__ordernumber_0='?' (Size = 50), @__userid_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE ((`o`.`OrderNumber` = @__ordernumber_0) AND (`o`.`CustomerId` = @__userid_1)) AND `o`.`DeletedAt` IS NULL)
2025-08-15 10:18:27.337 +03:00 [INF] Execute GetAll for entity Order
2025-08-15 10:18:27.531 +03:00 [INF] Executed DbCommand (116ms) [Parameters=[@__8__locals1_orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`, `t0`.`c0`, `t0`.`CreatedAt0`, `t0`.`ModifiedAt0`, `t0`.`CustomerId`, `t0`.`PaymentMethodId`, `t0`.`c1`, `t0`.`CreatedAt1`, `t0`.`ModifiedAt1`, `t0`.`Name0`, `t0`.`PaymentProviderId`, `t0`.`c2`, `t0`.`CreatedAt2`, `t0`.`ModifiedAt2`, `t0`.`Name1`, `t0`.`Amount`, `t0`.`PaymentDate`, `t0`.`OrderId`, `t0`.`DeletedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`, `p`.`Id` IS NULL AS `c0`, `p`.`Id` AS `Id1`, `p`.`CreatedAt` AS `CreatedAt0`, `p`.`ModifiedAt` AS `ModifiedAt0`, `p`.`CustomerId`, `p`.`PaymentMethodId`, `p0`.`Id` IS NULL AS `c1`, `p0`.`Id` AS `Id2`, `p0`.`CreatedAt` AS `CreatedAt1`, `p0`.`ModifiedAt` AS `ModifiedAt1`, `p0`.`Name` AS `Name0`, `p`.`PaymentProviderId`, `p1`.`Id` IS NULL AS `c2`, `p1`.`Id` AS `Id3`, `p1`.`CreatedAt` AS `CreatedAt2`, `p1`.`ModifiedAt` AS `ModifiedAt2`, `p1`.`Name` AS `Name1`, `p`.`Amount`, `p`.`PaymentDate`, `p`.`OrderId`, `p`.`DeletedAt`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    LEFT JOIN `Payments` AS `p` ON `o`.`Id` = `p`.`OrderId`
    LEFT JOIN `PaymentMethods` AS `p0` ON `p`.`PaymentMethodId` = `p0`.`Id`
    LEFT JOIN `PaymentProviders` AS `p1` ON `p`.`PaymentProviderId` = `p1`.`Id`
    WHERE `o`.`OrderNumber` = @__8__locals1_orderNumber_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p2`.`Id` AS `Id0`, `p2`.`Name`, `p2`.`Price`, `p2`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p2`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p2`.`Price`))
        ELSE `p2`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p2`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p3`.`Color`, COALESCE(`p3`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p3`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p3`.`Size`, `p3`.`DeletedAt`, COALESCE(`p3`.`Length`, 0) AS `Length`, COALESCE(`p3`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p3`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p2` ON `o0`.`ProductId` = `p2`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p2`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p3` ON `o0`.`ProductVariantId` = `p3`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-08-15 10:18:28.485 +03:00 [INF] Order ORD-20250815071638-5553 retrieved successfully for user d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:18:28.549 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 10:18:28.610 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce) in 1609.2801ms
2025-08-15 10:18:28.665 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce)'
2025-08-15 10:18:28.708 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Order/number/ORD-20250815071638-5553 - 200 1924 application/json; charset=utf-8 2234.7272ms
2025-08-15 10:18:32.337 +03:00 [INF] Setting cache for key: order_orderNumber_ORD-20250815071638-5553_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe_admin_False
2025-08-15 10:18:32.440 +03:00 [INF] Cache set successfully for key: order_orderNumber_ORD-20250815071638-5553_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe_admin_False with tags: [order]
2025-08-15 10:18:32.560 +03:00 [INF] Successfully cached order with key: order_orderNumber_ORD-20250815071638-5553_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe_admin_False
2025-08-15 10:20:37.123 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-15 10:20:37.154 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 30.3772ms
2025-08-15 10:20:37.329 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-15 10:20:37.337 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 7.798ms
2025-08-15 10:20:37.348 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-15 10:20:37.349 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-15 10:20:37.362 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16504 application/javascript; charset=utf-8 14.4467ms
2025-08-15 10:20:37.375 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 26.287ms
2025-08-15 10:20:38.065 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-15 10:20:38.386 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 320.913ms
2025-08-15 10:21:28.966 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Order/customer?page=1&pageSize=10 - null null
2025-08-15 10:21:28.971 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:21:29.160 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:21:29.169 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.GetCustomerOrders (E-Commerce)'
2025-08-15 10:21:29.175 +03:00 [INF] Route matched with {action = "GetCustomerOrders", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.DtoModels.OrderDtos.OrderListDto]]]] GetCustomerOrders(Int32, Int32) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 10:21:29.188 +03:00 [INF] Executing GetCustomerOrders with pagination: page 1, size 10
2025-08-15 10:21:29.189 +03:00 [INF] Getting orders for customer: d1c4400e-e5cc-4af0-919e-8b1fded727fe, Page: 1, PageSize: 10, IsDeleted: false
2025-08-15 10:21:29.191 +03:00 [INF] Getting cache for key: order_customer_d1c4400e-e5cc-4af0-919e-8b1fded727fe_deleted_False_page_1_size_10
2025-08-15 10:21:29.194 +03:00 [WRN] Cache miss for key: order_customer_d1c4400e-e5cc-4af0-919e-8b1fded727fe_deleted_False_page_1_size_10
2025-08-15 10:21:29.197 +03:00 [INF] Execute GetAll for entity Order
2025-08-15 10:21:29.355 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__8__locals1_userId_0='?' (Size = 255), @__p_2='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`OrderNumber`, `t0`.`Name`, `t`.`Status`, `t`.`Total`, `t`.`CreatedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`CustomerId`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Total`
    FROM `Orders` AS `o`
    WHERE (`o`.`CustomerId` = @__8__locals1_userId_0) AND `o`.`DeletedAt` IS NULL
    ORDER BY `o`.`CreatedAt` DESC
    LIMIT @__p_2 OFFSET @__p_1
) AS `t`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t0` ON `t`.`CustomerId` = `t0`.`Id`
ORDER BY `t`.`CreatedAt` DESC
2025-08-15 10:21:30.262 +03:00 [INF] Successfully retrieved 4 orders for customer d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:21:30.272 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.OrderDtos.OrderListDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:21:30.282 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.GetCustomerOrders (E-Commerce) in 1101.2445ms
2025-08-15 10:21:30.294 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.GetCustomerOrders (E-Commerce)'
2025-08-15 10:21:30.302 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Order/customer?page=1&pageSize=10 - 200 774 application/json; charset=utf-8 1336.6947ms
2025-08-15 10:21:37.790 +03:00 [INF] Setting cache for key: order_customer_d1c4400e-e5cc-4af0-919e-8b1fded727fe_deleted_False_page_1_size_10
2025-08-15 10:21:37.797 +03:00 [INF] Cache set successfully for key: order_customer_d1c4400e-e5cc-4af0-919e-8b1fded727fe_deleted_False_page_1_size_10 with tags: [order]
2025-08-15 10:21:37.803 +03:00 [INF] Successfully cached order list with key: order_customer_d1c4400e-e5cc-4af0-919e-8b1fded727fe_deleted_False_page_1_size_10
2025-08-15 10:22:14.721 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Order/number/ORD-20250815071526-5917 - null null
2025-08-15 10:22:14.730 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:22:14.882 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:22:14.893 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce)'
2025-08-15 10:22:14.902 +03:00 [INF] Route matched with {action = "GetOrderByNumber", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderDto]]] GetOrderByNumber(System.String) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 10:22:14.913 +03:00 [INF] Executing GetOrderByNumber for number: ORD-20250815071526-5917
2025-08-15 10:22:14.916 +03:00 [INF] Getting order by number: ORD-20250815071526-5917 for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe, IsAdmin: false
2025-08-15 10:22:14.921 +03:00 [INF] Getting cache for key: order_orderNumber_ORD-20250815071526-5917_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe_admin_False
2025-08-15 10:22:14.927 +03:00 [WRN] Cache miss for key: order_orderNumber_ORD-20250815071526-5917_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe_admin_False
2025-08-15 10:22:14.930 +03:00 [INF] Checking if order ORD-20250815071526-5917 exists for user d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:22:15.080 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__ordernumber_0='?' (Size = 50), @__userid_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE ((`o`.`OrderNumber` = @__ordernumber_0) AND (`o`.`CustomerId` = @__userid_1)) AND `o`.`DeletedAt` IS NULL)
2025-08-15 10:22:15.099 +03:00 [INF] Execute GetAll for entity Order
2025-08-15 10:22:15.267 +03:00 [INF] Executed DbCommand (87ms) [Parameters=[@__8__locals1_orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`, `t0`.`c0`, `t0`.`CreatedAt0`, `t0`.`ModifiedAt0`, `t0`.`CustomerId`, `t0`.`PaymentMethodId`, `t0`.`c1`, `t0`.`CreatedAt1`, `t0`.`ModifiedAt1`, `t0`.`Name0`, `t0`.`PaymentProviderId`, `t0`.`c2`, `t0`.`CreatedAt2`, `t0`.`ModifiedAt2`, `t0`.`Name1`, `t0`.`Amount`, `t0`.`PaymentDate`, `t0`.`OrderId`, `t0`.`DeletedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`, `p`.`Id` IS NULL AS `c0`, `p`.`Id` AS `Id1`, `p`.`CreatedAt` AS `CreatedAt0`, `p`.`ModifiedAt` AS `ModifiedAt0`, `p`.`CustomerId`, `p`.`PaymentMethodId`, `p0`.`Id` IS NULL AS `c1`, `p0`.`Id` AS `Id2`, `p0`.`CreatedAt` AS `CreatedAt1`, `p0`.`ModifiedAt` AS `ModifiedAt1`, `p0`.`Name` AS `Name0`, `p`.`PaymentProviderId`, `p1`.`Id` IS NULL AS `c2`, `p1`.`Id` AS `Id3`, `p1`.`CreatedAt` AS `CreatedAt2`, `p1`.`ModifiedAt` AS `ModifiedAt2`, `p1`.`Name` AS `Name1`, `p`.`Amount`, `p`.`PaymentDate`, `p`.`OrderId`, `p`.`DeletedAt`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    LEFT JOIN `Payments` AS `p` ON `o`.`Id` = `p`.`OrderId`
    LEFT JOIN `PaymentMethods` AS `p0` ON `p`.`PaymentMethodId` = `p0`.`Id`
    LEFT JOIN `PaymentProviders` AS `p1` ON `p`.`PaymentProviderId` = `p1`.`Id`
    WHERE `o`.`OrderNumber` = @__8__locals1_orderNumber_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p2`.`Id` AS `Id0`, `p2`.`Name`, `p2`.`Price`, `p2`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p2`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p2`.`Price`))
        ELSE `p2`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p2`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p3`.`Color`, COALESCE(`p3`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p3`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p3`.`Size`, `p3`.`DeletedAt`, COALESCE(`p3`.`Length`, 0) AS `Length`, COALESCE(`p3`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p3`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p2` ON `o0`.`ProductId` = `p2`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p2`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p3` ON `o0`.`ProductVariantId` = `p3`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-08-15 10:22:15.288 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'E_Commerce.Context.AppDbContext'.
System.Runtime.CompilerServices.HotReloadException: Attempted to invoke a deleted method implementation. This can happen when a method is deleted or its name or signature is changed while the application is running.
   at E_Commerce.DtoModels.OrderDtos.OrderDto.set_Status(OrderStatus value)
   at lambda_method506(Closure, QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.Runtime.CompilerServices.HotReloadException: Attempted to invoke a deleted method implementation. This can happen when a method is deleted or its name or signature is changed while the application is running.
   at E_Commerce.DtoModels.OrderDtos.OrderDto.set_Status(OrderStatus value)
   at lambda_method506(Closure, QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
2025-08-15 10:22:15.294 +03:00 [ERR] Error getting order by number ORD-20250815071526-5917 for user d1c4400e-e5cc-4af0-919e-8b1fded727fe
System.Runtime.CompilerServices.HotReloadException: Attempted to invoke a deleted method implementation. This can happen when a method is deleted or its name or signature is changed while the application is running.
   at E_Commerce.DtoModels.OrderDtos.OrderDto.set_Status(OrderStatus value)
   at lambda_method506(Closure, QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at E_Commerce.Services.Order.OrderServices.GetOrderByNumberAsync(String orderNumber, String userId, Boolean isAdmin)
2025-08-15 10:22:16.224 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 10:22:16.250 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce) in 1339.0264ms
2025-08-15 10:22:16.279 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce)'
2025-08-15 10:22:16.281 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Order/number/ORD-20250815071526-5917 - 500 240 application/json; charset=utf-8 1560.9441ms
2025-08-15 10:23:21.574 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/Order/1/status - application/json-patch+json 38
2025-08-15 10:23:21.581 +03:00 [INF] CORS policy execution successful.
2025-08-15 10:23:21.584 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:23:21.739 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:23:21.745 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce)'
2025-08-15 10:23:21.757 +03:00 [INF] Route matched with {action = "UpdateOrderStatus", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdateOrderStatus(Int32, E_Commerce.DtoModels.OrderDtos.UpdateOrderStatusDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 10:23:21.789 +03:00 [INF] Executing UpdateOrderStatus for ID: 1, status: Processing
2025-08-15 10:23:21.796 +03:00 [INF] Updating order 1 status to Processing
2025-08-15 10:23:22.032 +03:00 [INF] Updating order 1 status to Processing
2025-08-15 10:23:22.122 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE (`o`.`Id` = @__orderId_0) AND `o`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 10:23:22.131 +03:00 [WRN] Order 1 not found
2025-08-15 10:23:22.217 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:23:22.226 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce) in 465.2467ms
2025-08-15 10:23:22.229 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce)'
2025-08-15 10:23:22.233 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/Order/1/status - 500 221 application/json; charset=utf-8 658.9936ms
2025-08-15 10:23:43.679 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/Order/3/status - application/json-patch+json 38
2025-08-15 10:23:43.686 +03:00 [INF] CORS policy execution successful.
2025-08-15 10:23:43.690 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:23:43.852 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:23:43.861 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce)'
2025-08-15 10:23:43.864 +03:00 [INF] Route matched with {action = "UpdateOrderStatus", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdateOrderStatus(Int32, E_Commerce.DtoModels.OrderDtos.UpdateOrderStatusDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 10:23:43.874 +03:00 [INF] Executing UpdateOrderStatus for ID: 3, status: Processing
2025-08-15 10:23:43.877 +03:00 [INF] Updating order 3 status to Processing
2025-08-15 10:23:44.096 +03:00 [INF] Updating order 3 status to Processing
2025-08-15 10:23:44.176 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE (`o`.`Id` = @__orderId_0) AND `o`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 10:23:44.194 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-15 10:23:44.200 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-15 10:23:44.207 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-15 10:23:44.366 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = DateTime), @p9='?' (DbType = Int32), @p10='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `ModifiedAt` = @p0, `Status` = @p1
WHERE `Id` = @p2;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:23:44.612 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails ("Fashion_Site"."adminOperationsLogs", CONSTRAINT "FK_adminOperationsLogs_AspNetUsers_AdminId" FOREIGN KEY ("AdminId") REFERENCES "AspNetUsers" ("Id") ON DELETE RESTRICT)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.NextResultAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 90
   at MySqlConnector.MySqlDataReader.NextResultAsync(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 49
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Cannot add or update a child row: a foreign key constraint fails ("Fashion_Site"."adminOperationsLogs", CONSTRAINT "FK_adminOperationsLogs_AspNetUsers_AdminId" FOREIGN KEY ("AdminId") REFERENCES "AspNetUsers" ("Id") ON DELETE RESTRICT)
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.NextResultAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 90
   at MySqlConnector.MySqlDataReader.NextResultAsync(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 49
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-15 10:23:44.756 +03:00 [ERR] Error updating order status for order 3: An error occurred while saving the entity changes. See the inner exception for details.
2025-08-15 10:23:45.664 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:23:45.676 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce) in 1805.795ms
2025-08-15 10:23:45.693 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce)'
2025-08-15 10:23:45.700 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/Order/3/status - 500 253 application/json; charset=utf-8 2020.457ms
2025-08-15 10:24:25.318 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Order/status/0?page=1&pageSize=10 - null null
2025-08-15 10:24:25.325 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:24:25.487 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:24:25.511 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.GetOrdersByStatus (E-Commerce)'
2025-08-15 10:24:25.533 +03:00 [INF] Route matched with {action = "GetOrdersByStatus", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.DtoModels.OrderDtos.OrderListDto]]]] GetOrdersByStatus(E_Commerce.Enums.OrderStatus, Int32, Int32) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 10:24:25.567 +03:00 [INF] Executing GetOrdersByStatus for status: PendingPayment, page: 1, size: 10
2025-08-15 10:24:25.595 +03:00 [INF] Filtering orders - UserId: , Deleted: , Page: 1, PageSize: 10, Status: PendingPayment
2025-08-15 10:24:25.604 +03:00 [INF] Getting cache for key: order_filter_user_all_deleted_all_page_1_size_10_status_PendingPayment
2025-08-15 10:24:25.614 +03:00 [WRN] Cache miss for key: order_filter_user_all_deleted_all_page_1_size_10_status_PendingPayment
2025-08-15 10:24:25.627 +03:00 [INF] Execute GetAll for entity Order
2025-08-15 10:24:25.644 +03:00 [WRN] The query uses a row limiting operator ('Skip'/'Take') without an 'OrderBy' operator. This may lead to unpredictable results. If the 'Distinct' operator is used after 'OrderBy', then make sure to use the 'OrderBy' operator after 'Distinct' as the ordering would otherwise get erased.
2025-08-15 10:24:25.653 +03:00 [WRN] The query uses a row limiting operator ('Skip'/'Take') without an 'OrderBy' operator. This may lead to unpredictable results. If the 'Distinct' operator is used after 'OrderBy', then make sure to use the 'OrderBy' operator after 'Distinct' as the ordering would otherwise get erased.
2025-08-15 10:24:25.820 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`OrderNumber`, `t0`.`Name`, `t`.`Status`, `t`.`Total`, `t`.`CreatedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`CustomerId`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Total`
    FROM `Orders` AS `o`
    LIMIT @__p_1 OFFSET @__p_0
) AS `t`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t0` ON `t`.`CustomerId` = `t0`.`Id`
2025-08-15 10:24:26.739 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.OrderDtos.OrderListDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:24:26.758 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.GetOrdersByStatus (E-Commerce) in 1204.2992ms
2025-08-15 10:24:26.768 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.GetOrdersByStatus (E-Commerce)'
2025-08-15 10:24:26.780 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Order/status/0?page=1&pageSize=10 - 200 774 application/json; charset=utf-8 1462.3495ms
2025-08-15 10:24:28.062 +03:00 [INF] Setting cache for key: order_filter_user_all_deleted_all_page_1_size_10_status_PendingPayment
2025-08-15 10:24:28.076 +03:00 [INF] Cache set successfully for key: order_filter_user_all_deleted_all_page_1_size_10_status_PendingPayment with tags: [order]
2025-08-15 10:24:28.089 +03:00 [INF] Successfully cached order list with key: order_filter_user_all_deleted_all_page_1_size_10_status_PendingPayment
2025-08-15 10:24:35.466 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Order/status/3?page=1&pageSize=10 - null null
2025-08-15 10:24:35.475 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:24:35.631 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:24:35.643 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.GetOrdersByStatus (E-Commerce)'
2025-08-15 10:24:35.649 +03:00 [INF] Route matched with {action = "GetOrdersByStatus", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.DtoModels.OrderDtos.OrderListDto]]]] GetOrdersByStatus(E_Commerce.Enums.OrderStatus, Int32, Int32) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 10:24:35.659 +03:00 [INF] Executing GetOrdersByStatus for status: Shipped, page: 1, size: 10
2025-08-15 10:24:35.664 +03:00 [INF] Filtering orders - UserId: , Deleted: , Page: 1, PageSize: 10, Status: Shipped
2025-08-15 10:24:35.668 +03:00 [INF] Getting cache for key: order_filter_user_all_deleted_all_page_1_size_10_status_Shipped
2025-08-15 10:24:35.674 +03:00 [WRN] Cache miss for key: order_filter_user_all_deleted_all_page_1_size_10_status_Shipped
2025-08-15 10:24:35.679 +03:00 [INF] Execute GetAll for entity Order
2025-08-15 10:24:35.834 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`OrderNumber`, `t0`.`Name`, `t`.`Status`, `t`.`Total`, `t`.`CreatedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`CustomerId`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Total`
    FROM `Orders` AS `o`
    LIMIT @__p_1 OFFSET @__p_0
) AS `t`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t0` ON `t`.`CustomerId` = `t0`.`Id`
2025-08-15 10:24:36.748 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.OrderDtos.OrderListDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:24:36.763 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.GetOrdersByStatus (E-Commerce) in 1106.0282ms
2025-08-15 10:24:36.777 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.GetOrdersByStatus (E-Commerce)'
2025-08-15 10:24:36.788 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Order/status/3?page=1&pageSize=10 - 200 774 application/json; charset=utf-8 1321.8291ms
2025-08-15 10:24:41.268 +03:00 [INF] Setting cache for key: order_filter_user_all_deleted_all_page_1_size_10_status_Shipped
2025-08-15 10:24:41.280 +03:00 [INF] Cache set successfully for key: order_filter_user_all_deleted_all_page_1_size_10_status_Shipped with tags: [order]
2025-08-15 10:24:41.295 +03:00 [INF] Successfully cached order list with key: order_filter_user_all_deleted_all_page_1_size_10_status_Shipped
2025-08-15 10:49:39.580 +03:00 [INF] DB tables already exist. Exit install
2025-08-15 10:49:41.136 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-15 10:49:42.474 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-15 10:49:43.141 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-15 10:49:43.343 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-15 10:49:43.370 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-15 10:49:43.397 +03:00 [INF] Starting data seeding...
2025-08-15 10:49:43.472 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-15 10:49:44.222 +03:00 [INF] Executed DbCommand (117ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-15 10:49:44.299 +03:00 [INF] Role 'Admin' already exists.
2025-08-15 10:49:44.450 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-15 10:49:44.455 +03:00 [INF] Role 'User' already exists.
2025-08-15 10:49:44.629 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-15 10:49:44.779 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-15 10:49:44.787 +03:00 [INF] Data seeding completed successfully.
2025-08-15 10:49:46.710 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-15 10:49:46.881 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-15 10:49:46.901 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-15 10:49:46.910 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-15 10:49:46.912 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-15 10:49:47.101 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-15 10:49:47.104 +03:00 [INF] Hosting environment: Development
2025-08-15 10:49:47.106 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-15 10:49:47.322 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-15 10:49:47.388 +03:00 [INF] Server mrrobot:18156:f676c36f successfully announced in 158.869 ms
2025-08-15 10:49:47.392 +03:00 [INF] Server mrrobot:18156:f676c36f is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-15 10:49:47.429 +03:00 [INF] Server mrrobot:18156:f676c36f all the dispatchers started
2025-08-15 10:49:47.541 +03:00 [INF] 1 servers were removed due to timeout
2025-08-15 10:49:47.592 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 273.9381ms
2025-08-15 10:49:47.778 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-15 10:49:47.778 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-15 10:49:47.784 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 6.5223ms
2025-08-15 10:49:47.785 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-15 10:49:47.795 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16504 application/javascript; charset=utf-8 9.3297ms
2025-08-15 10:49:47.825 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 46.3395ms
2025-08-15 10:49:48.588 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-15 10:49:48.753 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 181.3329ms
2025-08-15 10:50:22.975 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json-patch+json 62
2025-08-15 10:50:22.985 +03:00 [INF] CORS policy execution successful.
2025-08-15 10:50:22.989 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-15 10:50:24.403 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:50:24.623 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:50:24.645 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-15 10:50:24.673 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-15 10:50:24.993 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-15 10:50:25.004 +03:00 [INF] Adding item to cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe, product: 1
2025-08-15 10:50:25.363 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-15 10:50:25.374 +03:00 [INF] Execute GetAll for entity Product
2025-08-15 10:50:25.631 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__itemDto_ProductId_0='?' (DbType = Int32), @__itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-08-15 10:50:25.660 +03:00 [INF] Retrieving cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:50:25.791 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-15 10:50:25.828 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-08-15 10:50:25.906 +03:00 [INF] CartItem added successfully (pending save)
2025-08-15 10:50:25.909 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-15 10:50:25.912 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-15 10:50:25.942 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-15 10:50:26.311 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (Size = 255), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (DbType = DateTime), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:50:26.525 +03:00 [INF] Removing cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:50:26.545 +03:00 [INF] Cache removed successfully for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:50:26.550 +03:00 [INF] Item added to cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe, product: 1
2025-08-15 10:50:26.562 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:50:26.586 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 1901.4549ms
2025-08-15 10:50:26.591 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-15 10:50:26.596 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 3621.2146ms
2025-08-15 10:50:52.732 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json-patch+json 63
2025-08-15 10:50:52.736 +03:00 [INF] CORS policy execution successful.
2025-08-15 10:50:52.742 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:50:52.892 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:50:52.898 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 10:50:52.907 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 10:50:52.946 +03:00 [INF] Executing CreateOrderFromCart
2025-08-15 10:50:52.957 +03:00 [INF] Creating order from cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:50:53.267 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-15 10:50:53.359 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 10:50:53.369 +03:00 [INF] Checking if address 1 exists for customer: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:50:53.447 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-15 10:50:53.456 +03:00 [INF] Getting cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:50:53.467 +03:00 [INF] Getting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:50:53.474 +03:00 [WRN] Cache miss for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:50:53.549 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 10:50:53.555 +03:00 [INF] Execute GetAll for entity Cart
2025-08-15 10:50:53.704 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-15 10:50:53.722 +03:00 [INF] Setting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:50:53.773 +03:00 [INF] Cache set successfully for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe with tags: [cart]
2025-08-15 10:50:53.851 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-15 10:50:53.863 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-15 10:50:53.908 +03:00 [INF] Order added successfully (pending save)
2025-08-15 10:50:54.081 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:50:54.165 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-15 10:50:54.194 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-15 10:50:54.197 +03:00 [INF] Clearing cart: 2
2025-08-15 10:50:54.279 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-15 10:50:54.290 +03:00 [INF] Cart 2 cleared successfully
2025-08-15 10:50:54.294 +03:00 [INF] Removing cache by tag: cart
2025-08-15 10:50:54.302 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-15 10:50:54.464 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:50:54.556 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-15 10:50:54.560 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-15 10:50:54.580 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-15 10:50:54.589 +03:00 [INF] Starting CreatePaymentMethod for user d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:50:54.669 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-15 10:50:54.684 +03:00 [INF] Getting payment method ID for enum "Wallet"
2025-08-15 10:50:54.687 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 10:50:54.777 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 10:50:54.786 +03:00 [INF] Found payment method ID 2 for enum "Wallet"
2025-08-15 10:50:54.794 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-15 10:50:54.877 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-15 10:50:54.917 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-15 10:50:54.998 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-15 10:50:55.002 +03:00 [INF] Executing GetTokenAsync
2025-08-15 10:50:55.753 +03:00 [INF] Successfully retrieved PayMob token
2025-08-15 10:50:55.758 +03:00 [INF] Getting address by ID: 1
2025-08-15 10:50:55.855 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 10:50:56.388 +03:00 [INF] Successfully created PayMob order: 370823854 for local order: 6
2025-08-15 10:50:56.391 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 10:50:56.469 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-08-15 10:50:56.475 +03:00 [INF] Using integration ID: 5236287 for payment method: "Wallet"
2025-08-15 10:50:56.481 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 370823854, Amount: 20000
2025-08-15 10:50:56.983 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-15 10:50:56.986 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-08-15 10:50:56.987 +03:00 [INF] Payment key generated successfully for Order ID: 370823854
2025-08-15 10:50:56.989 +03:00 [INF] Successfully generated payment key for order: 6
2025-08-15 10:50:56.993 +03:00 [WRN] Failed to generate online payment link.
2025-08-15 10:50:57.075 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 10:50:57.082 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 4171.8134ms
2025-08-15 10:50:57.085 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 10:50:57.088 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 4356.156ms
2025-08-15 10:52:47.811 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-15 10:52:47.825 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 14.001ms
2025-08-15 10:52:47.872 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-15 10:52:47.875 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-15 10:52:47.878 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 5.2388ms
2025-08-15 10:52:47.919 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 43.4223ms
2025-08-15 10:52:47.934 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-15 10:52:47.962 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16504 application/javascript; charset=utf-8 28.3532ms
2025-08-15 10:52:48.731 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-15 10:52:48.945 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 213.5369ms
2025-08-15 10:53:34.125 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-15 10:53:34.134 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 8.4628ms
2025-08-15 10:53:34.168 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-15 10:53:34.169 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-15 10:53:34.173 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-15 10:53:34.175 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 6.4437ms
2025-08-15 10:53:34.182 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16504 application/javascript; charset=utf-8 8.2659ms
2025-08-15 10:53:34.186 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 16.8843ms
2025-08-15 10:53:34.586 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-15 10:53:34.713 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 126.5609ms
2025-08-15 10:54:43.523 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-15 10:54:43.559 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 35.3078ms
2025-08-15 10:54:43.588 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-15 10:54:43.597 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 8.8388ms
2025-08-15 10:54:43.616 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-15 10:54:43.625 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 9.2279ms
2025-08-15 10:54:43.634 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-15 10:54:43.638 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16504 application/javascript; charset=utf-8 3.9634ms
2025-08-15 10:54:43.839 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-15 10:54:43.992 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 152.9585ms
2025-08-15 10:54:52.641 +03:00 [INF] DB tables already exist. Exit install
2025-08-15 10:54:53.929 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-15 10:54:54.917 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-15 10:54:55.604 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-15 10:54:55.790 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-15 10:54:55.837 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-15 10:54:55.851 +03:00 [INF] Starting data seeding...
2025-08-15 10:54:55.875 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-15 10:54:56.369 +03:00 [INF] Executed DbCommand (107ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-15 10:54:56.432 +03:00 [INF] Role 'Admin' already exists.
2025-08-15 10:54:56.583 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-15 10:54:56.591 +03:00 [INF] Role 'User' already exists.
2025-08-15 10:54:56.767 +03:00 [INF] Executed DbCommand (87ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-15 10:54:56.852 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-15 10:54:56.856 +03:00 [INF] Data seeding completed successfully.
2025-08-15 10:54:58.069 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-15 10:54:58.174 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-15 10:54:58.177 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-15 10:54:58.180 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-15 10:54:58.182 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-15 10:54:58.195 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-15 10:54:58.196 +03:00 [INF] Hosting environment: Development
2025-08-15 10:54:58.199 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-15 10:54:58.268 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-15 10:54:58.354 +03:00 [INF] Server mrrobot:4788:632b98ce successfully announced in 155.4342 ms
2025-08-15 10:54:58.362 +03:00 [INF] Server mrrobot:4788:632b98ce is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-15 10:54:58.447 +03:00 [INF] Server mrrobot:4788:632b98ce all the dispatchers started
2025-08-15 10:54:58.460 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 192.1623ms
2025-08-15 10:54:58.560 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-15 10:54:58.611 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 50.2731ms
2025-08-15 10:54:58.638 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-15 10:54:58.647 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-15 10:54:58.654 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16504 application/javascript; charset=utf-8 7.6475ms
2025-08-15 10:54:58.681 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 43.4406ms
2025-08-15 10:54:58.869 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-15 10:54:59.157 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 288.048ms
2025-08-15 10:56:01.368 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json-patch+json 62
2025-08-15 10:56:01.376 +03:00 [INF] CORS policy execution successful.
2025-08-15 10:56:01.380 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-15 10:56:01.531 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:56:01.722 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:56:01.739 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-15 10:56:01.764 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-15 10:56:02.094 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-15 10:56:02.104 +03:00 [INF] Adding item to cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe, product: 1
2025-08-15 10:56:02.438 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-15 10:56:02.497 +03:00 [INF] Execute GetAll for entity Product
2025-08-15 10:56:02.667 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__itemDto_ProductId_0='?' (DbType = Int32), @__itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-08-15 10:56:02.677 +03:00 [INF] Retrieving cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:56:02.792 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-15 10:56:02.854 +03:00 [INF] Execute Update for entity CartItem
2025-08-15 10:56:02.865 +03:00 [INF] CartItem marked for update (pending save)
2025-08-15 10:56:02.868 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-15 10:56:02.871 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-15 10:56:02.923 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-15 10:56:03.209 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p10='?' (Size = 255), @p11='?' (DbType = DateTime), @p12='?' (DbType = DateTime), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (DbType = Int32), @p17='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `CartItems` SET `AddedAt` = @p0, `CartId` = @p1, `CreatedAt` = @p2, `DeletedAt` = @p3, `ModifiedAt` = @p4, `ProductId` = @p5, `ProductVariantId` = @p6, `Quantity` = @p7, `UnitPrice` = @p8
WHERE `Id` = @p9;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:56:03.398 +03:00 [INF] Removing cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:56:03.415 +03:00 [INF] Cache removed successfully for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:56:03.419 +03:00 [INF] Item added to cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe, product: 1
2025-08-15 10:56:03.432 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:56:03.456 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 1682.1011ms
2025-08-15 10:56:03.464 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-15 10:56:03.471 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 2102.8349ms
2025-08-15 10:56:35.268 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json-patch+json 100
2025-08-15 10:56:35.301 +03:00 [INF] CORS policy execution successful.
2025-08-15 10:56:35.308 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:56:35.463 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:56:35.471 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 10:56:35.479 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 10:56:35.507 +03:00 [INF] Executing CreateOrderFromCart
2025-08-15 10:56:35.516 +03:00 [INF] Creating order from cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:56:35.822 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-15 10:56:35.910 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 10:56:35.917 +03:00 [INF] Checking if address 1 exists for customer: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:56:35.998 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-15 10:56:36.007 +03:00 [INF] Getting cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:56:36.011 +03:00 [INF] Getting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:56:36.017 +03:00 [WRN] Cache miss for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:56:36.093 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 10:56:36.098 +03:00 [INF] Execute GetAll for entity Cart
2025-08-15 10:56:36.255 +03:00 [INF] Executed DbCommand (87ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-15 10:56:36.272 +03:00 [INF] Setting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:56:36.309 +03:00 [INF] Cache set successfully for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe with tags: [cart]
2025-08-15 10:56:36.392 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-15 10:56:36.403 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-15 10:56:36.456 +03:00 [INF] Order added successfully (pending save)
2025-08-15 10:56:36.629 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:56:36.716 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-15 10:56:36.742 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-15 10:56:36.747 +03:00 [INF] Clearing cart: 2
2025-08-15 10:56:36.831 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-15 10:56:36.840 +03:00 [INF] Cart 2 cleared successfully
2025-08-15 10:56:36.845 +03:00 [INF] Removing cache by tag: cart
2025-08-15 10:56:36.852 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-15 10:56:37.014 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 10:56:37.100 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-15 10:56:37.103 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-15 10:56:37.121 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-15 10:56:37.128 +03:00 [INF] Starting CreatePaymentMethod for user d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 10:56:37.208 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-15 10:56:37.215 +03:00 [INF] Getting payment method ID for enum "Wallet"
2025-08-15 10:56:37.218 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 10:56:37.304 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 10:56:37.314 +03:00 [INF] Found payment method ID 2 for enum "Wallet"
2025-08-15 10:56:37.323 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-15 10:56:37.411 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-15 10:56:37.437 +03:00 [WRN] Failed to generate online payment link.
2025-08-15 10:56:37.520 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 10:56:37.527 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 2042.9115ms
2025-08-15 10:56:37.531 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 10:56:37.534 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 2266.4135ms
2025-08-15 10:57:11.107 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - null null
2025-08-15 10:57:11.117 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:57:11.267 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:57:11.272 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-08-15 10:57:11.288 +03:00 [INF] Route matched with {action = "GetAll", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.Services.PaymentMethodsServices.PaymentMethodDto]]]] GetAll(System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-15 10:57:11.304 +03:00 [INF] Admin requested GetAll PaymentMethods | isActive: , isDeleted: , Page: 1, PageSize: 10
2025-08-15 10:57:11.315 +03:00 [INF] Getting cache for key: paymentmethods___page1_size10
2025-08-15 10:57:11.319 +03:00 [WRN] Cache miss for key: paymentmethods___page1_size10
2025-08-15 10:57:11.323 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 10:57:11.486 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM `PaymentMethods` AS `p`
2025-08-15 10:57:11.661 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Name`, `p`.`IsActive`, `p`.`PaymentProviderId`, `p`.`Method`
FROM `PaymentMethods` AS `p`
ORDER BY `p`.`Id`
LIMIT @__p_1 OFFSET @__p_0
2025-08-15 10:57:12.612 +03:00 [INF] Fetched payment methods from DB and cached result.
2025-08-15 10:57:12.616 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.Services.PaymentMethodsServices.PaymentMethodDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:57:12.622 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce) in 1325.1019ms
2025-08-15 10:57:12.628 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.GetAll (E-Commerce)'
2025-08-15 10:57:12.631 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/PaymentMethod?page=1&pageSize=10 - 200 453 application/json; charset=utf-8 1523.874ms
2025-08-15 10:57:14.213 +03:00 [INF] Setting cache for key: paymentmethods___page1_size10
2025-08-15 10:57:14.222 +03:00 [INF] Cache set successfully for key: paymentmethods___page1_size10 with tags: [Paymentmethodcache]
2025-08-15 10:59:53.428 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/Activate/2 - null 0
2025-08-15 10:59:53.440 +03:00 [INF] CORS policy execution successful.
2025-08-15 10:59:53.443 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 10:59:53.601 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 10:59:53.619 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.ActivatePaymentMethod (E-Commerce)'
2025-08-15 10:59:53.625 +03:00 [INF] Route matched with {action = "ActivatePaymentMethod", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] ActivatePaymentMethod(Int32) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-15 10:59:53.866 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-15 10:59:53.944 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-15 10:59:54.039 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 10:59:54.047 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.ActivatePaymentMethod (E-Commerce) in 417.6858ms
2025-08-15 10:59:54.057 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.ActivatePaymentMethod (E-Commerce)'
2025-08-15 10:59:54.063 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/Activate/2 - 400 227 application/json; charset=utf-8 634.2754ms
2025-08-15 10:59:58.664 +03:00 [INF] 1 servers were removed due to timeout
2025-08-15 11:00:22.331 +03:00 [INF] DB tables already exist. Exit install
2025-08-15 11:00:23.895 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-15 11:00:24.904 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-15 11:00:25.629 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-15 11:00:25.825 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-15 11:00:25.849 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-15 11:00:25.879 +03:00 [INF] Starting data seeding...
2025-08-15 11:00:25.920 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-15 11:00:26.906 +03:00 [INF] Executed DbCommand (208ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-15 11:00:26.994 +03:00 [INF] Role 'Admin' already exists.
2025-08-15 11:00:27.145 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-15 11:00:27.149 +03:00 [INF] Role 'User' already exists.
2025-08-15 11:00:27.331 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-15 11:00:27.463 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-15 11:00:27.464 +03:00 [INF] Data seeding completed successfully.
2025-08-15 11:00:29.287 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-15 11:00:29.432 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-15 11:00:29.675 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-15 11:00:29.692 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-15 11:00:29.694 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-15 11:00:29.958 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-15 11:00:29.978 +03:00 [INF] Hosting environment: Development
2025-08-15 11:00:29.994 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-15 11:00:30.065 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-15 11:00:30.152 +03:00 [INF] Server mrrobot:2536:aa5c642a successfully announced in 170.531 ms
2025-08-15 11:00:30.208 +03:00 [INF] Server mrrobot:2536:aa5c642a is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-15 11:00:30.772 +03:00 [INF] Server mrrobot:2536:aa5c642a all the dispatchers started
2025-08-15 11:00:31.084 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-15 11:00:31.156 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-15 11:00:31.160 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 1118.7229ms
2025-08-15 11:00:31.243 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 169.218ms
2025-08-15 11:00:31.257 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-15 11:00:31.250 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16504 application/javascript; charset=utf-8 93.9881ms
2025-08-15 11:00:31.436 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 179.2972ms
2025-08-15 11:00:31.590 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-15 11:00:31.875 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 285.6752ms
2025-08-15 11:00:47.149 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json-patch+json 71
2025-08-15 11:00:47.155 +03:00 [INF] CORS policy execution successful.
2025-08-15 11:00:47.163 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-15 11:00:47.373 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 11:00:47.403 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-08-15 11:00:47.412 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-08-15 11:00:47.426 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 401 0 null 277.1789ms
2025-08-15 11:00:56.018 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart - null null
2025-08-15 11:00:56.030 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 11:00:56.046 +03:00 [INF] No cached response available for this request.
2025-08-15 11:00:56.060 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-08-15 11:00:56.064 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-08-15 11:00:56.070 +03:00 [INF] The response could not be cached for this request.
2025-08-15 11:00:56.072 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart - 401 0 null 53.7174ms
2025-08-15 11:01:18.984 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart - null null
2025-08-15 11:01:19.088 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 11:01:19.293 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 11:01:19.311 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-15 11:01:19.344 +03:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CartDtos.CartDto]]] GetCart() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-15 11:01:19.706 +03:00 [INF] Executing GetCart
2025-08-15 11:01:19.712 +03:00 [INF] Getting cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:01:19.716 +03:00 [INF] Getting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:01:19.732 +03:00 [WRN] Cache miss for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:01:19.899 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:01:19.906 +03:00 [INF] Execute GetAll for entity Cart
2025-08-15 11:01:20.262 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-15 11:01:20.294 +03:00 [INF] Setting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:01:20.355 +03:00 [INF] Cache set successfully for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe with tags: [cart]
2025-08-15 11:01:20.374 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CartDtos.CartDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 11:01:20.421 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.GetCart (E-Commerce) in 1062.1924ms
2025-08-15 11:01:20.427 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-15 11:01:20.433 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart - 200 982 application/json; charset=utf-8 1448.3413ms
2025-08-15 11:02:25.989 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json-patch+json 101
2025-08-15 11:02:25.995 +03:00 [INF] CORS policy execution successful.
2025-08-15 11:02:25.998 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 11:02:26.150 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 11:02:26.158 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 11:02:26.193 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 11:02:26.296 +03:00 [INF] Executing CreateOrderFromCart
2025-08-15 11:02:26.305 +03:00 [INF] Creating order from cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:02:26.688 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-15 11:02:26.771 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:02:26.780 +03:00 [INF] Checking if address 1 exists for customer: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:02:26.862 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:02:26.880 +03:00 [INF] Getting cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:02:26.885 +03:00 [INF] Getting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:02:26.896 +03:00 [INF] Cache hit for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:02:26.925 +03:00 [INF] Cache hit for cart user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:02:27.005 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-15 11:02:27.026 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-15 11:02:27.140 +03:00 [INF] Order added successfully (pending save)
2025-08-15 11:02:27.487 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 11:02:27.612 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-15 11:02:27.639 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-15 11:02:27.642 +03:00 [INF] Clearing cart: 2
2025-08-15 11:02:27.723 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-15 11:02:27.750 +03:00 [INF] Cart 2 cleared successfully
2025-08-15 11:02:27.757 +03:00 [INF] Removing cache by tag: cart
2025-08-15 11:02:27.768 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-15 11:02:27.952 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 11:02:28.051 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-15 11:02:28.056 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-15 11:02:28.082 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-15 11:02:28.090 +03:00 [INF] Starting CreatePaymentMethod for user d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:02:28.170 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-15 11:02:28.185 +03:00 [INF] Getting payment method ID for enum "Wallet"
2025-08-15 11:02:28.190 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 11:02:28.278 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 11:02:28.287 +03:00 [INF] Found payment method ID 2 for enum "Wallet"
2025-08-15 11:02:28.292 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-15 11:02:28.371 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-15 11:02:28.407 +03:00 [WRN] Failed to generate online payment link.
2025-08-15 11:02:28.495 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 11:02:28.503 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 2305.8276ms
2025-08-15 11:02:28.510 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 11:02:28.513 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 2523.9497ms
2025-08-15 11:02:46.007 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json-patch+json 101
2025-08-15 11:02:46.012 +03:00 [INF] CORS policy execution successful.
2025-08-15 11:02:46.014 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 11:02:46.164 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 11:02:46.168 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 11:02:46.171 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 11:02:46.178 +03:00 [INF] Executing CreateOrderFromCart
2025-08-15 11:02:46.179 +03:00 [INF] Creating order from cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:02:46.483 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-15 11:02:46.565 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:02:46.573 +03:00 [INF] Checking if address 1 exists for customer: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:02:46.651 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:02:46.657 +03:00 [INF] Getting cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:02:46.661 +03:00 [INF] Getting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:02:46.664 +03:00 [WRN] Cache miss for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:02:46.738 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:02:46.742 +03:00 [INF] Execute GetAll for entity Cart
2025-08-15 11:02:46.838 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-15 11:02:46.850 +03:00 [INF] Setting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:02:46.852 +03:00 [INF] Cache set successfully for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe with tags: [cart]
2025-08-15 11:02:46.927 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-15 11:02:46.933 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-15 11:02:46.939 +03:00 [INF] Order added successfully (pending save)
2025-08-15 11:02:47.089 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 11:02:47.167 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-15 11:02:47.171 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-15 11:02:47.174 +03:00 [INF] Clearing cart: 2
2025-08-15 11:02:47.250 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-15 11:02:47.259 +03:00 [INF] Cart 2 cleared successfully
2025-08-15 11:02:47.260 +03:00 [INF] Removing cache by tag: cart
2025-08-15 11:02:47.263 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-15 11:02:47.412 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 11:02:47.507 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-15 11:02:47.508 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-15 11:02:47.510 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-15 11:02:47.512 +03:00 [INF] Starting CreatePaymentMethod for user d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:02:47.588 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-15 11:02:47.594 +03:00 [INF] Getting payment method ID for enum "Wallet"
2025-08-15 11:02:47.596 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 11:02:47.672 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 11:02:47.679 +03:00 [INF] Found payment method ID 2 for enum "Wallet"
2025-08-15 11:02:47.683 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-15 11:02:47.758 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-15 11:03:15.942 +03:00 [WRN] Failed to generate online payment link.
2025-08-15 11:03:16.021 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 11:03:16.028 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 29853.2522ms
2025-08-15 11:03:16.031 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 11:03:16.033 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 30025.6834ms
2025-08-15 11:03:40.243 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-15 11:03:40.267 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 23.6407ms
2025-08-15 11:03:40.295 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-15 11:03:40.298 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-15 11:03:40.299 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 4.1924ms
2025-08-15 11:03:40.327 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 29.3924ms
2025-08-15 11:03:40.365 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-15 11:03:40.375 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16504 application/javascript; charset=utf-8 10.5911ms
2025-08-15 11:03:41.511 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-15 11:03:41.696 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 184.5496ms
2025-08-15 11:04:03.865 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-15 11:04:03.876 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 11.0168ms
2025-08-15 11:04:03.897 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-15 11:04:03.898 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-15 11:04:03.901 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-15 11:04:03.904 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 7.3949ms
2025-08-15 11:04:03.921 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16504 application/javascript; charset=utf-8 19.3767ms
2025-08-15 11:04:03.927 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 28.5146ms
2025-08-15 11:04:04.043 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-15 11:04:04.163 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 120.209ms
2025-08-15 11:05:02.620 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json-patch+json 101
2025-08-15 11:05:02.629 +03:00 [INF] CORS policy execution successful.
2025-08-15 11:05:02.633 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 11:05:02.783 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 11:05:02.788 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 11:05:02.796 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 11:05:02.837 +03:00 [INF] Executing CreateOrderFromCart
2025-08-15 11:05:02.841 +03:00 [INF] Creating order from cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:05:03.147 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-15 11:05:03.238 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:05:03.245 +03:00 [INF] Checking if address 1 exists for customer: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:05:03.325 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:05:03.331 +03:00 [INF] Getting cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:05:03.333 +03:00 [INF] Getting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:05:03.338 +03:00 [WRN] Cache miss for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:05:03.414 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:05:03.422 +03:00 [INF] Execute GetAll for entity Cart
2025-08-15 11:05:03.510 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-15 11:05:03.517 +03:00 [INF] Setting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:05:03.544 +03:00 [INF] Cache set successfully for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe with tags: [cart]
2025-08-15 11:05:03.622 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-15 11:05:03.628 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-15 11:05:03.633 +03:00 [INF] Order added successfully (pending save)
2025-08-15 11:05:03.783 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 11:05:03.863 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-15 11:05:03.866 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-15 11:05:03.868 +03:00 [INF] Clearing cart: 2
2025-08-15 11:05:03.942 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-15 11:05:03.950 +03:00 [INF] Cart 2 cleared successfully
2025-08-15 11:05:03.952 +03:00 [INF] Removing cache by tag: cart
2025-08-15 11:05:03.955 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-15 11:05:04.108 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 11:05:04.192 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-15 11:05:04.201 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-15 11:05:04.210 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-15 11:05:04.230 +03:00 [INF] Starting CreatePaymentMethod for user d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:05:04.315 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-15 11:05:04.326 +03:00 [INF] Getting payment method ID for enum "Wallet"
2025-08-15 11:05:04.329 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 11:05:04.406 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 11:05:04.417 +03:00 [INF] Found payment method ID 2 for enum "Wallet"
2025-08-15 11:05:04.420 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-15 11:05:04.498 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-15 11:05:11.175 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-15 11:05:11.260 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-15 11:05:11.275 +03:00 [INF] Executing GetTokenAsync
2025-08-15 11:05:12.039 +03:00 [INF] Successfully retrieved PayMob token
2025-08-15 11:05:12.057 +03:00 [INF] Getting address by ID: 1
2025-08-15 11:05:12.219 +03:00 [INF] Executed DbCommand (133ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 11:05:12.807 +03:00 [INF] Successfully created PayMob order: 370826916 for local order: 10
2025-08-15 11:05:17.169 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 11:05:17.250 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-08-15 11:05:17.259 +03:00 [INF] Using integration ID: 5236287 for payment method: "Wallet"
2025-08-15 11:05:17.266 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 370826916, Amount: 30000
2025-08-15 11:05:17.782 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-15 11:05:17.784 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-08-15 11:05:17.787 +03:00 [INF] Payment key generated successfully for Order ID: 370826916
2025-08-15 11:05:17.790 +03:00 [INF] Successfully generated payment key for order: 10
2025-08-15 11:05:18.653 +03:00 [WRN] Failed to generate online payment link.
2025-08-15 11:05:18.729 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 11:05:18.735 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 15933.9554ms
2025-08-15 11:05:18.737 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 11:05:18.739 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 16119.5843ms
2025-08-15 11:05:30.556 +03:00 [INF] 1 servers were removed due to timeout
2025-08-15 11:06:09.553 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-15 11:06:09.570 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 17.2816ms
2025-08-15 11:06:09.723 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-15 11:06:09.728 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 4.5815ms
2025-08-15 11:06:09.782 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-15 11:06:09.803 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-15 11:06:09.813 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 31.7365ms
2025-08-15 11:06:09.832 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16504 application/javascript; charset=utf-8 28.9472ms
2025-08-15 11:06:10.075 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-15 11:06:10.513 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 438.214ms
2025-08-15 11:06:49.655 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json-patch+json 101
2025-08-15 11:06:49.662 +03:00 [INF] CORS policy execution successful.
2025-08-15 11:06:49.665 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 11:06:49.815 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 11:06:49.821 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 11:06:49.827 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 11:06:49.837 +03:00 [INF] Executing CreateOrderFromCart
2025-08-15 11:06:49.839 +03:00 [INF] Creating order from cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:06:50.134 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-15 11:06:50.218 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:06:50.224 +03:00 [INF] Checking if address 1 exists for customer: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:06:50.301 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:06:50.307 +03:00 [INF] Getting cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:06:50.308 +03:00 [INF] Getting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:06:50.311 +03:00 [WRN] Cache miss for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:06:50.388 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:06:50.395 +03:00 [INF] Execute GetAll for entity Cart
2025-08-15 11:06:50.482 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-15 11:06:50.490 +03:00 [INF] Setting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:06:50.500 +03:00 [INF] Cache set successfully for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe with tags: [cart]
2025-08-15 11:06:50.578 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-15 11:06:50.588 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-15 11:06:50.589 +03:00 [INF] Order added successfully (pending save)
2025-08-15 11:06:50.740 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 11:06:50.825 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-15 11:06:50.833 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-15 11:06:50.839 +03:00 [INF] Clearing cart: 2
2025-08-15 11:06:50.920 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-15 11:06:50.927 +03:00 [INF] Cart 2 cleared successfully
2025-08-15 11:06:50.929 +03:00 [INF] Removing cache by tag: cart
2025-08-15 11:06:50.935 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-15 11:06:51.087 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 11:06:51.167 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-15 11:06:51.170 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-15 11:06:51.172 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-15 11:06:51.173 +03:00 [INF] Starting CreatePaymentMethod for user d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:06:51.249 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-15 11:06:51.258 +03:00 [INF] Getting payment method ID for enum "Wallet"
2025-08-15 11:06:51.261 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 11:06:51.336 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 11:06:51.341 +03:00 [INF] Found payment method ID 2 for enum "Wallet"
2025-08-15 11:06:51.346 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-15 11:06:51.422 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-15 11:06:54.641 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-15 11:06:54.720 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-15 11:06:54.726 +03:00 [INF] Executing GetTokenAsync
2025-08-15 11:06:55.429 +03:00 [INF] Successfully retrieved PayMob token
2025-08-15 11:06:55.433 +03:00 [INF] Getting address by ID: 1
2025-08-15 11:06:55.516 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 11:06:56.078 +03:00 [INF] Successfully created PayMob order: 370827302 for local order: 11
2025-08-15 11:06:56.082 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 11:06:56.157 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-08-15 11:06:56.168 +03:00 [INF] Using integration ID: 5236287 for payment method: "Wallet"
2025-08-15 11:06:56.170 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 370827302, Amount: 30000
2025-08-15 11:06:56.682 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-15 11:06:56.686 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-08-15 11:06:56.692 +03:00 [INF] Payment key generated successfully for Order ID: 370827302
2025-08-15 11:06:56.698 +03:00 [INF] Successfully generated payment key for order: 11
2025-08-15 11:09:30.933 +03:00 [WRN] Failed to generate online payment link.
2025-08-15 11:09:34.487 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 11:09:34.492 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 164657.2774ms
2025-08-15 11:09:34.494 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 11:09:34.496 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 164841.5512ms
2025-08-15 11:09:45.331 +03:00 [INF] Execution RecurringJobScheduler recovered from the Faulted state after 00:00:21.5585089 and is in the Running state now
2025-08-15 11:23:20.289 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/2 - multipart/form-data; boundary=----WebKitFormBoundaryAEj1hb1nJyO7IydP 447
2025-08-15 11:23:20.296 +03:00 [INF] CORS policy execution successful.
2025-08-15 11:23:20.301 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 11:23:20.514 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 11:23:20.519 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-08-15 11:23:20.545 +03:00 [INF] Route matched with {action = "UpdatePaymentMethod", controller = "PaymentMethod"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdatePaymentMethod(Int32, E_Commerce.Services.PaymentMethodsServices.Updatepaymentmethoddto) on controller E_Commerce.Controllers.PaymentMethodController (E-Commerce).
2025-08-15 11:23:20.612 +03:00 [INF] Starting UpdatePaymentMethod for ID 2 by user d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:23:20.831 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-15 11:23:20.909 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-15 11:23:20.925 +03:00 [INF] Updating payment method: Wallet
2025-08-15 11:23:21.114 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `PaymentMethods` SET `Name` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-15 11:23:21.195 +03:00 [INF] Payment method updated successfully with ID 2
2025-08-15 11:23:21.199 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-15 11:23:21.201 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-15 11:23:21.225 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-15 11:23:21.228 +03:00 [INF] Admin operation logged for payment method update 2
2025-08-15 11:23:21.392 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 11:23:22.529 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-15 11:23:22.540 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce) in 1991.8859ms
2025-08-15 11:23:22.544 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentMethodController.UpdatePaymentMethod (E-Commerce)'
2025-08-15 11:23:22.548 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/PaymentMethod/2 - 200 122 application/json; charset=utf-8 2259.4407ms
2025-08-15 11:23:26.668 +03:00 [INF] Removing cache by tag: Paymentmethodcache
2025-08-15 11:23:26.672 +03:00 [INF] Removed 1 cache entries for tag: Paymentmethodcache
2025-08-15 11:23:52.503 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json-patch+json 101
2025-08-15 11:23:52.513 +03:00 [INF] CORS policy execution successful.
2025-08-15 11:23:52.517 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 11:23:52.668 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 11:23:52.688 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 11:23:52.702 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 11:23:52.715 +03:00 [INF] Executing CreateOrderFromCart
2025-08-15 11:23:52.718 +03:00 [INF] Creating order from cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:23:53.026 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-15 11:23:53.106 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:23:53.112 +03:00 [INF] Checking if address 1 exists for customer: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:23:53.188 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:23:53.197 +03:00 [INF] Getting cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:23:53.198 +03:00 [INF] Getting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:23:53.200 +03:00 [WRN] Cache miss for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:23:53.276 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:23:53.293 +03:00 [INF] Execute GetAll for entity Cart
2025-08-15 11:23:53.384 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-15 11:23:53.396 +03:00 [INF] Setting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:23:53.398 +03:00 [INF] Cache set successfully for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe with tags: [cart]
2025-08-15 11:23:53.474 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-15 11:23:53.481 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-15 11:23:53.483 +03:00 [INF] Order added successfully (pending save)
2025-08-15 11:23:53.634 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 11:23:53.737 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-15 11:23:53.750 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-15 11:23:53.758 +03:00 [INF] Clearing cart: 2
2025-08-15 11:23:53.836 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-15 11:23:53.847 +03:00 [INF] Cart 2 cleared successfully
2025-08-15 11:23:53.849 +03:00 [INF] Removing cache by tag: cart
2025-08-15 11:23:53.852 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-15 11:23:54.008 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 11:23:54.099 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-15 11:23:54.103 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-15 11:23:54.105 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-15 11:23:54.107 +03:00 [INF] Starting CreatePaymentMethod for user d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:23:54.183 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-15 11:23:54.189 +03:00 [INF] Getting payment method ID for enum "Wallet"
2025-08-15 11:23:54.190 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 11:23:54.266 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 11:23:54.271 +03:00 [INF] Found payment method ID 2 for enum "Wallet"
2025-08-15 11:23:54.275 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-15 11:23:54.351 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-15 11:23:58.904 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-15 11:23:58.982 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-15 11:23:58.990 +03:00 [INF] Executing GetTokenAsync
2025-08-15 11:23:59.576 +03:00 [INF] Successfully retrieved PayMob token
2025-08-15 11:23:59.580 +03:00 [INF] Getting address by ID: 1
2025-08-15 11:23:59.663 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 11:24:00.189 +03:00 [INF] Successfully created PayMob order: 370830965 for local order: 12
2025-08-15 11:24:00.196 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 11:24:00.271 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-08-15 11:24:00.279 +03:00 [INF] Using integration ID: 5236287 for payment method: "Wallet"
2025-08-15 11:24:00.282 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 370830965, Amount: 30000
2025-08-15 11:24:00.783 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-15 11:24:00.786 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-08-15 11:24:00.791 +03:00 [INF] Payment key generated successfully for Order ID: 370830965
2025-08-15 11:24:00.795 +03:00 [INF] Successfully generated payment key for order: 12
2025-08-15 11:24:32.221 +03:00 [WRN] Failed to generate online payment link.
2025-08-15 11:24:32.299 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 11:24:32.305 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 39592.3019ms
2025-08-15 11:24:32.309 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 11:24:32.312 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 500 214 application/json; charset=utf-8 39808.9668ms
2025-08-15 11:31:41.595 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - application/json-patch+json 101
2025-08-15 11:31:41.600 +03:00 [INF] CORS policy execution successful.
2025-08-15 11:31:41.602 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 11:31:41.753 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-15 11:31:41.758 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 11:31:41.761 +03:00 [INF] Route matched with {action = "CreateOrderFromCart", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrderFromCart(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-15 11:31:41.766 +03:00 [INF] Executing CreateOrderFromCart
2025-08-15 11:31:41.771 +03:00 [INF] Creating order from cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:31:42.076 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-15 11:31:42.158 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:31:42.165 +03:00 [INF] Checking if address 1 exists for customer: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:31:42.242 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:31:42.246 +03:00 [INF] Getting cart for user: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:31:42.247 +03:00 [INF] Getting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:31:42.249 +03:00 [WRN] Cache miss for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:31:42.325 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-15 11:31:42.333 +03:00 [INF] Execute GetAll for entity Cart
2025-08-15 11:31:42.422 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id1`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id1`, `p0`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`
2025-08-15 11:31:42.435 +03:00 [INF] Setting cache for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:31:42.443 +03:00 [INF] Cache set successfully for key: cart_user_d1c4400e-e5cc-4af0-919e-8b1fded727fe with tags: [cart]
2025-08-15 11:31:42.524 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-15 11:31:42.530 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-15 11:31:42.532 +03:00 [INF] Order added successfully (pending save)
2025-08-15 11:31:42.686 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (DbType = Decimal), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 11:31:42.769 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-15 11:31:42.774 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-15 11:31:42.776 +03:00 [INF] Clearing cart: 2
2025-08-15 11:31:42.853 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-15 11:31:42.864 +03:00 [INF] Cart 2 cleared successfully
2025-08-15 11:31:42.867 +03:00 [INF] Removing cache by tag: cart
2025-08-15 11:31:42.875 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-15 11:31:43.030 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Decimal), @p10='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 11:31:43.114 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-15 11:31:43.116 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-15 11:31:43.121 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-15 11:31:43.123 +03:00 [INF] Starting CreatePaymentMethod for user d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 11:31:43.200 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE (`o`.`Id` = @__id_0) AND `o`.`DeletedAt` IS NULL)
2025-08-15 11:31:43.209 +03:00 [INF] Getting payment method ID for enum "Wallet"
2025-08-15 11:31:43.211 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 11:31:43.287 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 11:31:43.301 +03:00 [INF] Found payment method ID 2 for enum "Wallet"
2025-08-15 11:31:43.305 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 2
2025-08-15 11:31:43.381 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-15 11:31:44.975 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-08-15 11:31:45.064 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-08-15 11:31:45.070 +03:00 [INF] Executing GetTokenAsync
2025-08-15 11:31:45.793 +03:00 [INF] Successfully retrieved PayMob token
2025-08-15 11:31:45.799 +03:00 [INF] Getting address by ID: 1
2025-08-15 11:31:45.886 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-15 11:31:46.374 +03:00 [INF] Successfully created PayMob order: 370832525 for local order: 13
2025-08-15 11:31:46.377 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-08-15 11:31:46.456 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-08-15 11:31:46.477 +03:00 [INF] Using integration ID: 5236287 for payment method: "Wallet"
2025-08-15 11:31:46.483 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 370832525, Amount: 30000
2025-08-15 11:31:46.991 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-08-15 11:31:46.994 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-08-15 11:31:46.997 +03:00 [INF] Payment key generated successfully for Order ID: 370832525
2025-08-15 11:31:47.001 +03:00 [INF] Successfully generated payment key for order: 13
2025-08-15 11:31:48.771 +03:00 [INF] Executing CreateAsync for entity Payment
2025-08-15 11:31:48.833 +03:00 [INF] Payment added successfully (pending save)
2025-08-15 11:31:49.063 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (Size = 100), @p11='?' (DbType = DateTime), @p12='?' (DbType = DateTime), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (DbType = Int32), @p17='?' (DbType = DateTime), @p18='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 11:31:49.149 +03:00 [INF] Payment created successfully with ID 5
2025-08-15 11:31:49.153 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-15 11:31:49.156 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-15 11:31:49.160 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-15 11:31:49.312 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-15 11:31:50.353 +03:00 [INF] Execute GetAll for entity Order
2025-08-15 11:31:50.591 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[@__createdOrder_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`DeletedAt`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`, `t0`.`c0`, `t0`.`CreatedAt0`, `t0`.`ModifiedAt0`, `t0`.`CustomerId`, `t0`.`PaymentMethodId`, `t0`.`c1`, `t0`.`CreatedAt1`, `t0`.`ModifiedAt1`, `t0`.`Name0`, `t0`.`PaymentProviderId`, `t0`.`c2`, `t0`.`CreatedAt2`, `t0`.`ModifiedAt2`, `t0`.`Name1`, `t0`.`Amount`, `t0`.`PaymentDate`, `t0`.`OrderId`, `t0`.`DeletedAt0`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`DeletedAt`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`, `p`.`Id` IS NULL AS `c0`, `p`.`Id` AS `Id1`, `p`.`CreatedAt` AS `CreatedAt0`, `p`.`ModifiedAt` AS `ModifiedAt0`, `p`.`CustomerId`, `p`.`PaymentMethodId`, `p0`.`Id` IS NULL AS `c1`, `p0`.`Id` AS `Id2`, `p0`.`CreatedAt` AS `CreatedAt1`, `p0`.`ModifiedAt` AS `ModifiedAt1`, `p0`.`Name` AS `Name0`, `p`.`PaymentProviderId`, `p1`.`Id` IS NULL AS `c2`, `p1`.`Id` AS `Id3`, `p1`.`CreatedAt` AS `CreatedAt2`, `p1`.`ModifiedAt` AS `ModifiedAt2`, `p1`.`Name` AS `Name1`, `p`.`Amount`, `p`.`PaymentDate`, `p`.`OrderId`, `p`.`DeletedAt` AS `DeletedAt0`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    LEFT JOIN `Payments` AS `p` ON `o`.`Id` = `p`.`OrderId`
    LEFT JOIN `PaymentMethods` AS `p0` ON `p`.`PaymentMethodId` = `p0`.`Id`
    LEFT JOIN `PaymentProviders` AS `p1` ON `p`.`PaymentProviderId` = `p1`.`Id`
    WHERE `o`.`Id` = @__createdOrder_Id_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p2`.`Id` AS `Id0`, `p2`.`Name`, `p2`.`Price`, `p2`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p2`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p2`.`Price`))
        ELSE `p2`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p2`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p3`.`Color`, COALESCE(`p3`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p3`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p3`.`Size`, `p3`.`DeletedAt`, COALESCE(`p3`.`Length`, 0) AS `Length`, COALESCE(`p3`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p3`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p2` ON `o0`.`ProductId` = `p2`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p2`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p3` ON `o0`.`ProductVariantId` = `p3`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t0`.`Id1`, `t0`.`Id2`, `t0`.`Id3`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-08-15 11:31:50.607 +03:00 [INF] Removing cache by tag: order
2025-08-15 11:31:50.613 +03:00 [INF] Removed 4 cache entries for tag: order
2025-08-15 11:31:50.616 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 11:31:50.647 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce) in 8882.2787ms
2025-08-15 11:31:50.659 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrderFromCart (E-Commerce)'
2025-08-15 11:31:50.665 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order/create-from-cart - 201 2350 application/json; charset=utf-8 9069.6471ms
2025-08-15 17:34:31.199 +03:00 [INF] DB tables already exist. Exit install
2025-08-15 17:34:32.680 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-15 17:34:33.684 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-15 17:34:34.372 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-15 17:34:34.544 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-15 17:34:34.575 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-15 17:34:34.596 +03:00 [INF] Starting data seeding...
2025-08-15 17:34:34.624 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-15 17:34:35.132 +03:00 [INF] Executed DbCommand (127ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-15 17:34:35.213 +03:00 [INF] Role 'Admin' already exists.
2025-08-15 17:34:35.369 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-15 17:34:35.395 +03:00 [INF] Role 'User' already exists.
2025-08-15 17:34:35.571 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-15 17:34:35.659 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-15 17:34:35.661 +03:00 [INF] Data seeding completed successfully.
2025-08-15 17:34:37.576 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-15 17:34:37.711 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-15 17:34:37.715 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-15 17:34:37.723 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-15 17:34:37.730 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-15 17:34:37.765 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-15 17:34:37.769 +03:00 [INF] Hosting environment: Development
2025-08-15 17:34:37.771 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-15 17:34:37.937 +03:00 [INF] Server mrrobot:16944:21b1a86a successfully announced in 155.7388 ms
2025-08-15 17:34:37.942 +03:00 [INF] Server mrrobot:16944:21b1a86a is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-15 17:34:38.003 +03:00 [INF] Server mrrobot:16944:21b1a86a all the dispatchers started
2025-08-15 17:34:40.306 +03:00 [WRN] Stopping the server due to DomainUnload or ProcessExit event...
2025-08-15 17:34:40.313 +03:00 [INF] Server mrrobot:16944:21b1a86a caught stopping signal...
2025-08-15 17:34:40.316 +03:00 [INF] Server mrrobot:16944:21b1a86a caught stopped signal...
2025-08-15 17:34:40.336 +03:00 [INF] Server mrrobot:16944:21b1a86a All dispatchers stopped
2025-08-15 17:34:40.346 +03:00 [WRN] Server mrrobot:16944:21b1a86a caught shutdown signal...
2025-08-15 18:01:33.189 +03:00 [INF] DB tables already exist. Exit install
2025-08-15 18:01:34.597 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-15 18:01:49.914 +03:00 [ERR] An error occurred using the connection to database '' on server 'mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com'.
2025-08-15 18:02:23.448 +03:00 [INF] DB tables already exist. Exit install
2025-08-15 18:02:24.560 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-15 18:02:25.810 +03:00 [INF] Executed DbCommand (96ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-15 18:02:26.809 +03:00 [INF] Executed DbCommand (108ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-15 18:02:27.057 +03:00 [INF] Executed DbCommand (97ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-15 18:02:27.092 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-15 18:02:27.106 +03:00 [INF] Starting data seeding...
2025-08-15 18:02:27.141 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-15 18:02:27.814 +03:00 [INF] Executed DbCommand (189ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-15 18:02:27.887 +03:00 [INF] Role 'Admin' already exists.
2025-08-15 18:02:28.208 +03:00 [INF] Executed DbCommand (170ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-15 18:02:28.217 +03:00 [INF] Role 'User' already exists.
2025-08-15 18:02:28.535 +03:00 [INF] Executed DbCommand (138ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-15 18:02:28.619 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-15 18:02:28.623 +03:00 [INF] Data seeding completed successfully.
2025-08-15 18:02:30.308 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-15 18:02:30.466 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-15 18:02:30.471 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-15 18:02:30.527 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-15 18:02:30.529 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-15 18:02:30.548 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-15 18:02:30.550 +03:00 [INF] Hosting environment: Development
2025-08-15 18:02:30.560 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-15 18:02:30.760 +03:00 [INF] Server mrrobot:6356:f7885936 successfully announced in 199.8558 ms
2025-08-15 18:02:30.766 +03:00 [INF] Server mrrobot:6356:f7885936 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-15 18:02:30.847 +03:00 [INF] Server mrrobot:6356:f7885936 all the dispatchers started
2025-08-15 18:02:31.741 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-15 18:02:32.036 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 293.9218ms
2025-08-15 18:02:32.098 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-15 18:02:32.108 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-15 18:02:32.146 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-15 18:02:32.164 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 65.9101ms
2025-08-15 18:02:32.306 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 197.9818ms
2025-08-15 18:02:32.410 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 264.2707ms
2025-08-15 18:02:32.481 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-15 18:02:32.748 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 267.2431ms
2025-08-15 18:02:59.383 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Account/login - application/json-patch+json 70
2025-08-15 18:02:59.401 +03:00 [INF] CORS policy execution successful.
2025-08-15 18:02:59.410 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-15 18:03:00.961 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 18:03:00.978 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce)'
2025-08-15 18:03:01.012 +03:00 [INF] Route matched with {action = "LoginAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.TokenDtos.TokensDto]]] LoginAsync(E_Commerce.DtoModels.AccountDtos.LoginDTo) on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-15 18:03:01.325 +03:00 [INF] In LoginAsync Method 
2025-08-15 18:03:01.643 +03:00 [INF] Executed DbCommand (180ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-15 18:03:01.757 +03:00 [INF] ðŸ” Generating Access Token for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 18:03:01.763 +03:00 [INF] ðŸ” Generating Access Token for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 18:03:02.014 +03:00 [INF] Executed DbCommand (136ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-08-15 18:03:02.273 +03:00 [INF] Executed DbCommand (140ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-15 18:03:02.723 +03:00 [INF] Executed DbCommand (128ms) [Parameters=[@p22='?' (Size = 255), @p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p23='?' (Size = 4000), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 256), @p6='?' (DbType = Boolean), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = DateTime), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTimeOffset), @p13='?' (Size = 4000), @p14='?' (Size = 256), @p15='?' (Size = 256), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = Boolean), @p19='?' (Size = 4000), @p20='?' (DbType = Boolean), @p21='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `AspNetUsers` SET `AccessFailedCount` = @p0, `Age` = @p1, `ConcurrencyStamp` = @p2, `CreateAt` = @p3, `DeletedAt` = @p4, `Email` = @p5, `EmailConfirmed` = @p6, `Gender` = @p7, `ImageId` = @p8, `ImageId1` = @p9, `LastVisit` = @p10, `LockoutEnabled` = @p11, `LockoutEnd` = @p12, `Name` = @p13, `NormalizedEmail` = @p14, `NormalizedUserName` = @p15, `PasswordHash` = @p16, `PhoneNumber` = @p17, `PhoneNumberConfirmed` = @p18, `SecurityStamp` = @p19, `TwoFactorEnabled` = @p20, `UserName` = @p21
WHERE `Id` = @p22 AND `ConcurrencyStamp` = @p23;
SELECT ROW_COUNT();
2025-08-15 18:03:03.046 +03:00 [INF] Executed DbCommand (98ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-08-15 18:03:03.151 +03:00 [INF] âœ… Access Token generated successfully for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 18:03:03.154 +03:00 [INF] ðŸ”‘ Generating Refresh Token for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 18:03:03.166 +03:00 [INF] âœ… RefreshToken generated and stored for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 18:03:03.208 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.TokenDtos.TokensDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 18:03:03.234 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce) in 2212.0065ms
2025-08-15 18:03:03.244 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce)'
2025-08-15 18:03:03.249 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Account/login - 200 1251 application/json; charset=utf-8 3865.9628ms
2025-08-15 19:16:08.041 +03:00 [INF] DB tables already exist. Exit install
2025-08-15 19:16:09.806 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-15 19:16:10.855 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-15 19:16:11.541 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-15 19:16:11.750 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-15 19:16:11.794 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-15 19:16:11.817 +03:00 [INF] Starting data seeding...
2025-08-15 19:16:11.869 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-15 19:16:12.425 +03:00 [INF] Executed DbCommand (114ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-15 19:16:12.556 +03:00 [INF] Role 'Admin' already exists.
2025-08-15 19:16:12.712 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-15 19:16:12.738 +03:00 [INF] Role 'User' already exists.
2025-08-15 19:16:12.956 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-15 19:16:13.192 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-15 19:16:13.196 +03:00 [INF] Data seeding completed successfully.
2025-08-15 19:16:14.718 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-15 19:16:14.866 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-15 19:16:14.870 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-15 19:16:14.872 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-15 19:16:14.874 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-15 19:16:14.892 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-15 19:16:14.899 +03:00 [INF] Hosting environment: Development
2025-08-15 19:16:14.905 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-15 19:16:15.060 +03:00 [INF] Server mrrobot:10768:e08d1d42 successfully announced in 156.1273 ms
2025-08-15 19:16:15.066 +03:00 [INF] Server mrrobot:10768:e08d1d42 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-15 19:16:15.100 +03:00 [INF] Server mrrobot:10768:e08d1d42 all the dispatchers started
2025-08-15 19:16:15.689 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-15 19:16:16.433 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 762.0902ms
2025-08-15 19:16:16.460 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-15 19:16:16.490 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-15 19:16:16.497 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 37.2543ms
2025-08-15 19:16:16.507 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-15 19:16:16.523 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 33.5237ms
2025-08-15 19:16:16.674 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 167.7853ms
2025-08-15 19:16:16.732 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-15 19:16:17.002 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 270.3519ms
2025-08-15 19:17:15.093 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Account/login - application/json-patch+json 70
2025-08-15 19:17:15.102 +03:00 [INF] CORS policy execution successful.
2025-08-15 19:17:15.110 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-15 19:17:15.253 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 19:17:15.276 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce)'
2025-08-15 19:17:15.328 +03:00 [INF] Route matched with {action = "LoginAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.TokenDtos.TokensDto]]] LoginAsync(E_Commerce.DtoModels.AccountDtos.LoginDTo) on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-15 19:17:15.822 +03:00 [INF] In LoginAsync Method 
2025-08-15 19:17:15.979 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-15 19:17:16.167 +03:00 [INF] ðŸ” Generating Access Token for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 19:17:16.182 +03:00 [INF] ðŸ” Generating Access Token for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 19:17:16.363 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-08-15 19:17:16.531 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-15 19:17:17.006 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p22='?' (Size = 255), @p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p23='?' (Size = 4000), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 256), @p6='?' (DbType = Boolean), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = DateTime), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTimeOffset), @p13='?' (Size = 4000), @p14='?' (Size = 256), @p15='?' (Size = 256), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = Boolean), @p19='?' (Size = 4000), @p20='?' (DbType = Boolean), @p21='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `AspNetUsers` SET `AccessFailedCount` = @p0, `Age` = @p1, `ConcurrencyStamp` = @p2, `CreateAt` = @p3, `DeletedAt` = @p4, `Email` = @p5, `EmailConfirmed` = @p6, `Gender` = @p7, `ImageId` = @p8, `ImageId1` = @p9, `LastVisit` = @p10, `LockoutEnabled` = @p11, `LockoutEnd` = @p12, `Name` = @p13, `NormalizedEmail` = @p14, `NormalizedUserName` = @p15, `PasswordHash` = @p16, `PhoneNumber` = @p17, `PhoneNumberConfirmed` = @p18, `SecurityStamp` = @p19, `TwoFactorEnabled` = @p20, `UserName` = @p21
WHERE `Id` = @p22 AND `ConcurrencyStamp` = @p23;
SELECT ROW_COUNT();
2025-08-15 19:17:17.266 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-08-15 19:17:17.332 +03:00 [INF] âœ… Access Token generated successfully for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 19:17:17.337 +03:00 [INF] ðŸ”‘ Generating Refresh Token for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 19:17:17.351 +03:00 [INF] âœ… RefreshToken generated and stored for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 19:17:17.410 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.TokenDtos.TokensDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 19:17:17.447 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce) in 2102.5444ms
2025-08-15 19:17:17.451 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce)'
2025-08-15 19:17:17.470 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Account/login - 200 1251 application/json; charset=utf-8 2376.1317ms
2025-08-15 19:24:33.365 +03:00 [INF] DB tables already exist. Exit install
2025-08-15 19:24:34.772 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-15 19:24:35.778 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-15 19:24:36.464 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-15 19:24:36.636 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-15 19:24:36.674 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-15 19:24:36.689 +03:00 [INF] Starting data seeding...
2025-08-15 19:24:36.716 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-15 19:24:37.258 +03:00 [INF] Executed DbCommand (132ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-15 19:24:37.323 +03:00 [INF] Role 'Admin' already exists.
2025-08-15 19:24:37.478 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-15 19:24:37.489 +03:00 [INF] Role 'User' already exists.
2025-08-15 19:24:37.666 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-15 19:24:37.827 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-15 19:24:37.830 +03:00 [INF] Data seeding completed successfully.
2025-08-15 19:24:39.104 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-15 19:24:39.247 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-15 19:24:39.250 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-15 19:24:39.251 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-15 19:24:39.256 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-15 19:24:39.285 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-15 19:24:39.289 +03:00 [INF] Hosting environment: Development
2025-08-15 19:24:39.298 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-15 19:24:39.451 +03:00 [INF] Server mrrobot:5560:facf42fd successfully announced in 156.9463 ms
2025-08-15 19:24:39.460 +03:00 [INF] Server mrrobot:5560:facf42fd is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-15 19:24:39.540 +03:00 [INF] Server mrrobot:5560:facf42fd all the dispatchers started
2025-08-15 19:24:39.609 +03:00 [INF] 1 servers were removed due to timeout
2025-08-15 19:24:39.808 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-15 19:24:40.155 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 347.4207ms
2025-08-15 19:24:40.236 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-15 19:24:40.236 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-15 19:24:40.258 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-15 19:24:40.263 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 27.4951ms
2025-08-15 19:24:40.290 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 32.0489ms
2025-08-15 19:24:40.403 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 164.4619ms
2025-08-15 19:24:40.478 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-15 19:24:40.858 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 379.5566ms
2025-08-15 19:24:58.655 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Account/login - application/json-patch+json 70
2025-08-15 19:24:58.664 +03:00 [INF] CORS policy execution successful.
2025-08-15 19:24:58.686 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-15 19:24:58.832 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-15 19:24:58.849 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce)'
2025-08-15 19:24:58.889 +03:00 [INF] Route matched with {action = "LoginAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.TokenDtos.TokensDto]]] LoginAsync(E_Commerce.DtoModels.AccountDtos.LoginDTo) on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-15 19:24:59.360 +03:00 [INF] In LoginAsync Method 
2025-08-15 19:24:59.519 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-15 19:24:59.686 +03:00 [INF] ðŸ” Generating Access Token for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 19:24:59.701 +03:00 [INF] ðŸ” Generating Access Token for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 19:24:59.898 +03:00 [INF] Executed DbCommand (100ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-08-15 19:25:00.065 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-15 19:25:00.515 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p22='?' (Size = 255), @p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p23='?' (Size = 4000), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 256), @p6='?' (DbType = Boolean), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = DateTime), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTimeOffset), @p13='?' (Size = 4000), @p14='?' (Size = 256), @p15='?' (Size = 256), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = Boolean), @p19='?' (Size = 4000), @p20='?' (DbType = Boolean), @p21='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `AspNetUsers` SET `AccessFailedCount` = @p0, `Age` = @p1, `ConcurrencyStamp` = @p2, `CreateAt` = @p3, `DeletedAt` = @p4, `Email` = @p5, `EmailConfirmed` = @p6, `Gender` = @p7, `ImageId` = @p8, `ImageId1` = @p9, `LastVisit` = @p10, `LockoutEnabled` = @p11, `LockoutEnd` = @p12, `Name` = @p13, `NormalizedEmail` = @p14, `NormalizedUserName` = @p15, `PasswordHash` = @p16, `PhoneNumber` = @p17, `PhoneNumberConfirmed` = @p18, `SecurityStamp` = @p19, `TwoFactorEnabled` = @p20, `UserName` = @p21
WHERE `Id` = @p22 AND `ConcurrencyStamp` = @p23;
SELECT ROW_COUNT();
2025-08-15 19:25:00.793 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-08-15 19:25:00.865 +03:00 [INF] âœ… Access Token generated successfully for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 19:25:00.872 +03:00 [INF] ðŸ”‘ Generating Refresh Token for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 19:25:00.888 +03:00 [INF] âœ… RefreshToken generated and stored for User ID: d1c4400e-e5cc-4af0-919e-8b1fded727fe
2025-08-15 19:25:00.941 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.TokenDtos.TokensDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-15 19:25:00.982 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce) in 2078.3473ms
2025-08-15 19:25:00.991 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce)'
2025-08-15 19:25:00.998 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Account/login - 200 1251 application/json; charset=utf-8 2342.2908ms
2025-08-15 19:25:16.489 +03:00 [WRN] Stopping the server due to DomainUnload or ProcessExit event...
2025-08-15 19:25:16.559 +03:00 [INF] Server mrrobot:5560:facf42fd caught stopping signal...
2025-08-15 19:25:16.566 +03:00 [INF] Server mrrobot:5560:facf42fd caught stopped signal...
2025-08-15 19:25:16.574 +03:00 [INF] Server mrrobot:5560:facf42fd All dispatchers stopped
2025-08-15 19:25:16.597 +03:00 [WRN] Server mrrobot:5560:facf42fd caught shutdown signal...
