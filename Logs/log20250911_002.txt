2025-09-11 19:57:21.617 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-09-11 19:57:23.483 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-11 19:57:24.158 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-11 19:57:24.324 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-09-11 19:57:24.340 +03:00 [INF] Applying migration '20250911165452_updatepaymen'.
2025-09-11 19:57:24.993 +03:00 [ERR] Failed executing DbCommand (228ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX `IX_Payments_OrderId_Status_PaymentMethodId` ON `Payments` (`OrderId`, `Status`, `PaymentMethodId`);
2025-09-11 20:02:39.141 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-09-11 20:02:41.183 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-11 20:02:41.873 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-11 20:02:42.132 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-09-11 20:02:42.312 +03:00 [INF] Applying migration '20250911165452_updatepaymen'.
2025-09-11 20:02:43.031 +03:00 [ERR] Failed executing DbCommand (85ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

                DELETE FROM Payments
                WHERE Id NOT IN (
                    SELECT MIN(Id)
                    FROM Payments
                    GROUP BY OrderId, Status, PaymentMethodId
                );
2025-09-11 20:05:43.070 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-09-11 20:05:44.710 +03:00 [INF] Executed DbCommand (93ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-11 20:05:45.395 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-11 20:05:45.564 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-09-11 20:05:45.600 +03:00 [INF] Applying migration '20250911165452_updatepaymen'.
2025-09-11 20:05:46.178 +03:00 [INF] Executed DbCommand (120ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

    DELETE FROM Payments
    WHERE Id NOT IN (
        SELECT Id FROM (
            SELECT MIN(Id) AS Id
            FROM Payments
            GROUP BY OrderId, Status, PaymentMethodId
        ) AS tmp
    );
2025-09-11 20:05:46.361 +03:00 [INF] Executed DbCommand (182ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX `IX_Payments_OrderId_Status_PaymentMethodId` ON `Payments` (`OrderId`, `Status`, `PaymentMethodId`);
2025-09-11 20:05:46.434 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `__EFMigrationsHistory` (`MigrationId`, `ProductVersion`)
VALUES ('20250911165452_updatepaymen', '8.0.13');
2025-09-11 20:06:07.770 +03:00 [INF] DB tables already exist. Exit install
2025-09-11 20:06:09.293 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-09-11 20:06:10.274 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-11 20:06:11.014 +03:00 [INF] Executed DbCommand (98ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-11 20:06:11.191 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-09-11 20:06:11.237 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-11 20:06:11.257 +03:00 [INF] Starting data seeding...
2025-09-11 20:06:11.307 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-11 20:06:11.811 +03:00 [INF] Executed DbCommand (108ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-11 20:06:11.874 +03:00 [INF] Role 'Admin' already exists.
2025-09-11 20:06:12.027 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-11 20:06:12.037 +03:00 [INF] Role 'User' already exists.
2025-09-11 20:06:12.209 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-11 20:06:12.313 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-09-11 20:06:12.316 +03:00 [INF] Data seeding completed successfully.
2025-09-11 20:06:14.265 +03:00 [INF] Now listening on: http://localhost:5069
2025-09-11 20:06:14.371 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-09-11 20:06:14.398 +03:00 [INF] Using the following options for SQL Server job storage:
2025-09-11 20:06:14.400 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-09-11 20:06:14.402 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-09-11 20:06:14.439 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-11 20:06:14.462 +03:00 [INF] Hosting environment: Development
2025-09-11 20:06:14.470 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-09-11 20:06:14.649 +03:00 [INF] Server mrrobot:16836:d25d92fb successfully announced in 198.8935 ms
2025-09-11 20:06:14.710 +03:00 [INF] Server mrrobot:16836:d25d92fb is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-09-11 20:06:14.775 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-09-11 20:06:14.787 +03:00 [INF] Server mrrobot:16836:d25d92fb all the dispatchers started
2025-09-11 20:06:14.896 +03:00 [INF] 2 servers were removed due to timeout
2025-09-11 20:06:15.139 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 365.0993ms
2025-09-11 20:06:15.155 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-11 20:06:15.165 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 9.9377ms
2025-09-11 20:06:15.208 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-11 20:06:15.218 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-09-11 20:06:15.308 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 89.7842ms
2025-09-11 20:06:15.345 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 137.1781ms
2025-09-11 20:06:15.408 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-09-11 20:06:15.800 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 391.98ms
2025-09-11 20:09:12.027 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire - null null
2025-09-11 20:09:12.060 +03:00 [WRN] Failed to determine the https port for redirect.
2025-09-11 20:09:14.410 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire - 200 null text/html 2382.9627ms
2025-09-11 20:09:14.444 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/css-dark181801664897329 - null null
2025-09-11 20:09:14.444 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/js181802147093725 - null null
2025-09-11 20:09:14.445 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-11 20:09:14.445 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-11 20:09:14.447 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/css181801475891583 - null null
2025-09-11 20:09:14.464 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/css-dark181801664897329 - 200 null text/css 19.958ms
2025-09-11 20:09:14.492 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 47.211ms
2025-09-11 20:09:14.507 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/js181802147093725 - 200 null application/javascript 62.9587ms
2025-09-11 20:09:14.530 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/css181801475891583 - 200 null text/css 82.688ms
2025-09-11 20:09:14.530 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 84.7177ms
2025-09-11 20:09:16.372 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/jobs/enqueued - null null
2025-09-11 20:09:16.669 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 258
2025-09-11 20:09:16.687 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:09:17.938 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/jobs/enqueued - 200 null text/html 1565.6967ms
2025-09-11 20:09:17.974 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-11 20:09:17.975 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-11 20:09:17.982 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.4605ms
2025-09-11 20:09:18.014 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1344.0929ms
2025-09-11 20:09:18.032 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 55.851ms
2025-09-11 20:09:19.252 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - null null
2025-09-11 20:09:20.017 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:09:20.026 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:09:21.421 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1403.1481ms
2025-09-11 20:09:21.635 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - 200 null text/html 2382.5131ms
2025-09-11 20:09:21.688 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-11 20:09:21.675 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-11 20:09:21.783 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 95.0634ms
2025-09-11 20:09:21.837 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 161.2111ms
2025-09-11 20:09:23.827 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:09:23.837 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:09:24.749 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/jobs/scheduled/enqueue - application/x-www-form-urlencoded; charset=UTF-8 319
2025-09-11 20:09:24.757 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:09:25.228 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1400.9963ms
2025-09-11 20:09:27.256 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:09:27.273 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:09:28.690 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1433.8095ms
2025-09-11 20:09:30.707 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:09:30.735 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:09:32.311 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1603.4811ms
2025-09-11 20:09:32.785 +03:00 [INF] Starting CheckAndUpdatePaymentStatusAsync for payment 35
2025-09-11 20:09:32.987 +03:00 [INF] Starting CheckAndUpdatePaymentStatusAsync for payment 34
2025-09-11 20:09:32.987 +03:00 [INF] Starting CheckAndUpdatePaymentStatusAsync for payment 33
2025-09-11 20:09:32.987 +03:00 [INF] Starting CheckAndUpdatePaymentStatusAsync for payment 31
2025-09-11 20:09:33.003 +03:00 [INF] Starting CheckAndUpdatePaymentStatusAsync for payment 32
2025-09-11 20:09:33.036 +03:00 [INF] Executing GetByIdAsync for entity Payment with ID: 35
2025-09-11 20:09:33.131 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:09:33.140 +03:00 [WRN] Payment with ID 35 not found or deleted
2025-09-11 20:09:33.142 +03:00 [WRN] Payment 35 not found
2025-09-11 20:09:33.220 +03:00 [INF] Executing GetByIdAsync for entity Payment with ID: 34
2025-09-11 20:09:33.220 +03:00 [INF] Executing GetByIdAsync for entity Payment with ID: 33
2025-09-11 20:09:33.226 +03:00 [INF] Executing GetByIdAsync for entity Payment with ID: 31
2025-09-11 20:09:33.243 +03:00 [INF] Executing GetByIdAsync for entity Payment with ID: 32
2025-09-11 20:09:33.312 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:09:33.314 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:09:33.316 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:09:33.320 +03:00 [WRN] Payment with ID 34 not found or deleted
2025-09-11 20:09:33.325 +03:00 [WRN] Payment with ID 33 not found or deleted
2025-09-11 20:09:33.330 +03:00 [WRN] Payment with ID 31 not found or deleted
2025-09-11 20:09:33.331 +03:00 [WRN] Payment 34 not found
2025-09-11 20:09:33.334 +03:00 [WRN] Payment 33 not found
2025-09-11 20:09:33.337 +03:00 [WRN] Payment 31 not found
2025-09-11 20:09:33.413 +03:00 [INF] Executed DbCommand (167ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:09:33.425 +03:00 [WRN] Payment with ID 32 not found or deleted
2025-09-11 20:09:33.427 +03:00 [WRN] Payment 32 not found
2025-09-11 20:09:34.334 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:09:34.343 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:09:35.720 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1386.2759ms
2025-09-11 20:09:36.146 +03:00 [INF] Starting CheckAndUpdatePaymentStatusAsync for payment 28
2025-09-11 20:09:36.369 +03:00 [INF] Executing GetByIdAsync for entity Payment with ID: 28
2025-09-11 20:09:36.448 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:09:36.456 +03:00 [WRN] Payment with ID 28 not found or deleted
2025-09-11 20:09:36.458 +03:00 [WRN] Payment 28 not found
2025-09-11 20:09:37.735 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:09:37.743 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:09:38.989 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1254.0919ms
2025-09-11 20:09:39.389 +03:00 [INF] Starting CheckAndUpdatePaymentStatusAsync for payment 26
2025-09-11 20:09:39.612 +03:00 [INF] Executing GetByIdAsync for entity Payment with ID: 26
2025-09-11 20:09:39.693 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:09:39.710 +03:00 [WRN] Payment with ID 26 not found or deleted
2025-09-11 20:09:39.714 +03:00 [WRN] Payment 26 not found
2025-09-11 20:09:41.009 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:09:41.035 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:09:42.443 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1434.5525ms
2025-09-11 20:09:42.665 +03:00 [INF] Starting CheckAndUpdatePaymentStatusAsync for payment 24
2025-09-11 20:09:42.886 +03:00 [INF] Executing GetByIdAsync for entity Payment with ID: 24
2025-09-11 20:09:42.967 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:09:42.994 +03:00 [WRN] Payment with ID 24 not found or deleted
2025-09-11 20:09:42.997 +03:00 [WRN] Payment 24 not found
2025-09-11 20:09:43.172 +03:00 [INF] Starting CheckAndUpdatePaymentStatusAsync for payment 22
2025-09-11 20:09:43.393 +03:00 [INF] Executing GetByIdAsync for entity Payment with ID: 22
2025-09-11 20:09:43.476 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:09:43.491 +03:00 [WRN] Payment with ID 22 not found or deleted
2025-09-11 20:09:43.497 +03:00 [WRN] Payment 22 not found
2025-09-11 20:09:44.455 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:09:44.462 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:09:45.702 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1246.9735ms
2025-09-11 20:09:46.039 +03:00 [INF] Setting cache for key: advsearch__________False_1_100__
2025-09-11 20:09:46.344 +03:00 [INF] Cache set successfully for key: advsearch__________False_1_100__ with tags: [product_search]
2025-09-11 20:09:46.647 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 126
2025-09-11 20:09:46.736 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:09:46.927 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/jobs/scheduled/enqueue - 204 null null 22177.6971ms
2025-09-11 20:09:46.935 +03:00 [INF] Executed DbCommand (87ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:09:46.970 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - null null
2025-09-11 20:09:47.257 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:09:47.713 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:09:47.723 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:09:49.126 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1413.3953ms
2025-09-11 20:09:49.126 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - 200 null text/html 2155.9087ms
2025-09-11 20:09:49.248 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-11 20:09:49.269 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-11 20:09:49.291 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 22.2884ms
2025-09-11 20:09:49.298 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 50.655ms
2025-09-11 20:09:49.487 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 124
2025-09-11 20:09:49.566 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:09:49.649 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:09:49.805 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:09:51.316 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:09:51.332 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:09:52.645 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1328.4181ms
2025-09-11 20:09:53.050 +03:00 [INF] Order 126 auto-expired and restock scheduled
2025-09-11 20:09:53.524 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:09:53.527 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 124
2025-09-11 20:09:53.562 +03:00 [INF] Execute UpdateOrderAfterPaid_id:126_to status:"PaymentExpired"
2025-09-11 20:09:53.563 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:09:53.578 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 20:09:53.695 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:09:53.792 +03:00 [INF] Execute GetAll for entity Order
2025-09-11 20:09:53.795 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 20:09:53.857 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:09:53.867 +03:00 [INF] Execute GetAll for entity OrderItem
2025-09-11 20:09:53.898 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:09:53.968 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:09:53.979 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:09:53.986 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CancelledAt`, `t`.`CreatedAt`, `t`.`CustomerAddressId`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`DeliveredAt`, `t`.`DiscountAmount`, `t`.`ModifiedAt`, `t`.`Notes`, `t`.`OrderNumber`, `t`.`RestockedAt`, `t`.`RowVersion`, `t`.`ShippedAt`, `t`.`ShippingCost`, `t`.`Status`, `t`.`Subtotal`, `t`.`TaxAmount`, `t`.`Total`, `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`DeletedAt`, `o0`.`ModifiedAt`, `o0`.`OrderId`, `o0`.`OrderedAt`, `o0`.`ProductId`, `o0`.`ProductVariantId`, `o0`.`Quantity`, `o0`.`TotalPrice`, `o0`.`UnitPrice`
FROM (
    SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
    FROM `Orders` AS `o`
    WHERE `o`.`Id` = @__orderId_0
    LIMIT 1
) AS `t`
LEFT JOIN `OrderItem` AS `o0` ON `t`.`Id` = `o0`.`OrderId`
ORDER BY `t`.`Id`
2025-09-11 20:09:54.002 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:09:54.035 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-09-11 20:09:54.046 +03:00 [INF] Adding quantity for variant: 9
2025-09-11 20:09:54.096 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:09:54.106 +03:00 [WRN] Invalid status transition from "PaymentExpired" to "PaymentExpired"
2025-09-11 20:09:54.326 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:09:54.369 +03:00 [INF] Executed DbCommand (91ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-11 20:09:54.411 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:09:54.482 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 9
2025-09-11 20:09:54.573 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:09:54.661 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:09:54.670 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:09:55.304 +03:00 [INF] Order 124 auto-expired and restock scheduled
2025-09-11 20:09:55.582 +03:00 [INF] Quantity for variant 9 increased by 19
2025-09-11 20:09:55.586 +03:00 [INF] Adding quantity for variant: 2
2025-09-11 20:09:55.882 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-11 20:09:55.890 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 2
2025-09-11 20:09:55.901 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:09:55.967 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:09:56.066 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1404.4876ms
2025-09-11 20:09:56.328 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:09:56.647 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 125
2025-09-11 20:09:56.798 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:09:56.835 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:09:56.849 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:09:56.850 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 20:09:56.862 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:09:56.944 +03:00 [INF] Quantity for variant 2 increased by 3
2025-09-11 20:09:56.954 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:09:56.963 +03:00 [INF] Execute GetAll for entity OrderItem
2025-09-11 20:09:57.071 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 20:09:57.100 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-11 20:09:57.113 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-09-11 20:09:57.156 +03:00 [INF] Adding quantity for variant: 6
2025-09-11 20:09:57.249 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:09:57.263 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:09:57.279 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:09:57.288 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:09:57.458 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-11 20:09:57.459 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 20:09:57.465 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 6
2025-09-11 20:09:57.523 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:09:57.548 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:09:57.598 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:09:57.682 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 20:09:58.028 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:09:58.075 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:09:58.085 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:09:58.512 +03:00 [INF] Quantity for variant 6 increased by 3
2025-09-11 20:09:58.737 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-11 20:09:58.810 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:09:59.036 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:09:59.321 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1246.1494ms
2025-09-11 20:09:59.621 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:09:59.939 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:10:00.064 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:10:00.108 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 20:10:00.138 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-11 20:10:00.296 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-11 20:10:00.324 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 20:10:00.352 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-11 20:10:00.371 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:10:00.549 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:10:00.610 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:10:01.289 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 20:10:01.335 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:10:01.462 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:10:02.226 +03:00 [INF] Restocked inventory for order 124
2025-09-11 20:10:02.231 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 20:10:02.821 +03:00 [INF] Removed 1 cache entries for tags: [variantlist, variantdata]
2025-09-11 20:10:03.483 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 2147.5115ms
2025-09-11 20:10:03.870 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-11 20:10:04.087 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:10:04.091 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-11 20:10:04.096 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 20:10:04.161 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-11 20:10:04.229 +03:00 [INF] Restocked inventory for order 125
2025-09-11 20:10:04.231 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:10:04.314 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 20:10:04.389 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-11 20:10:04.515 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:10:04.599 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-11 20:10:04.673 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:10:04.745 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:10:04.767 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:10:04.815 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-11 20:10:04.971 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:10:04.979 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:10:04.986 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:10:04.986 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:10:05.177 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:10:05.195 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:10:05.399 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:10:05.408 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:10:05.412 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:10:05.418 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:10:05.491 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:10:05.506 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:10:05.575 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:10:05.575 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:10:05.590 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:10:06.002 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:10:06.007 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:10:06.024 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:10:06.465 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:10:06.776 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1284.9745ms
2025-09-11 20:10:06.893 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:10:06.982 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:10:07.119 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-11 20:10:07.136 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-11 20:10:07.207 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:10:07.284 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 1
2025-09-11 20:10:07.336 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-11 20:10:07.350 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-11 20:10:07.410 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:10:07.425 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:10:07.442 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:10:07.550 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:10:07.637 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:10:07.717 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:10:07.851 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:10:07.983 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:10:08.065 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:10:08.147 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:10:08.493 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:10:08.794 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:10:08.806 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:10:09.524 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:10:09.745 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:10:09.760 +03:00 [INF] Removing cache by tag: cart
2025-09-11 20:10:09.955 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:10:10.174 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:10:10.191 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1396.7882ms
2025-09-11 20:10:10.407 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-09-11 20:10:12.215 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:10:12.243 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:10:13.521 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1305.7109ms
2025-09-11 20:10:15.537 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:10:15.563 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:10:16.979 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1442.2203ms
2025-09-11 20:10:19.000 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:10:19.018 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:10:20.415 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1414.7423ms
2025-09-11 20:10:22.432 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:10:22.442 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:10:23.865 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1433.1318ms
2025-09-11 20:10:25.878 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:10:25.888 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:10:27.402 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1523.9264ms
2025-09-11 20:10:29.428 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:10:29.438 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:10:30.899 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1470.9561ms
2025-09-11 20:10:32.912 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:10:32.930 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:10:34.320 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1407.9135ms
2025-09-11 20:10:36.332 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:10:36.351 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:10:38.076 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1743.9662ms
2025-09-11 20:10:40.091 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:10:40.097 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:10:41.357 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1265.1776ms
2025-09-11 20:10:41.579 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 1
2025-09-11 20:10:41.734 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:10:41.910 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-11 20:10:43.373 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:10:43.383 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:10:44.135 +03:00 [INF] Removing cache by tag: cart
2025-09-11 20:10:44.366 +03:00 [WRN] No cache entries found for tag: cart
2025-09-11 20:10:44.811 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1437.9306ms
2025-09-11 20:10:46.836 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:10:46.844 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:10:48.104 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1268.4495ms
2025-09-11 20:10:49.581 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 1
2025-09-11 20:10:49.730 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:10:49.884 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-11 20:10:50.293 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:10:50.302 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:10:51.730 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1436.4531ms
2025-09-11 20:10:52.089 +03:00 [INF] Removing cache by tag: cart
2025-09-11 20:10:52.310 +03:00 [WRN] No cache entries found for tag: cart
2025-09-11 20:10:54.111 +03:00 [INF] Execute GetAll for entity CartItem
2025-09-11 20:10:55.057 +03:00 [INF] Executed DbCommand (116ms) [Parameters=[@__cartItemId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE (`c`.`Id` = @__cartItemId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:10:56.189 +03:00 [INF] Retrieving cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-09-11 20:10:57.524 +03:00 [INF] CartItem 82 price updated to 3374.08790000
2025-09-11 20:10:58.474 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-11 20:10:59.228 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:10:59.295 +03:00 [INF] Executed DbCommand (199ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
UPDATE `CartItems` SET `UnitPrice` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:11:00.061 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-11 20:11:00.480 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:11:00.895 +03:00 [INF] Executed DbCommand (90ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:11:01.285 +03:00 [WRN] Failed to process the job '4892': an exception occurred. Retry attempt 1 of 10 will be performed in 00:00:15.
Microsoft.EntityFrameworkCore.DbUpdateConcurrencyException: The database operation was expected to affect 1 row(s), but actually affected 0 row(s); data may have been modified or deleted since entities were loaded. See https://go.microsoft.com/fwlink/?LinkId=527962 for information on understanding and handling optimistic concurrency exceptions.
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ThrowAggregateUpdateConcurrencyExceptionAsync(RelationalDataReader reader, Int32 commandIndex, Int32 expectedRowsAffected, Int32 rowsAffected, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Update.Internal.MySqlModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.CartServices.CartQueryService.UpdateCartItemPriceAsync(Int32 cartItemId, Decimal newPrice) in D:\project_fashion\E-Commerce-API-main\Services\CartServices\CartQueryService.cs:line 167
   at InvokeStub_TaskAwaiter.GetResult(Object, Object, IntPtr*)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-09-11 20:11:02.072 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 2843.5ms
2025-09-11 20:11:03.010 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 20:11:03.920 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 20:11:05.014 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:11:06.873 +03:00 [INF] Removed 1 cache entries for tags: [variantlist, variantdata]
2025-09-11 20:11:07.393 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:11:08.038 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:11:08.991 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:11:09.898 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:11:10.969 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:11:11.008 +03:00 [INF] Execute GetAll for entity CartItem
2025-09-11 20:11:11.725 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__cartItemId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE (`c`.`Id` = @__cartItemId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:11:11.960 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:11:16.970 +03:00 [INF] Setting cache for key: order:id:127_user:ac03a6c3-9450-420a-9e6e-ea8902c018c5_admin:True
2025-09-11 20:11:18.984 +03:00 [INF] Cache set successfully for key: order:id:127_user:ac03a6c3-9450-420a-9e6e-ea8902c018c5_admin:True with tags: [order]
2025-09-11 20:11:26.077 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Order/number/ORD-20250911164319-5167 - null null
2025-09-11 20:11:26.448 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:11:26.650 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:11:26.672 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Order/number/ORD-20250911164319-5167 - 401 null application/json 594.9384ms
2025-09-11 20:11:53.876 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Order/number/ORD-20250911164319-5167 - null null
2025-09-11 20:11:54.894 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:11:55.126 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:11:56.157 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce)'
2025-09-11 20:11:56.294 +03:00 [INF] Route matched with {action = "GetOrderByNumber", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderDto]]] GetOrderByNumber(System.String) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-11 20:11:57.152 +03:00 [INF] Executing GetOrderByNumber for number: ORD-20250911164319-5167
2025-09-11 20:11:57.546 +03:00 [INF] Getting order by number: ORD-20250911164319-5167 for user: e682f183-1c61-400b-aa5a-171750f446b5, IsAdmin: false
2025-09-11 20:11:58.620 +03:00 [INF] Getting cache for key: order:number:ORD-20250911164319-5167_user:e682f183-1c61-400b-aa5a-171750f446b5_admin:False
2025-09-11 20:11:59.312 +03:00 [WRN] Cache miss for key: order:number:ORD-20250911164319-5167_user:e682f183-1c61-400b-aa5a-171750f446b5_admin:False
2025-09-11 20:11:59.600 +03:00 [INF] Checking if order ORD-20250911164319-5167 exists for user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:12:00.259 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__ordernumber_0='?' (Size = 50), @__userid_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE ((`o`.`OrderNumber` = @__ordernumber_0) AND (`o`.`CustomerId` = @__userid_1)) AND `o`.`DeletedAt` IS NULL)
2025-09-11 20:12:00.734 +03:00 [INF] Execute GetAll for entity Order
2025-09-11 20:12:01.928 +03:00 [INF] Executed DbCommand (112ms) [Parameters=[@__8__locals1_orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`DeletedAt`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`DeletedAt`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    WHERE `o`.`OrderNumber` = @__8__locals1_orderNumber_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, `p`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`))
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p0`.`Color`, COALESCE(`p0`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p0`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p0`.`Size`, `p0`.`DeletedAt`, COALESCE(`p0`.`Length`, 0) AS `Length`, COALESCE(`p0`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p0`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p` ON `o0`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p0` ON `o0`.`ProductVariantId` = `p0`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-09-11 20:12:05.730 +03:00 [INF] Order ORD-20250911164319-5167 retrieved successfully for user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:12:05.885 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:12:07.068 +03:00 [INF] Setting cache for key: order:number:ORD-20250911164319-5167_user:e682f183-1c61-400b-aa5a-171750f446b5_admin:False
2025-09-11 20:12:07.465 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce) in 10484.0696ms
2025-09-11 20:12:09.832 +03:00 [INF] Cache set successfully for key: order:number:ORD-20250911164319-5167_user:e682f183-1c61-400b-aa5a-171750f446b5_admin:False with tags: [order]
2025-09-11 20:12:11.183 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce)'
2025-09-11 20:12:12.131 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Order/number/ORD-20250911164319-5167 - 200 1409 application/json; charset=utf-8 18254.8716ms
2025-09-11 20:12:32.036 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:12:32.246 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:12:34.378 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 2341.7621ms
2025-09-11 20:12:43.364 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:12:43.372 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:12:47.686 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 4322.1976ms
2025-09-11 20:25:23.385 +03:00 [INF] DB tables already exist. Exit install
2025-09-11 20:25:24.988 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-09-11 20:25:26.031 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-11 20:25:26.710 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-11 20:25:26.885 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-09-11 20:25:26.907 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-11 20:25:26.918 +03:00 [INF] Starting data seeding...
2025-09-11 20:25:26.949 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-11 20:25:28.301 +03:00 [INF] Executed DbCommand (136ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-11 20:25:28.403 +03:00 [INF] Role 'Admin' already exists.
2025-09-11 20:25:28.566 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-11 20:25:28.574 +03:00 [INF] Role 'User' already exists.
2025-09-11 20:25:28.762 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-11 20:25:28.868 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-09-11 20:25:28.879 +03:00 [INF] Data seeding completed successfully.
2025-09-11 20:25:30.361 +03:00 [INF] Now listening on: http://localhost:5069
2025-09-11 20:25:30.468 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-09-11 20:25:30.472 +03:00 [INF] Using the following options for SQL Server job storage:
2025-09-11 20:25:30.477 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-09-11 20:25:30.481 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-09-11 20:25:30.496 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-11 20:25:30.502 +03:00 [INF] Hosting environment: Development
2025-09-11 20:25:30.505 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-09-11 20:25:30.697 +03:00 [INF] Server mrrobot:18404:4ca2c025 successfully announced in 189.3744 ms
2025-09-11 20:25:30.711 +03:00 [INF] Server mrrobot:18404:4ca2c025 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-09-11 20:25:30.806 +03:00 [INF] Server mrrobot:18404:4ca2c025 all the dispatchers started
2025-09-11 20:26:18.155 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Order/number/ORD-20250911164319-5167 - null null
2025-09-11 20:26:18.194 +03:00 [WRN] Failed to determine the https port for redirect.
2025-09-11 20:26:18.440 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:26:18.700 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:26:18.726 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce)'
2025-09-11 20:26:18.781 +03:00 [INF] Route matched with {action = "GetOrderByNumber", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderDto]]] GetOrderByNumber(System.String) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-11 20:26:19.162 +03:00 [INF] Executing GetOrderByNumber for number: ORD-20250911164319-5167
2025-09-11 20:26:19.174 +03:00 [INF] Getting order by number: ORD-20250911164319-5167 for user: e682f183-1c61-400b-aa5a-171750f446b5, IsAdmin: false
2025-09-11 20:26:19.184 +03:00 [INF] Getting cache for key: order:number:ORD-20250911164319-5167_user:e682f183-1c61-400b-aa5a-171750f446b5_admin:False
2025-09-11 20:26:19.424 +03:00 [INF] Cache hit for key: order:number:ORD-20250911164319-5167_user:e682f183-1c61-400b-aa5a-171750f446b5_admin:False
2025-09-11 20:26:19.485 +03:00 [INF] Cache hit for order number ORD-20250911164319-5167
2025-09-11 20:26:19.504 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:26:19.567 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce) in 775.6101ms
2025-09-11 20:26:19.572 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce)'
2025-09-11 20:26:19.585 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Order/number/ORD-20250911164319-5167 - 200 1407 application/json; charset=utf-8 1430.321ms
2025-09-11 20:26:52.141 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Order?page=1&pageSize=10 - null null
2025-09-11 20:26:52.259 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:26:52.440 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:26:52.460 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.GetOrders (E-Commerce)'
2025-09-11 20:26:52.541 +03:00 [INF] Route matched with {action = "GetOrders", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.DtoModels.OrderDtos.OrderListDto]]]] GetOrders(System.String, System.Nullable`1[System.Boolean], Int32, Int32, System.Nullable`1[E_Commerce.Enums.OrderStatus]) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-11 20:26:52.638 +03:00 [INF] Executing GetOrders: role: User, userId: e682f183-1c61-400b-aa5a-171750f446b5, deleted: , page: 1, size: 10, status: 
2025-09-11 20:26:52.656 +03:00 [INF] Filtering orders - UserId: e682f183-1c61-400b-aa5a-171750f446b5, Deleted: null, Page: 1, PageSize: 10, Status: null
2025-09-11 20:26:52.663 +03:00 [INF] Getting cache for key: order:filter:user:e682f183-1c61-400b-aa5a-171750f446b5_deleted:all_page:1_size:10_status:all
2025-09-11 20:26:52.877 +03:00 [WRN] Cache miss for key: order:filter:user:e682f183-1c61-400b-aa5a-171750f446b5_deleted:all_page:1_size:10_status:all
2025-09-11 20:26:52.882 +03:00 [INF] Execute GetAll for entity Order
2025-09-11 20:26:53.133 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__8__locals1_userId_0='?' (Size = 255), @__p_2='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`OrderNumber`, `t0`.`Name`, `t`.`Status`, `t`.`Total`, `t`.`CreatedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`CustomerId`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Total`
    FROM `Orders` AS `o`
    WHERE `o`.`CustomerId` = @__8__locals1_userId_0
    ORDER BY `o`.`CreatedAt` DESC
    LIMIT @__p_2 OFFSET @__p_1
) AS `t`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t0` ON `t`.`CustomerId` = `t0`.`Id`
ORDER BY `t`.`CreatedAt` DESC
2025-09-11 20:26:54.139 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.OrderDtos.OrderListDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-11 20:26:54.154 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.GetOrders (E-Commerce) in 1562.1478ms
2025-09-11 20:26:54.217 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.GetOrders (E-Commerce)'
2025-09-11 20:26:54.221 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Order?page=1&pageSize=10 - 200 936 application/json; charset=utf-8 2079.932ms
2025-09-11 20:26:55.565 +03:00 [INF] Setting cache for key: order:filter:user:e682f183-1c61-400b-aa5a-171750f446b5_deleted:all_page:1_size:10_status:all
2025-09-11 20:26:55.806 +03:00 [INF] Cache set successfully for key: order:filter:user:e682f183-1c61-400b-aa5a-171750f446b5_deleted:all_page:1_size:10_status:all with tags: [order]
2025-09-11 20:27:19.373 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart - null null
2025-09-11 20:27:19.386 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:27:19.538 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:27:19.549 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-09-11 20:27:19.556 +03:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CartDtos.CartDto]]] GetCart() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-11 20:27:19.569 +03:00 [INF] Executing GetCart
2025-09-11 20:27:19.577 +03:00 [INF] Getting cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:27:19.584 +03:00 [INF] Getting cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:27:19.799 +03:00 [WRN] Cache miss for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:27:19.966 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-11 20:27:19.974 +03:00 [INF] Execute GetAll for entity Cart
2025-09-11 20:27:20.235 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-09-11 20:27:20.298 +03:00 [INF] Setting cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:27:20.521 +03:00 [INF] Cache set successfully for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5 with tags: [cart]
2025-09-11 20:27:20.525 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CartDtos.CartDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:27:20.539 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.GetCart (E-Commerce) in 973.3207ms
2025-09-11 20:27:20.542 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-09-11 20:27:20.551 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart - 200 336 application/json; charset=utf-8 1178.8179ms
2025-09-11 20:27:56.746 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 62
2025-09-11 20:27:56.828 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:27:56.994 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:27:57.021 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-11 20:27:57.028 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-11 20:27:57.063 +03:00 [INF] Executing AddItemToCart for product ID: 6
2025-09-11 20:27:57.077 +03:00 [INF] Adding item to cart for user: e682f183-1c61-400b-aa5a-171750f446b5, product: 6
2025-09-11 20:27:57.415 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:27:57.426 +03:00 [INF] Execute GetAll for entity Product
2025-09-11 20:27:57.528 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-09-11 20:27:57.538 +03:00 [INF] Retrieving cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:27:57.653 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-11 20:27:57.786 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Cart WHERE Id = @p0 FOR UPDATE
2025-09-11 20:27:57.796 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-09-11 20:27:57.877 +03:00 [INF] CartItem added successfully (pending save)
2025-09-11 20:27:57.883 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:27:57.886 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:27:57.916 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:27:59.140 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (DbType = Int32), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`, `RowVersion`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:27:59.357 +03:00 [INF] Removing cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:27:59.786 +03:00 [INF] Cache removed successfully for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:27:59.794 +03:00 [INF] Item added to cart for user: e682f183-1c61-400b-aa5a-171750f446b5, product: 6
2025-09-11 20:27:59.805 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-11 20:27:59.823 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 2786.776ms
2025-09-11 20:27:59.922 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-11 20:28:00.388 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 3641.8084ms
2025-09-11 20:28:00.619 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 3
2025-09-11 20:28:01.054 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:28:05.102 +03:00 [INF] Removing cache by tag: cart
2025-09-11 20:28:05.824 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-09-11 20:28:10.258 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - null 0
2025-09-11 20:28:10.271 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:28:10.430 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:28:10.439 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-11 20:28:10.444 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-11 20:28:10.475 +03:00 [INF] Executing CheckOut
2025-09-11 20:28:10.483 +03:00 [INF] Checkout of cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:28:10.486 +03:00 [INF] Retrieving cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:28:10.648 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-11 20:28:10.813 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-11 20:28:10.824 +03:00 [INF] Removing cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:28:10.829 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-11 20:28:10.835 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 381.4197ms
2025-09-11 20:28:10.841 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-11 20:28:10.844 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - 200 122 application/json; charset=utf-8 585.9805ms
2025-09-11 20:28:11.260 +03:00 [INF] Cache removed successfully for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:28:23.768 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json 42
2025-09-11 20:28:23.842 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:28:23.994 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:28:24.003 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-11 20:28:24.009 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-11 20:28:24.055 +03:00 [INF] Executing CreateOrder
2025-09-11 20:28:24.070 +03:00 [INF] Creating order from cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:28:24.373 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:28:24.456 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-11 20:28:24.469 +03:00 [INF] Checking if address 31 exists for customer: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:28:24.551 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-09-11 20:28:24.558 +03:00 [INF] Getting cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:28:24.561 +03:00 [INF] Getting cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:28:24.772 +03:00 [WRN] Cache miss for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:28:24.850 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-11 20:28:24.859 +03:00 [INF] Execute GetAll for entity Cart
2025-09-11 20:28:24.955 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-09-11 20:28:26.748 +03:00 [INF] Setting cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:28:26.976 +03:00 [INF] Cache set successfully for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5 with tags: [cart]
2025-09-11 20:28:26.986 +03:00 [INF] Execute GetAll for entity ProductVariant
2025-09-11 20:28:27.087 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE `p`.`Id` = 4
2025-09-11 20:28:27.175 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-09-11 20:28:27.191 +03:00 [INF] Executing CreateAsync for entity Order
2025-09-11 20:28:27.250 +03:00 [INF] Order added successfully (pending save)
2025-09-11 20:28:27.428 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = Decimal), @p13='?' (DbType = Int32), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal), @p16='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `RestockedAt`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`, `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:28:27.524 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-09-11 20:28:27.561 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-09-11 20:28:27.571 +03:00 [INF] Removing 3 from variant: 4
2025-09-11 20:28:27.647 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity - @p0 WHERE Id = @p1 AND Quantity >= @p0
2025-09-11 20:28:27.659 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 4
2025-09-11 20:28:27.742 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:28:27.792 +03:00 [INF] Execute GetAll for entity CartItem
2025-09-11 20:28:27.956 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__cartItemId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE (`c`.`Id` = @__cartItemId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:28:28.090 +03:00 [INF] CartItem 83 price updated to 3374.08790000
2025-09-11 20:28:28.118 +03:00 [INF] Retrieving cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:28:28.374 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-11 20:28:28.502 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
UPDATE `CartItems` SET `UnitPrice` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:28:28.527 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-11 20:28:28.533 +03:00 [INF] Checkout date removed for cart of user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:28:28.658 +03:00 [INF] Clearing cart: 3
2025-09-11 20:28:28.744 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-09-11 20:28:28.758 +03:00 [INF] Cart 3 cleared successfully
2025-09-11 20:28:28.938 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 8) (DbType = Binary), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = Decimal), @p11='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0 AND `RowVersion` IS NULL;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:28:29.096 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:28:29.101 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:28:29.104 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:28:29.105 +03:00 [INF] Execute GetAll for entity Order
2025-09-11 20:28:29.144 +03:00 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-09-11 20:28:29.325 +03:00 [INF] Executed DbCommand (92ms) [Parameters=[@__createdOrder_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`DeletedAt`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`Id0`, `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`, `p0`.`Status`, `p0`.`Amount`, `p0`.`CreatedAt`, `p0`.`Id`, `p0`.`PaymentDate`, `p0`.`PaymentMethodId`, `p0`.`PaymentProviderId`, `t0`.`c`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`DeletedAt`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    WHERE `o`.`Id` = @__createdOrder_Id_0
    LIMIT 1
) AS `t0`
LEFT JOIN `Payments` AS `p` ON `t0`.`Id` = `p`.`OrderId`
LEFT JOIN `Payments` AS `p0` ON `t0`.`Id` = `p0`.`OrderId`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p1`.`Id` AS `Id0`, `p1`.`Name`, `p1`.`Price`, `p1`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p1`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p1`.`Price`))
        ELSE `p1`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p1`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p2`.`Color`, COALESCE(`p2`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p2`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p2`.`Size`, `p2`.`DeletedAt`, COALESCE(`p2`.`Length`, 0) AS `Length`, COALESCE(`p2`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p2`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p1` ON `o0`.`ProductId` = `p1`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p1`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p2` ON `o0`.`ProductVariantId` = `p2`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `p`.`Id`, `p0`.`Id`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-09-11 20:28:31.520 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 20:28:31.538 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-11 20:28:31.890 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:28:32.645 +03:00 [INF] Removed 3 cache entries for tags: [order]
2025-09-11 20:28:34.601 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:28:34.633 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 10617.2651ms
2025-09-11 20:28:34.641 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-11 20:28:34.644 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 201 1432 application/json; charset=utf-8 10877.2936ms
2025-09-11 20:28:35.520 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:28:36.028 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:28:37.506 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:28:37.935 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:28:38.414 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:28:38.469 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:28:38.474 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:28:38.477 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-11 20:28:38.486 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-11 20:28:38.695 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-11 20:28:38.699 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-11 20:28:38.844 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:28:38.900 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:28:38.901 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:28:46.817 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Order?page=1&pageSize=10 - null null
2025-09-11 20:28:46.826 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:28:46.989 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:28:47.026 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.GetOrders (E-Commerce)'
2025-09-11 20:28:47.029 +03:00 [INF] Route matched with {action = "GetOrders", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.DtoModels.OrderDtos.OrderListDto]]]] GetOrders(System.String, System.Nullable`1[System.Boolean], Int32, Int32, System.Nullable`1[E_Commerce.Enums.OrderStatus]) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-11 20:28:47.041 +03:00 [INF] Executing GetOrders: role: User, userId: e682f183-1c61-400b-aa5a-171750f446b5, deleted: , page: 1, size: 10, status: 
2025-09-11 20:28:47.044 +03:00 [INF] Filtering orders - UserId: e682f183-1c61-400b-aa5a-171750f446b5, Deleted: null, Page: 1, PageSize: 10, Status: null
2025-09-11 20:28:47.048 +03:00 [INF] Getting cache for key: order:filter:user:e682f183-1c61-400b-aa5a-171750f446b5_deleted:all_page:1_size:10_status:all
2025-09-11 20:28:47.263 +03:00 [WRN] Cache miss for key: order:filter:user:e682f183-1c61-400b-aa5a-171750f446b5_deleted:all_page:1_size:10_status:all
2025-09-11 20:28:47.271 +03:00 [INF] Execute GetAll for entity Order
2025-09-11 20:28:47.420 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__8__locals1_userId_0='?' (Size = 255), @__p_2='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`OrderNumber`, `t0`.`Name`, `t`.`Status`, `t`.`Total`, `t`.`CreatedAt`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`CustomerId`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Total`
    FROM `Orders` AS `o`
    WHERE `o`.`CustomerId` = @__8__locals1_userId_0
    ORDER BY `o`.`CreatedAt` DESC
    LIMIT @__p_2 OFFSET @__p_1
) AS `t`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t0` ON `t`.`CustomerId` = `t0`.`Id`
ORDER BY `t`.`CreatedAt` DESC
2025-09-11 20:28:48.314 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.OrderDtos.OrderListDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-11 20:28:48.321 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.GetOrders (E-Commerce) in 1280.4194ms
2025-09-11 20:28:48.325 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.GetOrders (E-Commerce)'
2025-09-11 20:28:48.327 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Order?page=1&pageSize=10 - 200 1098 application/json; charset=utf-8 1510.5709ms
2025-09-11 20:28:49.889 +03:00 [INF] Setting cache for key: order:filter:user:e682f183-1c61-400b-aa5a-171750f446b5_deleted:all_page:1_size:10_status:all
2025-09-11 20:28:50.110 +03:00 [INF] Cache set successfully for key: order:filter:user:e682f183-1c61-400b-aa5a-171750f446b5_deleted:all_page:1_size:10_status:all with tags: [order]
2025-09-11 20:29:08.191 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Order/number/ORD-20250911164319-5167 - null null
2025-09-11 20:29:08.240 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:29:08.392 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:29:08.411 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce)'
2025-09-11 20:29:08.413 +03:00 [INF] Route matched with {action = "GetOrderByNumber", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderDto]]] GetOrderByNumber(System.String) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-11 20:29:08.420 +03:00 [INF] Executing GetOrderByNumber for number: ORD-20250911164319-5167
2025-09-11 20:29:08.422 +03:00 [INF] Getting order by number: ORD-20250911164319-5167 for user: e682f183-1c61-400b-aa5a-171750f446b5, IsAdmin: false
2025-09-11 20:29:08.424 +03:00 [INF] Getting cache for key: order:number:ORD-20250911164319-5167_user:e682f183-1c61-400b-aa5a-171750f446b5_admin:False
2025-09-11 20:29:08.637 +03:00 [WRN] Cache miss for key: order:number:ORD-20250911164319-5167_user:e682f183-1c61-400b-aa5a-171750f446b5_admin:False
2025-09-11 20:29:08.649 +03:00 [INF] Checking if order ORD-20250911164319-5167 exists for user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:29:08.801 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__ordernumber_0='?' (Size = 50), @__userid_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE ((`o`.`OrderNumber` = @__ordernumber_0) AND (`o`.`CustomerId` = @__userid_1)) AND `o`.`DeletedAt` IS NULL)
2025-09-11 20:29:08.810 +03:00 [INF] Execute GetAll for entity Order
2025-09-11 20:29:08.840 +03:00 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-09-11 20:29:09.015 +03:00 [INF] Executed DbCommand (87ms) [Parameters=[@__8__locals1_orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`DeletedAt`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`Id0`, `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`, `p0`.`Status`, `p0`.`Amount`, `p0`.`CreatedAt`, `p0`.`Id`, `p0`.`PaymentDate`, `p0`.`PaymentMethodId`, `p0`.`PaymentProviderId`, `t0`.`c`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`DeletedAt`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    WHERE `o`.`OrderNumber` = @__8__locals1_orderNumber_0
    LIMIT 1
) AS `t0`
LEFT JOIN `Payments` AS `p` ON `t0`.`Id` = `p`.`OrderId`
LEFT JOIN `Payments` AS `p0` ON `t0`.`Id` = `p0`.`OrderId`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p1`.`Id` AS `Id0`, `p1`.`Name`, `p1`.`Price`, `p1`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p1`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p1`.`Price`))
        ELSE `p1`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p1`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p2`.`Color`, COALESCE(`p2`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p2`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p2`.`Size`, `p2`.`DeletedAt`, COALESCE(`p2`.`Length`, 0) AS `Length`, COALESCE(`p2`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p2`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p1` ON `o0`.`ProductId` = `p1`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p1`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p2` ON `o0`.`ProductVariantId` = `p2`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `p`.`Id`, `p0`.`Id`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-09-11 20:29:09.953 +03:00 [INF] Order ORD-20250911164319-5167 retrieved successfully for user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:29:09.957 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:29:09.969 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce) in 1551.2659ms
2025-09-11 20:29:09.973 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.GetOrderByNumber (E-Commerce)'
2025-09-11 20:29:09.975 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Order/number/ORD-20250911164319-5167 - 200 1678 application/json; charset=utf-8 1784.0592ms
2025-09-11 20:29:11.702 +03:00 [INF] Setting cache for key: order:number:ORD-20250911164319-5167_user:e682f183-1c61-400b-aa5a-171750f446b5_admin:False
2025-09-11 20:29:11.943 +03:00 [INF] Cache set successfully for key: order:number:ORD-20250911164319-5167_user:e682f183-1c61-400b-aa5a-171750f446b5_admin:False with tags: [order]
2025-09-11 20:30:16.116 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.116 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.126 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.126 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.218 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.245 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.271 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.293 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.304 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.309 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.319 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.321 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.324 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.330 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.337 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.344 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.348 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.350 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.353 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.356 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.359 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.363 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.370 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.377 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.382 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.382 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.385 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.387 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.392 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.398 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.407 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.414 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.422 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.427 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.448 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.430 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.433 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.427 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.461 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:16.466 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.477 +03:00 [INF] Executed DbCommand (96ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:16.481 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:30:16.497 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:16.511 +03:00 [INF] Executed DbCommand (93ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:16.519 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:16.531 +03:00 [INF] Executed DbCommand (112ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:16.563 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:16.549 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:16.554 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:16.546 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:16.598 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:16.604 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:16.666 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:16.666 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:16.680 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:16.696 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:16.715 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:16.715 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:16.716 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:16.732 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:16.756 +03:00 [INF] Executed DbCommand (335ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:16.760 +03:00 [INF] Executed DbCommand (339ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:16.767 +03:00 [INF] Executed DbCommand (341ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:16.775 +03:00 [INF] Executed DbCommand (348ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:16.778 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:16.786 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:16.791 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:16.795 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:16.798 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:16.800 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:16.805 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:16.808 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:16.812 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:16.819 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:16.826 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:16.831 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:16.831 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:16.832 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:16.836 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:16.839 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:16.842 +03:00 [INF] Executed DbCommand (382ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:16.844 +03:00 [INF] Executed DbCommand (383ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:16.854 +03:00 [INF] Executed DbCommand (377ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:16.874 +03:00 [INF] Executed DbCommand (365ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:16.879 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:16.883 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:16.888 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:16.895 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:16.897 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:16.899 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:16.903 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:16.906 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:16.919 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:16.929 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:16.933 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:16.941 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:16.942 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:16.946 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:16.947 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:16.949 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:16.965 +03:00 [INF] Executed DbCommand (454ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:16.966 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.966 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.968 +03:00 [INF] Executed DbCommand (215ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:16.971 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:16.984 +03:00 [INF] Executed DbCommand (217ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:17.017 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:17.046 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 79.8394ms
2025-09-11 20:30:17.047 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 81.0205ms
2025-09-11 20:30:17.053 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:17.059 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 87.9222ms
2025-09-11 20:30:17.062 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:17.063 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:17.117 +03:00 [INF] Executed DbCommand (342ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:17.125 +03:00 [INF] Executed DbCommand (283ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:17.127 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:17.140 +03:00 [INF] Executed DbCommand (287ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:17.141 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:17.147 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:17.150 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:17.155 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:17.161 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:17.165 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:17.171 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:17.171 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:17.173 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:17.174 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:17.177 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:17.180 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:17.183 +03:00 [INF] Executed DbCommand (309ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:17.183 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:17.191 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:17.195 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:17.197 +03:00 [INF] Executed DbCommand (230ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:30:17.200 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:17.208 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:17.212 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:17.214 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.215 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:17.222 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:17.225 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:17.227 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:17.230 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.235 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 21.1373ms
2025-09-11 20:30:17.241 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.241 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:30:17.245 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.248 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:17.259 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 28.5475ms
2025-09-11 20:30:17.274 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.275 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.468ms
2025-09-11 20:30:17.280 +03:00 [INF] Executing CreatePayment for order: ORD-20250911172827-4324
2025-09-11 20:30:17.289 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 43.9142ms
2025-09-11 20:30:17.291 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:17.298 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.309 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.309 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.310 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911172827-4324 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:30:17.315 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.321 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.325 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.329 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.329 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.332 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.341 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.342 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.344 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.348 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 19.4401ms
2025-09-11 20:30:17.359 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.682ms
2025-09-11 20:30:17.364 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.3824ms
2025-09-11 20:30:17.371 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.376 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 33.817ms
2025-09-11 20:30:17.377 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.412 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.414 +03:00 [INF] Executed DbCommand (106ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.426 +03:00 [INF] Executed DbCommand (102ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.429 +03:00 [INF] Executed DbCommand (102ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.442 +03:00 [INF] Executed DbCommand (114ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.449 +03:00 [INF] Executed DbCommand (116ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.454 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.459 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.464 +03:00 [INF] Executed DbCommand (124ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.470 +03:00 [INF] Executed DbCommand (126ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.472 +03:00 [INF] Executed DbCommand (103ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.474 +03:00 [INF] Executed DbCommand (97ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.481 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.489 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.493 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.497 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.503 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 21.5749ms
2025-09-11 20:30:17.510 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.514 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 21.2325ms
2025-09-11 20:30:17.521 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 23.7513ms
2025-09-11 20:30:17.529 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.532 +03:00 [INF] Executed DbCommand (103ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.540 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.547 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.549 +03:00 [INF] Executed DbCommand (107ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.558 +03:00 [INF] Executed DbCommand (108ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:17.561 +03:00 [INF] Executed DbCommand (90ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.561 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.565 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.570 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:30:17.578 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.582 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.588 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 22.277ms
2025-09-11 20:30:17.596 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 17.5757ms
2025-09-11 20:30:17.598 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.599 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.608 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.609 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.610 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.615 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.624 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 26.1241ms
2025-09-11 20:30:17.628 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.6201ms
2025-09-11 20:30:17.632 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.640 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.3397ms
2025-09-11 20:30:17.645 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.3987ms
2025-09-11 20:30:17.649 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.242ms
2025-09-11 20:30:17.661 +03:00 [INF] Executed DbCommand (102ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.666 +03:00 [INF] Getting order by number: ORD-20250911172827-4324
2025-09-11 20:30:17.676 +03:00 [INF] Executed DbCommand (115ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.680 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.695 +03:00 [INF] Executed DbCommand (97ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:30:17.702 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.711 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.712 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.721 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.726 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.733 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:30:17.738 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 36.0031ms
2025-09-11 20:30:17.743 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.0111ms
2025-09-11 20:30:17.749 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 36.5356ms
2025-09-11 20:30:17.755 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.4778ms
2025-09-11 20:30:17.760 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.046ms
2025-09-11 20:30:17.762 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:17.770 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.776 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.785 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:30:17.792 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.798 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.807 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 37.2183ms
2025-09-11 20:30:17.813 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 37.1095ms
2025-09-11 20:30:17.817 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.822 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.825 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.7991ms
2025-09-11 20:30:17.830 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.0996ms
2025-09-11 20:30:17.838 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.846 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.853 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 35.7238ms
2025-09-11 20:30:17.858 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 36.1289ms
2025-09-11 20:30:17.865 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.874 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.880 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 41.7405ms
2025-09-11 20:30:17.885 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 38.911ms
2025-09-11 20:30:17.895 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:17.902 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.908 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 42.7333ms
2025-09-11 20:30:17.914 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 39.3419ms
2025-09-11 20:30:17.923 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.929 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.936 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:30:17.944 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 42.2357ms
2025-09-11 20:30:17.952 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.961 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.966 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 42.6723ms
2025-09-11 20:30:17.976 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 46.7986ms
2025-09-11 20:30:17.980 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:30:17.989 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:17.993 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 40.9538ms
2025-09-11 20:30:17.998 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 37.0945ms
2025-09-11 20:30:18.007 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.012 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.048 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.052 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 63.2562ms
2025-09-11 20:30:18.072 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.089 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.103 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 96.1877ms
2025-09-11 20:30:18.128 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 115.2329ms
2025-09-11 20:30:18.132 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 83.5654ms
2025-09-11 20:30:18.139 +03:00 [INF] Executed DbCommand (91ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:30:18.145 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 73.0639ms
2025-09-11 20:30:18.150 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 61.5132ms
2025-09-11 20:30:18.162 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.180 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.213 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.277 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.305 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:18.311 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.316 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 153.8946ms
2025-09-11 20:30:18.327 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 146.6018ms
2025-09-11 20:30:18.333 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 120.1921ms
2025-09-11 20:30:18.340 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 63.4241ms
2025-09-11 20:30:18.348 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 36.8357ms
2025-09-11 20:30:18.348 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.356 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.363 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.373 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.379 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.387 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.393 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 44.8908ms
2025-09-11 20:30:18.397 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 41.072ms
2025-09-11 20:30:18.403 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 39.2744ms
2025-09-11 20:30:18.409 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 36.2841ms
2025-09-11 20:30:18.416 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 37.3312ms
2025-09-11 20:30:18.430 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 42.4795ms
2025-09-11 20:30:18.437 +03:00 [INF] Executed DbCommand (89ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:30:18.445 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.466 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.477 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.484 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:30:18.498 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 53.0434ms
2025-09-11 20:30:18.509 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 42.6279ms
2025-09-11 20:30:18.513 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 36.2531ms
2025-09-11 20:30:18.525 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.525 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:18.531 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.541 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.546 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 21.1031ms
2025-09-11 20:30:18.549 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:18.556 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 24.62ms
2025-09-11 20:30:18.562 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 20.8366ms
2025-09-11 20:30:18.571 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.581 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.590 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.595 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 24.2843ms
2025-09-11 20:30:18.602 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 21.0409ms
2025-09-11 20:30:18.608 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 17.4797ms
2025-09-11 20:30:18.615 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.623 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.630 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.637 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 21.7017ms
2025-09-11 20:30:18.643 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 19.6218ms
2025-09-11 20:30:18.650 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 20.1017ms
2025-09-11 20:30:18.660 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.675 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.678 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.682 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.689 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.144ms
2025-09-11 20:30:18.694 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 19.0228ms
2025-09-11 20:30:18.700 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 21.7277ms
2025-09-11 20:30:18.706 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 24.2268ms
2025-09-11 20:30:18.715 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.722 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.730 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.739 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.744 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.8459ms
2025-09-11 20:30:18.749 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 26.8584ms
2025-09-11 20:30:18.756 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 26.2536ms
2025-09-11 20:30:18.761 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 22.4105ms
2025-09-11 20:30:18.768 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.777 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:30:18.803 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.1639ms
2025-09-11 20:30:18.809 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.7427ms
2025-09-11 20:30:19.479 +03:00 [INF] Received HTTP response headers after 902.7665ms - 201
2025-09-11 20:30:19.487 +03:00 [INF] End processing HTTP request after 963.3789ms - 201
2025-09-11 20:30:19.496 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:30:19.577 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:30:19.596 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:30:19.736 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:19.776 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:19.781 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:20.001 +03:00 [INF] Received HTTP response headers after 209.0849ms - 201
2025-09-11 20:30:20.005 +03:00 [INF] End processing HTTP request after 229.2111ms - 201
2025-09-11 20:30:20.009 +03:00 [INF] Successfully created PayMob order: 384500831 for local order: ORD-20250911172827-4324
2025-09-11 20:30:20.012 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:20.090 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:30:20.099 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:30:20.108 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384500831, Amount: 1012226
2025-09-11 20:30:20.115 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:20.120 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:20.341 +03:00 [INF] Received HTTP response headers after 218.4493ms - 201
2025-09-11 20:30:20.346 +03:00 [INF] End processing HTTP request after 231.4519ms - 201
2025-09-11 20:30:20.349 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:30:20.355 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:30:20.358 +03:00 [INF] Payment key generated successfully for Order ID: 384500831
2025-09-11 20:30:20.363 +03:00 [INF] Successfully generated payment key for order: ORD-20250911172827-4324
2025-09-11 20:30:20.368 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:20.447 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:30:20.456 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:30:20.472 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:30:20.476 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:30:20.480 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:30:20.482 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:30:20.664 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:30:20.822 +03:00 [INF] Payment created successfully with ID 37
2025-09-11 20:30:20.822 +03:00 [INF] Executed DbCommand (3,368ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:20.835 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:30:20.911 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:30:20.921 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:30:20.924 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:21.000 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:21.009 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:30:21.012 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:30:21.088 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:30:21.116 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:21.225 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:30:21.291 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:30:21.296 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:21.299 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:21.530 +03:00 [INF] Received HTTP response headers after 220.8074ms - 201
2025-09-11 20:30:21.535 +03:00 [INF] End processing HTTP request after 239.2854ms - 201
2025-09-11 20:30:21.539 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:30:21.617 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:30:21.625 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:30:21.706 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:21.707 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:21.713 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 5093.1988ms
2025-09-11 20:30:21.718 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:21.715 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:21.721 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 200 1365 application/json; charset=utf-8 5604.5279ms
2025-09-11 20:30:21.724 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:21.941 +03:00 [INF] Received HTTP response headers after 207.7923ms - 201
2025-09-11 20:30:21.947 +03:00 [INF] End processing HTTP request after 232.5374ms - 201
2025-09-11 20:30:21.953 +03:00 [INF] Successfully created PayMob order: 384500849 for local order: ORD-20250911172827-4324
2025-09-11 20:30:21.958 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:22.034 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:30:22.041 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:30:22.045 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384500849, Amount: 1012226
2025-09-11 20:30:22.048 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:22.052 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:22.275 +03:00 [INF] Received HTTP response headers after 219.4076ms - 201
2025-09-11 20:30:22.281 +03:00 [INF] End processing HTTP request after 232.8851ms - 201
2025-09-11 20:30:22.286 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:30:22.290 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:30:22.294 +03:00 [INF] Payment key generated successfully for Order ID: 384500849
2025-09-11 20:30:22.297 +03:00 [INF] Successfully generated payment key for order: ORD-20250911172827-4324
2025-09-11 20:30:22.300 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:22.376 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:30:22.388 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:30:22.393 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:30:22.396 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:30:22.399 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:30:22.402 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:30:22.578 +03:00 [ERR] Failed executing DbCommand (97ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:30:22.807 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:30:22.824 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:30:22.932 +03:00 [INF] Executed DbCommand (5,474ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:22.940 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:30:23.016 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:30:23.026 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:30:23.028 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:23.103 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:23.111 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:30:23.113 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:30:23.188 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:30:23.200 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:23.277 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:30:23.286 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:30:23.288 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:23.293 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:23.518 +03:00 [INF] Received HTTP response headers after 219.6588ms - 201
2025-09-11 20:30:23.523 +03:00 [INF] End processing HTTP request after 234.7222ms - 201
2025-09-11 20:30:23.526 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:30:23.605 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:30:23.613 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:30:23.696 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:23.707 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:23.710 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:23.813 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:23.820 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 7171.5849ms
2025-09-11 20:30:23.826 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:23.831 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 7714.685ms
2025-09-11 20:30:23.937 +03:00 [INF] Received HTTP response headers after 222.516ms - 201
2025-09-11 20:30:23.942 +03:00 [INF] End processing HTTP request after 235.2579ms - 201
2025-09-11 20:30:23.948 +03:00 [INF] Successfully created PayMob order: 384500868 for local order: ORD-20250911172827-4324
2025-09-11 20:30:23.952 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:24.028 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:30:24.040 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:30:24.058 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384500868, Amount: 1012226
2025-09-11 20:30:24.063 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:24.066 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:24.292 +03:00 [INF] Received HTTP response headers after 216.5599ms - 201
2025-09-11 20:30:24.295 +03:00 [INF] End processing HTTP request after 231.265ms - 201
2025-09-11 20:30:24.298 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:30:24.305 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:30:24.307 +03:00 [INF] Payment key generated successfully for Order ID: 384500868
2025-09-11 20:30:24.309 +03:00 [INF] Successfully generated payment key for order: ORD-20250911172827-4324
2025-09-11 20:30:24.311 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:24.394 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:30:24.402 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:30:24.404 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:30:24.408 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:30:24.410 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:30:24.412 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:30:24.567 +03:00 [ERR] Failed executing DbCommand (79ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:30:24.725 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:30:24.748 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:30:24.841 +03:00 [INF] Executed DbCommand (7,378ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:24.851 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:30:24.930 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:30:24.939 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:30:24.943 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:25.018 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:25.027 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:30:25.032 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:30:25.108 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:30:25.117 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:25.192 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:30:25.200 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:30:25.202 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:25.210 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:25.436 +03:00 [INF] Received HTTP response headers after 222.0829ms - 201
2025-09-11 20:30:25.467 +03:00 [INF] End processing HTTP request after 264.5663ms - 201
2025-09-11 20:30:25.473 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:30:25.553 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:30:25.558 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:30:25.640 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:25.648 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:25.650 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:25.714 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:25.720 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 9025.5985ms
2025-09-11 20:30:25.724 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:25.728 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 9602.0635ms
2025-09-11 20:30:25.862 +03:00 [INF] Received HTTP response headers after 206.0387ms - 201
2025-09-11 20:30:25.869 +03:00 [INF] End processing HTTP request after 220.7988ms - 201
2025-09-11 20:30:25.874 +03:00 [INF] Successfully created PayMob order: 384500887 for local order: ORD-20250911172827-4324
2025-09-11 20:30:25.878 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:25.953 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:30:25.960 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:30:25.963 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384500887, Amount: 1012226
2025-09-11 20:30:25.965 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:25.969 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:26.192 +03:00 [INF] Received HTTP response headers after 219.7788ms - 201
2025-09-11 20:30:26.199 +03:00 [INF] End processing HTTP request after 233.9715ms - 201
2025-09-11 20:30:26.206 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:30:26.210 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:30:26.214 +03:00 [INF] Payment key generated successfully for Order ID: 384500887
2025-09-11 20:30:26.219 +03:00 [INF] Successfully generated payment key for order: ORD-20250911172827-4324
2025-09-11 20:30:26.222 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:26.299 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:30:26.309 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:30:26.311 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:30:26.313 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:30:26.314 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:30:26.316 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:30:26.468 +03:00 [ERR] Failed executing DbCommand (76ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:30:26.623 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:30:26.646 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:30:26.743 +03:00 [INF] Executed DbCommand (9,274ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:26.751 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:30:26.848 +03:00 [INF] Executed DbCommand (93ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:30:26.890 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:30:26.908 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:27.017 +03:00 [INF] Executed DbCommand (105ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:27.031 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:30:27.037 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:30:27.200 +03:00 [INF] Executed DbCommand (161ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:30:27.206 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:27.301 +03:00 [INF] Executed DbCommand (93ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:30:27.311 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:30:27.314 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:27.317 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:27.553 +03:00 [INF] Received HTTP response headers after 228.7157ms - 201
2025-09-11 20:30:27.560 +03:00 [INF] End processing HTTP request after 245.9734ms - 201
2025-09-11 20:30:27.563 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:30:27.640 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:30:27.650 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:30:27.736 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:27.739 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:27.742 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 11065.1277ms
2025-09-11 20:30:27.751 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:27.755 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:27.760 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:27.763 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 11636.7565ms
2025-09-11 20:30:27.981 +03:00 [INF] Received HTTP response headers after 213.6169ms - 201
2025-09-11 20:30:27.987 +03:00 [INF] End processing HTTP request after 235.8222ms - 201
2025-09-11 20:30:27.992 +03:00 [INF] Successfully created PayMob order: 384500904 for local order: ORD-20250911172827-4324
2025-09-11 20:30:27.997 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:28.076 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:30:28.086 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:30:28.092 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384500904, Amount: 1012226
2025-09-11 20:30:28.098 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:28.101 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:28.324 +03:00 [INF] Received HTTP response headers after 216.7316ms - 201
2025-09-11 20:30:28.341 +03:00 [INF] End processing HTTP request after 243.0664ms - 201
2025-09-11 20:30:28.344 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:30:28.346 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:30:28.378 +03:00 [INF] Payment key generated successfully for Order ID: 384500904
2025-09-11 20:30:28.411 +03:00 [INF] Successfully generated payment key for order: ORD-20250911172827-4324
2025-09-11 20:30:28.430 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:28.505 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:30:28.511 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:30:28.513 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:30:28.516 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:30:28.518 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:30:28.521 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:30:28.673 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:30:28.829 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:30:28.850 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:30:28.937 +03:00 [INF] Executed DbCommand (11,457ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:28.949 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:30:29.025 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:30:29.033 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:30:29.037 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:29.113 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:29.122 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:30:29.127 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:30:29.204 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:30:29.215 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:29.290 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:30:29.296 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:30:29.298 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:29.302 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:29.526 +03:00 [INF] Received HTTP response headers after 218.7782ms - 201
2025-09-11 20:30:29.531 +03:00 [INF] End processing HTTP request after 233.2092ms - 201
2025-09-11 20:30:29.535 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:30:29.617 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:30:29.627 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:30:29.709 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:29.721 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:29.726 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:29.822 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:29.834 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 13018.245ms
2025-09-11 20:30:29.842 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:29.845 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 13541.06ms
2025-09-11 20:30:29.958 +03:00 [INF] Received HTTP response headers after 227.2967ms - 201
2025-09-11 20:30:29.963 +03:00 [INF] End processing HTTP request after 242.6928ms - 201
2025-09-11 20:30:29.966 +03:00 [INF] Successfully created PayMob order: 384500926 for local order: ORD-20250911172827-4324
2025-09-11 20:30:29.973 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:30.058 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:30:30.066 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:30:30.075 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384500926, Amount: 1012226
2025-09-11 20:30:30.078 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:30.081 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:30.300 +03:00 [INF] Received HTTP response headers after 217.1002ms - 201
2025-09-11 20:30:30.306 +03:00 [INF] End processing HTTP request after 228.165ms - 201
2025-09-11 20:30:30.312 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:30:30.314 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:30:30.316 +03:00 [INF] Payment key generated successfully for Order ID: 384500926
2025-09-11 20:30:30.320 +03:00 [INF] Successfully generated payment key for order: ORD-20250911172827-4324
2025-09-11 20:30:30.325 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:30.400 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:30:30.410 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:30:30.413 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:30:30.416 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:30:30.419 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:30:30.423 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:30:30.577 +03:00 [ERR] Failed executing DbCommand (76ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:30:30.744 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:30:30.768 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:30:30.865 +03:00 [INF] Executed DbCommand (13,378ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:30.873 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:30:30.950 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:30:30.960 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:30:30.963 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:31.025 +03:00 [INF] 1 servers were removed due to timeout
2025-09-11 20:30:31.040 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:31.048 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:30:31.050 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:30:31.127 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:30:31.143 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:31.220 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:30:31.246 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:30:31.248 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:31.259 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:31.523 +03:00 [INF] Received HTTP response headers after 233.9752ms - 201
2025-09-11 20:30:31.528 +03:00 [INF] End processing HTTP request after 280.2117ms - 201
2025-09-11 20:30:31.531 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:30:31.609 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:30:31.620 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:30:31.706 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:31.714 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:31.719 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:31.739 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:31.750 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 14924.7596ms
2025-09-11 20:30:31.765 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:31.767 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 15446.0603ms
2025-09-11 20:30:31.952 +03:00 [INF] Received HTTP response headers after 227.7208ms - 201
2025-09-11 20:30:31.956 +03:00 [INF] End processing HTTP request after 241.9585ms - 201
2025-09-11 20:30:31.960 +03:00 [INF] Successfully created PayMob order: 384500947 for local order: ORD-20250911172827-4324
2025-09-11 20:30:31.962 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:32.040 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:30:32.050 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:30:32.054 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384500947, Amount: 1012226
2025-09-11 20:30:32.058 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:32.061 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:32.288 +03:00 [INF] Received HTTP response headers after 223.8569ms - 201
2025-09-11 20:30:32.296 +03:00 [INF] End processing HTTP request after 238.1612ms - 201
2025-09-11 20:30:32.304 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:30:32.312 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:30:32.315 +03:00 [INF] Payment key generated successfully for Order ID: 384500947
2025-09-11 20:30:32.322 +03:00 [INF] Successfully generated payment key for order: ORD-20250911172827-4324
2025-09-11 20:30:32.327 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:32.405 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:30:32.414 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:30:32.419 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:30:32.425 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:30:32.428 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:30:32.430 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:30:32.586 +03:00 [ERR] Failed executing DbCommand (79ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:30:32.755 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:30:32.781 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:30:32.875 +03:00 [INF] Executed DbCommand (15,383ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:32.886 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:30:32.964 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:30:32.975 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:30:32.978 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:33.054 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:33.074 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:30:33.077 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:30:33.152 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:30:33.165 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:33.248 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:30:33.256 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:30:33.258 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:33.260 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:33.481 +03:00 [INF] Received HTTP response headers after 218.4544ms - 201
2025-09-11 20:30:33.486 +03:00 [INF] End processing HTTP request after 228.7505ms - 201
2025-09-11 20:30:33.491 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:30:33.567 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:30:33.576 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:30:33.658 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:33.671 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:33.677 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:33.775 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:33.780 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 16969.1939ms
2025-09-11 20:30:33.785 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:33.791 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 17481.9171ms
2025-09-11 20:30:33.888 +03:00 [INF] Received HTTP response headers after 208.036ms - 201
2025-09-11 20:30:33.892 +03:00 [INF] End processing HTTP request after 221.5945ms - 201
2025-09-11 20:30:33.899 +03:00 [INF] Successfully created PayMob order: 384500963 for local order: ORD-20250911172827-4324
2025-09-11 20:30:33.906 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:33.983 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:30:33.994 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:30:33.998 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384500963, Amount: 1012226
2025-09-11 20:30:34.000 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:34.004 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:34.228 +03:00 [INF] Received HTTP response headers after 217.9841ms - 201
2025-09-11 20:30:34.235 +03:00 [INF] End processing HTTP request after 234.6644ms - 201
2025-09-11 20:30:34.241 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:30:34.245 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:30:34.248 +03:00 [INF] Payment key generated successfully for Order ID: 384500963
2025-09-11 20:30:34.250 +03:00 [INF] Successfully generated payment key for order: ORD-20250911172827-4324
2025-09-11 20:30:34.255 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:34.331 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:30:34.341 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:30:34.343 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:30:34.346 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:30:34.349 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:30:34.350 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:30:34.505 +03:00 [ERR] Failed executing DbCommand (76ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:30:34.670 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:30:34.691 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:30:34.781 +03:00 [INF] Executed DbCommand (17,284ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:34.787 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:30:34.864 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:30:34.873 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:30:34.877 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:34.952 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:34.961 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:30:34.967 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:30:35.042 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:30:35.049 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:35.126 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:30:35.136 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:30:35.141 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:35.144 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:35.364 +03:00 [INF] Received HTTP response headers after 216.8636ms - 201
2025-09-11 20:30:35.381 +03:00 [INF] End processing HTTP request after 240.6385ms - 201
2025-09-11 20:30:35.390 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:30:35.470 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:30:35.479 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:30:35.562 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:35.573 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:35.577 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:35.651 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:35.656 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 18826.6988ms
2025-09-11 20:30:35.659 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:35.662 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 19343.346ms
2025-09-11 20:30:35.788 +03:00 [INF] Received HTTP response headers after 206.8819ms - 201
2025-09-11 20:30:35.794 +03:00 [INF] End processing HTTP request after 220.3128ms - 201
2025-09-11 20:30:35.799 +03:00 [INF] Successfully created PayMob order: 384500985 for local order: ORD-20250911172827-4324
2025-09-11 20:30:35.804 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:35.881 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:30:35.892 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:30:35.896 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384500985, Amount: 1012226
2025-09-11 20:30:35.900 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:35.912 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:36.131 +03:00 [INF] Received HTTP response headers after 214.9586ms - 201
2025-09-11 20:30:36.140 +03:00 [INF] End processing HTTP request after 239.1432ms - 201
2025-09-11 20:30:36.143 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:30:36.144 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:30:36.146 +03:00 [INF] Payment key generated successfully for Order ID: 384500985
2025-09-11 20:30:36.148 +03:00 [INF] Successfully generated payment key for order: ORD-20250911172827-4324
2025-09-11 20:30:36.150 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:36.226 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:30:36.231 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:30:36.239 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:30:36.249 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:30:36.253 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:30:36.256 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:30:36.408 +03:00 [ERR] Failed executing DbCommand (76ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:30:36.563 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:30:36.588 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:30:36.680 +03:00 [INF] Executed DbCommand (19,172ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:36.691 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:30:36.769 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:30:36.778 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:30:36.781 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:36.856 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:36.869 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:30:36.873 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:30:36.950 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:30:36.961 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:37.037 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:30:37.061 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:30:37.067 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:37.074 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:37.297 +03:00 [INF] Received HTTP response headers after 217.6535ms - 201
2025-09-11 20:30:37.308 +03:00 [INF] End processing HTTP request after 241.7558ms - 201
2025-09-11 20:30:37.313 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:30:37.394 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:30:37.410 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:30:37.507 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:37.526 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:37.532 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:37.571 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:37.575 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 20659.3642ms
2025-09-11 20:30:37.579 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:37.581 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 21233.3884ms
2025-09-11 20:30:37.763 +03:00 [INF] Received HTTP response headers after 225.2755ms - 201
2025-09-11 20:30:37.767 +03:00 [INF] End processing HTTP request after 240.7218ms - 201
2025-09-11 20:30:37.772 +03:00 [INF] Successfully created PayMob order: 384501003 for local order: ORD-20250911172827-4324
2025-09-11 20:30:37.776 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:37.852 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:30:37.862 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:30:37.866 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384501003, Amount: 1012226
2025-09-11 20:30:37.871 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:37.877 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:38.117 +03:00 [INF] Received HTTP response headers after 236.723ms - 201
2025-09-11 20:30:38.131 +03:00 [INF] End processing HTTP request after 259.6422ms - 201
2025-09-11 20:30:38.142 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:30:38.145 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:30:38.147 +03:00 [INF] Payment key generated successfully for Order ID: 384501003
2025-09-11 20:30:38.148 +03:00 [INF] Successfully generated payment key for order: ORD-20250911172827-4324
2025-09-11 20:30:38.150 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:38.231 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:30:38.240 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:30:38.243 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:30:38.244 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:30:38.247 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:30:38.249 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:30:38.402 +03:00 [ERR] Failed executing DbCommand (79ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:30:38.578 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:30:38.601 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:30:38.689 +03:00 [INF] Executed DbCommand (21,134ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:38.698 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:30:38.774 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:30:38.792 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:30:38.801 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:38.879 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:38.931 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:30:38.948 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:30:39.038 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:30:39.042 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:39.117 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:30:39.125 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:30:39.127 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:39.130 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:39.351 +03:00 [INF] Received HTTP response headers after 219.4195ms - 201
2025-09-11 20:30:39.356 +03:00 [INF] End processing HTTP request after 229.0644ms - 201
2025-09-11 20:30:39.359 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:30:39.436 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:30:39.444 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:30:39.525 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:39.536 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:39.539 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:39.568 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:39.575 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 22638.2274ms
2025-09-11 20:30:39.578 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:39.581 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 23224.872ms
2025-09-11 20:30:39.755 +03:00 [INF] Received HTTP response headers after 214.124ms - 201
2025-09-11 20:30:39.761 +03:00 [INF] End processing HTTP request after 225.552ms - 201
2025-09-11 20:30:39.768 +03:00 [INF] Successfully created PayMob order: 384501031 for local order: ORD-20250911172827-4324
2025-09-11 20:30:39.772 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:39.849 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:30:39.858 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:30:39.860 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384501031, Amount: 1012226
2025-09-11 20:30:39.862 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:39.865 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:40.085 +03:00 [INF] Received HTTP response headers after 217.9128ms - 201
2025-09-11 20:30:40.096 +03:00 [INF] End processing HTTP request after 233.4905ms - 201
2025-09-11 20:30:40.111 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:30:40.121 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:30:40.129 +03:00 [INF] Payment key generated successfully for Order ID: 384501031
2025-09-11 20:30:40.132 +03:00 [INF] Successfully generated payment key for order: ORD-20250911172827-4324
2025-09-11 20:30:40.137 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:40.215 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:30:40.224 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:30:40.227 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:30:40.229 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:30:40.231 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:30:40.241 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:30:40.392 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:30:40.544 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:30:40.565 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:30:40.677 +03:00 [INF] Executed DbCommand (23,112ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:40.683 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:30:40.760 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:30:40.769 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:30:40.773 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:40.850 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:40.861 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:30:40.866 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:30:40.942 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:30:40.952 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:41.065 +03:00 [INF] Executed DbCommand (110ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:30:41.075 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:30:41.079 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:41.082 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:41.319 +03:00 [INF] Received HTTP response headers after 232.1273ms - 201
2025-09-11 20:30:41.324 +03:00 [INF] End processing HTTP request after 245.4942ms - 201
2025-09-11 20:30:41.329 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:30:41.424 +03:00 [INF] Executed DbCommand (92ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:30:41.434 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:30:41.518 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:41.528 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:41.531 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:41.674 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:41.681 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 24749.4589ms
2025-09-11 20:30:41.687 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:41.691 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 25337.7832ms
2025-09-11 20:30:41.760 +03:00 [INF] Received HTTP response headers after 225.8935ms - 201
2025-09-11 20:30:41.764 +03:00 [INF] End processing HTTP request after 235.9224ms - 201
2025-09-11 20:30:41.771 +03:00 [INF] Successfully created PayMob order: 384501062 for local order: ORD-20250911172827-4324
2025-09-11 20:30:41.798 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:41.901 +03:00 [INF] Executed DbCommand (91ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:30:41.907 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:30:41.910 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384501062, Amount: 1012226
2025-09-11 20:30:41.912 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:41.917 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:42.144 +03:00 [INF] Received HTTP response headers after 222.4487ms - 201
2025-09-11 20:30:42.161 +03:00 [INF] End processing HTTP request after 248.398ms - 201
2025-09-11 20:30:42.170 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:30:42.176 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:30:42.182 +03:00 [INF] Payment key generated successfully for Order ID: 384501062
2025-09-11 20:30:42.188 +03:00 [INF] Successfully generated payment key for order: ORD-20250911172827-4324
2025-09-11 20:30:42.195 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:42.273 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:30:42.281 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:30:42.283 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:30:42.286 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:30:42.288 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:30:42.292 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:30:42.445 +03:00 [ERR] Failed executing DbCommand (78ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:30:42.603 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:30:42.623 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:30:42.717 +03:00 [INF] Executed DbCommand (25,140ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:42.725 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:30:42.801 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:30:42.811 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:30:42.813 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:42.887 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:42.896 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:30:42.899 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:30:42.976 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:30:42.987 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:43.062 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:30:43.070 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:30:43.074 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:43.080 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:43.302 +03:00 [INF] Received HTTP response headers after 220.4099ms - 201
2025-09-11 20:30:43.313 +03:00 [INF] End processing HTTP request after 238.9069ms - 201
2025-09-11 20:30:43.316 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:30:43.395 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:30:43.403 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:30:43.487 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:43.494 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:43.496 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:43.602 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:43.607 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 26679.7274ms
2025-09-11 20:30:43.613 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:43.616 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 27266.2747ms
2025-09-11 20:30:43.707 +03:00 [INF] Received HTTP response headers after 208.245ms - 201
2025-09-11 20:30:43.713 +03:00 [INF] End processing HTTP request after 218.3932ms - 201
2025-09-11 20:30:43.719 +03:00 [INF] Successfully created PayMob order: 384501077 for local order: ORD-20250911172827-4324
2025-09-11 20:30:43.724 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:43.800 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:30:43.813 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:30:43.816 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384501077, Amount: 1012226
2025-09-11 20:30:43.820 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:43.825 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:44.045 +03:00 [INF] Received HTTP response headers after 217.6095ms - 201
2025-09-11 20:30:44.050 +03:00 [INF] End processing HTTP request after 230.1781ms - 201
2025-09-11 20:30:44.055 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:30:44.060 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:30:44.063 +03:00 [INF] Payment key generated successfully for Order ID: 384501077
2025-09-11 20:30:44.066 +03:00 [INF] Successfully generated payment key for order: ORD-20250911172827-4324
2025-09-11 20:30:44.069 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:44.147 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:30:44.159 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:30:44.160 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:30:44.162 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:30:44.164 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:30:44.166 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:30:44.317 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:30:44.481 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:30:44.501 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:30:44.601 +03:00 [INF] Executed DbCommand (27,020ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:44.608 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:30:44.685 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:30:44.690 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:30:44.692 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:44.771 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:44.779 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:30:44.782 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:30:44.856 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:30:44.865 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:44.942 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:30:44.946 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:30:44.948 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:44.951 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:45.173 +03:00 [INF] Received HTTP response headers after 218.21ms - 201
2025-09-11 20:30:45.187 +03:00 [INF] End processing HTTP request after 239.1852ms - 201
2025-09-11 20:30:45.196 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:30:45.273 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:30:45.282 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:30:45.366 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:45.375 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:45.377 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:45.490 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:45.496 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 28350.5294ms
2025-09-11 20:30:45.500 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:45.502 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 29120.6927ms
2025-09-11 20:30:45.605 +03:00 [INF] Received HTTP response headers after 224.8108ms - 201
2025-09-11 20:30:45.610 +03:00 [INF] End processing HTTP request after 235.2719ms - 201
2025-09-11 20:30:45.613 +03:00 [INF] Successfully created PayMob order: 384501090 for local order: ORD-20250911172827-4324
2025-09-11 20:30:45.616 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:45.697 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:30:45.706 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:30:45.711 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384501090, Amount: 1012226
2025-09-11 20:30:45.713 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:45.717 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:45.938 +03:00 [INF] Received HTTP response headers after 217.3143ms - 201
2025-09-11 20:30:45.943 +03:00 [INF] End processing HTTP request after 229.9711ms - 201
2025-09-11 20:30:45.948 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:30:45.950 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:30:45.956 +03:00 [INF] Payment key generated successfully for Order ID: 384501090
2025-09-11 20:30:45.959 +03:00 [INF] Successfully generated payment key for order: ORD-20250911172827-4324
2025-09-11 20:30:45.961 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:46.037 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:30:46.061 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:30:46.066 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:30:46.075 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:30:46.082 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:30:46.084 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:30:46.243 +03:00 [ERR] Failed executing DbCommand (76ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:30:46.393 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:30:46.412 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:30:46.500 +03:00 [INF] Executed DbCommand (28,867ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:46.508 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:30:46.586 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:30:46.593 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:30:46.596 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:46.671 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:46.679 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:30:46.681 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:30:46.757 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:30:46.767 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:46.844 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:30:46.857 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:30:46.861 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:46.883 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:47.110 +03:00 [INF] Received HTTP response headers after 222.7392ms - 201
2025-09-11 20:30:47.116 +03:00 [INF] End processing HTTP request after 255.1536ms - 201
2025-09-11 20:30:47.121 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:30:47.200 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:30:47.209 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:30:47.293 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:47.316 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:47.326 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:47.372 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:47.379 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 30220.5052ms
2025-09-11 20:30:47.393 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:47.396 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 31014.4734ms
2025-09-11 20:30:47.542 +03:00 [INF] Received HTTP response headers after 209.5729ms - 201
2025-09-11 20:30:47.545 +03:00 [INF] End processing HTTP request after 229.5177ms - 201
2025-09-11 20:30:47.548 +03:00 [INF] Successfully created PayMob order: 384501110 for local order: ORD-20250911172827-4324
2025-09-11 20:30:47.562 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:47.641 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:30:47.657 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:30:47.660 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384501110, Amount: 1012226
2025-09-11 20:30:47.663 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:47.666 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:47.891 +03:00 [INF] Received HTTP response headers after 216.296ms - 201
2025-09-11 20:30:47.894 +03:00 [INF] End processing HTTP request after 231.3884ms - 201
2025-09-11 20:30:47.897 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:30:47.899 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:30:47.901 +03:00 [INF] Payment key generated successfully for Order ID: 384501110
2025-09-11 20:30:47.904 +03:00 [INF] Successfully generated payment key for order: ORD-20250911172827-4324
2025-09-11 20:30:47.907 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:48.005 +03:00 [INF] Executed DbCommand (97ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:30:48.016 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:30:48.019 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:30:48.021 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:30:48.024 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:30:48.027 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:30:48.182 +03:00 [ERR] Failed executing DbCommand (78ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:30:48.383 +03:00 [ERR] Failed executing DbCommand (30,707ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:48.394 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:30:48.414 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> MySqlConnector.MySqlException (0x80004005): Query execution was interrupted
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 124
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:30:48.442 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:30:48.602 +03:00 [ERR] Failed executing DbCommand (30,783ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:48.613 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> MySqlConnector.MySqlException (0x80004005): Query execution was interrupted
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 124
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:30:48.636 +03:00 [INF] Executed DbCommand (30,929ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:48.644 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:30:48.720 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:30:48.729 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:30:48.733 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:49.246 +03:00 [INF] Executed DbCommand (512ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:49.253 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:30:49.258 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:30:49.376 +03:00 [ERR] Failed executing DbCommand (31,656ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:49.382 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> MySqlConnector.MySqlException (0x80004005): Query execution was interrupted
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 124
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:30:49.395 +03:00 [INF] Executed DbCommand (134ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:30:49.399 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:49.411 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:49.417 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 32223.9712ms
2025-09-11 20:30:49.425 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:49.429 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 33002.557ms
2025-09-11 20:30:49.449 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:49.455 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 32286.1438ms
2025-09-11 20:30:49.458 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:49.463 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 33077.5507ms
2025-09-11 20:30:49.473 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:30:49.479 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:30:49.481 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:49.483 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:30:49.592 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:49.598 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 32318.9637ms
2025-09-11 20:30:49.602 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:49.608 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 33180.9994ms
2025-09-11 20:30:49.709 +03:00 [INF] Received HTTP response headers after 222.4185ms - 201
2025-09-11 20:30:49.714 +03:00 [INF] End processing HTTP request after 233.3611ms - 201
2025-09-11 20:30:49.721 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:30:49.801 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:30:49.809 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:30:49.891 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:30:49.896 +03:00 [ERR] Failed executing DbCommand (32,170ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:30:49.900 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:49.908 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> MySqlConnector.MySqlException (0x80004005): Query execution was interrupted
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 124
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:30:49.913 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:30:50.137 +03:00 [INF] Received HTTP response headers after 206.7387ms - 201
2025-09-11 20:30:50.145 +03:00 [INF] End processing HTTP request after 244.3308ms - 201
2025-09-11 20:30:50.151 +03:00 [INF] Successfully created PayMob order: 384501131 for local order: ORD-20250911172827-4324
2025-09-11 20:30:50.157 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:30:50.234 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:30:50.242 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:30:50.245 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384501131, Amount: 1012226
2025-09-11 20:30:50.249 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:50.254 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:30:50.340 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:50.347 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 33148.8681ms
2025-09-11 20:30:50.355 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:50.362 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 33939.7884ms
2025-09-11 20:30:50.475 +03:00 [INF] Received HTTP response headers after 215.1493ms - 201
2025-09-11 20:30:50.480 +03:00 [INF] End processing HTTP request after 230.4437ms - 201
2025-09-11 20:30:50.487 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:30:50.491 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:30:50.493 +03:00 [INF] Payment key generated successfully for Order ID: 384501131
2025-09-11 20:30:50.495 +03:00 [INF] Successfully generated payment key for order: ORD-20250911172827-4324
2025-09-11 20:30:50.497 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:30:50.598 +03:00 [INF] Executed DbCommand (90ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:30:50.606 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:30:50.608 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:30:50.610 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:30:50.612 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:30:50.614 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:30:50.833 +03:00 [ERR] Failed executing DbCommand (107ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:30:51.008 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:51.014 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 33766.5771ms
2025-09-11 20:30:51.017 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:51.022 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 34591.5834ms
2025-09-11 20:30:51.022 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:30:51.060 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '128-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:30:52.084 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:30:52.090 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 34900.7872ms
2025-09-11 20:30:52.092 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:30:52.094 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 35707.1779ms
2025-09-11 20:37:01.523 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:37:01.549 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:37:01.701 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - null null
2025-09-11 20:37:03.366 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1843.558ms
2025-09-11 20:37:04.247 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - 200 null text/html 2545.9266ms
2025-09-11 20:37:04.294 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/css18180871306285 - null null
2025-09-11 20:37:04.295 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/css-dark181801095147957 - null null
2025-09-11 20:37:04.309 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/js181801546128990 - null null
2025-09-11 20:37:04.333 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/css-dark181801095147957 - 200 null text/css 38.099ms
2025-09-11 20:37:04.348 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/css18180871306285 - 200 null text/css 53.9579ms
2025-09-11 20:37:04.486 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/js181801546128990 - 200 null application/javascript 177.2576ms
2025-09-11 20:37:04.549 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-11 20:37:04.561 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 11.8238ms
2025-09-11 20:37:04.608 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-11 20:37:04.705 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 97.3464ms
2025-09-11 20:37:07.285 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:37:07.300 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:37:08.710 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1425.6495ms
2025-09-11 20:37:11.288 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:37:11.303 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:37:12.874 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1585.9857ms
2025-09-11 20:43:15.919 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:43:15.948 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:43:17.045 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - null null
2025-09-11 20:43:19.348 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 3429.0207ms
2025-09-11 20:43:21.367 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:43:21.383 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:43:23.465 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - 200 null text/html 6420.4938ms
2025-09-11 20:43:23.518 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-11 20:43:23.533 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-11 20:43:23.562 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 43.4051ms
2025-09-11 20:43:23.645 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 112.3428ms
2025-09-11 20:43:25.652 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:43:25.662 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:43:28.650 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 7282.7297ms
2025-09-11 20:43:31.950 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 6297.3686ms
2025-09-11 20:43:32.378 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/jobs/scheduled/enqueue - application/x-www-form-urlencoded; charset=UTF-8 47
2025-09-11 20:43:32.398 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:43:33.961 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:43:33.971 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:43:35.758 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1796.54ms
2025-09-11 20:43:37.114 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/jobs/scheduled/enqueue - 204 null null 4735.6066ms
2025-09-11 20:43:37.156 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - null null
2025-09-11 20:43:38.287 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:43:38.294 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:43:39.387 +03:00 [INF] Starting CheckAndUpdatePaymentStatusAsync for payment 37
2025-09-11 20:43:39.970 +03:00 [INF] Executing GetByIdAsync for entity Payment with ID: 37
2025-09-11 20:43:40.228 +03:00 [INF] Executed DbCommand (191ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:43:40.448 +03:00 [INF] Executed DbCommand (204ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Payments WHERE Id = @p0 FOR UPDATE
2025-09-11 20:43:40.466 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:43:40.559 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 128
2025-09-11 20:43:40.574 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 127
2025-09-11 20:43:40.676 +03:00 [INF] Executed DbCommand (207ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:43:40.685 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:43:40.695 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:43:40.699 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:43:40.780 +03:00 [INF] Executed DbCommand (210ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:43:40.804 +03:00 [INF] Executed DbCommand (225ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:43:41.026 +03:00 [INF] Executed DbCommand (210ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:43:41.030 +03:00 [INF] Executed DbCommand (209ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:43:41.477 +03:00 [INF] Executed DbCommand (210ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:43:41.480 +03:00 [INF] Executed DbCommand (213ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:43:41.693 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 3406.3438ms
2025-09-11 20:43:41.711 +03:00 [INF] Received HTTP response headers after 1007.7539ms - 201
2025-09-11 20:43:41.720 +03:00 [INF] End processing HTTP request after 1026.8696ms - 201
2025-09-11 20:43:41.748 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:43:41.755 +03:00 [INF] Start processing HTTP request GET https://accept.paymob.com/api/ecommerce/orders/384500831
2025-09-11 20:43:41.763 +03:00 [INF] Sending HTTP request GET https://accept.paymob.com/api/ecommerce/orders/384500831
2025-09-11 20:43:41.847 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - 200 null text/html 4690.4381ms
2025-09-11 20:43:41.885 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-11 20:43:41.889 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-11 20:43:41.900 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 11.3262ms
2025-09-11 20:43:41.902 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 16.8457ms
2025-09-11 20:43:42.072 +03:00 [INF] Received HTTP response headers after 304.8864ms - 200
2025-09-11 20:43:42.077 +03:00 [INF] End processing HTTP request after 322.2235ms - 200
2025-09-11 20:43:44.291 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:43:44.301 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:43:44.964 +03:00 [INF] Executed DbCommand (189ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p3='?' (Size = 8) (DbType = Binary), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Payments` SET `ModifiedAt` = @p0, `Status` = @p1
WHERE `Id` = @p2 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = @p2;
2025-09-11 20:43:47.828 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 3537.3767ms
2025-09-11 20:43:48.030 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 128
2025-09-11 20:43:48.455 +03:00 [INF] Executed DbCommand (209ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:43:48.908 +03:00 [INF] Executed DbCommand (223ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:43:48.936 +03:00 [INF] Execute GetAll for entity OrderItem
2025-09-11 20:43:49.419 +03:00 [INF] Executed DbCommand (232ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-09-11 20:43:49.442 +03:00 [INF] Adding quantity for variant: 4
2025-09-11 20:43:49.856 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:43:49.884 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:43:50.377 +03:00 [INF] Executed DbCommand (235ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-11 20:43:50.386 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 4
2025-09-11 20:43:50.618 +03:00 [INF] Executed DbCommand (230ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:43:51.989 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 127
2025-09-11 20:43:52.469 +03:00 [INF] Executed DbCommand (240ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:43:53.256 +03:00 [INF] Execute UpdateOrderAfterPaid_id:128_to status:"PaymentExpired"
2025-09-11 20:43:53.518 +03:00 [INF] Quantity for variant 4 increased by 3
2025-09-11 20:43:53.532 +03:00 [INF] Executed DbCommand (281ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:43:53.545 +03:00 [INF] Execute GetAll for entity OrderItem
2025-09-11 20:43:54.141 +03:00 [INF] Executed DbCommand (301ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-09-11 20:43:54.151 +03:00 [INF] Adding quantity for variant: 4
2025-09-11 20:43:54.776 +03:00 [INF] Executed DbCommand (342ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:43:55.480 +03:00 [INF] Execute GetAll for entity Order
2025-09-11 20:43:55.548 +03:00 [INF] Executed DbCommand (383ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-11 20:43:55.555 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 4
2025-09-11 20:43:55.896 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:43:55.963 +03:00 [INF] Executed DbCommand (443ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CancelledAt`, `t`.`CreatedAt`, `t`.`CustomerAddressId`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`DeliveredAt`, `t`.`DiscountAmount`, `t`.`ModifiedAt`, `t`.`Notes`, `t`.`OrderNumber`, `t`.`RestockedAt`, `t`.`RowVersion`, `t`.`ShippedAt`, `t`.`ShippingCost`, `t`.`Status`, `t`.`Subtotal`, `t`.`TaxAmount`, `t`.`Total`, `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`DeletedAt`, `o0`.`ModifiedAt`, `o0`.`OrderId`, `o0`.`OrderedAt`, `o0`.`ProductId`, `o0`.`ProductVariantId`, `o0`.`Quantity`, `o0`.`TotalPrice`, `o0`.`UnitPrice`
FROM (
    SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
    FROM `Orders` AS `o`
    WHERE `o`.`Id` = @__orderId_0
    LIMIT 1
) AS `t`
LEFT JOIN `OrderItem` AS `o0` ON `t`.`Id` = `o0`.`OrderId`
ORDER BY `t`.`Id`
2025-09-11 20:43:55.976 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:43:55.980 +03:00 [INF] Executed DbCommand (421ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:43:56.460 +03:00 [INF] Executed DbCommand (483ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:43:56.472 +03:00 [WRN] Invalid status transition from "PaymentExpired" to "PaymentExpired"
2025-09-11 20:43:56.689 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 6832.3275ms
2025-09-11 20:43:56.966 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:43:57.047 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:43:58.119 +03:00 [INF] Order 128 auto-expired and restock scheduled
2025-09-11 20:43:58.613 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:43:59.031 +03:00 [INF] Order 127 auto-expired and restock scheduled
2025-09-11 20:43:59.286 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:43:59.297 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:43:59.491 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:43:59.666 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:43:59.768 +03:00 [INF] Quantity for variant 4 increased by 3
2025-09-11 20:44:00.127 +03:00 [INF] Executed DbCommand (317ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-11 20:44:00.217 +03:00 [INF] Payment 37 updated to "Failed"
2025-09-11 20:44:00.623 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:44:00.838 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:44:01.032 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:44:01.395 +03:00 [INF] Executed DbCommand (222ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:44:01.664 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:44:01.682 +03:00 [INF] Executed DbCommand (243ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:44:01.788 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:44:01.861 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:44:02.685 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:44:04.921 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 5634.6621ms
2025-09-11 20:44:06.826 +03:00 [INF] Executed DbCommand (241ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-11 20:44:08.059 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:44:08.297 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:44:08.783 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:44:08.927 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:44:09.308 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 20:44:09.521 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 20:44:09.830 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:44:10.302 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:44:10.583 +03:00 [INF] Restocked inventory for order 128
2025-09-11 20:44:11.111 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:44:11.122 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-11 20:44:11.393 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-11 20:44:11.626 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:44:12.505 +03:00 [INF] Restocked inventory for order 127
2025-09-11 20:44:13.279 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:44:13.632 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:44:13.920 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:44:14.196 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:44:15.015 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-11 20:44:15.018 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:44:15.086 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:44:15.326 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-11 20:44:15.607 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:44:15.632 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:44:15.766 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:44:16.271 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:44:17.580 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 62
2025-09-11 20:44:17.610 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:44:17.840 +03:00 [INF] Executed DbCommand (112ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:44:17.852 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-11 20:44:17.860 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-11 20:44:17.880 +03:00 [INF] Executing AddItemToCart for product ID: 6
2025-09-11 20:44:17.882 +03:00 [INF] Adding item to cart for user: e682f183-1c61-400b-aa5a-171750f446b5, product: 6
2025-09-11 20:44:18.385 +03:00 [INF] Executed DbCommand (120ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:44:18.402 +03:00 [INF] Execute GetAll for entity Product
2025-09-11 20:44:18.573 +03:00 [INF] Executed DbCommand (166ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-09-11 20:44:18.582 +03:00 [INF] Retrieving cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:44:18.728 +03:00 [INF] Executed DbCommand (144ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-11 20:44:18.889 +03:00 [INF] Executed DbCommand (121ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Cart WHERE Id = @p0 FOR UPDATE
2025-09-11 20:44:18.937 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-09-11 20:44:18.948 +03:00 [INF] CartItem added successfully (pending save)
2025-09-11 20:44:18.950 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:44:18.952 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:44:18.954 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:44:20.210 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (DbType = Int32), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`, `RowVersion`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:44:20.663 +03:00 [INF] Removing cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:44:21.102 +03:00 [INF] Cache removed successfully for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:44:21.105 +03:00 [INF] Item added to cart for user: e682f183-1c61-400b-aa5a-171750f446b5, product: 6
2025-09-11 20:44:21.113 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-11 20:44:21.118 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 3253.3475ms
2025-09-11 20:44:21.122 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-11 20:44:21.124 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 3543.9092ms
2025-09-11 20:44:21.347 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 3
2025-09-11 20:44:21.501 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:44:26.279 +03:00 [INF] Removing cache by tag: cart
2025-09-11 20:44:26.467 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - null 0
2025-09-11 20:44:26.524 +03:00 [WRN] No cache entries found for tag: cart
2025-09-11 20:44:26.584 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:44:26.899 +03:00 [INF] Executed DbCommand (135ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:44:26.989 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-11 20:44:27.016 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-11 20:44:27.157 +03:00 [INF] Executing CheckOut
2025-09-11 20:44:27.168 +03:00 [INF] Checkout of cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:44:27.188 +03:00 [INF] Retrieving cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:44:27.539 +03:00 [INF] Executed DbCommand (160ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-11 20:44:27.872 +03:00 [INF] Executed DbCommand (166ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-11 20:44:27.882 +03:00 [INF] Removing cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:44:27.885 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-11 20:44:27.891 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 736.6979ms
2025-09-11 20:44:27.900 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-11 20:44:27.903 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - 200 122 application/json; charset=utf-8 1435.3636ms
2025-09-11 20:44:28.496 +03:00 [INF] Cache removed successfully for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:44:38.890 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json 42
2025-09-11 20:44:38.901 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:44:39.243 +03:00 [INF] Executed DbCommand (168ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:44:39.255 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-11 20:44:39.267 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-11 20:44:39.274 +03:00 [INF] Executing CreateOrder
2025-09-11 20:44:39.281 +03:00 [INF] Creating order from cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:44:40.032 +03:00 [INF] Executed DbCommand (202ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:44:40.219 +03:00 [INF] Executed DbCommand (178ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-11 20:44:40.228 +03:00 [INF] Checking if address 31 exists for customer: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:44:40.419 +03:00 [INF] Executed DbCommand (186ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-09-11 20:44:40.436 +03:00 [INF] Getting cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:44:40.440 +03:00 [INF] Getting cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:44:40.768 +03:00 [WRN] Cache miss for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:44:40.956 +03:00 [INF] Executed DbCommand (185ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-11 20:44:40.964 +03:00 [INF] Execute GetAll for entity Cart
2025-09-11 20:44:41.204 +03:00 [INF] Executed DbCommand (231ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-09-11 20:44:45.422 +03:00 [INF] Setting cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:44:45.768 +03:00 [INF] Cache set successfully for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5 with tags: [cart]
2025-09-11 20:44:45.789 +03:00 [INF] Execute GetAll for entity ProductVariant
2025-09-11 20:44:45.983 +03:00 [INF] Executed DbCommand (187ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE `p`.`Id` = 4
2025-09-11 20:44:46.189 +03:00 [INF] Executed DbCommand (191ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-09-11 20:44:46.201 +03:00 [INF] Executing CreateAsync for entity Order
2025-09-11 20:44:46.203 +03:00 [INF] Order added successfully (pending save)
2025-09-11 20:44:46.627 +03:00 [INF] Executed DbCommand (215ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = Decimal), @p13='?' (DbType = Int32), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal), @p16='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `RestockedAt`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`, `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:44:46.859 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-09-11 20:44:46.866 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-09-11 20:44:46.868 +03:00 [INF] Removing 3 from variant: 4
2025-09-11 20:44:47.097 +03:00 [INF] Executed DbCommand (227ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity - @p0 WHERE Id = @p1 AND Quantity >= @p0
2025-09-11 20:44:47.108 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 4
2025-09-11 20:44:47.347 +03:00 [INF] Executed DbCommand (233ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:44:48.849 +03:00 [INF] Execute GetAll for entity CartItem
2025-09-11 20:44:49.003 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__cartItemId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE (`c`.`Id` = @__cartItemId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:44:49.003 +03:00 [INF] Clearing cart: 3
2025-09-11 20:44:49.019 +03:00 [INF] CartItem 84 price updated to 3374.08790000
2025-09-11 20:44:49.020 +03:00 [INF] Retrieving cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:44:49.095 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-09-11 20:44:49.106 +03:00 [INF] Cart 3 cleared successfully
2025-09-11 20:44:49.355 +03:00 [INF] Executed DbCommand (256ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-11 20:44:49.542 +03:00 [INF] Executed DbCommand (185ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 8) (DbType = Binary), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = Decimal), @p11='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0 AND `RowVersion` IS NULL;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:44:49.786 +03:00 [INF] Executed DbCommand (191ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-11 20:44:49.797 +03:00 [INF] Checkout date removed for cart of user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:44:49.834 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:44:49.834 +03:00 [INF] Executed DbCommand (311ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
UPDATE `CartItems` SET `UnitPrice` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:44:49.837 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:44:49.845 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:44:49.848 +03:00 [INF] Execute GetAll for entity Order
2025-09-11 20:44:50.327 +03:00 [INF] Executed DbCommand (266ms) [Parameters=[@__createdOrder_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`DeletedAt`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`Id0`, `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`, `p0`.`Status`, `p0`.`Amount`, `p0`.`CreatedAt`, `p0`.`Id`, `p0`.`PaymentDate`, `p0`.`PaymentMethodId`, `p0`.`PaymentProviderId`, `t0`.`c`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`DeletedAt`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    WHERE `o`.`Id` = @__createdOrder_Id_0
    LIMIT 1
) AS `t0`
LEFT JOIN `Payments` AS `p` ON `t0`.`Id` = `p`.`OrderId`
LEFT JOIN `Payments` AS `p0` ON `t0`.`Id` = `p0`.`OrderId`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p1`.`Id` AS `Id0`, `p1`.`Name`, `p1`.`Price`, `p1`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p1`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p1`.`Price`))
        ELSE `p1`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p1`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p2`.`Color`, COALESCE(`p2`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p2`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p2`.`Size`, `p2`.`DeletedAt`, COALESCE(`p2`.`Length`, 0) AS `Length`, COALESCE(`p2`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p2`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p1` ON `o0`.`ProductId` = `p1`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p1`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p2` ON `o0`.`ProductVariantId` = `p2`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `p`.`Id`, `p0`.`Id`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-09-11 20:44:51.919 +03:00 [WRN] Failed to process the job '4981': an exception occurred. Retry attempt 1 of 10 will be performed in 00:00:43.
Microsoft.EntityFrameworkCore.DbUpdateConcurrencyException: The database operation was expected to affect 1 row(s), but actually affected 0 row(s); data may have been modified or deleted since entities were loaded. See https://go.microsoft.com/fwlink/?LinkId=527962 for information on understanding and handling optimistic concurrency exceptions.
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ThrowAggregateUpdateConcurrencyExceptionAsync(RelationalDataReader reader, Int32 commandIndex, Int32 expectedRowsAffected, Int32 rowsAffected, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Update.Internal.MySqlModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.CartServices.CartQueryService.UpdateCartItemPriceAsync(Int32 cartItemId, Decimal newPrice) in D:\project_fashion\E-Commerce-API-main\Services\CartServices\CartQueryService.cs:line 167
   at InvokeStub_TaskAwaiter.GetResult(Object, Object, IntPtr*)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-09-11 20:44:56.007 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 20:44:56.223 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 20:44:56.373 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:44:56.823 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:44:58.491 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:44:58.662 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:44:58.917 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:44:58.920 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:44:58.956 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 19682.8564ms
2025-09-11 20:44:58.961 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-11 20:44:58.970 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 201 1432 application/json; charset=utf-8 20079.8751ms
2025-09-11 20:44:59.097 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:44:59.152 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-11 20:44:59.387 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-11 20:45:01.835 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-11 20:45:02.134 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-11 20:45:05.097 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:45:05.823 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:45:51.807 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:51.807 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:51.808 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:51.809 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:51.858 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:51.898 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:51.951 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:51.948 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:51.940 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:51.952 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:51.959 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:51.965 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:51.966 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:51.975 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:51.980 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:51.990 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:51.998 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:52.000 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.003 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:52.007 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.010 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.015 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:52.018 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.022 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:52.029 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:52.033 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.037 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:52.044 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.057 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.045 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.050 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:52.057 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:52.064 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:52.070 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:52.073 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.075 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.075 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.078 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.083 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:52.090 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:52.097 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:45:52.103 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 24.7375ms
2025-09-11 20:45:52.105 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.107 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.108 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.119 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.123 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 18.0046ms
2025-09-11 20:45:52.131 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 24.0551ms
2025-09-11 20:45:52.137 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.0257ms
2025-09-11 20:45:52.143 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 23.8313ms
2025-09-11 20:45:52.154 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.160 +03:00 [INF] Executed DbCommand (117ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.172 +03:00 [INF] Executed DbCommand (129ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.180 +03:00 [INF] Executed DbCommand (124ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.185 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.7348ms
2025-09-11 20:45:52.190 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.195 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.200 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.206 +03:00 [INF] Executed DbCommand (164ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.209 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.212 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.214 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.219 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.239 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.239 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.240 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.240 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.246 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.253 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.257 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.309 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.309 +03:00 [INF] Executed DbCommand (266ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.315 +03:00 [INF] Executed DbCommand (210ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.319 +03:00 [INF] Executed DbCommand (166ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.319 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.392 +03:00 [INF] Executed DbCommand (239ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.335 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.382 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.328 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.519 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.520 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.526 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.531 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.534 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.541 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.558 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.583 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.588 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.591 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.593 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.596 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.599 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.601 +03:00 [INF] Executed DbCommand (448ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.606 +03:00 [INF] Executed DbCommand (453ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.609 +03:00 [INF] Executed DbCommand (438ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.615 +03:00 [INF] Executed DbCommand (306ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.632 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.642 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.648 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.653 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.657 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.659 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.662 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.665 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.670 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.693 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.679 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.692 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.674 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.703 +03:00 [INF] Executed DbCommand (389ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.707 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.708 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.710 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.717 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.720 +03:00 [INF] Executed DbCommand (405ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.722 +03:00 [INF] Executed DbCommand (408ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.725 +03:00 [INF] Executed DbCommand (410ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.726 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.733 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.738 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.742 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.749 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.751 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.753 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.755 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.756 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.761 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.766 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.770 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.772 +03:00 [INF] Executed DbCommand (458ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.774 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.776 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.779 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.784 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.786 +03:00 [INF] Executed DbCommand (471ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.789 +03:00 [INF] Executed DbCommand (471ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.792 +03:00 [INF] Executed DbCommand (474ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:45:52.794 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.799 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.803 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.807 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:45:52.813 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.814 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.816 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.818 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:45:52.819 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.824 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.828 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.832 +03:00 [INF] Executing CreatePayment for order: ORD-20250911174445-2533
2025-09-11 20:45:52.837 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.837 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.839 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.840 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911174445-2533 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:45:52.843 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.843 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.849 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 11.3657ms
2025-09-11 20:45:52.852 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.854 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.858 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 14.8288ms
2025-09-11 20:45:52.863 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 19.9772ms
2025-09-11 20:45:52.872 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.876 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 24.0111ms
2025-09-11 20:45:52.882 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 27.6653ms
2025-09-11 20:45:52.889 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.895 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.901 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 28.4177ms
2025-09-11 20:45:52.907 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.913 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.919 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.4679ms
2025-09-11 20:45:52.923 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 27.7465ms
2025-09-11 20:45:52.935 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:52.943 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 35.4539ms
2025-09-11 20:45:52.950 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 36.4046ms
2025-09-11 20:45:52.957 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:52.966 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:52.968 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.977 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.989 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.990 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.992 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:52.999 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 30.7015ms
2025-09-11 20:45:53.004 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 27.74ms
2025-09-11 20:45:53.010 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 21.4152ms
2025-09-11 20:45:53.018 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 28.2461ms
2025-09-11 20:45:53.024 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.1359ms
2025-09-11 20:45:53.034 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.040 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.048 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.054 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.060 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.063 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.065 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.066 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.068 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.069 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.071 +03:00 [INF] Executed DbCommand (103ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.072 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.074 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.078 +03:00 [INF] Executed DbCommand (87ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.080 +03:00 [INF] Executed DbCommand (91ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.104 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.114 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 41.7554ms
2025-09-11 20:45:53.118 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 43.4024ms
2025-09-11 20:45:53.131 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.136 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.4999ms
2025-09-11 20:45:53.143 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.151 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.154 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.162 +03:00 [INF] Executed DbCommand (100ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.165 +03:00 [INF] Executed DbCommand (100ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.166 +03:00 [INF] Executed DbCommand (100ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.168 +03:00 [INF] Executed DbCommand (100ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.173 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.179 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.191 +03:00 [INF] Getting order by number: ORD-20250911174445-2533
2025-09-11 20:45:53.197 +03:00 [INF] Executed DbCommand (128ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.199 +03:00 [INF] Executed DbCommand (122ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.204 +03:00 [INF] Executed DbCommand (133ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.206 +03:00 [INF] Executed DbCommand (127ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.215 +03:00 [INF] Executed DbCommand (143ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.219 +03:00 [INF] Executed DbCommand (146ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.224 +03:00 [INF] Executed DbCommand (139ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:45:53.233 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.237 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.241 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.263 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:45:53.273 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 39.5636ms
2025-09-11 20:45:53.285 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 47.6507ms
2025-09-11 20:45:53.292 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 51.3017ms
2025-09-11 20:45:53.297 +03:00 [INF] Executed DbCommand (144ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.304 +03:00 [INF] Executed DbCommand (140ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.316 +03:00 [INF] Executed DbCommand (150ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.321 +03:00 [INF] Executed DbCommand (154ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.328 +03:00 [INF] Executed DbCommand (130ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.332 +03:00 [INF] Executed DbCommand (129ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.336 +03:00 [INF] Executed DbCommand (130ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:45:53.342 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.347 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.351 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.357 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.363 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 20.9014ms
2025-09-11 20:45:53.369 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 21.7782ms
2025-09-11 20:45:53.375 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 23.4852ms
2025-09-11 20:45:53.381 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 24.4486ms
2025-09-11 20:45:53.388 +03:00 [INF] Executed DbCommand (92ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:45:53.393 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.401 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.407 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.413 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:45:53.419 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 26.0095ms
2025-09-11 20:45:53.425 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 23.6188ms
2025-09-11 20:45:53.435 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 27.7659ms
2025-09-11 20:45:53.436 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:45:53.443 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.457 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.467 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.470 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.474 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.4767ms
2025-09-11 20:45:53.484 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 26.7921ms
2025-09-11 20:45:53.489 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 22.0595ms
2025-09-11 20:45:53.498 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 27.7791ms
2025-09-11 20:45:53.504 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.505 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.514 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.520 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.529 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.535 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 30.0026ms
2025-09-11 20:45:53.539 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.6772ms
2025-09-11 20:45:53.546 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.6623ms
2025-09-11 20:45:53.551 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.0695ms
2025-09-11 20:45:53.557 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 28.1157ms
2025-09-11 20:45:53.566 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.572 +03:00 [INF] Executed DbCommand (102ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:45:53.581 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.588 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.596 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.602 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 36.0806ms
2025-09-11 20:45:53.608 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:45:53.615 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.2798ms
2025-09-11 20:45:53.620 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.6684ms
2025-09-11 20:45:53.626 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.9633ms
2025-09-11 20:45:53.634 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.637 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:45:53.645 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.654 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.662 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.667 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 33.1373ms
2025-09-11 20:45:53.670 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.674 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.0259ms
2025-09-11 20:45:53.681 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 26.8591ms
2025-09-11 20:45:53.687 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 25.2544ms
2025-09-11 20:45:53.698 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.703 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 33.0401ms
2025-09-11 20:45:53.709 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.718 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.723 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.728 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.6686ms
2025-09-11 20:45:53.735 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.740 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.106ms
2025-09-11 20:45:53.750 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.0915ms
2025-09-11 20:45:53.755 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.9975ms
2025-09-11 20:45:53.764 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.770 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.7905ms
2025-09-11 20:45:53.782 +03:00 [INF] Executed DbCommand (113ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:45:53.790 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.800 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.808 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 43.6208ms
2025-09-11 20:45:53.824 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.843 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:45:53.852 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 61.8066ms
2025-09-11 20:45:53.868 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 68.1891ms
2025-09-11 20:45:53.885 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:53.898 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 72.6814ms
2025-09-11 20:45:53.903 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.029 +03:00 [INF] Executed DbCommand (127ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:45:54.128 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:45:54.108 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 222.3391ms
2025-09-11 20:45:54.117 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.122 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 219.4673ms
2025-09-11 20:45:54.092 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.131 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:45:54.143 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.159 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 41.5565ms
2025-09-11 20:45:54.167 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.172 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 80.1492ms
2025-09-11 20:45:54.175 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:45:54.182 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 38.6018ms
2025-09-11 20:45:54.188 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.197 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 30.3324ms
2025-09-11 20:45:54.215 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.221 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.228 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.235 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 46.7017ms
2025-09-11 20:45:54.241 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.247 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.7737ms
2025-09-11 20:45:54.252 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.5668ms
2025-09-11 20:45:54.257 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 28.2398ms
2025-09-11 20:45:54.263 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.273 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.7171ms
2025-09-11 20:45:54.288 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.298 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.304 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.309 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 45.7985ms
2025-09-11 20:45:54.319 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.323 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.9382ms
2025-09-11 20:45:54.334 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 36.1392ms
2025-09-11 20:45:54.339 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.783ms
2025-09-11 20:45:54.348 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.353 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.5562ms
2025-09-11 20:45:54.368 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.375 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:45:54.382 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.5507ms
2025-09-11 20:45:54.396 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 28.0553ms
2025-09-11 20:45:54.402 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 27.2068ms
2025-09-11 20:45:55.650 +03:00 [INF] Received HTTP response headers after 1441.4222ms - 201
2025-09-11 20:45:55.654 +03:00 [INF] End processing HTTP request after 1522.3595ms - 201
2025-09-11 20:45:55.664 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:45:55.822 +03:00 [INF] Executed DbCommand (156ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:45:55.831 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:45:56.004 +03:00 [INF] Executed DbCommand (171ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:45:56.025 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:45:56.031 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:45:56.333 +03:00 [INF] Received HTTP response headers after 297.2209ms - 201
2025-09-11 20:45:56.341 +03:00 [INF] End processing HTTP request after 315.698ms - 201
2025-09-11 20:45:56.363 +03:00 [INF] Successfully created PayMob order: 384510352 for local order: ORD-20250911174445-2533
2025-09-11 20:45:56.370 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:45:56.529 +03:00 [INF] Executed DbCommand (156ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:45:56.538 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:45:56.542 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384510352, Amount: 1012226
2025-09-11 20:45:56.553 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:45:56.556 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:45:56.870 +03:00 [INF] Received HTTP response headers after 310.9653ms - 201
2025-09-11 20:45:56.879 +03:00 [INF] End processing HTTP request after 326.4128ms - 201
2025-09-11 20:45:56.893 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:45:56.914 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:45:56.921 +03:00 [INF] Payment key generated successfully for Order ID: 384510352
2025-09-11 20:45:56.924 +03:00 [INF] Successfully generated payment key for order: ORD-20250911174445-2533
2025-09-11 20:45:56.927 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:45:57.097 +03:00 [INF] Executed DbCommand (165ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:45:57.119 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:45:57.132 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:45:57.136 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:45:57.143 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:45:57.155 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:45:57.494 +03:00 [INF] Executed DbCommand (171ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:45:57.756 +03:00 [INF] Payment created successfully with ID 53
2025-09-11 20:45:57.756 +03:00 [INF] Executed DbCommand (4,634ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:45:57.768 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:45:57.951 +03:00 [INF] Executed DbCommand (179ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:45:57.962 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:45:57.967 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:45:58.156 +03:00 [INF] Executed DbCommand (186ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:45:58.169 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:45:58.172 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:45:58.361 +03:00 [INF] Executed DbCommand (188ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:45:58.368 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:45:58.568 +03:00 [INF] Executed DbCommand (196ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:45:58.584 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:45:58.586 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:45:58.590 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:45:58.954 +03:00 [INF] Received HTTP response headers after 357.7073ms - 201
2025-09-11 20:45:58.963 +03:00 [INF] End processing HTTP request after 376.9506ms - 201
2025-09-11 20:45:58.971 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:45:59.186 +03:00 [INF] Executed DbCommand (210ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:45:59.198 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:45:59.431 +03:00 [INF] Executed DbCommand (230ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:45:59.443 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:45:59.450 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:45:59.884 +03:00 [INF] Received HTTP response headers after 429.6771ms - 201
2025-09-11 20:45:59.891 +03:00 [INF] End processing HTTP request after 447.9139ms - 201
2025-09-11 20:45:59.905 +03:00 [INF] Successfully created PayMob order: 384510382 for local order: ORD-20250911174445-2533
2025-09-11 20:45:59.908 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:46:00.155 +03:00 [INF] Executed DbCommand (242ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:46:00.163 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:46:00.167 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384510382, Amount: 1012226
2025-09-11 20:46:00.170 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:46:00.172 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:46:00.223 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:00.226 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 7998.3818ms
2025-09-11 20:46:00.232 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:00.235 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 200 1365 application/json; charset=utf-8 8427.6916ms
2025-09-11 20:46:00.580 +03:00 [INF] Received HTTP response headers after 405.6658ms - 201
2025-09-11 20:46:00.588 +03:00 [INF] End processing HTTP request after 417.5059ms - 201
2025-09-11 20:46:00.593 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:46:00.596 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:46:00.598 +03:00 [INF] Payment key generated successfully for Order ID: 384510382
2025-09-11 20:46:00.600 +03:00 [INF] Successfully generated payment key for order: ORD-20250911174445-2533
2025-09-11 20:46:00.605 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:46:00.901 +03:00 [INF] Executed DbCommand (294ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:46:00.910 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:46:00.914 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:46:00.916 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:46:00.918 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:46:00.920 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:46:01.645 +03:00 [ERR] Failed executing DbCommand (399ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:46:02.586 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:46:02.609 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:46:02.723 +03:00 [INF] Executed DbCommand (9,595ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:02.775 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:46:03.396 +03:00 [INF] Executed DbCommand (618ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:46:03.404 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:46:03.406 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:46:04.048 +03:00 [INF] Executed DbCommand (640ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:46:04.055 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:46:04.059 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:46:04.595 +03:00 [INF] Executed DbCommand (534ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:46:04.600 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:46:04.928 +03:00 [INF] Executed DbCommand (326ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:46:04.934 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:46:04.938 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:46:04.941 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:46:05.425 +03:00 [INF] Received HTTP response headers after 481.0271ms - 201
2025-09-11 20:46:05.431 +03:00 [INF] End processing HTTP request after 493.1042ms - 201
2025-09-11 20:46:05.435 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:46:05.858 +03:00 [INF] Executed DbCommand (420ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:46:05.865 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:46:06.283 +03:00 [INF] Executed DbCommand (415ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:46:06.289 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:46:06.291 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:46:06.863 +03:00 [INF] Received HTTP response headers after 568.7348ms - 201
2025-09-11 20:46:06.871 +03:00 [INF] End processing HTTP request after 582.5423ms - 201
2025-09-11 20:46:06.876 +03:00 [INF] Successfully created PayMob order: 384510464 for local order: ORD-20250911174445-2533
2025-09-11 20:46:06.880 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:46:07.342 +03:00 [INF] Executed DbCommand (458ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:46:07.421 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:46:07.435 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384510464, Amount: 1012226
2025-09-11 20:46:07.452 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:46:07.456 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:46:08.085 +03:00 [INF] Received HTTP response headers after 622.6484ms - 201
2025-09-11 20:46:08.088 +03:00 [INF] End processing HTTP request after 635.5599ms - 201
2025-09-11 20:46:08.090 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:46:08.092 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:46:08.101 +03:00 [INF] Payment key generated successfully for Order ID: 384510464
2025-09-11 20:46:08.103 +03:00 [INF] Successfully generated payment key for order: ORD-20250911174445-2533
2025-09-11 20:46:08.105 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:46:08.307 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:08.310 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 16072.1325ms
2025-09-11 20:46:08.313 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:08.315 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 16363.8082ms
2025-09-11 20:46:08.579 +03:00 [INF] Executed DbCommand (472ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:46:08.585 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:46:08.588 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:46:08.592 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:46:08.594 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:46:08.596 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:46:09.556 +03:00 [ERR] Failed executing DbCommand (475ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:46:10.512 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:46:10.533 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:46:10.643 +03:00 [INF] Executed DbCommand (17,471ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:10.652 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:46:11.142 +03:00 [INF] Executed DbCommand (487ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:46:11.157 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:46:11.162 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:46:11.653 +03:00 [INF] Executed DbCommand (485ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:46:11.660 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:46:11.666 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:46:12.166 +03:00 [INF] Executed DbCommand (496ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:46:12.174 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:46:12.683 +03:00 [INF] Executed DbCommand (508ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:46:12.692 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:46:12.694 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:46:12.697 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:46:13.739 +03:00 [INF] Received HTTP response headers after 1038.9741ms - 201
2025-09-11 20:46:13.745 +03:00 [INF] End processing HTTP request after 1051.4611ms - 201
2025-09-11 20:46:13.751 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:46:14.339 +03:00 [INF] Executed DbCommand (586ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:46:14.351 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:46:14.794 +03:00 [INF] Executed DbCommand (441ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:46:14.811 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:46:14.817 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:46:15.386 +03:00 [INF] Received HTTP response headers after 566.4872ms - 201
2025-09-11 20:46:15.391 +03:00 [INF] End processing HTTP request after 579.9012ms - 201
2025-09-11 20:46:15.395 +03:00 [INF] Successfully created PayMob order: 384510544 for local order: ORD-20250911174445-2533
2025-09-11 20:46:15.399 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:46:15.711 +03:00 [INF] Executed DbCommand (310ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:46:15.721 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:46:15.725 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384510544, Amount: 1012226
2025-09-11 20:46:15.730 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:46:15.733 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:46:16.073 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:16.080 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 23848.5333ms
2025-09-11 20:46:16.085 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:16.101 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 24292.1233ms
2025-09-11 20:46:16.213 +03:00 [INF] Received HTTP response headers after 477.3841ms - 201
2025-09-11 20:46:16.218 +03:00 [INF] End processing HTTP request after 488.727ms - 201
2025-09-11 20:46:16.222 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:46:16.224 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:46:16.226 +03:00 [INF] Payment key generated successfully for Order ID: 384510544
2025-09-11 20:46:16.228 +03:00 [INF] Successfully generated payment key for order: ORD-20250911174445-2533
2025-09-11 20:46:16.230 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:46:16.597 +03:00 [INF] Executed DbCommand (365ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:46:16.615 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:46:16.620 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:46:16.626 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:46:16.630 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:46:16.633 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:46:17.371 +03:00 [ERR] Failed executing DbCommand (371ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:46:17.976 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:46:17.994 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:46:18.109 +03:00 [INF] Executed DbCommand (24,931ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:18.120 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:46:18.322 +03:00 [INF] Executed DbCommand (200ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:46:18.331 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:46:18.335 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:46:18.547 +03:00 [INF] Executed DbCommand (210ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:46:18.558 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:46:18.564 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:46:18.770 +03:00 [INF] Executed DbCommand (203ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:46:18.796 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:46:18.998 +03:00 [INF] Executed DbCommand (198ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:46:19.006 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:46:19.008 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:46:19.020 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:46:19.382 +03:00 [INF] Received HTTP response headers after 358.6332ms - 201
2025-09-11 20:46:19.387 +03:00 [INF] End processing HTTP request after 379.3793ms - 201
2025-09-11 20:46:19.392 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:46:19.608 +03:00 [INF] Executed DbCommand (212ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:46:19.620 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:46:19.850 +03:00 [INF] Executed DbCommand (228ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:46:19.858 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:46:19.861 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:46:20.223 +03:00 [INF] Received HTTP response headers after 357.4475ms - 201
2025-09-11 20:46:20.231 +03:00 [INF] End processing HTTP request after 372.2395ms - 201
2025-09-11 20:46:20.234 +03:00 [INF] Successfully created PayMob order: 384510604 for local order: ORD-20250911174445-2533
2025-09-11 20:46:20.240 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:46:20.467 +03:00 [INF] Executed DbCommand (213ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:46:20.473 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:46:20.475 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384510604, Amount: 1012226
2025-09-11 20:46:20.480 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:46:20.483 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:46:20.777 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:20.784 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 28477.8481ms
2025-09-11 20:46:20.789 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:20.791 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 28984.1436ms
2025-09-11 20:46:20.849 +03:00 [INF] Received HTTP response headers after 363.1116ms - 201
2025-09-11 20:46:20.856 +03:00 [INF] End processing HTTP request after 376.3516ms - 201
2025-09-11 20:46:20.861 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:46:20.864 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:46:20.866 +03:00 [INF] Payment key generated successfully for Order ID: 384510604
2025-09-11 20:46:20.868 +03:00 [INF] Successfully generated payment key for order: ORD-20250911174445-2533
2025-09-11 20:46:20.870 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:46:21.076 +03:00 [INF] Executed DbCommand (204ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:46:21.088 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:46:21.090 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:46:21.092 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:46:21.094 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:46:21.096 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:46:21.497 +03:00 [ERR] Failed executing DbCommand (199ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:46:21.885 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:46:21.909 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:46:22.016 +03:00 [INF] Executed DbCommand (28,825ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:22.024 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:46:22.205 +03:00 [INF] Executed DbCommand (179ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:46:22.216 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:46:22.219 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:46:22.392 +03:00 [INF] Executed DbCommand (170ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:46:22.405 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:46:22.408 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:46:22.585 +03:00 [INF] Executed DbCommand (175ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:46:22.597 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:46:22.779 +03:00 [INF] Executed DbCommand (173ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:46:22.804 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:46:22.809 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:46:22.815 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:46:23.153 +03:00 [INF] Received HTTP response headers after 328.3495ms - 201
2025-09-11 20:46:23.155 +03:00 [INF] End processing HTTP request after 346.247ms - 201
2025-09-11 20:46:23.158 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:46:23.334 +03:00 [INF] Executed DbCommand (174ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:46:23.341 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:46:23.528 +03:00 [INF] Executed DbCommand (184ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:46:23.537 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:46:23.540 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:46:23.795 +03:00 [INF] Received HTTP response headers after 252.736ms - 201
2025-09-11 20:46:23.800 +03:00 [INF] End processing HTTP request after 262.9971ms - 201
2025-09-11 20:46:23.804 +03:00 [INF] Successfully created PayMob order: 384510641 for local order: ORD-20250911174445-2533
2025-09-11 20:46:23.807 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:46:23.923 +03:00 [INF] Executed DbCommand (114ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:46:23.930 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:46:23.931 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:23.933 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384510641, Amount: 1012226
2025-09-11 20:46:23.936 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 31380.0634ms
2025-09-11 20:46:23.938 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:46:23.941 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:23.944 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:46:23.947 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 31981.329ms
2025-09-11 20:46:24.233 +03:00 [INF] Received HTTP response headers after 282.778ms - 201
2025-09-11 20:46:24.246 +03:00 [INF] End processing HTTP request after 307.8427ms - 201
2025-09-11 20:46:24.257 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:46:24.268 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:46:24.276 +03:00 [INF] Payment key generated successfully for Order ID: 384510641
2025-09-11 20:46:24.281 +03:00 [INF] Successfully generated payment key for order: ORD-20250911174445-2533
2025-09-11 20:46:24.284 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:46:24.437 +03:00 [INF] Executed DbCommand (151ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:46:24.437 +03:00 [ERR] Failed executing DbCommand (31,241ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:24.469 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> MySqlConnector.MySqlException (0x80004005): Query execution was interrupted
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 124
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:46:24.459 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:46:24.482 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:46:24.483 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:46:24.486 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:46:24.489 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:46:24.843 +03:00 [ERR] Failed executing DbCommand (190ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:46:25.214 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:46:25.236 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:46:25.305 +03:00 [ERR] Failed executing DbCommand (32,092ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:25.318 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 67
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 75
   at MySqlConnector.Protocol.Serialization.BufferedByteReader.ReadBytesAsync(IByteHandler byteHandler, ArraySegment`1 buffer, Int32 totalBytesToRead, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/BufferedByteReader.cs:line 34
   at MySqlConnector.Protocol.Serialization.ProtocolUtility.ReadPayloadAsync(BufferedByteReader bufferedByteReader, IByteHandler byteHandler, Func`1 getNextSequenceNumber, ArraySegmentHolder`1 previousPayloads, ProtocolErrorBehavior protocolErrorBehavior, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/ProtocolUtility.cs:line 421
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 882
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:46:25.376 +03:00 [ERR] An error occurred using a transaction.
2025-09-11 20:46:25.384 +03:00 [ERR] Error in CreatePayment: Connection must be Open; current state is Closed
2025-09-11 20:46:25.386 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:25.389 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 32851.2107ms
2025-09-11 20:46:25.393 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:25.403 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 225 application/json; charset=utf-8 33451.0023ms
2025-09-11 20:46:25.459 +03:00 [ERR] Failed executing DbCommand (32,235ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:25.460 +03:00 [ERR] Failed executing DbCommand (32,227ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:25.465 +03:00 [ERR] Failed executing DbCommand (32,228ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:25.468 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 67
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 75
   at MySqlConnector.Protocol.Serialization.BufferedByteReader.ReadBytesAsync(IByteHandler byteHandler, ArraySegment`1 buffer, Int32 totalBytesToRead, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/BufferedByteReader.cs:line 34
   at MySqlConnector.Protocol.Serialization.ProtocolUtility.ReadPayloadAsync(BufferedByteReader bufferedByteReader, IByteHandler byteHandler, Func`1 getNextSequenceNumber, ArraySegmentHolder`1 previousPayloads, ProtocolErrorBehavior protocolErrorBehavior, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/ProtocolUtility.cs:line 421
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 882
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:46:25.470 +03:00 [ERR] Failed executing DbCommand (32,230ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:25.475 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 67
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 75
   at MySqlConnector.Protocol.Serialization.BufferedByteReader.ReadBytesAsync(IByteHandler byteHandler, ArraySegment`1 buffer, Int32 totalBytesToRead, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/BufferedByteReader.cs:line 34
   at MySqlConnector.Protocol.Serialization.ProtocolUtility.ReadPayloadAsync(BufferedByteReader bufferedByteReader, IByteHandler byteHandler, Func`1 getNextSequenceNumber, ArraySegmentHolder`1 previousPayloads, ProtocolErrorBehavior protocolErrorBehavior, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/ProtocolUtility.cs:line 421
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 882
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:46:25.481 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 67
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 75
   at MySqlConnector.Protocol.Serialization.BufferedByteReader.ReadBytesAsync(IByteHandler byteHandler, ArraySegment`1 buffer, Int32 totalBytesToRead, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/BufferedByteReader.cs:line 34
   at MySqlConnector.Protocol.Serialization.ProtocolUtility.ReadPayloadAsync(BufferedByteReader bufferedByteReader, IByteHandler byteHandler, Func`1 getNextSequenceNumber, ArraySegmentHolder`1 previousPayloads, ProtocolErrorBehavior protocolErrorBehavior, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/ProtocolUtility.cs:line 421
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 882
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:46:25.494 +03:00 [ERR] An error occurred using a transaction.
2025-09-11 20:46:25.499 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 67
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 75
   at MySqlConnector.Protocol.Serialization.BufferedByteReader.ReadBytesAsync(IByteHandler byteHandler, ArraySegment`1 buffer, Int32 totalBytesToRead, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/BufferedByteReader.cs:line 34
   at MySqlConnector.Protocol.Serialization.ProtocolUtility.ReadPayloadAsync(BufferedByteReader bufferedByteReader, IByteHandler byteHandler, Func`1 getNextSequenceNumber, ArraySegmentHolder`1 previousPayloads, ProtocolErrorBehavior protocolErrorBehavior, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/ProtocolUtility.cs:line 421
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 882
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:46:25.514 +03:00 [ERR] An error occurred using a transaction.
2025-09-11 20:46:25.539 +03:00 [ERR] An error occurred using a transaction.
2025-09-11 20:46:25.539 +03:00 [ERR] Error in CreatePayment: Connection must be Open; current state is Closed
2025-09-11 20:46:25.559 +03:00 [ERR] An error occurred using a transaction.
2025-09-11 20:46:25.559 +03:00 [ERR] Error in CreatePayment: Connection must be Open; current state is Closed
2025-09-11 20:46:25.560 +03:00 [ERR] Error in CreatePayment: Connection must be Open; current state is Closed
2025-09-11 20:46:25.565 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:25.568 +03:00 [ERR] Error in CreatePayment: Connection must be Open; current state is Closed
2025-09-11 20:46:25.569 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:25.571 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:25.584 +03:00 [INF] Executed DbCommand (32,365ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:25.586 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 33005.1551ms
2025-09-11 20:46:25.588 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:25.590 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 32841.6062ms
2025-09-11 20:46:25.593 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 32914.8013ms
2025-09-11 20:46:25.600 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:46:25.603 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:25.606 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 32932.7144ms
2025-09-11 20:46:25.609 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:25.613 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:25.617 +03:00 [ERR] Failed executing DbCommand (32,290ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:25.618 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 225 application/json; charset=utf-8 33809.9685ms
2025-09-11 20:46:25.621 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:25.623 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 225 application/json; charset=utf-8 33579.4815ms
2025-09-11 20:46:25.626 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 225 application/json; charset=utf-8 33625.6644ms
2025-09-11 20:46:25.633 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 67
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 75
   at MySqlConnector.Protocol.Serialization.BufferedByteReader.ReadBytesAsync(IByteHandler byteHandler, ArraySegment`1 buffer, Int32 totalBytesToRead, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/BufferedByteReader.cs:line 34
   at MySqlConnector.Protocol.Serialization.ProtocolUtility.ReadPayloadAsync(BufferedByteReader bufferedByteReader, IByteHandler byteHandler, Func`1 getNextSequenceNumber, ArraySegmentHolder`1 previousPayloads, ProtocolErrorBehavior protocolErrorBehavior, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/ProtocolUtility.cs:line 421
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 882
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:46:25.639 +03:00 [ERR] Failed executing DbCommand (32,308ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:25.641 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 225 application/json; charset=utf-8 33661.3047ms
2025-09-11 20:46:25.653 +03:00 [ERR] Failed executing DbCommand (32,317ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:25.659 +03:00 [ERR] Failed executing DbCommand (32,318ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:25.676 +03:00 [ERR] An error occurred using a transaction.
2025-09-11 20:46:25.681 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 67
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 75
   at MySqlConnector.Protocol.Serialization.BufferedByteReader.ReadBytesAsync(IByteHandler byteHandler, ArraySegment`1 buffer, Int32 totalBytesToRead, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/BufferedByteReader.cs:line 34
   at MySqlConnector.Protocol.Serialization.ProtocolUtility.ReadPayloadAsync(BufferedByteReader bufferedByteReader, IByteHandler byteHandler, Func`1 getNextSequenceNumber, ArraySegmentHolder`1 previousPayloads, ProtocolErrorBehavior protocolErrorBehavior, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/ProtocolUtility.cs:line 421
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 882
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:46:25.688 +03:00 [ERR] Failed executing DbCommand (32,341ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:25.691 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 67
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 75
   at MySqlConnector.Protocol.Serialization.BufferedByteReader.ReadBytesAsync(IByteHandler byteHandler, ArraySegment`1 buffer, Int32 totalBytesToRead, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/BufferedByteReader.cs:line 34
   at MySqlConnector.Protocol.Serialization.ProtocolUtility.ReadPayloadAsync(BufferedByteReader bufferedByteReader, IByteHandler byteHandler, Func`1 getNextSequenceNumber, ArraySegmentHolder`1 previousPayloads, ProtocolErrorBehavior protocolErrorBehavior, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/ProtocolUtility.cs:line 421
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 882
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:46:25.698 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 67
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 75
   at MySqlConnector.Protocol.Serialization.BufferedByteReader.ReadBytesAsync(IByteHandler byteHandler, ArraySegment`1 buffer, Int32 totalBytesToRead, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/BufferedByteReader.cs:line 34
   at MySqlConnector.Protocol.Serialization.ProtocolUtility.ReadPayloadAsync(BufferedByteReader bufferedByteReader, IByteHandler byteHandler, Func`1 getNextSequenceNumber, ArraySegmentHolder`1 previousPayloads, ProtocolErrorBehavior protocolErrorBehavior, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/ProtocolUtility.cs:line 421
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 882
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:46:25.700 +03:00 [ERR] Error in CreatePayment: Connection must be Open; current state is Closed
2025-09-11 20:46:25.716 +03:00 [ERR] An error occurred using a transaction.
2025-09-11 20:46:25.719 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 67
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 75
   at MySqlConnector.Protocol.Serialization.BufferedByteReader.ReadBytesAsync(IByteHandler byteHandler, ArraySegment`1 buffer, Int32 totalBytesToRead, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/BufferedByteReader.cs:line 34
   at MySqlConnector.Protocol.Serialization.ProtocolUtility.ReadPayloadAsync(BufferedByteReader bufferedByteReader, IByteHandler byteHandler, Func`1 getNextSequenceNumber, ArraySegmentHolder`1 previousPayloads, ProtocolErrorBehavior protocolErrorBehavior, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/ProtocolUtility.cs:line 421
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 882
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:46:25.733 +03:00 [ERR] An error occurred using a transaction.
2025-09-11 20:46:25.754 +03:00 [ERR] An error occurred using a transaction.
2025-09-11 20:46:25.754 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:25.756 +03:00 [ERR] Error in CreatePayment: Connection must be Open; current state is Closed
2025-09-11 20:46:25.809 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:25.801 +03:00 [ERR] Error in CreatePayment: Connection must be Open; current state is Closed
2025-09-11 20:46:25.802 +03:00 [ERR] Error in CreatePayment: Connection must be Open; current state is Closed
2025-09-11 20:46:25.806 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 33036.652ms
2025-09-11 20:46:25.800 +03:00 [ERR] An error occurred using a transaction.
2025-09-11 20:46:25.816 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 33056.1979ms
2025-09-11 20:46:25.817 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:25.820 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:25.826 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:25.827 +03:00 [ERR] Error in CreatePayment: Connection must be Open; current state is Closed
2025-09-11 20:46:25.833 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:25.835 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 33069.7254ms
2025-09-11 20:46:25.842 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 33030.1351ms
2025-09-11 20:46:25.844 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 225 application/json; charset=utf-8 33811.527ms
2025-09-11 20:46:25.848 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:25.851 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 225 application/json; charset=utf-8 33794.7812ms
2025-09-11 20:46:25.872 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:25.881 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:25.893 +03:00 [ERR] Failed executing DbCommand (32,542ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:25.898 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 33074.5871ms
2025-09-11 20:46:25.910 +03:00 [ERR] Failed executing DbCommand (32,553ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:46:25.913 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 225 application/json; charset=utf-8 33903.7744ms
2025-09-11 20:46:25.916 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 225 application/json; charset=utf-8 33870.4435ms
2025-09-11 20:46:25.920 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 67
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 75
   at MySqlConnector.Protocol.Serialization.BufferedByteReader.ReadBytesAsync(IByteHandler byteHandler, ArraySegment`1 buffer, Int32 totalBytesToRead, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/BufferedByteReader.cs:line 34
   at MySqlConnector.Protocol.Serialization.ProtocolUtility.ReadPayloadAsync(BufferedByteReader bufferedByteReader, IByteHandler byteHandler, Func`1 getNextSequenceNumber, ArraySegmentHolder`1 previousPayloads, ProtocolErrorBehavior protocolErrorBehavior, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/ProtocolUtility.cs:line 421
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 882
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:46:25.923 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:25.927 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 67
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 75
   at MySqlConnector.Protocol.Serialization.BufferedByteReader.ReadBytesAsync(IByteHandler byteHandler, ArraySegment`1 buffer, Int32 totalBytesToRead, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/BufferedByteReader.cs:line 34
   at MySqlConnector.Protocol.Serialization.ProtocolUtility.ReadPayloadAsync(BufferedByteReader bufferedByteReader, IByteHandler byteHandler, Func`1 getNextSequenceNumber, ArraySegmentHolder`1 previousPayloads, ProtocolErrorBehavior protocolErrorBehavior, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/ProtocolUtility.cs:line 421
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 882
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:46:25.936 +03:00 [INF] Executed DbCommand (320ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:46:25.975 +03:00 [ERR] An error occurred using a transaction.
2025-09-11 20:46:25.976 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 225 application/json; charset=utf-8 33903.1123ms
2025-09-11 20:46:26.000 +03:00 [ERR] An error occurred using a transaction.
2025-09-11 20:46:26.003 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:46:26.004 +03:00 [ERR] Error in CreatePayment: Connection must be Open; current state is Closed
2025-09-11 20:46:26.016 +03:00 [ERR] Error in CreatePayment: Connection must be Open; current state is Closed
2025-09-11 20:46:26.018 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:46:26.020 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:26.021 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:26.025 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 33194.0339ms
2025-09-11 20:46:26.032 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 33205.791ms
2025-09-11 20:46:26.034 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:26.037 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:26.041 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 225 application/json; charset=utf-8 33965.9549ms
2025-09-11 20:46:26.039 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 225 application/json; charset=utf-8 33963.4164ms
2025-09-11 20:46:26.275 +03:00 [INF] Executed DbCommand (252ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:46:26.287 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:46:26.291 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:46:26.560 +03:00 [INF] Executed DbCommand (267ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:46:26.570 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:46:26.830 +03:00 [INF] Executed DbCommand (256ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:46:26.839 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:46:26.843 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:46:26.923 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:46:27.268 +03:00 [INF] Received HTTP response headers after 341.9019ms - 201
2025-09-11 20:46:27.274 +03:00 [INF] End processing HTTP request after 431.4613ms - 201
2025-09-11 20:46:27.509 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:46:27.603 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:27.607 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 35021.6801ms
2025-09-11 20:46:27.611 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:27.614 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 35649.0916ms
2025-09-11 20:46:27.628 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:27.632 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 34962.8706ms
2025-09-11 20:46:27.635 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:27.637 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 35629.9929ms
2025-09-11 20:46:27.779 +03:00 [INF] Executed DbCommand (266ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:46:27.787 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:46:28.058 +03:00 [INF] Executed DbCommand (269ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:46:28.069 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:46:28.074 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:46:28.419 +03:00 [INF] Received HTTP response headers after 341.3085ms - 201
2025-09-11 20:46:28.425 +03:00 [INF] End processing HTTP request after 355.5669ms - 201
2025-09-11 20:46:28.434 +03:00 [INF] Successfully created PayMob order: 384510688 for local order: ORD-20250911174445-2533
2025-09-11 20:46:28.439 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:46:28.707 +03:00 [INF] Executed DbCommand (263ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:46:28.751 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:46:28.754 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384510688, Amount: 1012226
2025-09-11 20:46:28.759 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:46:28.768 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:46:29.120 +03:00 [INF] Received HTTP response headers after 350.3423ms - 201
2025-09-11 20:46:29.123 +03:00 [INF] End processing HTTP request after 364.2057ms - 201
2025-09-11 20:46:29.127 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:46:29.131 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:46:29.134 +03:00 [INF] Payment key generated successfully for Order ID: 384510688
2025-09-11 20:46:29.137 +03:00 [INF] Successfully generated payment key for order: ORD-20250911174445-2533
2025-09-11 20:46:29.140 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:46:29.214 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:46:29.220 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:46:29.222 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:46:29.224 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:46:29.226 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:46:29.227 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:46:29.389 +03:00 [ERR] Failed executing DbCommand (81ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:46:29.963 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:46:29.986 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '129-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:46:33.866 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:46:33.878 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 41187.4927ms
2025-09-11 20:46:33.887 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:46:33.893 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 41875.4137ms
2025-09-11 20:48:22.047 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:48:22.059 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:48:23.470 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1422.9799ms
2025-09-11 20:48:26.296 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:48:26.303 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:48:27.700 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1403.8137ms
2025-09-11 20:48:30.287 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:48:30.294 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:48:31.700 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1413.2912ms
2025-09-11 20:50:33.725 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:50:33.855 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:50:35.207 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - null null
2025-09-11 20:50:35.259 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1533.6166ms
2025-09-11 20:50:36.045 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - null null
2025-09-11 20:50:37.265 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:50:37.273 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:50:37.585 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - 200 null text/html 2377.7159ms
2025-09-11 20:50:38.374 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - 200 null text/html 2329.7315ms
2025-09-11 20:50:38.445 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-11 20:50:38.478 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-11 20:50:38.548 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 103.1816ms
2025-09-11 20:50:38.565 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 86.8294ms
2025-09-11 20:50:38.710 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1444.5855ms
2025-09-11 20:50:40.644 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:50:40.655 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:50:42.080 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1435.885ms
2025-09-11 20:50:42.150 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/jobs/scheduled/enqueue - application/x-www-form-urlencoded; charset=UTF-8 31
2025-09-11 20:50:42.163 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:50:44.103 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:50:44.111 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:50:44.374 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/jobs/scheduled/enqueue - 204 null null 2224.0325ms
2025-09-11 20:50:44.409 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - null null
2025-09-11 20:50:45.799 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1696.7751ms
2025-09-11 20:50:46.017 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 129
2025-09-11 20:50:46.105 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:50:46.190 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:50:46.344 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:50:46.582 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - 200 null text/html 2173.1967ms
2025-09-11 20:50:46.612 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-11 20:50:46.627 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-11 20:50:46.693 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 79.7909ms
2025-09-11 20:50:46.708 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 81.554ms
2025-09-11 20:50:48.733 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:50:48.740 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:50:49.993 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1260.4949ms
2025-09-11 20:50:51.400 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:50:51.700 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:50:51.723 +03:00 [INF] Order 129 auto-expired and restock scheduled
2025-09-11 20:50:51.829 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:50:52.006 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:50:52.015 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:50:52.126 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:50:52.310 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:50:52.735 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:50:53.410 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:50:53.767 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1761.3274ms
2025-09-11 20:50:53.832 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:50:55.779 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:50:55.788 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:50:56.870 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 20:50:57.031 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1252.2238ms
2025-09-11 20:50:57.083 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 20:50:59.038 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:50:59.048 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:50:59.848 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:51:00.268 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:51:00.451 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1412.9817ms
2025-09-11 20:51:00.810 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:51:01.233 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:51:02.473 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:51:02.488 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:51:02.791 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:51:03.215 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:51:03.222 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:51:03.645 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:51:03.731 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1257.6375ms
2025-09-11 20:51:04.644 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-11 20:51:04.835 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:51:04.866 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-11 20:51:05.259 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:51:05.494 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:51:05.745 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:51:05.751 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:51:05.916 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:51:06.727 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-11 20:51:06.941 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-11 20:51:07.154 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1409.3278ms
2025-09-11 20:51:07.702 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:51:08.134 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:51:09.171 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:51:09.181 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:51:09.956 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:51:10.395 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:51:10.414 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1243.2425ms
2025-09-11 20:51:13.294 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:51:13.300 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:51:14.696 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1402.053ms
2025-09-11 20:51:16.708 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:51:16.728 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:51:18.114 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1406.1411ms
2025-09-11 20:51:20.291 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:51:20.300 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:51:21.709 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1417.4194ms
2025-09-11 20:51:24.318 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:51:24.352 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:51:25.765 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1447.4692ms
2025-09-11 20:51:27.469 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 62
2025-09-11 20:51:27.495 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:51:27.646 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:51:27.661 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-11 20:51:27.665 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-11 20:51:27.680 +03:00 [INF] Executing AddItemToCart for product ID: 6
2025-09-11 20:51:27.682 +03:00 [INF] Adding item to cart for user: e682f183-1c61-400b-aa5a-171750f446b5, product: 6
2025-09-11 20:51:27.993 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:51:28.014 +03:00 [INF] Execute GetAll for entity Product
2025-09-11 20:51:28.099 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-09-11 20:51:28.109 +03:00 [INF] Retrieving cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:51:28.189 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-11 20:51:28.273 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Cart WHERE Id = @p0 FOR UPDATE
2025-09-11 20:51:28.287 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-09-11 20:51:28.292 +03:00 [INF] CartItem added successfully (pending save)
2025-09-11 20:51:28.294 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:51:28.295 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:51:28.297 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:51:29.374 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (DbType = Int32), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`, `RowVersion`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:51:29.529 +03:00 [INF] Removing cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:51:29.967 +03:00 [INF] Cache removed successfully for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:51:29.979 +03:00 [INF] Item added to cart for user: e682f183-1c61-400b-aa5a-171750f446b5, product: 6
2025-09-11 20:51:29.989 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-11 20:51:29.995 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 2326.1058ms
2025-09-11 20:51:29.998 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-11 20:51:30.001 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 2531.4373ms
2025-09-11 20:51:34.173 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - null 0
2025-09-11 20:51:34.180 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:51:34.328 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:51:34.336 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-11 20:51:34.343 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-11 20:51:34.347 +03:00 [INF] Executing CheckOut
2025-09-11 20:51:34.349 +03:00 [INF] Checkout of cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:51:34.351 +03:00 [INF] Retrieving cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:51:34.502 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-11 20:51:34.658 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-11 20:51:34.664 +03:00 [INF] Removing cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:51:34.667 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-11 20:51:34.672 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 325.2398ms
2025-09-11 20:51:34.680 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-11 20:51:34.684 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - 200 122 application/json; charset=utf-8 511.0763ms
2025-09-11 20:51:35.114 +03:00 [INF] Cache removed successfully for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:51:36.415 +03:00 [INF] Removing cache by tag: cart
2025-09-11 20:51:36.656 +03:00 [WRN] No cache entries found for tag: cart
2025-09-11 20:51:38.607 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json 42
2025-09-11 20:51:38.630 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:51:38.783 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:51:38.796 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-11 20:51:38.798 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-11 20:51:38.802 +03:00 [INF] Executing CreateOrder
2025-09-11 20:51:38.805 +03:00 [INF] Creating order from cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:51:39.109 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:51:39.194 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-11 20:51:39.205 +03:00 [INF] Checking if address 31 exists for customer: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:51:39.292 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-09-11 20:51:39.300 +03:00 [INF] Getting cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:51:39.305 +03:00 [INF] Getting cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:51:39.527 +03:00 [WRN] Cache miss for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:51:39.606 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-11 20:51:39.616 +03:00 [INF] Execute GetAll for entity Cart
2025-09-11 20:51:39.709 +03:00 [INF] Executed DbCommand (87ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-09-11 20:51:41.458 +03:00 [INF] Setting cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:51:41.679 +03:00 [INF] Cache set successfully for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5 with tags: [cart]
2025-09-11 20:51:41.686 +03:00 [INF] Execute GetAll for entity ProductVariant
2025-09-11 20:51:41.773 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE `p`.`Id` = 4
2025-09-11 20:51:41.862 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-09-11 20:51:41.869 +03:00 [INF] Executing CreateAsync for entity Order
2025-09-11 20:51:41.873 +03:00 [INF] Order added successfully (pending save)
2025-09-11 20:51:41.908 +03:00 [INF] Execute GetAll for entity CartItem
2025-09-11 20:51:42.031 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = Decimal), @p13='?' (DbType = Int32), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal), @p16='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `RestockedAt`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`, `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:51:42.058 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__cartItemId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE (`c`.`Id` = @__cartItemId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:51:42.073 +03:00 [INF] CartItem 85 price updated to 3374.08790000
2025-09-11 20:51:42.114 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-09-11 20:51:42.118 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-09-11 20:51:42.123 +03:00 [INF] Removing 3 from variant: 4
2025-09-11 20:51:42.200 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity - @p0 WHERE Id = @p1 AND Quantity >= @p0
2025-09-11 20:51:42.210 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 4
2025-09-11 20:51:42.329 +03:00 [INF] Executed DbCommand (115ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:51:42.446 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
UPDATE `CartItems` SET `UnitPrice` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:51:43.307 +03:00 [INF] Retrieving cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:51:43.422 +03:00 [INF] Clearing cart: 3
2025-09-11 20:51:43.475 +03:00 [INF] Executed DbCommand (89ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-11 20:51:43.499 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-09-11 20:51:43.503 +03:00 [INF] Cart 3 cleared successfully
2025-09-11 20:51:43.630 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-11 20:51:43.636 +03:00 [INF] Checkout date removed for cart of user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:51:43.664 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 8) (DbType = Binary), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = Decimal), @p11='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0 AND `RowVersion` IS NULL;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:51:43.819 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:51:43.826 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:51:43.829 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:51:43.833 +03:00 [INF] Execute GetAll for entity Order
2025-09-11 20:51:44.018 +03:00 [INF] Executed DbCommand (104ms) [Parameters=[@__createdOrder_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`DeletedAt`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`Id0`, `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`, `p0`.`Status`, `p0`.`Amount`, `p0`.`CreatedAt`, `p0`.`Id`, `p0`.`PaymentDate`, `p0`.`PaymentMethodId`, `p0`.`PaymentProviderId`, `t0`.`c`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`DeletedAt`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    WHERE `o`.`Id` = @__createdOrder_Id_0
    LIMIT 1
) AS `t0`
LEFT JOIN `Payments` AS `p` ON `t0`.`Id` = `p`.`OrderId`
LEFT JOIN `Payments` AS `p0` ON `t0`.`Id` = `p0`.`OrderId`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p1`.`Id` AS `Id0`, `p1`.`Name`, `p1`.`Price`, `p1`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p1`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p1`.`Price`))
        ELSE `p1`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p1`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p2`.`Color`, COALESCE(`p2`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p2`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p2`.`Size`, `p2`.`DeletedAt`, COALESCE(`p2`.`Length`, 0) AS `Length`, COALESCE(`p2`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p2`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p1` ON `o0`.`ProductId` = `p1`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p1`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p2` ON `o0`.`ProductVariantId` = `p2`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `p`.`Id`, `p0`.`Id`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-09-11 20:51:44.906 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-11 20:51:45.206 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:51:46.493 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 20:51:46.708 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 20:51:47.178 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:51:47.478 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-11 20:51:47.607 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:51:47.713 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-11 20:51:48.328 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-11 20:51:48.542 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-11 20:51:49.057 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:51:49.203 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:51:49.418 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:51:49.435 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 10634.1689ms
2025-09-11 20:51:49.441 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-11 20:51:49.445 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 201 1432 application/json; charset=utf-8 10838.1514ms
2025-09-11 20:51:49.479 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:51:49.629 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:51:49.861 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:51:50.297 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:52:17.759 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:17.768 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:17.769 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:17.769 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:17.770 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:17.820 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:17.854 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:17.916 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:17.945 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:17.950 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:17.957 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:17.961 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:17.961 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:17.963 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:17.966 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:17.975 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:17.982 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:17.987 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:17.994 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:17.999 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:18.001 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.003 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.004 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.006 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.011 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.014 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:18.019 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:18.027 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:18.031 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:18.035 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:18.042 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.044 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.046 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.047 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.049 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.053 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:18.059 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 20:52:18.064 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 18.2445ms
2025-09-11 20:52:18.070 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 22.4449ms
2025-09-11 20:52:18.076 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 26.711ms
2025-09-11 20:52:18.080 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.080 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.096 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.103 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.109 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 28.5985ms
2025-09-11 20:52:18.113 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.6982ms
2025-09-11 20:52:18.123 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 26.3089ms
2025-09-11 20:52:18.129 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 26.4326ms
2025-09-11 20:52:18.136 +03:00 [INF] Executed DbCommand (97ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.144 +03:00 [INF] Executed DbCommand (104ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.154 +03:00 [INF] Executed DbCommand (114ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.165 +03:00 [INF] Executed DbCommand (124ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.169 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.176 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.180 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.184 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.186 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.189 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.192 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.197 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.202 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.206 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.212 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.215 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.216 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.217 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.219 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.221 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.226 +03:00 [INF] Executed DbCommand (186ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.229 +03:00 [INF] Executed DbCommand (150ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.230 +03:00 [INF] Executed DbCommand (151ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.233 +03:00 [INF] Executed DbCommand (153ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.236 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.242 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.247 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.252 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.254 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.258 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.265 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.267 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.271 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.281 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.286 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.294 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.295 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.297 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.298 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.300 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.302 +03:00 [INF] Executed DbCommand (223ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.309 +03:00 [INF] Executed DbCommand (213ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.312 +03:00 [INF] Executed DbCommand (176ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.314 +03:00 [INF] Executed DbCommand (89ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.318 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.329 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.347 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.353 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.357 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.360 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.362 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.364 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.421 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.433 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.436 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.443 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.444 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.446 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.448 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.450 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.453 +03:00 [INF] Executed DbCommand (225ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.455 +03:00 [INF] Executed DbCommand (227ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.465 +03:00 [INF] Executed DbCommand (237ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.470 +03:00 [INF] Executed DbCommand (241ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.478 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.482 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.486 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.492 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.494 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.496 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.497 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.499 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.504 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.510 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.524 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.516 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.517 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.513 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.531 +03:00 [INF] Executed DbCommand (299ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 20:52:18.533 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.550 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.552 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.565 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:18.575 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.579 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.580 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.584 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 33.7505ms
2025-09-11 20:52:18.586 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.587 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 20:52:18.594 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 19.0344ms
2025-09-11 20:52:18.602 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 22.6946ms
2025-09-11 20:52:18.610 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 30.5288ms
2025-09-11 20:52:18.619 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.627 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 41.3985ms
2025-09-11 20:52:18.633 +03:00 [INF] Executing CreatePayment for order: ORD-20250911175141-5818
2025-09-11 20:52:18.683 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911175141-5818 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 20:52:18.649 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.657 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.663 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.681 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.641 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.697 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.699 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.704 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 47.6743ms
2025-09-11 20:52:18.714 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 51.1926ms
2025-09-11 20:52:18.719 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 37.601ms
2025-09-11 20:52:18.728 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.730 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.732 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.740 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.749 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.757 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.759 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.761 +03:00 [INF] Executed DbCommand (99ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:18.763 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.765 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.767 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.770 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.777 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:18.784 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.791 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 28.0502ms
2025-09-11 20:52:18.797 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.655ms
2025-09-11 20:52:18.802 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.7479ms
2025-09-11 20:52:18.804 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:18.809 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.813 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.001ms
2025-09-11 20:52:18.820 +03:00 [INF] Executed DbCommand (91ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:18.829 +03:00 [INF] Executed DbCommand (97ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:18.835 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:18.841 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.844 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:18.849 +03:00 [INF] Executed DbCommand (87ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:18.854 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.865 +03:00 [INF] Executed DbCommand (101ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:18.869 +03:00 [INF] Executed DbCommand (103ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:18.875 +03:00 [INF] Executed DbCommand (106ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:18.876 +03:00 [INF] Executed DbCommand (100ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:18.881 +03:00 [INF] Executed DbCommand (98ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:18.885 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:18.891 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.903 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.903 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:52:18.910 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.915 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 24.2656ms
2025-09-11 20:52:18.920 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 17.7353ms
2025-09-11 20:52:18.926 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:18.930 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 19.9752ms
2025-09-11 20:52:18.936 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.945 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:18.949 +03:00 [INF] Getting order by number: ORD-20250911175141-5818
2025-09-11 20:52:18.956 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:18.961 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 25.3829ms
2025-09-11 20:52:18.967 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.968 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.978 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.986 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:18.992 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 25.0261ms
2025-09-11 20:52:18.997 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 28.7183ms
2025-09-11 20:52:19.003 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 24.0222ms
2025-09-11 20:52:19.009 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 23.4629ms
2025-09-11 20:52:19.016 +03:00 [INF] Executed DbCommand (92ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:52:19.025 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.030 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.043 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 20:52:19.048 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:52:19.087 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:19.061 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 30.2892ms
2025-09-11 20:52:19.080 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.056 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.2123ms
2025-09-11 20:52:19.101 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.120 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.130 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 49.7556ms
2025-09-11 20:52:19.151 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.177 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 75.8047ms
2025-09-11 20:52:19.200 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 79.9188ms
2025-09-11 20:52:19.219 +03:00 [INF] Executed DbCommand (120ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:19.229 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 78.3861ms
2025-09-11 20:52:19.243 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.265 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.270 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:52:19.282 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.286 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 42.9204ms
2025-09-11 20:52:19.297 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.2866ms
2025-09-11 20:52:19.300 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:52:19.304 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 22.4185ms
2025-09-11 20:52:19.319 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.329 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.331 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.337 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.346 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 26.9361ms
2025-09-11 20:52:19.350 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 21.0139ms
2025-09-11 20:52:19.357 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 26.3192ms
2025-09-11 20:52:19.363 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 25.3861ms
2025-09-11 20:52:19.368 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.377 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.377 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.377 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.382 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.392 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.397 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.4823ms
2025-09-11 20:52:19.408 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.8255ms
2025-09-11 20:52:19.415 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 38.0347ms
2025-09-11 20:52:19.420 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 43.1418ms
2025-09-11 20:52:19.427 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 44.779ms
2025-09-11 20:52:19.431 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 39.1001ms
2025-09-11 20:52:19.436 +03:00 [INF] Executed DbCommand (106ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:52:19.444 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.451 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.461 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.471 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.479 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.486 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:19.492 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 48.0426ms
2025-09-11 20:52:19.499 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 47.9973ms
2025-09-11 20:52:19.506 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 44.265ms
2025-09-11 20:52:19.512 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 41.3865ms
2025-09-11 20:52:19.518 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 38.3455ms
2025-09-11 20:52:19.520 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.526 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.533 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.541 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.549 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.556 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.563 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 43.0252ms
2025-09-11 20:52:19.568 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 42.1919ms
2025-09-11 20:52:19.574 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 40.3024ms
2025-09-11 20:52:19.582 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 41.4728ms
2025-09-11 20:52:19.589 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 40.2356ms
2025-09-11 20:52:19.596 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 39.913ms
2025-09-11 20:52:19.603 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:52:19.612 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.619 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.627 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.634 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.645 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.649 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:52:19.654 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 41.9934ms
2025-09-11 20:52:19.662 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 42.9831ms
2025-09-11 20:52:19.667 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 40.0584ms
2025-09-11 20:52:19.677 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 43.8464ms
2025-09-11 20:52:19.682 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 37.2647ms
2025-09-11 20:52:19.684 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:19.692 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.699 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.707 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.714 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.721 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.724 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:19.730 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 37.6371ms
2025-09-11 20:52:19.737 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 37.7816ms
2025-09-11 20:52:19.743 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 35.8277ms
2025-09-11 20:52:19.748 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.261ms
2025-09-11 20:52:19.753 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.932ms
2025-09-11 20:52:19.760 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.764 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.771 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.778 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.785 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.792 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.799 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 39.266ms
2025-09-11 20:52:19.805 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 41.5143ms
2025-09-11 20:52:19.812 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 40.8756ms
2025-09-11 20:52:19.817 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 39.7349ms
2025-09-11 20:52:19.823 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 37.9111ms
2025-09-11 20:52:19.830 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 37.738ms
2025-09-11 20:52:19.837 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.845 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.851 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.859 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.869 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.876 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.878 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 41.7085ms
2025-09-11 20:52:19.885 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 39.6015ms
2025-09-11 20:52:19.891 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 39.1507ms
2025-09-11 20:52:19.897 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 38.2432ms
2025-09-11 20:52:19.902 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 33.2589ms
2025-09-11 20:52:19.908 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.3135ms
2025-09-11 20:52:19.916 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.924 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.931 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.945 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 20:52:19.964 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 48.7372ms
2025-09-11 20:52:19.970 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 45.4ms
2025-09-11 20:52:19.977 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 45.9652ms
2025-09-11 20:52:19.983 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 37.9031ms
2025-09-11 20:52:20.614 +03:00 [INF] Received HTTP response headers after 858.0108ms - 201
2025-09-11 20:52:20.623 +03:00 [INF] End processing HTTP request after 938.6114ms - 201
2025-09-11 20:52:20.642 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:52:20.755 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:52:20.762 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:52:20.844 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:20.850 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:20.853 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:21.072 +03:00 [INF] Received HTTP response headers after 215.7486ms - 201
2025-09-11 20:52:21.077 +03:00 [INF] End processing HTTP request after 226.8409ms - 201
2025-09-11 20:52:21.089 +03:00 [INF] Successfully created PayMob order: 384514148 for local order: ORD-20250911175141-5818
2025-09-11 20:52:21.093 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:21.171 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:52:21.180 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:52:21.183 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384514148, Amount: 1012226
2025-09-11 20:52:21.187 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:21.191 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:21.417 +03:00 [INF] Received HTTP response headers after 222.6281ms - 201
2025-09-11 20:52:21.427 +03:00 [INF] End processing HTTP request after 239.2544ms - 201
2025-09-11 20:52:21.432 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:52:21.435 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:52:21.438 +03:00 [INF] Payment key generated successfully for Order ID: 384514148
2025-09-11 20:52:21.441 +03:00 [INF] Successfully generated payment key for order: ORD-20250911175141-5818
2025-09-11 20:52:21.445 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:21.519 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:52:21.527 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:52:21.536 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:52:21.540 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:52:21.543 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:52:21.545 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:52:21.699 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:52:21.856 +03:00 [INF] Payment created successfully with ID 60
2025-09-11 20:52:21.857 +03:00 [INF] Executed DbCommand (3,048ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:21.870 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:52:21.949 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:52:21.963 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:52:21.965 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:22.042 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:22.054 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:52:22.061 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:52:22.137 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:52:22.146 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:22.223 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:52:22.228 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:52:22.230 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:22.232 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:22.451 +03:00 [INF] Received HTTP response headers after 215.5533ms - 201
2025-09-11 20:52:22.456 +03:00 [INF] End processing HTTP request after 226.4148ms - 201
2025-09-11 20:52:22.461 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:52:22.547 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:52:22.562 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:52:22.647 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:22.654 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:22.661 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:22.734 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:22.742 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 4540.535ms
2025-09-11 20:52:22.745 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:22.749 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 200 1365 application/json; charset=utf-8 4990.0991ms
2025-09-11 20:52:22.874 +03:00 [INF] Received HTTP response headers after 207.6783ms - 201
2025-09-11 20:52:22.880 +03:00 [INF] End processing HTTP request after 225.5307ms - 201
2025-09-11 20:52:22.896 +03:00 [INF] Successfully created PayMob order: 384514166 for local order: ORD-20250911175141-5818
2025-09-11 20:52:22.901 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:22.978 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:52:22.986 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:52:22.989 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384514166, Amount: 1012226
2025-09-11 20:52:22.993 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:22.997 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:23.215 +03:00 [INF] Received HTTP response headers after 215.5856ms - 201
2025-09-11 20:52:23.220 +03:00 [INF] End processing HTTP request after 226.7456ms - 201
2025-09-11 20:52:23.226 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:52:23.229 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:52:23.232 +03:00 [INF] Payment key generated successfully for Order ID: 384514166
2025-09-11 20:52:23.234 +03:00 [INF] Successfully generated payment key for order: ORD-20250911175141-5818
2025-09-11 20:52:23.235 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:23.311 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:52:23.319 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:52:23.323 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:52:23.328 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:52:23.329 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:52:23.331 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:52:23.485 +03:00 [ERR] Failed executing DbCommand (78ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:52:23.686 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:52:23.701 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:52:23.814 +03:00 [INF] Executed DbCommand (4,974ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:23.825 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:52:23.902 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:52:23.913 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:52:23.915 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:23.989 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:23.997 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:52:24.000 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:52:24.075 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:52:24.084 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:24.159 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:52:24.169 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:52:24.171 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:24.174 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:24.395 +03:00 [INF] Received HTTP response headers after 217.2725ms - 201
2025-09-11 20:52:24.402 +03:00 [INF] End processing HTTP request after 231.2778ms - 201
2025-09-11 20:52:24.408 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:52:24.487 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:52:24.498 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:52:24.580 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:24.596 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:24.600 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:24.710 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:24.715 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 6510.5956ms
2025-09-11 20:52:24.718 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:24.720 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 6952.4102ms
2025-09-11 20:52:24.817 +03:00 [INF] Received HTTP response headers after 214.7577ms - 201
2025-09-11 20:52:24.826 +03:00 [INF] End processing HTTP request after 229.6779ms - 201
2025-09-11 20:52:24.829 +03:00 [INF] Successfully created PayMob order: 384514185 for local order: ORD-20250911175141-5818
2025-09-11 20:52:24.832 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:24.907 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:52:24.918 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:52:24.920 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384514185, Amount: 1012226
2025-09-11 20:52:24.925 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:24.927 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:25.147 +03:00 [INF] Received HTTP response headers after 216.9282ms - 201
2025-09-11 20:52:25.151 +03:00 [INF] End processing HTTP request after 225.9902ms - 201
2025-09-11 20:52:25.156 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:52:25.159 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:52:25.162 +03:00 [INF] Payment key generated successfully for Order ID: 384514185
2025-09-11 20:52:25.164 +03:00 [INF] Successfully generated payment key for order: ORD-20250911175141-5818
2025-09-11 20:52:25.166 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:25.241 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:52:25.251 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:52:25.254 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:52:25.256 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:52:25.258 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:52:25.260 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:52:25.412 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:52:25.568 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:52:25.588 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:52:25.679 +03:00 [INF] Executed DbCommand (6,825ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:25.693 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:52:25.769 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:52:25.777 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:52:25.779 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:25.855 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:25.864 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:52:25.866 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:52:25.941 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:52:25.965 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:26.046 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:52:26.058 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:52:26.060 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:26.063 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:26.284 +03:00 [INF] Received HTTP response headers after 217.4503ms - 201
2025-09-11 20:52:26.289 +03:00 [INF] End processing HTTP request after 229.3019ms - 201
2025-09-11 20:52:26.295 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:52:26.382 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:52:26.392 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:52:26.474 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:26.485 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:26.494 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:26.551 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:26.556 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 8344.5847ms
2025-09-11 20:52:26.560 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:26.562 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 8793.1577ms
2025-09-11 20:52:26.706 +03:00 [INF] Received HTTP response headers after 209.1068ms - 201
2025-09-11 20:52:26.717 +03:00 [INF] End processing HTTP request after 232.3422ms - 201
2025-09-11 20:52:26.730 +03:00 [INF] Successfully created PayMob order: 384514207 for local order: ORD-20250911175141-5818
2025-09-11 20:52:26.743 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:26.824 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:52:26.836 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:52:26.843 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384514207, Amount: 1012226
2025-09-11 20:52:26.847 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:26.850 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:27.070 +03:00 [INF] Received HTTP response headers after 216.222ms - 201
2025-09-11 20:52:27.076 +03:00 [INF] End processing HTTP request after 228.9721ms - 201
2025-09-11 20:52:27.079 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:52:27.081 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:52:27.082 +03:00 [INF] Payment key generated successfully for Order ID: 384514207
2025-09-11 20:52:27.085 +03:00 [INF] Successfully generated payment key for order: ORD-20250911175141-5818
2025-09-11 20:52:27.089 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:27.164 +03:00 [INF] Executed DbCommand (71ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:52:27.171 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:52:27.175 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:52:27.176 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:52:27.178 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:52:27.180 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:52:27.334 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:52:27.505 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:52:27.530 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:52:27.617 +03:00 [INF] Executed DbCommand (8,758ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:27.628 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:52:27.708 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:52:27.725 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:52:27.729 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:27.806 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:27.815 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:52:27.817 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:52:27.894 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:52:27.902 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:27.976 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:52:27.984 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:52:27.986 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:27.989 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:28.215 +03:00 [INF] Received HTTP response headers after 222.1899ms - 201
2025-09-11 20:52:28.223 +03:00 [INF] End processing HTTP request after 237.2215ms - 201
2025-09-11 20:52:28.232 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:52:28.316 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:52:28.330 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:52:28.413 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:28.425 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:28.429 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:28.485 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:28.495 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 10210.4639ms
2025-09-11 20:52:28.499 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:28.502 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 10541.6019ms
2025-09-11 20:52:28.666 +03:00 [INF] Received HTTP response headers after 234.8832ms - 201
2025-09-11 20:52:28.673 +03:00 [INF] End processing HTTP request after 248.0142ms - 201
2025-09-11 20:52:28.679 +03:00 [INF] Successfully created PayMob order: 384514228 for local order: ORD-20250911175141-5818
2025-09-11 20:52:28.682 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:28.757 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:52:28.765 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:52:28.769 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384514228, Amount: 1012226
2025-09-11 20:52:28.771 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:28.775 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:28.996 +03:00 [INF] Received HTTP response headers after 217.8765ms - 201
2025-09-11 20:52:29.007 +03:00 [INF] End processing HTTP request after 235.6639ms - 201
2025-09-11 20:52:29.013 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:52:29.018 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:52:29.020 +03:00 [INF] Payment key generated successfully for Order ID: 384514228
2025-09-11 20:52:29.023 +03:00 [INF] Successfully generated payment key for order: ORD-20250911175141-5818
2025-09-11 20:52:29.025 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:29.101 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:52:29.109 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:52:29.126 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:52:29.161 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:52:29.175 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:52:29.178 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:52:29.329 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:52:29.488 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:52:29.509 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:52:29.596 +03:00 [INF] Executed DbCommand (10,733ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:29.606 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:52:29.684 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:52:29.697 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:52:29.699 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:29.774 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:29.784 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:52:29.790 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:52:29.868 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:52:29.876 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:29.956 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:52:29.970 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:52:29.980 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:29.991 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:30.215 +03:00 [INF] Received HTTP response headers after 217.0581ms - 201
2025-09-11 20:52:30.222 +03:00 [INF] End processing HTTP request after 242.1655ms - 201
2025-09-11 20:52:30.228 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:52:30.305 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:52:30.317 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:52:30.401 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:30.410 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:30.419 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:30.473 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:30.482 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 12202.0812ms
2025-09-11 20:52:30.487 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:30.498 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 12541.0086ms
2025-09-11 20:52:30.632 +03:00 [INF] Received HTTP response headers after 208.6352ms - 201
2025-09-11 20:52:30.640 +03:00 [INF] End processing HTTP request after 229.251ms - 201
2025-09-11 20:52:30.645 +03:00 [INF] Successfully created PayMob order: 384514254 for local order: ORD-20250911175141-5818
2025-09-11 20:52:30.653 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:30.730 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:52:30.742 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:52:30.744 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384514254, Amount: 1012226
2025-09-11 20:52:30.747 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:30.749 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:30.969 +03:00 [INF] Received HTTP response headers after 218.1768ms - 201
2025-09-11 20:52:30.975 +03:00 [INF] End processing HTTP request after 228.0791ms - 201
2025-09-11 20:52:30.980 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:52:30.983 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:52:30.985 +03:00 [INF] Payment key generated successfully for Order ID: 384514254
2025-09-11 20:52:30.988 +03:00 [INF] Successfully generated payment key for order: ORD-20250911175141-5818
2025-09-11 20:52:30.990 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:31.067 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:52:31.081 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:52:31.084 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:52:31.086 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:52:31.088 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:52:31.091 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:52:31.244 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:52:31.401 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:52:31.427 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:52:31.525 +03:00 [INF] Executed DbCommand (12,656ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:31.535 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:52:31.612 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:52:31.621 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:52:31.628 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:31.705 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:31.713 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:52:31.716 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:52:31.791 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:52:31.799 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:31.875 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:52:31.885 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:52:31.887 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:31.896 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:32.136 +03:00 [INF] Received HTTP response headers after 232.0799ms - 201
2025-09-11 20:52:32.154 +03:00 [INF] End processing HTTP request after 267.1554ms - 201
2025-09-11 20:52:32.160 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:52:32.240 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:52:32.247 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:52:32.330 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:32.342 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:32.347 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:32.418 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:32.423 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 14208.5505ms
2025-09-11 20:52:32.427 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:32.431 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 14661.4927ms
2025-09-11 20:52:32.557 +03:00 [INF] Received HTTP response headers after 207.6357ms - 201
2025-09-11 20:52:32.562 +03:00 [INF] End processing HTTP request after 220.2011ms - 201
2025-09-11 20:52:32.568 +03:00 [INF] Successfully created PayMob order: 384514276 for local order: ORD-20250911175141-5818
2025-09-11 20:52:32.573 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:32.651 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:52:32.661 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:52:32.666 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384514276, Amount: 1012226
2025-09-11 20:52:32.670 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:32.673 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:32.890 +03:00 [INF] Received HTTP response headers after 213.7698ms - 201
2025-09-11 20:52:32.894 +03:00 [INF] End processing HTTP request after 224.7859ms - 201
2025-09-11 20:52:32.898 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:52:32.901 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:52:32.903 +03:00 [INF] Payment key generated successfully for Order ID: 384514276
2025-09-11 20:52:32.907 +03:00 [INF] Successfully generated payment key for order: ORD-20250911175141-5818
2025-09-11 20:52:32.909 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:32.985 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:52:32.996 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:52:32.999 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:52:33.001 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:52:33.003 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:52:33.005 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:52:33.162 +03:00 [ERR] Failed executing DbCommand (79ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:52:33.322 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:52:33.342 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:52:33.433 +03:00 [INF] Executed DbCommand (14,559ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:33.438 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:52:33.518 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:52:33.532 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:52:33.538 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:33.640 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:33.647 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:52:33.650 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:52:33.725 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:52:33.735 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:33.810 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:52:33.816 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:52:33.819 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:33.821 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:34.055 +03:00 [INF] Received HTTP response headers after 229.7573ms - 201
2025-09-11 20:52:34.065 +03:00 [INF] End processing HTTP request after 246.1618ms - 201
2025-09-11 20:52:34.071 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:52:34.151 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:52:34.162 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:52:34.244 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:34.253 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:34.256 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:34.320 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:34.332 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 16061.6055ms
2025-09-11 20:52:34.339 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:34.347 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 16578.2648ms
2025-09-11 20:52:34.475 +03:00 [INF] Received HTTP response headers after 215.6634ms - 201
2025-09-11 20:52:34.480 +03:00 [INF] End processing HTTP request after 226.7018ms - 201
2025-09-11 20:52:34.484 +03:00 [INF] Successfully created PayMob order: 384514295 for local order: ORD-20250911175141-5818
2025-09-11 20:52:34.489 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:34.565 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:52:34.573 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:52:34.578 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384514295, Amount: 1012226
2025-09-11 20:52:34.585 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:34.592 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:34.817 +03:00 [INF] Received HTTP response headers after 220.8816ms - 201
2025-09-11 20:52:34.833 +03:00 [INF] End processing HTTP request after 248.0931ms - 201
2025-09-11 20:52:34.836 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:52:34.838 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:52:34.840 +03:00 [INF] Payment key generated successfully for Order ID: 384514295
2025-09-11 20:52:34.852 +03:00 [INF] Successfully generated payment key for order: ORD-20250911175141-5818
2025-09-11 20:52:34.856 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:34.932 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:52:34.947 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:52:34.949 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:52:34.950 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:52:34.952 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:52:34.954 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:52:35.107 +03:00 [ERR] Failed executing DbCommand (76ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:52:35.261 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:52:35.284 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:52:35.374 +03:00 [INF] Executed DbCommand (16,493ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:35.386 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:52:35.464 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:52:35.473 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:52:35.477 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:35.554 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:35.562 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:52:35.565 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:52:35.640 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:52:35.653 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:35.729 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:52:35.745 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:52:35.749 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:35.751 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:35.981 +03:00 [INF] Received HTTP response headers after 228.0819ms - 201
2025-09-11 20:52:35.988 +03:00 [INF] End processing HTTP request after 238.5805ms - 201
2025-09-11 20:52:35.995 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:52:36.076 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:52:36.084 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:52:36.166 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:36.177 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:36.180 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:36.250 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:36.257 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 17837.4808ms
2025-09-11 20:52:36.264 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:36.269 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 18307.3356ms
2025-09-11 20:52:36.393 +03:00 [INF] Received HTTP response headers after 209.1098ms - 201
2025-09-11 20:52:36.399 +03:00 [INF] End processing HTTP request after 221.8689ms - 201
2025-09-11 20:52:36.413 +03:00 [INF] Successfully created PayMob order: 384514314 for local order: ORD-20250911175141-5818
2025-09-11 20:52:36.423 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:36.501 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:52:36.512 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:52:36.518 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384514314, Amount: 1012226
2025-09-11 20:52:36.527 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:36.530 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:36.750 +03:00 [INF] Received HTTP response headers after 216.9906ms - 201
2025-09-11 20:52:36.754 +03:00 [INF] End processing HTTP request after 226.2011ms - 201
2025-09-11 20:52:36.759 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:52:36.762 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:52:36.764 +03:00 [INF] Payment key generated successfully for Order ID: 384514314
2025-09-11 20:52:36.767 +03:00 [INF] Successfully generated payment key for order: ORD-20250911175141-5818
2025-09-11 20:52:36.769 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:36.844 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:52:36.851 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:52:36.852 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:52:36.854 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:52:36.855 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:52:36.860 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:52:37.013 +03:00 [ERR] Failed executing DbCommand (76ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:52:37.171 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:52:37.194 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:52:37.291 +03:00 [INF] Executed DbCommand (18,406ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:37.301 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:52:37.379 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:52:37.391 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:52:37.395 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:37.473 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:37.482 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:52:37.485 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:52:37.560 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:52:37.569 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:37.648 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:52:37.654 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:52:37.660 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:37.663 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:37.885 +03:00 [INF] Received HTTP response headers after 219.388ms - 201
2025-09-11 20:52:37.888 +03:00 [INF] End processing HTTP request after 228.6449ms - 201
2025-09-11 20:52:37.893 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:52:37.971 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:52:37.978 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:52:38.063 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:38.070 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:38.072 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:38.159 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:38.164 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 19728.178ms
2025-09-11 20:52:38.169 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:38.174 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 20172.9531ms
2025-09-11 20:52:38.281 +03:00 [INF] Received HTTP response headers after 205.7286ms - 201
2025-09-11 20:52:38.288 +03:00 [INF] End processing HTTP request after 218.4472ms - 201
2025-09-11 20:52:38.296 +03:00 [INF] Successfully created PayMob order: 384514338 for local order: ORD-20250911175141-5818
2025-09-11 20:52:38.300 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:38.376 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:52:38.385 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:52:38.393 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384514338, Amount: 1012226
2025-09-11 20:52:38.399 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:38.401 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:38.622 +03:00 [INF] Received HTTP response headers after 218.7023ms - 201
2025-09-11 20:52:38.630 +03:00 [INF] End processing HTTP request after 231.5576ms - 201
2025-09-11 20:52:38.637 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:52:38.642 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:52:38.646 +03:00 [INF] Payment key generated successfully for Order ID: 384514338
2025-09-11 20:52:38.648 +03:00 [INF] Successfully generated payment key for order: ORD-20250911175141-5818
2025-09-11 20:52:38.651 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:38.726 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:52:38.736 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:52:38.742 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:52:38.745 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:52:38.749 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:52:38.750 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:52:38.906 +03:00 [ERR] Failed executing DbCommand (80ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:52:39.063 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:52:39.087 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:52:39.175 +03:00 [INF] Executed DbCommand (20,285ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:39.190 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:52:39.268 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:52:39.286 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:52:39.300 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:39.376 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:39.381 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:52:39.383 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:52:39.459 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:52:39.468 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:39.543 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:52:39.554 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:52:39.558 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:39.562 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:39.786 +03:00 [INF] Received HTTP response headers after 221.8804ms - 201
2025-09-11 20:52:39.792 +03:00 [INF] End processing HTTP request after 234.1558ms - 201
2025-09-11 20:52:39.797 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:52:39.877 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:52:39.885 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:52:39.968 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:39.978 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:39.983 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:40.062 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:40.070 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 21776.1691ms
2025-09-11 20:52:40.076 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:40.079 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 22115.8883ms
2025-09-11 20:52:40.192 +03:00 [INF] Received HTTP response headers after 206.5579ms - 201
2025-09-11 20:52:40.198 +03:00 [INF] End processing HTTP request after 219.3641ms - 201
2025-09-11 20:52:40.203 +03:00 [INF] Successfully created PayMob order: 384514357 for local order: ORD-20250911175141-5818
2025-09-11 20:52:40.209 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:40.287 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:52:40.297 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:52:40.303 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384514357, Amount: 1012226
2025-09-11 20:52:40.308 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:40.313 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:40.532 +03:00 [INF] Received HTTP response headers after 215.5989ms - 201
2025-09-11 20:52:40.541 +03:00 [INF] End processing HTTP request after 233.2676ms - 201
2025-09-11 20:52:40.544 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:52:40.553 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:52:40.566 +03:00 [INF] Payment key generated successfully for Order ID: 384514357
2025-09-11 20:52:40.569 +03:00 [INF] Successfully generated payment key for order: ORD-20250911175141-5818
2025-09-11 20:52:40.571 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:40.649 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:52:40.687 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:52:40.693 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:52:40.695 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:52:40.698 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:52:40.700 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:52:40.877 +03:00 [ERR] Failed executing DbCommand (78ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:52:41.037 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:52:41.063 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:52:41.153 +03:00 [INF] Executed DbCommand (22,259ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:41.165 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:52:41.243 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:52:41.267 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:52:41.274 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:41.353 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:41.367 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:52:41.371 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:52:41.451 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:52:41.461 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:41.537 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:52:41.547 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:52:41.549 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:41.554 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:41.793 +03:00 [INF] Received HTTP response headers after 231.988ms - 201
2025-09-11 20:52:41.797 +03:00 [INF] End processing HTTP request after 247.795ms - 201
2025-09-11 20:52:41.804 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:52:41.883 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:52:41.895 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:52:41.980 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:41.993 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:42.001 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:42.040 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:42.043 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 23611.2066ms
2025-09-11 20:52:42.049 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:42.052 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 24085.5934ms
2025-09-11 20:52:42.216 +03:00 [INF] Received HTTP response headers after 207.9953ms - 201
2025-09-11 20:52:42.219 +03:00 [INF] End processing HTTP request after 225.5698ms - 201
2025-09-11 20:52:42.226 +03:00 [INF] Successfully created PayMob order: 384514377 for local order: ORD-20250911175141-5818
2025-09-11 20:52:42.228 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:42.303 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:52:42.310 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:52:42.312 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384514377, Amount: 1012226
2025-09-11 20:52:42.315 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:42.320 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:42.538 +03:00 [INF] Received HTTP response headers after 214.8884ms - 201
2025-09-11 20:52:42.545 +03:00 [INF] End processing HTTP request after 229.2002ms - 201
2025-09-11 20:52:42.552 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:52:42.557 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:52:42.561 +03:00 [INF] Payment key generated successfully for Order ID: 384514377
2025-09-11 20:52:42.566 +03:00 [INF] Successfully generated payment key for order: ORD-20250911175141-5818
2025-09-11 20:52:42.568 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:42.643 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:52:42.652 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:52:42.654 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:52:42.658 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:52:42.662 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:52:42.664 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:52:42.818 +03:00 [ERR] Failed executing DbCommand (78ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:52:42.972 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:52:42.986 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:52:43.074 +03:00 [INF] Executed DbCommand (24,165ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:43.080 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:52:43.157 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:52:43.163 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:52:43.165 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:43.241 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:43.247 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:52:43.249 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:52:43.325 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:52:43.330 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:43.407 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:52:43.425 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:52:43.432 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:43.446 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:43.685 +03:00 [INF] Received HTTP response headers after 221.5973ms - 201
2025-09-11 20:52:43.692 +03:00 [INF] End processing HTTP request after 259.8252ms - 201
2025-09-11 20:52:43.696 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:52:43.774 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:52:43.786 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:52:43.868 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:43.878 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:43.881 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:44.095 +03:00 [INF] Received HTTP response headers after 211.1281ms - 201
2025-09-11 20:52:44.101 +03:00 [INF] End processing HTTP request after 223.0574ms - 201
2025-09-11 20:52:44.105 +03:00 [INF] Successfully created PayMob order: 384514394 for local order: ORD-20250911175141-5818
2025-09-11 20:52:44.110 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:44.187 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:52:44.202 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:52:44.209 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384514394, Amount: 1012226
2025-09-11 20:52:44.217 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:44.225 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:44.277 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:44.286 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 25845.4006ms
2025-09-11 20:52:44.290 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:44.295 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 26292.4862ms
2025-09-11 20:52:44.453 +03:00 [INF] Received HTTP response headers after 219.4352ms - 201
2025-09-11 20:52:44.459 +03:00 [INF] End processing HTTP request after 242.144ms - 201
2025-09-11 20:52:44.464 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:52:44.466 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:52:44.468 +03:00 [INF] Payment key generated successfully for Order ID: 384514394
2025-09-11 20:52:44.470 +03:00 [INF] Successfully generated payment key for order: ORD-20250911175141-5818
2025-09-11 20:52:44.471 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:44.547 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:52:44.555 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:52:44.558 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:52:44.559 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:52:44.562 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:52:44.565 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:52:44.717 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:52:44.875 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:52:44.907 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:52:45.068 +03:00 [INF] Executed DbCommand (26,119ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:45.076 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:52:45.153 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:52:45.161 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:52:45.163 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:45.238 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:45.245 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:52:45.247 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:52:45.322 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:52:45.332 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:45.408 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:52:45.418 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:52:45.420 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:45.424 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:45.649 +03:00 [INF] Received HTTP response headers after 221.8283ms - 201
2025-09-11 20:52:45.655 +03:00 [INF] End processing HTTP request after 234.4741ms - 201
2025-09-11 20:52:45.663 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:52:45.741 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:52:45.752 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:52:45.837 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:45.848 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:45.851 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:45.949 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:45.957 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 27447.7136ms
2025-09-11 20:52:45.961 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:45.964 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 27960.3873ms
2025-09-11 20:52:46.067 +03:00 [INF] Received HTTP response headers after 212.176ms - 201
2025-09-11 20:52:46.071 +03:00 [INF] End processing HTTP request after 223.4089ms - 201
2025-09-11 20:52:46.078 +03:00 [INF] Successfully created PayMob order: 384514417 for local order: ORD-20250911175141-5818
2025-09-11 20:52:46.083 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:46.159 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:52:46.168 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:52:46.176 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384514417, Amount: 1012226
2025-09-11 20:52:46.180 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:46.183 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:46.401 +03:00 [INF] Received HTTP response headers after 214.8316ms - 201
2025-09-11 20:52:46.409 +03:00 [INF] End processing HTTP request after 228.2919ms - 201
2025-09-11 20:52:46.411 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:52:46.413 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:52:46.417 +03:00 [INF] Payment key generated successfully for Order ID: 384514417
2025-09-11 20:52:46.419 +03:00 [INF] Successfully generated payment key for order: ORD-20250911175141-5818
2025-09-11 20:52:46.428 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:46.505 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:52:46.511 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:52:46.520 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:52:46.524 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:52:46.525 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:52:46.527 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:52:46.678 +03:00 [ERR] Failed executing DbCommand (78ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:52:46.852 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:52:46.901 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:52:46.992 +03:00 [INF] Executed DbCommand (28,026ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:47.002 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:52:47.079 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:52:47.087 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:52:47.090 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:47.168 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:47.185 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:52:47.194 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:52:47.273 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:52:47.290 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:47.370 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:52:47.381 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:52:47.385 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:47.391 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:47.648 +03:00 [INF] Received HTTP response headers after 252.1619ms - 201
2025-09-11 20:52:47.654 +03:00 [INF] End processing HTTP request after 269.3839ms - 201
2025-09-11 20:52:47.662 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:52:47.740 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:52:47.747 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:52:47.829 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:47.863 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:47.876 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:47.878 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 29375.1283ms
2025-09-11 20:52:47.881 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:47.884 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:47.889 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 29883.5858ms
2025-09-11 20:52:48.093 +03:00 [INF] Received HTTP response headers after 206.1202ms - 201
2025-09-11 20:52:48.095 +03:00 [INF] End processing HTTP request after 219.6831ms - 201
2025-09-11 20:52:48.098 +03:00 [INF] Successfully created PayMob order: 384514439 for local order: ORD-20250911175141-5818
2025-09-11 20:52:48.103 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:48.179 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:52:48.189 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:52:48.193 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384514439, Amount: 1012226
2025-09-11 20:52:48.197 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:48.199 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:48.462 +03:00 [INF] Received HTTP response headers after 260.075ms - 201
2025-09-11 20:52:48.467 +03:00 [INF] End processing HTTP request after 269.9481ms - 201
2025-09-11 20:52:48.471 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:52:48.474 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:52:48.477 +03:00 [INF] Payment key generated successfully for Order ID: 384514439
2025-09-11 20:52:48.484 +03:00 [INF] Successfully generated payment key for order: ORD-20250911175141-5818
2025-09-11 20:52:48.488 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:48.565 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:52:48.577 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:52:48.581 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:52:48.584 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:52:48.587 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:52:48.590 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:52:48.743 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:52:48.896 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:52:48.918 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:52:49.005 +03:00 [INF] Executed DbCommand (30,027ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:49.015 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 20:52:49.092 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 20:52:49.104 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 20:52:49.108 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:49.184 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:49.193 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 20:52:49.198 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 20:52:49.277 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:52:49.282 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:49.358 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:52:49.364 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:52:49.365 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:49.367 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:52:49.589 +03:00 [INF] Received HTTP response headers after 218.462ms - 201
2025-09-11 20:52:49.595 +03:00 [INF] End processing HTTP request after 229.4008ms - 201
2025-09-11 20:52:49.598 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:52:49.675 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 20:52:49.684 +03:00 [INF] Getting address by ID: 31
2025-09-11 20:52:49.701 +03:00 [ERR] Failed executing DbCommand (30,622ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:52:49.711 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> MySqlConnector.MySqlException (0x80004005): Query execution was interrupted
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 124
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 20:52:49.768 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 20:52:49.779 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:49.783 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 20:52:49.878 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:49.886 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 31370.3018ms
2025-09-11 20:52:49.890 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:49.894 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 31883.4138ms
2025-09-11 20:52:49.994 +03:00 [INF] Received HTTP response headers after 208.4935ms - 201
2025-09-11 20:52:50.000 +03:00 [INF] End processing HTTP request after 221.4758ms - 201
2025-09-11 20:52:50.007 +03:00 [INF] Successfully created PayMob order: 384514461 for local order: ORD-20250911175141-5818
2025-09-11 20:52:50.012 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 20:52:50.089 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 20:52:50.099 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 20:52:50.104 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384514461, Amount: 1012226
2025-09-11 20:52:50.107 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:50.110 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 20:52:50.332 +03:00 [INF] Received HTTP response headers after 219.2077ms - 201
2025-09-11 20:52:50.337 +03:00 [INF] End processing HTTP request after 229.7953ms - 201
2025-09-11 20:52:50.345 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 20:52:50.349 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 20:52:50.351 +03:00 [INF] Payment key generated successfully for Order ID: 384514461
2025-09-11 20:52:50.354 +03:00 [INF] Successfully generated payment key for order: ORD-20250911175141-5818
2025-09-11 20:52:50.356 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:52:50.433 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 20:52:50.444 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 20:52:50.447 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 20:52:50.449 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 20:52:50.450 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 20:52:50.452 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 20:52:50.605 +03:00 [ERR] Failed executing DbCommand (78ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 20:52:50.677 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:50.684 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 32050.9606ms
2025-09-11 20:52:50.690 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:50.693 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 32649.2668ms
2025-09-11 20:52:50.794 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 20:52:50.811 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '130-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 20:52:51.775 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 20:52:51.784 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 33271.3518ms
2025-09-11 20:52:51.794 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 20:52:51.799 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 33756.8964ms
2025-09-11 20:53:17.729 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:53:17.761 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:53:19.171 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1441.514ms
2025-09-11 20:53:21.280 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:53:21.287 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:53:22.694 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1414.3353ms
2025-09-11 20:53:25.289 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:53:25.299 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:53:26.714 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1425.7937ms
2025-09-11 20:59:02.649 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:02.731 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:04.147 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1499.0016ms
2025-09-11 20:59:04.621 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - null null
2025-09-11 20:59:06.162 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:06.178 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:06.996 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - 200 null text/html 2375.1799ms
2025-09-11 20:59:07.086 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-11 20:59:07.088 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-11 20:59:07.116 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 29.3739ms
2025-09-11 20:59:07.156 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 68.9191ms
2025-09-11 20:59:07.580 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1418.3876ms
2025-09-11 20:59:09.303 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:09.372 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:10.080 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/jobs/scheduled/enqueue - application/x-www-form-urlencoded; charset=UTF-8 31
2025-09-11 20:59:10.092 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:10.798 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1494.6626ms
2025-09-11 20:59:12.316 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/jobs/scheduled/enqueue - 204 null null 2236.7819ms
2025-09-11 20:59:12.348 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - null null
2025-09-11 20:59:12.822 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:12.845 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:13.214 +03:00 [INF] Starting CheckAndUpdatePaymentStatusAsync for payment 60
2025-09-11 20:59:13.440 +03:00 [INF] Executing GetByIdAsync for entity Payment with ID: 60
2025-09-11 20:59:13.529 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:59:13.625 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Payments WHERE Id = @p0 FOR UPDATE
2025-09-11 20:59:13.635 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 20:59:13.712 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 20:59:13.732 +03:00 [INF] Executing GetTokenAsync
2025-09-11 20:59:13.749 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:59:13.755 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 20:59:14.248 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1426.7291ms
2025-09-11 20:59:14.274 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 130
2025-09-11 20:59:14.353 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:59:14.438 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:59:14.471 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - 200 null text/html 2123.5097ms
2025-09-11 20:59:14.497 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-11 20:59:14.505 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-11 20:59:14.532 +03:00 [INF] Received HTTP response headers after 774.2271ms - 201
2025-09-11 20:59:14.549 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 52.1022ms
2025-09-11 20:59:14.558 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 52.9257ms
2025-09-11 20:59:14.561 +03:00 [INF] End processing HTTP request after 818.8389ms - 201
2025-09-11 20:59:14.605 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:59:14.614 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 20:59:14.626 +03:00 [INF] Start processing HTTP request GET https://accept.paymob.com/api/ecommerce/orders/384514148
2025-09-11 20:59:14.631 +03:00 [INF] Sending HTTP request GET https://accept.paymob.com/api/ecommerce/orders/384514148
2025-09-11 20:59:14.843 +03:00 [INF] Received HTTP response headers after 206.3496ms - 200
2025-09-11 20:59:14.849 +03:00 [INF] End processing HTTP request after 222.7926ms - 200
2025-09-11 20:59:15.885 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p3='?' (Size = 8) (DbType = Binary), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Payments` SET `ModifiedAt` = @p0, `Status` = @p1
WHERE `Id` = @p2 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = @p2;
2025-09-11 20:59:16.579 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:16.628 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:16.958 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 130
2025-09-11 20:59:17.110 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:59:17.266 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:59:17.276 +03:00 [INF] Execute GetAll for entity OrderItem
2025-09-11 20:59:17.426 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-09-11 20:59:17.433 +03:00 [INF] Execute UpdateOrderAfterPaid_id:130_to status:"PaymentExpired"
2025-09-11 20:59:17.438 +03:00 [INF] Adding quantity for variant: 4
2025-09-11 20:59:17.667 +03:00 [INF] Execute GetAll for entity Order
2025-09-11 20:59:17.912 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CancelledAt`, `t`.`CreatedAt`, `t`.`CustomerAddressId`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`DeliveredAt`, `t`.`DiscountAmount`, `t`.`ModifiedAt`, `t`.`Notes`, `t`.`OrderNumber`, `t`.`RestockedAt`, `t`.`RowVersion`, `t`.`ShippedAt`, `t`.`ShippingCost`, `t`.`Status`, `t`.`Subtotal`, `t`.`TaxAmount`, `t`.`Total`, `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`DeletedAt`, `o0`.`ModifiedAt`, `o0`.`OrderId`, `o0`.`OrderedAt`, `o0`.`ProductId`, `o0`.`ProductVariantId`, `o0`.`Quantity`, `o0`.`TotalPrice`, `o0`.`UnitPrice`
FROM (
    SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
    FROM `Orders` AS `o`
    WHERE `o`.`Id` = @__orderId_0
    LIMIT 1
) AS `t`
LEFT JOIN `OrderItem` AS `o0` ON `t`.`Id` = `o0`.`OrderId`
ORDER BY `t`.`Id`
2025-09-11 20:59:18.034 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 20:59:18.050 +03:00 [WRN] Invalid status transition from "PaymentExpired" to "PaymentExpired"
2025-09-11 20:59:18.200 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-11 20:59:18.207 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 4
2025-09-11 20:59:18.225 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 20:59:18.251 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 20:59:18.251 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1672.7768ms
2025-09-11 20:59:18.283 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 20:59:18.439 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 20:59:18.466 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 20:59:19.094 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:59:19.220 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:59:19.253 +03:00 [INF] Quantity for variant 4 increased by 3
2025-09-11 20:59:19.520 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:59:19.548 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:59:19.646 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:59:19.969 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:59:19.999 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:59:20.267 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:20.277 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:20.372 +03:00 [INF] Order 130 auto-expired and restock scheduled
2025-09-11 20:59:20.392 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:59:20.402 +03:00 [INF] Payment 60 updated to "Failed"
2025-09-11 20:59:20.423 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:59:21.029 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:59:21.467 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:59:21.651 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1383.4763ms
2025-09-11 20:59:21.686 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:59:21.801 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:59:22.048 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:59:22.109 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:59:22.157 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-11 20:59:22.225 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:59:22.465 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 20:59:22.472 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:59:22.751 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 20:59:22.835 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 20:59:22.965 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 20:59:23.259 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 20:59:23.671 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:23.683 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:23.959 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:59:24.381 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:59:24.432 +03:00 [INF] Restocked inventory for order 130
2025-09-11 20:59:24.947 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1275.9516ms
2025-09-11 20:59:24.965 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-11 20:59:25.009 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 20:59:25.182 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-11 20:59:25.438 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 20:59:25.608 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-11 20:59:25.814 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 20:59:25.823 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-11 20:59:26.238 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 20:59:26.968 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:26.977 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:27.284 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 20:59:27.714 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 20:59:28.409 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1441.5685ms
2025-09-11 20:59:30.423 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:30.433 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:31.755 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1331.5491ms
2025-09-11 20:59:33.766 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:33.778 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:35.212 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1446.5841ms
2025-09-11 20:59:37.235 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:37.249 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:38.652 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1417.2746ms
2025-09-11 20:59:40.667 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:40.676 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:42.077 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1410.3609ms
2025-09-11 20:59:44.091 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:44.112 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:45.501 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1409.8103ms
2025-09-11 20:59:47.523 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:47.540 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:48.941 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1417.3932ms
2025-09-11 20:59:50.950 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:50.957 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:52.411 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1461.2564ms
2025-09-11 20:59:54.433 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:54.451 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:55.863 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1429.5892ms
2025-09-11 20:59:57.877 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 20:59:57.883 +03:00 [INF] CORS policy execution successful.
2025-09-11 20:59:59.298 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1421.3578ms
2025-09-11 21:00:01.319 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:01.339 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:02.752 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1433.0788ms
2025-09-11 21:00:04.767 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:04.779 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:06.182 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1414.8523ms
2025-09-11 21:00:08.198 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:08.207 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:09.593 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1394.9499ms
2025-09-11 21:00:11.606 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:11.617 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:13.026 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1420.1742ms
2025-09-11 21:00:15.042 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:15.053 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:17.445 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 2402.2775ms
2025-09-11 21:00:19.463 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:19.481 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:20.937 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1474.1309ms
2025-09-11 21:00:22.959 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:22.991 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:24.378 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1418.8515ms
2025-09-11 21:00:26.401 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:26.411 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:27.811 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1409.4032ms
2025-09-11 21:00:29.823 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:29.851 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:31.247 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1424.2567ms
2025-09-11 21:00:33.266 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:33.284 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:34.671 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1404.1169ms
2025-09-11 21:00:36.681 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:36.693 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:38.080 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1399.0454ms
2025-09-11 21:00:40.096 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:40.116 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:41.504 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1408.1324ms
2025-09-11 21:00:43.518 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:43.547 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:44.938 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1419.9449ms
2025-09-11 21:00:46.964 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:46.986 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:48.374 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1410.1214ms
2025-09-11 21:00:50.398 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:50.409 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:51.795 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1397.0123ms
2025-09-11 21:00:53.800 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:53.810 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:55.205 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1404.6758ms
2025-09-11 21:00:57.221 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:00:57.229 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:00:58.608 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1386.9557ms
2025-09-11 21:01:00.621 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:00.633 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:02.021 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1399.988ms
2025-09-11 21:01:04.038 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:04.054 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:05.466 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1428.1405ms
2025-09-11 21:01:07.478 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:07.489 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:08.878 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1400.0763ms
2025-09-11 21:01:10.890 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:10.905 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:12.321 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1430.8926ms
2025-09-11 21:01:14.343 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:14.356 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:15.746 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1403.2418ms
2025-09-11 21:01:17.763 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:17.777 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:19.165 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1401.8227ms
2025-09-11 21:01:21.178 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:21.193 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:22.592 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1414.1851ms
2025-09-11 21:01:24.632 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:24.870 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:26.404 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1772.3975ms
2025-09-11 21:01:28.274 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 62
2025-09-11 21:01:28.300 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:01:28.432 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:28.460 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:01:28.461 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:28.467 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-11 21:01:28.471 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-11 21:01:28.485 +03:00 [INF] Executing AddItemToCart for product ID: 6
2025-09-11 21:01:28.487 +03:00 [INF] Adding item to cart for user: e682f183-1c61-400b-aa5a-171750f446b5, product: 6
2025-09-11 21:01:28.812 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:01:28.825 +03:00 [INF] Execute GetAll for entity Product
2025-09-11 21:01:28.925 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-09-11 21:01:28.934 +03:00 [INF] Retrieving cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:01:29.023 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-11 21:01:29.103 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Cart WHERE Id = @p0 FOR UPDATE
2025-09-11 21:01:29.114 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-09-11 21:01:29.117 +03:00 [INF] CartItem added successfully (pending save)
2025-09-11 21:01:29.119 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:01:29.121 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:01:29.129 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:01:29.845 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1413.1104ms
2025-09-11 21:01:30.169 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (DbType = Int32), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`, `RowVersion`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:01:30.345 +03:00 [INF] Removing cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:01:30.771 +03:00 [INF] Cache removed successfully for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:01:30.773 +03:00 [INF] Item added to cart for user: e682f183-1c61-400b-aa5a-171750f446b5, product: 6
2025-09-11 21:01:30.785 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-11 21:01:30.790 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 2312.2337ms
2025-09-11 21:01:30.793 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-11 21:01:30.798 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 2523.8361ms
2025-09-11 21:01:31.340 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 3
2025-09-11 21:01:31.513 +03:00 [INF] Executed DbCommand (95ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:01:31.858 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:32.007 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:33.404 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1546.5681ms
2025-09-11 21:01:34.276 +03:00 [INF] Removing cache by tag: cart
2025-09-11 21:01:34.489 +03:00 [WRN] No cache entries found for tag: cart
2025-09-11 21:01:35.413 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:35.419 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:35.903 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - null 0
2025-09-11 21:01:35.915 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:01:36.065 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:01:36.083 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-11 21:01:36.096 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-11 21:01:36.113 +03:00 [INF] Executing CheckOut
2025-09-11 21:01:36.118 +03:00 [INF] Checkout of cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:01:36.125 +03:00 [INF] Retrieving cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:01:36.283 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-11 21:01:36.581 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-11 21:01:36.670 +03:00 [INF] Removing cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:01:36.676 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-11 21:01:36.680 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1266.3739ms
2025-09-11 21:01:36.693 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 581.0314ms
2025-09-11 21:01:36.736 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-11 21:01:36.742 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - 200 122 application/json; charset=utf-8 839.0866ms
2025-09-11 21:01:37.107 +03:00 [INF] Cache removed successfully for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:01:38.690 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:38.696 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:40.094 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1403.5503ms
2025-09-11 21:01:41.614 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json 42
2025-09-11 21:01:41.929 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:01:42.083 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:01:42.093 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-11 21:01:42.095 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-11 21:01:42.100 +03:00 [INF] Executing CreateOrder
2025-09-11 21:01:42.101 +03:00 [INF] Creating order from cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:01:42.119 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:42.127 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:42.401 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:01:42.484 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-11 21:01:42.497 +03:00 [INF] Checking if address 31 exists for customer: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:01:42.575 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-09-11 21:01:42.584 +03:00 [INF] Getting cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:01:42.586 +03:00 [INF] Getting cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:01:42.804 +03:00 [WRN] Cache miss for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:01:42.884 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-11 21:01:42.895 +03:00 [INF] Execute GetAll for entity Cart
2025-09-11 21:01:42.998 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-09-11 21:01:43.508 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1389.7097ms
2025-09-11 21:01:44.791 +03:00 [INF] Setting cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:01:45.031 +03:00 [INF] Cache set successfully for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5 with tags: [cart]
2025-09-11 21:01:45.040 +03:00 [INF] Execute GetAll for entity ProductVariant
2025-09-11 21:01:45.132 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE `p`.`Id` = 4
2025-09-11 21:01:45.223 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-09-11 21:01:45.233 +03:00 [INF] Executing CreateAsync for entity Order
2025-09-11 21:01:45.236 +03:00 [INF] Order added successfully (pending save)
2025-09-11 21:01:45.390 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = Decimal), @p13='?' (DbType = Int32), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal), @p16='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `RestockedAt`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`, `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:01:45.483 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-09-11 21:01:45.487 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-09-11 21:01:45.493 +03:00 [INF] Removing 3 from variant: 4
2025-09-11 21:01:45.518 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:45.529 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:45.570 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity - @p0 WHERE Id = @p1 AND Quantity >= @p0
2025-09-11 21:01:45.580 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 4
2025-09-11 21:01:45.658 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:01:46.039 +03:00 [INF] Execute GetAll for entity CartItem
2025-09-11 21:01:46.194 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__cartItemId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE (`c`.`Id` = @__cartItemId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:01:46.220 +03:00 [INF] CartItem 86 price updated to 3374.08790000
2025-09-11 21:01:46.531 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
UPDATE `CartItems` SET `UnitPrice` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 21:01:46.540 +03:00 [INF] Clearing cart: 3
2025-09-11 21:01:46.622 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-09-11 21:01:46.630 +03:00 [INF] Cart 3 cleared successfully
2025-09-11 21:01:46.785 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 8) (DbType = Binary), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = Decimal), @p11='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0 AND `RowVersion` IS NULL;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:01:46.925 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1407.3426ms
2025-09-11 21:01:46.943 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:01:46.947 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:01:46.950 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:01:46.952 +03:00 [INF] Execute GetAll for entity Order
2025-09-11 21:01:47.126 +03:00 [INF] Executed DbCommand (89ms) [Parameters=[@__createdOrder_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`DeletedAt`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`Id0`, `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`, `p0`.`Status`, `p0`.`Amount`, `p0`.`CreatedAt`, `p0`.`Id`, `p0`.`PaymentDate`, `p0`.`PaymentMethodId`, `p0`.`PaymentProviderId`, `t0`.`c`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`DeletedAt`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    WHERE `o`.`Id` = @__createdOrder_Id_0
    LIMIT 1
) AS `t0`
LEFT JOIN `Payments` AS `p` ON `t0`.`Id` = `p`.`OrderId`
LEFT JOIN `Payments` AS `p0` ON `t0`.`Id` = `p0`.`OrderId`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p1`.`Id` AS `Id0`, `p1`.`Name`, `p1`.`Price`, `p1`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p1`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p1`.`Price`))
        ELSE `p1`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p1`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p2`.`Color`, COALESCE(`p2`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p2`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p2`.`Size`, `p2`.`DeletedAt`, COALESCE(`p2`.`Length`, 0) AS `Length`, COALESCE(`p2`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p2`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p1` ON `o0`.`ProductId` = `p1`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p1`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p2` ON `o0`.`ProductVariantId` = `p2`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `p`.`Id`, `p0`.`Id`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-09-11 21:01:47.508 +03:00 [INF] Retrieving cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:01:47.661 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-11 21:01:47.826 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-11 21:01:47.834 +03:00 [INF] Checkout date removed for cart of user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:01:48.008 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-11 21:01:48.307 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 21:01:48.940 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:48.965 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:49.696 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 21:01:49.918 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 21:01:50.195 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1255.3383ms
2025-09-11 21:01:50.409 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 21:01:50.690 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-11 21:01:50.882 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 21:01:50.932 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-11 21:01:51.610 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 21:01:52.038 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 21:01:52.088 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-11 21:01:52.206 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:52.308 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-11 21:01:52.317 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:52.325 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 21:01:52.359 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 21:01:52.456 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:01:52.479 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 10381.2736ms
2025-09-11 21:01:52.483 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-11 21:01:52.502 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 201 1431 application/json; charset=utf-8 10887.8333ms
2025-09-11 21:01:52.757 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 21:01:52.782 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 21:01:52.876 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 21:01:53.372 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 21:01:53.705 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1498.7159ms
2025-09-11 21:01:55.717 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:55.725 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:01:56.974 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1256.0125ms
2025-09-11 21:01:58.985 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:01:58.998 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:02:00.404 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1419.4728ms
2025-09-11 21:02:02.428 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:02:02.439 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:02:03.837 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1408.8914ms
2025-09-11 21:02:06.295 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:02:06.319 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:02:07.700 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1404.8999ms
2025-09-11 21:02:10.293 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:02:10.306 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:02:11.691 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1398.0704ms
2025-09-11 21:02:40.181 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.186 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.210 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.211 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.264 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.309 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.347 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.396 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.399 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.401 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.403 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.405 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.409 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.414 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.420 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.426 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.429 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.430 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.431 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.435 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.436 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.440 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.446 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.452 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.469 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.478 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.486 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.483 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.485 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.482 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.487 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.493 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.499 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.504 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.515 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.521 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.529 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.529 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.532 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.533 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.535 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.543 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.551 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:02:40.560 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 27.8309ms
2025-09-11 21:02:40.566 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.4061ms
2025-09-11 21:02:40.571 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 36.6762ms
2025-09-11 21:02:40.576 +03:00 [INF] Executed DbCommand (95ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.578 +03:00 [INF] Executed DbCommand (96ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.583 +03:00 [INF] Executed DbCommand (101ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.595 +03:00 [INF] Executed DbCommand (113ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.600 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.603 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.612 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.617 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.622 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.631 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.487ms
2025-09-11 21:02:40.633 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.636 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.639 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.644 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.654 +03:00 [INF] Executed DbCommand (126ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.660 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.663 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.667 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.678 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.679 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.680 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.681 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.683 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.685 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.688 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.695 +03:00 [INF] Executed DbCommand (168ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.696 +03:00 [INF] Executed DbCommand (168ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.700 +03:00 [INF] Executed DbCommand (172ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.704 +03:00 [INF] Executed DbCommand (127ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.714 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.717 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.721 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.727 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.731 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.733 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.735 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.737 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.740 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.742 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.746 +03:00 [INF] Executed DbCommand (153ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.751 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.754 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.766 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.776 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.777 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.777 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.780 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.781 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.783 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.785 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.787 +03:00 [INF] Executed DbCommand (194ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.790 +03:00 [INF] Executed DbCommand (196ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.795 +03:00 [INF] Executed DbCommand (195ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.799 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.800 +03:00 [INF] Executed DbCommand (147ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.804 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.812 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.815 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.817 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.821 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.827 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.829 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.831 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.836 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.845 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.849 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.852 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.858 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.860 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.861 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.862 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.864 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.867 +03:00 [INF] Executed DbCommand (168ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.871 +03:00 [INF] Executed DbCommand (167ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.871 +03:00 [INF] Executed DbCommand (167ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.878 +03:00 [INF] Executed DbCommand (175ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.881 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.885 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.888 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.897 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.899 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.901 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.904 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.910 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.917 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.918 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.927 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.930 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:40.930 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.931 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.933 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.934 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:40.937 +03:00 [INF] Executed DbCommand (233ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.943 +03:00 [INF] Executed DbCommand (239ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:02:40.948 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.949 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.952 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.958 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:40.963 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 14.9712ms
2025-09-11 21:02:40.968 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 19.8645ms
2025-09-11 21:02:40.971 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.976 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:02:40.984 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.992 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:40.996 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:41.000 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180145-3539
2025-09-11 21:02:41.005 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 21.2378ms
2025-09-11 21:02:41.012 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 20.2169ms
2025-09-11 21:02:41.014 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:41.016 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180145-3539 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:02:41.030 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.036 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.039 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.043 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.045 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.047 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.049 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.051 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.075 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 24.2849ms
2025-09-11 21:02:41.062 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 15.5122ms
2025-09-11 21:02:41.067 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 18.1413ms
2025-09-11 21:02:41.055 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 9.5819ms
2025-09-11 21:02:41.084 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.084 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.093 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.101 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.112 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.116 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.3538ms
2025-09-11 21:02:41.122 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 37.9514ms
2025-09-11 21:02:41.130 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 36.748ms
2025-09-11 21:02:41.136 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 35.2981ms
2025-09-11 21:02:41.138 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.148 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.155 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.164 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.172 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.177 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.178 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.181 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.182 +03:00 [INF] Executed DbCommand (138ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.184 +03:00 [INF] Executed DbCommand (138ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.186 +03:00 [INF] Executed DbCommand (138ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.188 +03:00 [INF] Executed DbCommand (138ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.192 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.197 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.202 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.209 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.214 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.218 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.219 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.221 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.226 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.233 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.238 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 19.6628ms
2025-09-11 21:02:41.246 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 27.6406ms
2025-09-11 21:02:41.252 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 30.8709ms
2025-09-11 21:02:41.261 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 35.3446ms
2025-09-11 21:02:41.266 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 33.3371ms
2025-09-11 21:02:41.279 +03:00 [INF] Executed DbCommand (101ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.365 +03:00 [INF] Executed DbCommand (181ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.294 +03:00 [INF] Executed DbCommand (115ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.328 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.340 +03:00 [INF] Executed DbCommand (158ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.286 +03:00 [INF] Executed DbCommand (110ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.371 +03:00 [INF] Executed DbCommand (185ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.386 +03:00 [INF] Executed DbCommand (198ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.388 +03:00 [INF] Executed DbCommand (196ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.398 +03:00 [INF] Executed DbCommand (202ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:02:41.403 +03:00 [INF] Executed DbCommand (187ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.409 +03:00 [INF] Executed DbCommand (191ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.416 +03:00 [INF] Executed DbCommand (196ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.421 +03:00 [INF] Executed DbCommand (199ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.426 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 21:02:41.432 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.437 +03:00 [INF] Getting order by number: ORD-20250911180145-3539
2025-09-11 21:02:41.442 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.447 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.448 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.450 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.451 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.458 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 15.728ms
2025-09-11 21:02:41.463 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 16.1314ms
2025-09-11 21:02:41.468 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 20.0743ms
2025-09-11 21:02:41.477 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 27.7879ms
2025-09-11 21:02:41.483 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.7458ms
2025-09-11 21:02:41.499 +03:00 [INF] Executed DbCommand (112ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.504 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.513 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.550 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 37.3287ms
2025-09-11 21:02:41.533 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.537 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.8255ms
2025-09-11 21:02:41.529 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 21:02:41.560 +03:00 [INF] Executed DbCommand (109ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:02:41.565 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.577 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.585 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:02:41.599 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.626 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 60.6106ms
2025-09-11 21:02:41.637 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 60.7348ms
2025-09-11 21:02:41.646 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:02:41.654 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 55.0521ms
2025-09-11 21:02:41.665 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.679 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.683 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.754 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 71.0743ms
2025-09-11 21:02:41.712 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 46.5975ms
2025-09-11 21:02:41.729 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 50.598ms
2025-09-11 21:02:41.689 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.781 +03:00 [INF] Executed DbCommand (99ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:02:41.798 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.814 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.830 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 140.9862ms
2025-09-11 21:02:41.834 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:02:41.843 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 45.0816ms
2025-09-11 21:02:41.848 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 33.7067ms
2025-09-11 21:02:41.853 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.858 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:02:41.866 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.877 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.882 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 28.7173ms
2025-09-11 21:02:41.884 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.889 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 22.9024ms
2025-09-11 21:02:41.894 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 17.5071ms
2025-09-11 21:02:41.900 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.908 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 23.5146ms
2025-09-11 21:02:41.915 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.922 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.928 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 27.5565ms
2025-09-11 21:02:41.935 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.941 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 26.8905ms
2025-09-11 21:02:41.947 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 25.3651ms
2025-09-11 21:02:41.954 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.964 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 28.284ms
2025-09-11 21:02:41.972 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:02:41.979 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.985 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 30.7715ms
2025-09-11 21:02:41.993 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:41.999 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:02:42.004 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 24.4651ms
2025-09-11 21:02:42.011 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.016 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 23.3407ms
2025-09-11 21:02:42.018 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.036 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.045 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.2987ms
2025-09-11 21:02:42.065 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.065 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.070 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 51.8405ms
2025-09-11 21:02:42.076 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 39.365ms
2025-09-11 21:02:42.083 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.088 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 23.7002ms
2025-09-11 21:02:42.096 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.06ms
2025-09-11 21:02:42.102 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:02:42.111 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.116 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 33.3792ms
2025-09-11 21:02:42.125 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.133 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.137 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:02:42.145 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 33.9019ms
2025-09-11 21:02:42.152 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.159 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 33.5008ms
2025-09-11 21:02:42.165 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.5397ms
2025-09-11 21:02:42.167 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:02:42.176 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.181 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.599ms
2025-09-11 21:02:42.191 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.200 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.203 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:02:42.209 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 33.765ms
2025-09-11 21:02:42.216 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.222 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 30.796ms
2025-09-11 21:02:42.229 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.0174ms
2025-09-11 21:02:42.238 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.244 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.246 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.4944ms
2025-09-11 21:02:42.253 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.262 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.265 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 27.1792ms
2025-09-11 21:02:42.271 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 27.3988ms
2025-09-11 21:02:42.280 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.293 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 39.4924ms
2025-09-11 21:02:42.299 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 37.434ms
2025-09-11 21:02:42.337 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.316 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.321 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 40.5162ms
2025-09-11 21:02:42.330 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.308 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.344 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 7.528ms
2025-09-11 21:02:42.349 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 33.4351ms
2025-09-11 21:02:42.356 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.365 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.709ms
2025-09-11 21:02:42.370 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 62.223ms
2025-09-11 21:02:42.379 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.385 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.393 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 36.6385ms
2025-09-11 21:02:42.399 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.407 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.412 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 33.353ms
2025-09-11 21:02:42.418 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.3731ms
2025-09-11 21:02:42.426 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.431 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.744ms
2025-09-11 21:02:42.437 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.6667ms
2025-09-11 21:02:42.445 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.453 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.461 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.6279ms
2025-09-11 21:02:42.468 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:02:42.482 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 36.1748ms
2025-09-11 21:02:42.486 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.7606ms
2025-09-11 21:02:42.501 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.6836ms
2025-09-11 21:02:43.002 +03:00 [INF] Received HTTP response headers after 771.1672ms - 201
2025-09-11 21:02:43.012 +03:00 [INF] End processing HTTP request after 845.1888ms - 201
2025-09-11 21:02:43.032 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:02:43.111 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:02:43.122 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:02:43.207 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:02:43.217 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:02:43.236 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:02:43.472 +03:00 [INF] Received HTTP response headers after 227.25ms - 201
2025-09-11 21:02:43.529 +03:00 [INF] End processing HTTP request after 311.5904ms - 201
2025-09-11 21:02:43.536 +03:00 [INF] Successfully created PayMob order: 384520623 for local order: ORD-20250911180145-3539
2025-09-11 21:02:43.540 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:02:43.616 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:02:43.621 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:02:43.624 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384520623, Amount: 1012226
2025-09-11 21:02:43.627 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:02:43.629 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:02:43.850 +03:00 [INF] Received HTTP response headers after 218.3501ms - 201
2025-09-11 21:02:43.856 +03:00 [INF] End processing HTTP request after 229.3142ms - 201
2025-09-11 21:02:43.860 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:02:43.862 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:02:43.864 +03:00 [INF] Payment key generated successfully for Order ID: 384520623
2025-09-11 21:02:43.866 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180145-3539
2025-09-11 21:02:43.868 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:02:43.944 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:02:43.952 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:02:43.956 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:02:43.959 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:02:43.960 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:02:43.962 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:02:44.114 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:02:44.267 +03:00 [INF] Executed DbCommand (3,065ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:02:44.267 +03:00 [INF] Payment created successfully with ID 76
2025-09-11 21:02:44.275 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 21:02:44.359 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 21:02:44.366 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:02:44.369 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:02:44.444 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:02:44.454 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:02:44.458 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:02:44.534 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:02:44.543 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:02:44.620 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:02:44.643 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:02:44.645 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:02:44.650 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:02:44.924 +03:00 [INF] Received HTTP response headers after 262.498ms - 201
2025-09-11 21:02:44.926 +03:00 [INF] End processing HTTP request after 281.1129ms - 201
2025-09-11 21:02:44.929 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:02:45.005 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:02:45.010 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:02:45.092 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:02:45.097 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:02:45.099 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:02:45.150 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:02:45.153 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 4497.5079ms
2025-09-11 21:02:45.156 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:45.159 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 200 1365 application/json; charset=utf-8 4978.8228ms
2025-09-11 21:02:45.311 +03:00 [INF] Received HTTP response headers after 209.4191ms - 201
2025-09-11 21:02:45.314 +03:00 [INF] End processing HTTP request after 216.9639ms - 201
2025-09-11 21:02:45.317 +03:00 [INF] Successfully created PayMob order: 384520656 for local order: ORD-20250911180145-3539
2025-09-11 21:02:45.319 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:02:45.397 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:02:45.401 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:02:45.404 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384520656, Amount: 1012226
2025-09-11 21:02:45.407 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:02:45.410 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:02:45.636 +03:00 [INF] Received HTTP response headers after 223.8627ms - 201
2025-09-11 21:02:45.642 +03:00 [INF] End processing HTTP request after 234.7381ms - 201
2025-09-11 21:02:45.645 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:02:45.647 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:02:45.649 +03:00 [INF] Payment key generated successfully for Order ID: 384520656
2025-09-11 21:02:45.651 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180145-3539
2025-09-11 21:02:45.653 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:02:45.730 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:02:45.737 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:02:45.742 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:02:45.744 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:02:45.745 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:02:45.751 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:02:47.078 +03:00 [ERR] Failed executing DbCommand (1,252ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:02:48.206 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:02:48.246 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 21:02:48.367 +03:00 [INF] Executed DbCommand (7,159ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:02:48.382 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 21:02:48.461 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 21:02:48.469 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:02:48.472 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:02:48.552 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:02:48.563 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:02:48.568 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:02:48.645 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:02:48.654 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:02:48.730 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:02:48.747 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:02:48.750 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:02:48.753 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:02:48.982 +03:00 [INF] Received HTTP response headers after 224.0472ms - 201
2025-09-11 21:02:48.987 +03:00 [INF] End processing HTTP request after 237.2101ms - 201
2025-09-11 21:02:49.000 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:02:49.083 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:02:49.100 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:02:49.198 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:02:49.206 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:02:49.209 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:02:49.251 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:02:49.257 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 8585.7613ms
2025-09-11 21:02:49.265 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:49.270 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 9059.576ms
2025-09-11 21:02:49.422 +03:00 [INF] Received HTTP response headers after 208.8302ms - 201
2025-09-11 21:02:49.432 +03:00 [INF] End processing HTTP request after 226.0847ms - 201
2025-09-11 21:02:49.441 +03:00 [INF] Successfully created PayMob order: 384520705 for local order: ORD-20250911180145-3539
2025-09-11 21:02:49.450 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:02:49.529 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:02:49.545 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:02:49.551 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384520705, Amount: 1012226
2025-09-11 21:02:49.559 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:02:49.565 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:02:49.792 +03:00 [INF] Received HTTP response headers after 224.5189ms - 201
2025-09-11 21:02:49.798 +03:00 [INF] End processing HTTP request after 239.1938ms - 201
2025-09-11 21:02:49.804 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:02:49.810 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:02:49.814 +03:00 [INF] Payment key generated successfully for Order ID: 384520705
2025-09-11 21:02:49.818 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180145-3539
2025-09-11 21:02:49.821 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:02:49.899 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:02:49.913 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:02:49.919 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:02:49.921 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:02:49.926 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:02:49.929 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:02:50.087 +03:00 [ERR] Failed executing DbCommand (81ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:02:50.245 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:02:50.281 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 21:02:50.384 +03:00 [INF] Executed DbCommand (9,170ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:02:50.396 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 21:02:50.477 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 21:02:50.503 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:02:50.505 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:02:50.588 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:02:50.597 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:02:50.600 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:02:50.676 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:02:50.687 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:02:50.765 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:02:50.778 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:02:50.782 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:02:50.784 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:02:51.020 +03:00 [INF] Received HTTP response headers after 232.251ms - 201
2025-09-11 21:02:51.026 +03:00 [INF] End processing HTTP request after 244.324ms - 201
2025-09-11 21:02:51.031 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:02:51.109 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:02:51.119 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:02:51.202 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:02:51.216 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:02:51.219 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:02:51.273 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:02:51.288 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 10625.1676ms
2025-09-11 21:02:51.294 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:51.297 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 11111.4356ms
2025-09-11 21:02:51.433 +03:00 [INF] Received HTTP response headers after 211.2648ms - 201
2025-09-11 21:02:51.438 +03:00 [INF] End processing HTTP request after 222.7317ms - 201
2025-09-11 21:02:51.445 +03:00 [INF] Successfully created PayMob order: 384520725 for local order: ORD-20250911180145-3539
2025-09-11 21:02:51.448 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:02:51.523 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:02:51.534 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:02:51.538 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384520725, Amount: 1012226
2025-09-11 21:02:51.543 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:02:51.546 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:02:51.771 +03:00 [INF] Received HTTP response headers after 220.7523ms - 201
2025-09-11 21:02:51.777 +03:00 [INF] End processing HTTP request after 233.6945ms - 201
2025-09-11 21:02:51.783 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:02:51.786 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:02:51.794 +03:00 [INF] Payment key generated successfully for Order ID: 384520725
2025-09-11 21:02:51.799 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180145-3539
2025-09-11 21:02:51.803 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:02:51.881 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:02:51.894 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:02:51.899 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:02:51.903 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:02:51.906 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:02:51.920 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:02:52.087 +03:00 [ERR] Failed executing DbCommand (85ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:02:52.243 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:02:52.271 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 21:02:52.361 +03:00 [INF] Executed DbCommand (11,128ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:02:52.370 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 21:02:52.445 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 21:02:52.454 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:02:52.456 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:02:52.532 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:02:52.539 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:02:52.544 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:02:52.622 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:02:52.632 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:02:52.708 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:02:52.718 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:02:52.720 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:02:52.726 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:02:52.949 +03:00 [INF] Received HTTP response headers after 217.373ms - 201
2025-09-11 21:02:52.970 +03:00 [INF] End processing HTTP request after 249.5409ms - 201
2025-09-11 21:02:52.987 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:02:53.072 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:02:53.084 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:02:53.168 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:02:53.183 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:02:53.189 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:02:53.246 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:02:53.255 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 12587.8257ms
2025-09-11 21:02:53.262 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:53.266 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 13056.337ms
2025-09-11 21:02:53.412 +03:00 [INF] Received HTTP response headers after 216.9777ms - 201
2025-09-11 21:02:53.418 +03:00 [INF] End processing HTTP request after 234.9121ms - 201
2025-09-11 21:02:53.421 +03:00 [INF] Successfully created PayMob order: 384520742 for local order: ORD-20250911180145-3539
2025-09-11 21:02:53.425 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:02:53.501 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:02:53.509 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:02:53.512 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384520742, Amount: 1012226
2025-09-11 21:02:53.514 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:02:53.522 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:02:53.749 +03:00 [INF] Received HTTP response headers after 223.2245ms - 201
2025-09-11 21:02:53.770 +03:00 [INF] End processing HTTP request after 256.0382ms - 201
2025-09-11 21:02:53.783 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:02:53.791 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:02:53.798 +03:00 [INF] Payment key generated successfully for Order ID: 384520742
2025-09-11 21:02:53.803 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180145-3539
2025-09-11 21:02:53.807 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:02:53.883 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:02:53.897 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:02:53.899 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:02:53.902 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:02:53.904 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:02:53.908 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:02:54.062 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:02:54.217 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:02:54.242 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 21:02:54.384 +03:00 [INF] Executed DbCommand (13,019ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:02:54.401 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 21:02:54.479 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 21:02:54.491 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:02:54.495 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:02:54.572 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:02:54.580 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:02:54.584 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:02:54.660 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:02:54.670 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:02:54.751 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:02:54.770 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:02:54.771 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:02:54.785 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:02:55.023 +03:00 [INF] Received HTTP response headers after 235.5117ms - 201
2025-09-11 21:02:55.028 +03:00 [INF] End processing HTTP request after 256.6097ms - 201
2025-09-11 21:02:55.037 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:02:55.118 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:02:55.128 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:02:55.212 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:02:55.224 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:02:55.228 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:02:55.256 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:02:55.264 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 14514.6935ms
2025-09-11 21:02:55.268 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:55.270 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 14870.6082ms
2025-09-11 21:02:55.446 +03:00 [INF] Received HTTP response headers after 216.0917ms - 201
2025-09-11 21:02:55.452 +03:00 [INF] End processing HTTP request after 228.5293ms - 201
2025-09-11 21:02:55.455 +03:00 [INF] Successfully created PayMob order: 384520778 for local order: ORD-20250911180145-3539
2025-09-11 21:02:55.459 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:02:55.535 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:02:55.545 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:02:55.560 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384520778, Amount: 1012226
2025-09-11 21:02:55.566 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:02:55.570 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:02:55.802 +03:00 [INF] Received HTTP response headers after 222.3371ms - 201
2025-09-11 21:02:55.810 +03:00 [INF] End processing HTTP request after 244.1799ms - 201
2025-09-11 21:02:55.815 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:02:55.817 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:02:55.819 +03:00 [INF] Payment key generated successfully for Order ID: 384520778
2025-09-11 21:02:55.821 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180145-3539
2025-09-11 21:02:55.822 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:02:55.899 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:02:55.927 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:02:55.932 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:02:55.935 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:02:55.940 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:02:55.944 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:02:56.099 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:02:56.274 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:02:56.289 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 21:02:56.379 +03:00 [INF] Executed DbCommand (15,009ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:02:56.386 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 21:02:56.465 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 21:02:56.471 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:02:56.475 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:02:56.552 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:02:56.566 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:02:56.573 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:02:56.650 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:02:56.665 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:02:56.740 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:02:56.750 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:02:56.751 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:02:56.754 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:02:56.986 +03:00 [INF] Received HTTP response headers after 228.6443ms - 201
2025-09-11 21:02:56.994 +03:00 [INF] End processing HTTP request after 242.729ms - 201
2025-09-11 21:02:56.999 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:02:57.079 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:02:57.098 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:02:57.183 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:02:57.194 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:02:57.198 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:02:57.267 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:02:57.271 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 16560.94ms
2025-09-11 21:02:57.278 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:57.281 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 16879.6568ms
2025-09-11 21:02:57.414 +03:00 [INF] Received HTTP response headers after 213.3164ms - 201
2025-09-11 21:02:57.419 +03:00 [INF] End processing HTTP request after 224.5248ms - 201
2025-09-11 21:02:57.424 +03:00 [INF] Successfully created PayMob order: 384520796 for local order: ORD-20250911180145-3539
2025-09-11 21:02:57.430 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:02:57.506 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:02:57.567 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:02:57.591 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384520796, Amount: 1012226
2025-09-11 21:02:57.595 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:02:57.600 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:02:57.839 +03:00 [INF] Received HTTP response headers after 221.5642ms - 201
2025-09-11 21:02:57.853 +03:00 [INF] End processing HTTP request after 257.5981ms - 201
2025-09-11 21:02:57.863 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:02:57.864 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:02:57.866 +03:00 [INF] Payment key generated successfully for Order ID: 384520796
2025-09-11 21:02:57.868 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180145-3539
2025-09-11 21:02:57.870 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:02:57.945 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:02:57.950 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:02:57.953 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:02:57.955 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:02:57.958 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:02:57.960 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:02:58.112 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:02:58.268 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:02:58.288 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 21:02:58.376 +03:00 [INF] Executed DbCommand (16,991ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:02:58.383 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 21:02:58.459 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 21:02:58.469 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:02:58.470 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:02:58.548 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:02:58.558 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:02:58.564 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:02:58.640 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:02:58.649 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:02:58.725 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:02:58.733 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:02:58.735 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:02:58.737 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:02:58.963 +03:00 [INF] Received HTTP response headers after 221.8217ms - 201
2025-09-11 21:02:58.975 +03:00 [INF] End processing HTTP request after 240.4689ms - 201
2025-09-11 21:02:58.981 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:02:59.059 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:02:59.067 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:02:59.150 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:02:59.158 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:02:59.161 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:02:59.253 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:02:59.259 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 18415.1839ms
2025-09-11 21:02:59.265 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:02:59.268 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 18837.0336ms
2025-09-11 21:02:59.374 +03:00 [INF] Received HTTP response headers after 210.3983ms - 201
2025-09-11 21:02:59.379 +03:00 [INF] End processing HTTP request after 220.4128ms - 201
2025-09-11 21:02:59.383 +03:00 [INF] Successfully created PayMob order: 384520816 for local order: ORD-20250911180145-3539
2025-09-11 21:02:59.387 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:02:59.461 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:02:59.473 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:02:59.476 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384520816, Amount: 1012226
2025-09-11 21:02:59.480 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:02:59.482 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:02:59.964 +03:00 [INF] Received HTTP response headers after 479.898ms - 201
2025-09-11 21:02:59.973 +03:00 [INF] End processing HTTP request after 493.0981ms - 201
2025-09-11 21:02:59.979 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:02:59.982 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:02:59.985 +03:00 [INF] Payment key generated successfully for Order ID: 384520816
2025-09-11 21:02:59.987 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180145-3539
2025-09-11 21:02:59.990 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:03:00.066 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:03:00.073 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:03:00.075 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:03:00.077 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:03:00.080 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:03:00.082 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:03:00.233 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:03:00.389 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:03:00.418 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 21:03:00.571 +03:00 [INF] Executed DbCommand (19,173ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:03:00.581 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 21:03:00.661 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 21:03:00.667 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:03:00.669 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:03:00.744 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:03:00.749 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:03:00.752 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:03:00.829 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:03:00.837 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:03:00.916 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:03:00.925 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:03:00.930 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:03:00.934 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:03:01.191 +03:00 [INF] Received HTTP response headers after 254.3396ms - 201
2025-09-11 21:03:01.197 +03:00 [INF] End processing HTTP request after 267.5484ms - 201
2025-09-11 21:03:01.204 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:03:01.284 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:03:01.296 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:03:01.385 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:03:01.396 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:03:01.400 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:03:01.457 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:03:01.463 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 20665.6135ms
2025-09-11 21:03:01.468 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:03:01.472 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 21042.0652ms
2025-09-11 21:03:01.665 +03:00 [INF] Received HTTP response headers after 262.871ms - 201
2025-09-11 21:03:01.673 +03:00 [INF] End processing HTTP request after 276.475ms - 201
2025-09-11 21:03:01.679 +03:00 [INF] Successfully created PayMob order: 384520836 for local order: ORD-20250911180145-3539
2025-09-11 21:03:01.687 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:03:01.766 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:03:01.779 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:03:01.783 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384520836, Amount: 1012226
2025-09-11 21:03:01.786 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:03:01.789 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:03:02.033 +03:00 [INF] Received HTTP response headers after 229.6357ms - 201
2025-09-11 21:03:02.037 +03:00 [INF] End processing HTTP request after 250.4362ms - 201
2025-09-11 21:03:02.042 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:03:02.045 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:03:02.047 +03:00 [INF] Payment key generated successfully for Order ID: 384520836
2025-09-11 21:03:02.050 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180145-3539
2025-09-11 21:03:02.052 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:03:02.127 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:03:02.137 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:03:02.141 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:03:02.143 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:03:02.145 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:03:02.147 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:03:02.299 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:03:02.457 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:03:02.475 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 21:03:02.560 +03:00 [INF] Executed DbCommand (21,157ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:03:02.569 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 21:03:02.647 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 21:03:02.657 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:03:02.661 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:03:02.736 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:03:02.747 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:03:02.750 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:03:02.828 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:03:02.847 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:03:02.927 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:03:02.937 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:03:02.940 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:03:02.944 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:03:03.176 +03:00 [INF] Received HTTP response headers after 229.2979ms - 201
2025-09-11 21:03:03.181 +03:00 [INF] End processing HTTP request after 240.838ms - 201
2025-09-11 21:03:03.190 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:03:03.274 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:03:03.285 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:03:03.366 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:03:03.372 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:03:03.377 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:03:03.443 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:03:03.447 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 22678.395ms
2025-09-11 21:03:03.449 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:03:03.452 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 23023.2584ms
2025-09-11 21:03:03.588 +03:00 [INF] Received HTTP response headers after 208.7905ms - 201
2025-09-11 21:03:03.595 +03:00 [INF] End processing HTTP request after 222.4024ms - 201
2025-09-11 21:03:03.598 +03:00 [INF] Successfully created PayMob order: 384520860 for local order: ORD-20250911180145-3539
2025-09-11 21:03:03.600 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:03:03.675 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:03:03.685 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:03:03.687 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384520860, Amount: 1012226
2025-09-11 21:03:03.691 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:03:03.694 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:03:03.916 +03:00 [INF] Received HTTP response headers after 218.9852ms - 201
2025-09-11 21:03:03.934 +03:00 [INF] End processing HTTP request after 242.9825ms - 201
2025-09-11 21:03:03.942 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:03:03.947 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:03:03.950 +03:00 [INF] Payment key generated successfully for Order ID: 384520860
2025-09-11 21:03:03.953 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180145-3539
2025-09-11 21:03:03.955 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:03:04.032 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:03:04.049 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:03:04.055 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:03:04.059 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:03:04.063 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:03:04.066 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:03:04.219 +03:00 [ERR] Failed executing DbCommand (76ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:03:04.393 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:03:04.427 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 21:03:04.524 +03:00 [INF] Executed DbCommand (23,116ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:03:04.533 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 21:03:04.609 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 21:03:04.622 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:03:04.630 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:03:04.712 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:03:04.732 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:03:04.734 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:03:04.810 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:03:04.815 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:03:04.891 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:03:04.899 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:03:04.901 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:03:04.904 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:03:05.141 +03:00 [INF] Received HTTP response headers after 232.8327ms - 201
2025-09-11 21:03:05.160 +03:00 [INF] End processing HTTP request after 259.1351ms - 201
2025-09-11 21:03:05.170 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:03:05.253 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:03:05.272 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:03:05.358 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:03:05.369 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:03:05.373 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:03:05.405 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:03:05.412 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 24652.0823ms
2025-09-11 21:03:05.416 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:03:05.418 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 25015.027ms
2025-09-11 21:03:05.588 +03:00 [INF] Received HTTP response headers after 210.9981ms - 201
2025-09-11 21:03:05.596 +03:00 [INF] End processing HTTP request after 227.3169ms - 201
2025-09-11 21:03:05.601 +03:00 [INF] Successfully created PayMob order: 384520889 for local order: ORD-20250911180145-3539
2025-09-11 21:03:05.605 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:03:05.684 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:03:05.703 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:03:05.710 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384520889, Amount: 1012226
2025-09-11 21:03:05.720 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:03:05.724 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:03:05.952 +03:00 [INF] Received HTTP response headers after 223.7597ms - 201
2025-09-11 21:03:05.962 +03:00 [INF] End processing HTTP request after 242.0632ms - 201
2025-09-11 21:03:05.969 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:03:05.975 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:03:05.981 +03:00 [INF] Payment key generated successfully for Order ID: 384520889
2025-09-11 21:03:05.985 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180145-3539
2025-09-11 21:03:05.989 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:03:06.069 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:03:06.081 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:03:06.083 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:03:06.084 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:03:06.088 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:03:06.106 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:03:06.262 +03:00 [ERR] Failed executing DbCommand (78ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:03:06.417 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:03:06.437 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 21:03:06.523 +03:00 [INF] Executed DbCommand (25,108ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:03:06.534 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 21:03:06.612 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 21:03:06.622 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:03:06.624 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:03:06.700 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:03:06.720 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:03:06.732 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:03:06.811 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:03:06.823 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:03:06.904 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:03:06.916 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:03:06.919 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:03:06.923 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:03:07.148 +03:00 [INF] Received HTTP response headers after 219.9895ms - 201
2025-09-11 21:03:07.156 +03:00 [INF] End processing HTTP request after 237.1195ms - 201
2025-09-11 21:03:07.165 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:03:07.247 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:03:07.258 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:03:07.344 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:03:07.354 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:03:07.359 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:03:07.414 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:03:07.421 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 26667.7084ms
2025-09-11 21:03:07.429 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:03:07.434 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 27028.6841ms
2025-09-11 21:03:07.570 +03:00 [INF] Received HTTP response headers after 206.3344ms - 201
2025-09-11 21:03:07.581 +03:00 [INF] End processing HTTP request after 226.5953ms - 201
2025-09-11 21:03:07.583 +03:00 [INF] Successfully created PayMob order: 384520904 for local order: ORD-20250911180145-3539
2025-09-11 21:03:07.585 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:03:07.660 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:03:07.666 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:03:07.669 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384520904, Amount: 1012226
2025-09-11 21:03:07.672 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:03:07.676 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:03:07.899 +03:00 [INF] Received HTTP response headers after 220.4069ms - 201
2025-09-11 21:03:07.913 +03:00 [INF] End processing HTTP request after 241.301ms - 201
2025-09-11 21:03:07.926 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:03:07.932 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:03:07.937 +03:00 [INF] Payment key generated successfully for Order ID: 384520904
2025-09-11 21:03:07.941 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180145-3539
2025-09-11 21:03:07.945 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:03:08.021 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:03:08.034 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:03:08.038 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:03:08.039 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:03:08.043 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:03:08.046 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:03:08.197 +03:00 [ERR] Failed executing DbCommand (76ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:03:08.356 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:03:08.378 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 21:03:08.471 +03:00 [INF] Executed DbCommand (27,050ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:03:08.487 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 21:03:08.568 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 21:03:08.586 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:03:08.590 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:03:08.666 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:03:08.678 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:03:08.682 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:03:08.757 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:03:08.769 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:03:08.845 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:03:08.855 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:03:08.865 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:03:08.870 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:03:09.098 +03:00 [INF] Received HTTP response headers after 219.6517ms - 201
2025-09-11 21:03:09.101 +03:00 [INF] End processing HTTP request after 236.1816ms - 201
2025-09-11 21:03:09.103 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:03:09.181 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:03:09.190 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:03:09.274 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:03:09.285 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:03:09.293 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:03:09.352 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:03:09.361 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 28513.8469ms
2025-09-11 21:03:09.366 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:03:09.368 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 28932.9753ms
2025-09-11 21:03:09.513 +03:00 [INF] Received HTTP response headers after 212.818ms - 201
2025-09-11 21:03:09.531 +03:00 [INF] End processing HTTP request after 245.5974ms - 201
2025-09-11 21:03:09.545 +03:00 [INF] Successfully created PayMob order: 384520927 for local order: ORD-20250911180145-3539
2025-09-11 21:03:09.556 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:03:09.636 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:03:09.647 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:03:09.650 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384520927, Amount: 1012226
2025-09-11 21:03:09.653 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:03:09.656 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:03:09.877 +03:00 [INF] Received HTTP response headers after 217.333ms - 201
2025-09-11 21:03:09.884 +03:00 [INF] End processing HTTP request after 230.7328ms - 201
2025-09-11 21:03:09.888 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:03:09.890 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:03:09.893 +03:00 [INF] Payment key generated successfully for Order ID: 384520927
2025-09-11 21:03:09.895 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180145-3539
2025-09-11 21:03:09.897 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:03:09.972 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:03:09.988 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:03:09.995 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:03:10.000 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:03:10.003 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:03:10.009 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:03:10.165 +03:00 [ERR] Failed executing DbCommand (76ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:03:10.341 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:03:10.372 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 21:03:10.466 +03:00 [INF] Executed DbCommand (29,034ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:03:10.477 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 21:03:10.554 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 21:03:10.560 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:03:10.562 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:03:10.636 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:03:10.643 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:03:10.646 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:03:10.721 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:03:10.729 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:03:10.804 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:03:10.815 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:03:10.817 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:03:10.819 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:03:11.045 +03:00 [INF] Received HTTP response headers after 222.8345ms - 201
2025-09-11 21:03:11.062 +03:00 [INF] End processing HTTP request after 244.788ms - 201
2025-09-11 21:03:11.077 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:03:11.160 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:03:11.169 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:03:11.251 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:03:11.260 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:03:11.264 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:03:11.336 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:03:11.343 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 30492.3192ms
2025-09-11 21:03:11.348 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:03:11.351 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 30914.5997ms
2025-09-11 21:03:11.479 +03:00 [INF] Received HTTP response headers after 212.7455ms - 201
2025-09-11 21:03:11.490 +03:00 [INF] End processing HTTP request after 229.886ms - 201
2025-09-11 21:03:11.498 +03:00 [INF] Successfully created PayMob order: 384520956 for local order: ORD-20250911180145-3539
2025-09-11 21:03:11.502 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:03:11.580 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:03:11.592 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:03:11.598 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384520956, Amount: 1012226
2025-09-11 21:03:11.602 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:03:11.606 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:03:11.828 +03:00 [INF] Received HTTP response headers after 217.9196ms - 201
2025-09-11 21:03:11.837 +03:00 [INF] End processing HTTP request after 235.3317ms - 201
2025-09-11 21:03:11.842 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:03:11.845 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:03:11.866 +03:00 [INF] Payment key generated successfully for Order ID: 384520956
2025-09-11 21:03:11.868 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180145-3539
2025-09-11 21:03:11.871 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:03:11.949 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:03:11.954 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:03:11.960 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:03:11.962 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:03:11.963 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:03:11.965 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:03:12.116 +03:00 [ERR] Failed executing DbCommand (75ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:03:12.258 +03:00 [ERR] Failed executing DbCommand (30,821ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:03:12.274 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> MySqlConnector.MySqlException (0x80004005): Query execution was interrupted
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 124
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 21:03:12.269 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:03:12.325 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 21:03:12.489 +03:00 [INF] Executed DbCommand (31,047ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:03:12.500 +03:00 [INF] Execute GetAll for entity Payment
2025-09-11 21:03:12.577 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__order_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE (`p`.`OrderId` = @__order_Id_0) AND (`p`.`Status` = 1)
LIMIT 1
2025-09-11 21:03:12.593 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:03:12.598 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:03:12.674 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:03:12.685 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:03:12.688 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:03:12.766 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:03:12.779 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:03:12.856 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:03:12.867 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:03:12.870 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:03:12.873 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:03:13.100 +03:00 [INF] Received HTTP response headers after 222.867ms - 201
2025-09-11 21:03:13.106 +03:00 [INF] End processing HTTP request after 235.8216ms - 201
2025-09-11 21:03:13.112 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:03:13.198 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:03:13.212 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:03:13.220 +03:00 [ERR] Failed executing DbCommand (31,774ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:03:13.226 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> MySqlConnector.MySqlException (0x80004005): Query execution was interrupted
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 124
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 21:03:13.245 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:03:13.250 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 32326.4385ms
2025-09-11 21:03:13.255 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:03:13.258 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 32776.4987ms
2025-09-11 21:03:13.293 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:03:13.296 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:03:13.302 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 32446.8498ms
2025-09-11 21:03:13.313 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:03:13.315 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 32829.0929ms
2025-09-11 21:03:13.310 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:03:13.329 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:03:13.564 +03:00 [INF] Received HTTP response headers after 233.0753ms - 201
2025-09-11 21:03:13.570 +03:00 [INF] End processing HTTP request after 260.1663ms - 201
2025-09-11 21:03:13.573 +03:00 [INF] Successfully created PayMob order: 384520975 for local order: ORD-20250911180145-3539
2025-09-11 21:03:13.578 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:03:13.656 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:03:13.665 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:03:13.672 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384520975, Amount: 1012226
2025-09-11 21:03:13.679 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:03:13.681 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:03:13.708 +03:00 [ERR] Failed executing DbCommand (32,109ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:03:13.709 +03:00 [ERR] Failed executing DbCommand (32,144ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:03:13.716 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 67
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 75
   at MySqlConnector.Protocol.Serialization.BufferedByteReader.ReadBytesAsync(IByteHandler byteHandler, ArraySegment`1 buffer, Int32 totalBytesToRead, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/BufferedByteReader.cs:line 34
   at MySqlConnector.Protocol.Serialization.ProtocolUtility.ReadPayloadAsync(BufferedByteReader bufferedByteReader, IByteHandler byteHandler, Func`1 getNextSequenceNumber, ArraySegmentHolder`1 previousPayloads, ProtocolErrorBehavior protocolErrorBehavior, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/ProtocolUtility.cs:line 421
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 882
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 21:03:13.720 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> System.IO.IOException: Unable to read data from the transport connection: The I/O operation has been aborted because of either a thread exit or an application request..
 ---> System.Net.Sockets.SocketException (995): The I/O operation has been aborted because of either a thread exit or an application request.
   --- End of inner exception stack trace ---
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.ThrowException(SocketError error, CancellationToken cancellationToken)
   at System.Net.Sockets.Socket.AwaitableSocketAsyncEventArgs.System.Threading.Tasks.Sources.IValueTaskSource<System.Int32>.GetResult(Int16 token)
   at System.Net.Security.SslStream.EnsureFullTlsFrameAsync[TIOAdapter](CancellationToken cancellationToken, Int32 estimatedSize)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Net.Security.SslStream.ReadAsyncInternal[TIOAdapter](Memory`1 buffer, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 67
   at MySqlConnector.Protocol.Serialization.StreamByteHandler.<ReadBytesAsync>g__DoReadBytesAsync|6_2(Memory`1 buffer) in /_/src/MySqlConnector/Protocol/Serialization/StreamByteHandler.cs:line 75
   at MySqlConnector.Protocol.Serialization.BufferedByteReader.ReadBytesAsync(IByteHandler byteHandler, ArraySegment`1 buffer, Int32 totalBytesToRead, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/BufferedByteReader.cs:line 34
   at MySqlConnector.Protocol.Serialization.ProtocolUtility.ReadPayloadAsync(BufferedByteReader bufferedByteReader, IByteHandler byteHandler, Func`1 getNextSequenceNumber, ArraySegmentHolder`1 previousPayloads, ProtocolErrorBehavior protocolErrorBehavior, IOBehavior ioBehavior) in /_/src/MySqlConnector/Protocol/Serialization/ProtocolUtility.cs:line 421
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 882
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 21:03:13.741 +03:00 [ERR] Failed executing DbCommand (32,209ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:03:13.748 +03:00 [ERR] An error occurred using a transaction.
2025-09-11 21:03:13.762 +03:00 [ERR] An error occurred using a transaction.
2025-09-11 21:03:13.765 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> MySqlConnector.MySqlException (0x80004005): Query execution was interrupted
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 124
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 21:03:13.768 +03:00 [ERR] Error in CreatePayment: Connection must be Open; current state is Closed
2025-09-11 21:03:13.769 +03:00 [ERR] Error in CreatePayment: Connection must be Open; current state is Closed
2025-09-11 21:03:13.782 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:03:13.784 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:03:13.788 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 32791.9329ms
2025-09-11 21:03:13.791 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 32791.5384ms
2025-09-11 21:03:13.795 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:03:13.798 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:03:13.802 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 225 application/json; charset=utf-8 33273.5505ms
2025-09-11 21:03:13.804 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 225 application/json; charset=utf-8 33274.8028ms
2025-09-11 21:03:13.907 +03:00 [INF] Received HTTP response headers after 223.0377ms - 201
2025-09-11 21:03:13.914 +03:00 [INF] End processing HTTP request after 235.5223ms - 201
2025-09-11 21:03:13.919 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:03:13.925 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:03:13.930 +03:00 [INF] Payment key generated successfully for Order ID: 384520975
2025-09-11 21:03:13.932 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180145-3539
2025-09-11 21:03:13.935 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:03:14.010 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:03:14.020 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:03:14.022 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:03:14.024 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:03:14.026 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:03:14.028 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:03:14.182 +03:00 [ERR] Failed executing DbCommand (78ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:03:14.204 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:03:14.214 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 33296.3841ms
2025-09-11 21:03:14.222 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:03:14.228 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 33745.4635ms
2025-09-11 21:03:14.351 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:03:14.388 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '131-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 304
2025-09-11 21:03:14.725 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:03:14.730 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 33801.4415ms
2025-09-11 21:03:14.737 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:03:14.740 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 34252.1131ms
2025-09-11 21:03:15.367 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:03:15.376 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 34462.5342ms
2025-09-11 21:03:15.384 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:03:15.388 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 34903.3378ms
2025-09-11 21:07:07.604 +03:00 [INF] DB tables already exist. Exit install
2025-09-11 21:07:09.044 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-09-11 21:07:10.152 +03:00 [INF] Executed DbCommand (100ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-11 21:07:10.835 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-09-11 21:07:11.035 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-09-11 21:07:11.057 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-11 21:07:11.072 +03:00 [INF] Starting data seeding...
2025-09-11 21:07:11.118 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-11 21:07:11.631 +03:00 [INF] Executed DbCommand (113ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-11 21:07:11.699 +03:00 [INF] Role 'Admin' already exists.
2025-09-11 21:07:11.851 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-09-11 21:07:11.861 +03:00 [INF] Role 'User' already exists.
2025-09-11 21:07:12.036 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-09-11 21:07:12.177 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-09-11 21:07:12.186 +03:00 [INF] Data seeding completed successfully.
2025-09-11 21:07:13.781 +03:00 [INF] Now listening on: http://localhost:5069
2025-09-11 21:07:13.910 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-09-11 21:07:13.924 +03:00 [INF] Using the following options for SQL Server job storage:
2025-09-11 21:07:13.927 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-09-11 21:07:13.938 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-09-11 21:07:13.956 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-11 21:07:13.958 +03:00 [INF] Hosting environment: Development
2025-09-11 21:07:13.960 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-09-11 21:07:14.137 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - null null
2025-09-11 21:07:14.289 +03:00 [WRN] Failed to determine the https port for redirect.
2025-09-11 21:07:14.435 +03:00 [INF] Server mrrobot:24088:b2add2d6 successfully announced in 467.5753 ms
2025-09-11 21:07:14.443 +03:00 [INF] Server mrrobot:24088:b2add2d6 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-09-11 21:07:14.470 +03:00 [INF] Server mrrobot:24088:b2add2d6 all the dispatchers started
2025-09-11 21:07:16.880 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - 200 null text/html 2743.5372ms
2025-09-11 21:07:17.092 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/css181801145232225 - null null
2025-09-11 21:07:17.096 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/css-dark18180449332647 - null null
2025-09-11 21:07:17.096 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/js181802016498828 - null null
2025-09-11 21:07:17.096 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-11 21:07:17.126 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/css-dark18180449332647 - 200 null text/css 29.7603ms
2025-09-11 21:07:17.134 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/css181801145232225 - 200 null text/css 42.4866ms
2025-09-11 21:07:17.158 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 62.0459ms
2025-09-11 21:07:17.192 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/js181802016498828 - 200 null application/javascript 95.6982ms
2025-09-11 21:07:17.212 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-11 21:07:17.295 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 82.7463ms
2025-09-11 21:07:19.420 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:07:19.434 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:07:20.895 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1475.0986ms
2025-09-11 21:07:22.946 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:07:22.959 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:07:24.153 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/jobs/scheduled/enqueue - application/x-www-form-urlencoded; charset=UTF-8 31
2025-09-11 21:07:24.163 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:07:24.369 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1423.5847ms
2025-09-11 21:07:26.399 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/jobs/scheduled/enqueue - 204 null null 2245.7051ms
2025-09-11 21:07:26.400 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:07:26.421 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:07:26.429 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - null null
2025-09-11 21:07:27.045 +03:00 [INF] Starting CheckAndUpdatePaymentStatusAsync for payment 76
2025-09-11 21:07:27.300 +03:00 [INF] Executing GetByIdAsync for entity Payment with ID: 76
2025-09-11 21:07:27.392 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`
FROM `Payments` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:07:27.524 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Payments WHERE Id = @p0 FOR UPDATE
2025-09-11 21:07:27.550 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:07:27.643 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:07:27.655 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:07:27.671 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:07:27.679 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:07:27.896 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1496.0387ms
2025-09-11 21:07:28.439 +03:00 [INF] Received HTTP response headers after 749.6341ms - 201
2025-09-11 21:07:28.446 +03:00 [INF] End processing HTTP request after 783.2773ms - 201
2025-09-11 21:07:28.460 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:07:28.462 +03:00 [INF] Start processing HTTP request GET https://accept.paymob.com/api/ecommerce/orders/384520623
2025-09-11 21:07:28.466 +03:00 [INF] Sending HTTP request GET https://accept.paymob.com/api/ecommerce/orders/384520623
2025-09-11 21:07:28.629 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/hangfire/jobs/scheduled - 200 null text/html 2200.188ms
2025-09-11 21:07:28.664 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-09-11 21:07:28.664 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-09-11 21:07:28.679 +03:00 [INF] Received HTTP response headers after 209.9818ms - 200
2025-09-11 21:07:28.687 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 23.3336ms
2025-09-11 21:07:28.690 +03:00 [INF] End processing HTTP request after 227.5612ms - 200
2025-09-11 21:07:28.692 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 28.3386ms
2025-09-11 21:07:29.946 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p3='?' (Size = 8) (DbType = Binary), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Payments` SET `ModifiedAt` = @p0, `Status` = @p1
WHERE `Id` = @p2 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = @p2;
2025-09-11 21:07:30.801 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:07:30.810 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:07:32.079 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1277.4026ms
2025-09-11 21:07:34.093 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:07:34.101 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:07:34.635 +03:00 [INF] Payment 76 updated to "Failed"
2025-09-11 21:07:35.559 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1465.6159ms
2025-09-11 21:07:37.325 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 131
2025-09-11 21:07:37.369 +03:00 [INF] Execute UpdateOrderAfterPaid_id:131_to status:"PaymentExpired"
2025-09-11 21:07:37.388 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 21:07:37.395 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 21:07:37.402 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 21:07:37.407 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 21:07:37.413 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:07:37.533 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:07:37.584 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:07:37.595 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:07:37.601 +03:00 [INF] Execute GetAll for entity Order
2025-09-11 21:07:37.692 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 21:07:37.713 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 21:07:37.787 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CancelledAt`, `t`.`CreatedAt`, `t`.`CustomerAddressId`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`DeliveredAt`, `t`.`DiscountAmount`, `t`.`ModifiedAt`, `t`.`Notes`, `t`.`OrderNumber`, `t`.`RestockedAt`, `t`.`RowVersion`, `t`.`ShippedAt`, `t`.`ShippingCost`, `t`.`Status`, `t`.`Subtotal`, `t`.`TaxAmount`, `t`.`Total`, `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`DeletedAt`, `o0`.`ModifiedAt`, `o0`.`OrderId`, `o0`.`OrderedAt`, `o0`.`ProductId`, `o0`.`ProductVariantId`, `o0`.`Quantity`, `o0`.`TotalPrice`, `o0`.`UnitPrice`
FROM (
    SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
    FROM `Orders` AS `o`
    WHERE `o`.`Id` = @__orderId_0
    LIMIT 1
) AS `t`
LEFT JOIN `OrderItem` AS `o0` ON `t`.`Id` = `o0`.`OrderId`
ORDER BY `t`.`Id`
2025-09-11 21:07:37.822 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 21:07:37.825 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 21:07:37.826 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 21:07:37.829 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 21:07:37.898 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:07:37.906 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 21:07:38.070 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 21:07:38.863 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1279.1806ms
2025-09-11 21:07:40.688 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 21:07:40.701 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 131
2025-09-11 21:07:40.864 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:07:40.876 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:07:40.896 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:07:40.920 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 21:07:40.998 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 21:07:41.021 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:07:41.027 +03:00 [INF] Execute GetAll for entity OrderItem
2025-09-11 21:07:41.185 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-09-11 21:07:41.200 +03:00 [INF] Adding quantity for variant: 4
2025-09-11 21:07:41.212 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 21:07:41.499 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity + @p0 WHERE Id = @p1
2025-09-11 21:07:41.509 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 4
2025-09-11 21:07:41.595 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:07:42.276 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1400.5748ms
2025-09-11 21:07:42.606 +03:00 [INF] Quantity for variant 4 increased by 3
2025-09-11 21:07:42.623 +03:00 [INF] Updated order 131 to "PaymentExpired" after payment
2025-09-11 21:07:42.906 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 21:07:43.216 +03:00 [INF] Order 131 auto-expired and restock scheduled
2025-09-11 21:07:43.768 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 21:07:44.061 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 21:07:44.213 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 21:07:44.283 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:07:44.294 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:07:44.486 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 21:07:45.497 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 21:07:45.545 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1262.5613ms
2025-09-11 21:07:45.919 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 21:07:46.087 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 21:07:46.508 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 21:07:47.106 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 21:07:47.335 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 21:07:47.425 +03:00 [INF] Restocked inventory for order 131
2025-09-11 21:07:47.526 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 21:07:47.560 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:07:47.573 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:07:47.706 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 21:07:47.706 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 21:07:47.707 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 21:07:47.753 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 21:07:47.756 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 21:07:47.757 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 21:07:47.845 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 21:07:47.921 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-11 21:07:47.926 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 21:07:48.128 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 21:07:48.135 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 21:07:48.175 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 21:07:48.176 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 21:07:48.267 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 21:07:48.360 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 21:07:48.782 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 21:07:48.959 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1398.6681ms
2025-09-11 21:07:49.204 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 21:07:50.673 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-11 21:07:50.886 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-11 21:07:50.966 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:07:50.973 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:07:52.103 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-11 21:07:52.222 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1256.6672ms
2025-09-11 21:07:52.327 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-11 21:07:53.776 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 21:07:54.197 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 21:07:54.229 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:07:54.240 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:07:55.652 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1423.2071ms
2025-09-11 21:07:58.414 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:07:58.605 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:07:59.857 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1443.6775ms
2025-09-11 21:08:01.880 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:01.890 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:03.440 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1559.9521ms
2025-09-11 21:08:04.522 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json 62
2025-09-11 21:08:04.894 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:08:05.097 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:08:05.288 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-11 21:08:05.330 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-11 21:08:05.401 +03:00 [INF] Executing AddItemToCart for product ID: 6
2025-09-11 21:08:05.422 +03:00 [INF] Adding item to cart for user: e682f183-1c61-400b-aa5a-171750f446b5, product: 6
2025-09-11 21:08:05.477 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:05.485 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:05.756 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:08:05.787 +03:00 [INF] Execute GetAll for entity Product
2025-09-11 21:08:05.925 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-09-11 21:08:05.941 +03:00 [INF] Retrieving cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:08:06.043 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-11 21:08:06.146 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Cart WHERE Id = @p0 FOR UPDATE
2025-09-11 21:08:06.157 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-09-11 21:08:06.213 +03:00 [INF] CartItem added successfully (pending save)
2025-09-11 21:08:06.221 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:08:06.224 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:08:06.253 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:08:06.888 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1410.403ms
2025-09-11 21:08:07.363 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (DbType = Int32), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`, `RowVersion`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:08:07.535 +03:00 [INF] Removing cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:08:07.969 +03:00 [INF] Cache removed successfully for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:08:07.972 +03:00 [INF] Item added to cart for user: e682f183-1c61-400b-aa5a-171750f446b5, product: 6
2025-09-11 21:08:07.991 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-11 21:08:08.026 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 2668.5302ms
2025-09-11 21:08:08.071 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-09-11 21:08:08.475 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 3
2025-09-11 21:08:08.660 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 4137.8033ms
2025-09-11 21:08:08.911 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:08.945 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:08:09.044 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:10.439 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1528.7545ms
2025-09-11 21:08:11.251 +03:00 [INF] Removing cache by tag: cart
2025-09-11 21:08:11.467 +03:00 [WRN] No cache entries found for tag: cart
2025-09-11 21:08:12.460 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:12.469 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:13.744 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1284.2079ms
2025-09-11 21:08:14.938 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - null 0
2025-09-11 21:08:15.520 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:08:15.840 +03:00 [INF] Executed DbCommand (149ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:08:15.840 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:16.224 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-11 21:08:16.228 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:16.237 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-09-11 21:08:16.247 +03:00 [INF] Executing CheckOut
2025-09-11 21:08:16.281 +03:00 [INF] Checkout of cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:08:16.287 +03:00 [INF] Retrieving cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:08:16.438 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-11 21:08:16.592 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-11 21:08:16.603 +03:00 [INF] Removing cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:08:16.607 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-11 21:08:16.610 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 365.6049ms
2025-09-11 21:08:16.623 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-09-11 21:08:16.626 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - 200 122 application/json; charset=utf-8 1689.0201ms
2025-09-11 21:08:17.040 +03:00 [INF] Cache removed successfully for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:08:17.649 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1809.4373ms
2025-09-11 21:08:19.171 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json 42
2025-09-11 21:08:19.291 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:08:19.444 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:08:19.465 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-11 21:08:19.498 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-09-11 21:08:19.513 +03:00 [INF] Executing CreateOrder
2025-09-11 21:08:19.528 +03:00 [INF] Creating order from cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:08:19.671 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:19.677 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:19.827 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:08:19.918 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-11 21:08:19.935 +03:00 [INF] Checking if address 31 exists for customer: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:08:20.020 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-09-11 21:08:20.030 +03:00 [INF] Getting cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:08:20.036 +03:00 [INF] Getting cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:08:20.254 +03:00 [WRN] Cache miss for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:08:20.331 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-09-11 21:08:20.336 +03:00 [INF] Execute GetAll for entity Cart
2025-09-11 21:08:20.486 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-09-11 21:08:21.060 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1388.549ms
2025-09-11 21:08:22.270 +03:00 [INF] Setting cache for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:08:22.555 +03:00 [INF] Cache set successfully for key: cart:user:e682f183-1c61-400b-aa5a-171750f446b5 with tags: [cart]
2025-09-11 21:08:22.560 +03:00 [INF] Execute GetAll for entity ProductVariant
2025-09-11 21:08:22.663 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE `p`.`Id` = 4
2025-09-11 21:08:22.751 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-09-11 21:08:22.758 +03:00 [INF] Executing CreateAsync for entity Order
2025-09-11 21:08:22.763 +03:00 [INF] Order added successfully (pending save)
2025-09-11 21:08:22.930 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = Decimal), @p13='?' (DbType = Int32), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal), @p16='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `RestockedAt`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`, `RowVersion`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:08:23.018 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-09-11 21:08:23.026 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-09-11 21:08:23.032 +03:00 [INF] Removing 3 from variant: 4
2025-09-11 21:08:23.076 +03:00 [INF] Execute GetAll for entity CartItem
2025-09-11 21:08:23.080 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:23.088 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:23.118 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
UPDATE ProductVariants SET Quantity = Quantity - @p0 WHERE Id = @p1 AND Quantity >= @p0
2025-09-11 21:08:23.123 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 4
2025-09-11 21:08:23.200 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:08:23.232 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__cartItemId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE (`c`.`Id` = @__cartItemId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:08:23.242 +03:00 [INF] CartItem 87 price updated to 3374.08790000
2025-09-11 21:08:23.534 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p1='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary), @p0='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
UPDATE `CartItems` SET `UnitPrice` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 21:08:24.103 +03:00 [INF] Clearing cart: 3
2025-09-11 21:08:24.188 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`RowVersion`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-09-11 21:08:24.197 +03:00 [INF] Cart 3 cleared successfully
2025-09-11 21:08:24.363 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 8) (DbType = Binary), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = Decimal), @p11='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0 AND `RowVersion` IS NULL;
SELECT ROW_COUNT();

INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:08:24.476 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1396.9795ms
2025-09-11 21:08:24.784 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:08:24.786 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:08:24.789 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:08:24.791 +03:00 [INF] Execute GetAll for entity Order
2025-09-11 21:08:24.847 +03:00 [WRN] Compiling a query which loads related collections for more than one collection navigation, either via 'Include' or through projection, but no 'QuerySplittingBehavior' has been configured. By default, Entity Framework will use 'QuerySplittingBehavior.SingleQuery', which can potentially result in slow query performance. See https://go.microsoft.com/fwlink/?linkid=2134277 for more information. To identify the query that's triggering this warning call 'ConfigureWarnings(w => w.Throw(RelationalEventId.MultipleCollectionIncludeWarning))'.
2025-09-11 21:08:24.946 +03:00 [INF] Retrieving cart for user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:08:25.026 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[@__createdOrder_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`DeletedAt`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`Id0`, `p`.`Id`, `p`.`Amount`, `p`.`CreatedAt`, `p`.`CustomerId`, `p`.`DeletedAt`, `p`.`ModifiedAt`, `p`.`OrderId`, `p`.`PaymentDate`, `p`.`PaymentMethodId`, `p`.`PaymentProviderId`, `p`.`ProviderOrderId`, `p`.`RowVersion`, `p`.`Status`, `p`.`TransactionId`, `p0`.`Status`, `p0`.`Amount`, `p0`.`CreatedAt`, `p0`.`Id`, `p0`.`PaymentDate`, `p0`.`PaymentMethodId`, `p0`.`PaymentProviderId`, `t0`.`c`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`DeletedAt`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    WHERE `o`.`Id` = @__createdOrder_Id_0
    LIMIT 1
) AS `t0`
LEFT JOIN `Payments` AS `p` ON `t0`.`Id` = `p`.`OrderId`
LEFT JOIN `Payments` AS `p0` ON `t0`.`Id` = `p0`.`OrderId`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p1`.`Id` AS `Id0`, `p1`.`Name`, `p1`.`Price`, `p1`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p1`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p1`.`Price`))
        ELSE `p1`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p1`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p2`.`Color`, COALESCE(`p2`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p2`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p2`.`Size`, `p2`.`DeletedAt`, COALESCE(`p2`.`Length`, 0) AS `Length`, COALESCE(`p2`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p2`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p1` ON `o0`.`ProductId` = `p1`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p1`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p2` ON `o0`.`ProductVariantId` = `p2`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `p`.`Id`, `p0`.`Id`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-09-11 21:08:25.103 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`RowVersion`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`RowVersion`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-09-11 21:08:25.255 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-09-11 21:08:25.264 +03:00 [INF] Checkout date removed for cart of user: e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:08:26.256 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`RowVersion`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`RowVersion`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`RowVersion`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-09-11 21:08:26.559 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 8) (DbType = Binary)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `Quantity` = @p0
WHERE `Id` = @p1 AND `RowVersion` IS NULL;
SELECT `RowVersion`
FROM `Products`
WHERE ROW_COUNT() = 1 AND `Id` = @p1;
2025-09-11 21:08:26.638 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:26.645 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:27.881 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1243.1022ms
2025-09-11 21:08:27.954 +03:00 [INF] Removing cache by tags: [order]
2025-09-11 21:08:28.167 +03:00 [WRN] No cache entries found for tags: [order]
2025-09-11 21:08:28.435 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-09-11 21:08:28.867 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-09-11 21:08:29.360 +03:00 [INF] Removing cache by tag: CollectionWithProduct
2025-09-11 21:08:29.365 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 21:08:29.572 +03:00 [WRN] No cache entries found for tag: CollectionWithProduct
2025-09-11 21:08:29.787 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 21:08:29.906 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:29.914 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:30.359 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:08:30.413 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 10907.936ms
2025-09-11 21:08:30.420 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-09-11 21:08:30.423 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 201 1431 application/json; charset=utf-8 11251.5264ms
2025-09-11 21:08:30.605 +03:00 [INF] Removing cache by tag: subcategorywithdata
2025-09-11 21:08:30.855 +03:00 [WRN] No cache entries found for tag: subcategorywithdata
2025-09-11 21:08:31.047 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-09-11 21:08:31.297 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1391.4126ms
2025-09-11 21:08:31.490 +03:00 [INF] Removing cache by tags: [Product, Productwithdata]
2025-09-11 21:08:31.690 +03:00 [WRN] No cache entries found for tags: [collection, CollectionWithProduct]
2025-09-11 21:08:31.746 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-09-11 21:08:31.941 +03:00 [WRN] No cache entries found for tags: [Product, Productwithdata]
2025-09-11 21:08:32.163 +03:00 [WRN] No cache entries found for tags: [subcategory, subcategorywithdata]
2025-09-11 21:08:33.340 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:33.351 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:34.607 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1266.8428ms
2025-09-11 21:08:36.628 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:36.655 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:38.067 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1439.0792ms
2025-09-11 21:08:40.087 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:40.096 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:41.513 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1425.5637ms
2025-09-11 21:08:43.537 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:43.543 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:44.944 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1407.7781ms
2025-09-11 21:08:46.967 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:46.977 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:48.383 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1416.3213ms
2025-09-11 21:08:50.397 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:50.407 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:51.817 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1420.1828ms
2025-09-11 21:08:53.825 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:53.878 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:55.270 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1444.8529ms
2025-09-11 21:08:57.293 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:08:57.307 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:08:58.716 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1422.7269ms
2025-09-11 21:09:00.735 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:09:00.742 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:09:02.150 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1415.7779ms
2025-09-11 21:09:04.286 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:09:04.298 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:09:05.694 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1407.3965ms
2025-09-11 21:09:07.724 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:09:07.739 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:09:09.131 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1406.7218ms
2025-09-11 21:09:11.157 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:09:11.172 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:09:12.886 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1729.3256ms
2025-09-11 21:09:14.893 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:09:14.904 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:09:16.343 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1450.1501ms
2025-09-11 21:09:18.356 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:09:18.363 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:09:19.758 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1401.9843ms
2025-09-11 21:09:22.284 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:09:22.293 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:09:23.716 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1431.5996ms
2025-09-11 21:09:26.378 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:09:26.391 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:09:27.797 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1418.5709ms
2025-09-11 21:10:18.892 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:18.893 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:18.898 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:18.910 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:18.912 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:18.915 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:18.918 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:18.928 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:18.930 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:18.931 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:18.933 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:18.951 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:18.971 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:18.994 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.017 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.042 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.060 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.072 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.087 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.098 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.106 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.109 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.111 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.112 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.114 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.116 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.117 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.124 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.124 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.129 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.129 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.133 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.140 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.145 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.151 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.158 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.164 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.167 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.172 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.178 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.184 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-09-11 21:10:19.193 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.193 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.197 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.199 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.200 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.200 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.212 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.214 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.214 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 47.4415ms
2025-09-11 21:10:19.216 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.222 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.1076ms
2025-09-11 21:10:19.227 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 33.4642ms
2025-09-11 21:10:19.232 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.3472ms
2025-09-11 21:10:19.240 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 41.3144ms
2025-09-11 21:10:19.245 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 44.6581ms
2025-09-11 21:10:19.250 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 49.5132ms
2025-09-11 21:10:19.258 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 46.1398ms
2025-09-11 21:10:19.262 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 48.6881ms
2025-09-11 21:10:19.272 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.277 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 61.6974ms
2025-09-11 21:10:19.284 +03:00 [INF] Executed DbCommand (92ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.292 +03:00 [INF] Executed DbCommand (100ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.343 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.350 +03:00 [INF] Executed DbCommand (158ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.356 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.371 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.366 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.367 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.360 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.384 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.388 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.392 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.392 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.393 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.397 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.408 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.408 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.408 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.408 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.411 +03:00 [INF] Executed DbCommand (219ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.413 +03:00 [INF] Executed DbCommand (221ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.416 +03:00 [INF] Executed DbCommand (223ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.418 +03:00 [INF] Executed DbCommand (225ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.424 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.429 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.450 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.446 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.448 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.439 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.458 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.465 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.472 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.482 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.478 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.482 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.476 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.490 +03:00 [INF] Executed DbCommand (291ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.491 +03:00 [INF] Executed DbCommand (291ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.501 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.514 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.517 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.528 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.531 +03:00 [INF] Executed DbCommand (259ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.533 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.546 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.546 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.588 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.600 +03:00 [INF] Executed DbCommand (328ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.623 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.633 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.647 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.694 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.711 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.715 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.725 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.727 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.739 +03:00 [INF] Executed DbCommand (321ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.766 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.750 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.775 +03:00 [INF] Executed DbCommand (287ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.748 +03:00 [INF] Executed DbCommand (263ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.772 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.758 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.788 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.795 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.799 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.801 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.810 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.812 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.813 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.816 +03:00 [INF] Executed DbCommand (327ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.825 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.828 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.831 +03:00 [INF] Executed DbCommand (301ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.857 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.859 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.860 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.864 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.868 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.879 +03:00 [INF] Executed DbCommand (349ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.881 +03:00 [INF] Executed DbCommand (351ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.883 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.894 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.899 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.910 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.915 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.929 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.940 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.942 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.944 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.950 +03:00 [INF] Executed DbCommand (419ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-09-11 21:10:19.957 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.962 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:19.974 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.976 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:19.977 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.978 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:19.984 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 9.7794ms
2025-09-11 21:10:19.989 +03:00 [INF] Route matched with {action = "CreatePayment", controller = "Payment"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto]]] CreatePayment(CreatePaymentRequestDto) on controller E_Commerce.Controllers.PaymentController (E-Commerce).
2025-09-11 21:10:19.992 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.993 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.993 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.993 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.993 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.994 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.994 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:19.995 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.007 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.009 +03:00 [INF] Executing CreatePayment for order: ORD-20250911180822-8048
2025-09-11 21:10:20.015 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 22.9997ms
2025-09-11 21:10:20.022 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 29.7167ms
2025-09-11 21:10:20.026 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 33.3737ms
2025-09-11 21:10:20.032 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 38.9374ms
2025-09-11 21:10:20.040 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 46.7492ms
2025-09-11 21:10:20.047 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 53.6503ms
2025-09-11 21:10:20.051 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 57.4781ms
2025-09-11 21:10:20.057 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 62.4842ms
2025-09-11 21:10:20.062 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 54.507ms
2025-09-11 21:10:20.063 +03:00 [INF] Starting CreatePaymentMethod for order ORD-20250911180822-8048 by user e682f183-1c61-400b-aa5a-171750f446b5
2025-09-11 21:10:20.073 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.077 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.083 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.091 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.098 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.107 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.113 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.123 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.129 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.132 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.142 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.142 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.143 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.143 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.145 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.147 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.149 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.157 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 33.7221ms
2025-09-11 21:10:20.162 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.4336ms
2025-09-11 21:10:20.167 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.2794ms
2025-09-11 21:10:20.174 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 31.2702ms
2025-09-11 21:10:20.179 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 36.5103ms
2025-09-11 21:10:20.181 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.188 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 44.8773ms
2025-09-11 21:10:20.192 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 47.0616ms
2025-09-11 21:10:20.199 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 51.2706ms
2025-09-11 21:10:20.210 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 60.7859ms
2025-09-11 21:10:20.215 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.224 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.229 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.234 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.241 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.242 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.248 +03:00 [INF] Executed DbCommand (106ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.254 +03:00 [INF] Executed DbCommand (112ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.259 +03:00 [INF] Executed DbCommand (117ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.265 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.267 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.268 +03:00 [INF] Executed DbCommand (125ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.271 +03:00 [INF] Executed DbCommand (124ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.273 +03:00 [INF] Executed DbCommand (128ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.274 +03:00 [INF] Executed DbCommand (125ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.275 +03:00 [INF] Executed DbCommand (95ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.282 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.287 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.291 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.292 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.294 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.297 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.301 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.306 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.310 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.313 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.317 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 35.1952ms
2025-09-11 21:10:20.323 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 36.2702ms
2025-09-11 21:10:20.328 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 37.1542ms
2025-09-11 21:10:20.332 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 39.5086ms
2025-09-11 21:10:20.337 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 42.9542ms
2025-09-11 21:10:20.342 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 44.5256ms
2025-09-11 21:10:20.346 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 45.1096ms
2025-09-11 21:10:20.350 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 43.8145ms
2025-09-11 21:10:20.356 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 46.3114ms
2025-09-11 21:10:20.362 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 48.5556ms
2025-09-11 21:10:20.370 +03:00 [INF] Executed DbCommand (127ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.378 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.384 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.392 +03:00 [INF] Executed DbCommand (126ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.399 +03:00 [INF] Executed DbCommand (131ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.408 +03:00 [INF] Executed DbCommand (138ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.415 +03:00 [INF] Executed DbCommand (143ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.424 +03:00 [INF] Executed DbCommand (150ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.430 +03:00 [INF] Executed DbCommand (155ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.439 +03:00 [INF] Executed DbCommand (157ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:20.444 +03:00 [INF] Executed DbCommand (152ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.446 +03:00 [INF] Executed DbCommand (152ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.447 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.452 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.456 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.460 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.463 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.467 +03:00 [INF] Getting order by number: ORD-20250911180822-8048
2025-09-11 21:10:20.472 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.478 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.483 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.484 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:20.489 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 42.0153ms
2025-09-11 21:10:20.493 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 41.0568ms
2025-09-11 21:10:20.496 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 40.0471ms
2025-09-11 21:10:20.500 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 40.8405ms
2025-09-11 21:10:20.506 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 43.3211ms
2025-09-11 21:10:20.508 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.511 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 39.4529ms
2025-09-11 21:10:20.516 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 37.3806ms
2025-09-11 21:10:20.522 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 39.3042ms
2025-09-11 21:10:20.524 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:20.529 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.535 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.541 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.548 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.554 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.558 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 50.4763ms
2025-09-11 21:10:20.564 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.571 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.583 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.595 +03:00 [INF] Executed DbCommand (87ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`RowVersion`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`OrderNumber` = @__orderNumber_0
LIMIT 1
2025-09-11 21:10:20.607 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.610 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.613 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 71.2731ms
2025-09-11 21:10:20.616 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 68.5214ms
2025-09-11 21:10:20.623 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 68.2881ms
2025-09-11 21:10:20.629 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.634 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 69.5263ms
2025-09-11 21:10:20.642 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 70.7269ms
2025-09-11 21:10:20.647 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 64.6259ms
2025-09-11 21:10:20.656 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.661 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 54.4216ms
2025-09-11 21:10:20.666 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 55.7692ms
2025-09-11 21:10:20.681 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:20.705 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 75.8348ms
2025-09-11 21:10:20.732 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 75.9984ms
2025-09-11 21:10:20.744 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.749 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:20.755 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.761 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.766 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 22.3408ms
2025-09-11 21:10:20.771 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:20.774 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 19.1331ms
2025-09-11 21:10:20.779 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 18.0372ms
2025-09-11 21:10:20.787 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.822 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 34.4999ms
2025-09-11 21:10:20.802 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.812 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.796 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.831 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.838 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 36.5178ms
2025-09-11 21:10:20.844 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 32.1626ms
2025-09-11 21:10:20.848 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 52.2259ms
2025-09-11 21:10:20.855 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 23.6802ms
2025-09-11 21:10:20.862 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.868 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:20.875 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.883 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.889 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 27.0547ms
2025-09-11 21:10:20.898 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 22.9881ms
2025-09-11 21:10:20.904 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 21.0693ms
2025-09-11 21:10:20.911 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.917 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.922 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:20.924 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.929 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 18.7185ms
2025-09-11 21:10:20.934 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 17.4272ms
2025-09-11 21:10:20.938 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.943 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 18.7832ms
2025-09-11 21:10:20.950 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.959 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.964 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 26.0139ms
2025-09-11 21:10:20.974 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.978 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 28.5228ms
2025-09-11 21:10:20.982 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 23.0567ms
2025-09-11 21:10:20.991 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:20.995 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 20.9356ms
2025-09-11 21:10:21.023 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:21.028 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:21.032 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 41.1506ms
2025-09-11 21:10:21.050 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:21.070 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:21.100 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 71.4783ms
2025-09-11 21:10:21.108 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Payment - application/json; charset=utf-8 114
2025-09-11 21:10:21.117 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 67.3089ms
2025-09-11 21:10:21.118 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:21.201 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 429 null application/json 92.5491ms
2025-09-11 21:10:21.250 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:21.845 +03:00 [INF] Received HTTP response headers after 576.8505ms - 201
2025-09-11 21:10:21.848 +03:00 [INF] End processing HTTP request after 729.3605ms - 201
2025-09-11 21:10:21.854 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:21.945 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:21.967 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:22.068 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:22.104 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:22.111 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:22.384 +03:00 [INF] Received HTTP response headers after 268.2588ms - 201
2025-09-11 21:10:22.389 +03:00 [INF] End processing HTTP request after 284.9903ms - 201
2025-09-11 21:10:22.409 +03:00 [INF] Successfully created PayMob order: 384525773 for local order: ORD-20250911180822-8048
2025-09-11 21:10:22.413 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:22.496 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:22.516 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:22.525 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384525773, Amount: 1012226
2025-09-11 21:10:22.532 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:22.535 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:22.770 +03:00 [INF] Received HTTP response headers after 226.4411ms - 201
2025-09-11 21:10:22.776 +03:00 [INF] End processing HTTP request after 243.5753ms - 201
2025-09-11 21:10:22.779 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:22.781 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:22.782 +03:00 [INF] Payment key generated successfully for Order ID: 384525773
2025-09-11 21:10:22.785 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:22.792 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:22.870 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:22.878 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:22.885 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:22.889 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:22.891 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:22.892 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:23.066 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:23.234 +03:00 [INF] Payment created successfully with ID 91
2025-09-11 21:10:23.235 +03:00 [INF] Executed DbCommand (2,949ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:23.243 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:23.245 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:23.321 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:23.328 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:23.332 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:23.408 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:23.415 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:23.491 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:23.501 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:23.505 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:23.508 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:23.736 +03:00 [INF] Received HTTP response headers after 226.5452ms - 201
2025-09-11 21:10:23.742 +03:00 [INF] End processing HTTP request after 237.4015ms - 201
2025-09-11 21:10:23.747 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:23.826 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:23.834 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:23.923 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:23.943 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:23.949 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:24.120 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:24.127 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 4747.5635ms
2025-09-11 21:10:24.131 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:24.134 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 200 1365 application/json; charset=utf-8 5235.3532ms
2025-09-11 21:10:24.173 +03:00 [INF] Received HTTP response headers after 217.0885ms - 201
2025-09-11 21:10:24.176 +03:00 [INF] End processing HTTP request after 233.0732ms - 201
2025-09-11 21:10:24.179 +03:00 [INF] Successfully created PayMob order: 384525793 for local order: ORD-20250911180822-8048
2025-09-11 21:10:24.182 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:24.257 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:24.263 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:24.266 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384525793, Amount: 1012226
2025-09-11 21:10:24.270 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:24.273 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:24.497 +03:00 [INF] Received HTTP response headers after 220.8321ms - 201
2025-09-11 21:10:24.508 +03:00 [INF] End processing HTTP request after 238.5269ms - 201
2025-09-11 21:10:24.517 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:24.524 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:24.530 +03:00 [INF] Payment key generated successfully for Order ID: 384525793
2025-09-11 21:10:24.534 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:24.537 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:24.612 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:24.619 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:24.624 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:24.626 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:24.630 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:24.632 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:24.800 +03:00 [ERR] Failed executing DbCommand (91ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:25.026 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:10:25.049 +03:00 [WRN] Unique constraint violation while creating payment. Order: ORD-20250911180822-8048, User: e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 291
2025-09-11 21:10:25.155 +03:00 [INF] Executed DbCommand (4,865ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:25.164 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:25.165 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:25.166 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:25.171 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 5702.7733ms
2025-09-11 21:10:25.178 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:25.181 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 409 330 application/json; charset=utf-8 6268.9155ms
2025-09-11 21:10:25.248 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:25.255 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:25.259 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:25.334 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:25.371 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:25.447 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:25.464 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:25.466 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:25.471 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:25.702 +03:00 [INF] Received HTTP response headers after 224.0071ms - 201
2025-09-11 21:10:25.707 +03:00 [INF] End processing HTTP request after 240.9073ms - 201
2025-09-11 21:10:25.710 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:25.788 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:25.798 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:25.881 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:25.906 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:25.913 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:26.139 +03:00 [INF] Received HTTP response headers after 221.9164ms - 201
2025-09-11 21:10:26.143 +03:00 [INF] End processing HTTP request after 237.6222ms - 201
2025-09-11 21:10:26.149 +03:00 [INF] Successfully created PayMob order: 384525815 for local order: ORD-20250911180822-8048
2025-09-11 21:10:26.151 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:26.228 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:26.239 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:26.244 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384525815, Amount: 1012226
2025-09-11 21:10:26.247 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:26.250 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:26.477 +03:00 [INF] Received HTTP response headers after 222.1167ms - 201
2025-09-11 21:10:26.486 +03:00 [INF] End processing HTTP request after 239.045ms - 201
2025-09-11 21:10:26.496 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:26.507 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:26.512 +03:00 [INF] Payment key generated successfully for Order ID: 384525815
2025-09-11 21:10:26.516 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:26.518 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:26.596 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:26.606 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:26.608 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:26.611 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:26.613 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:26.615 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:26.766 +03:00 [ERR] Failed executing DbCommand (78ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:26.921 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:10:26.946 +03:00 [WRN] Unique constraint violation while creating payment. Order: ORD-20250911180822-8048, User: e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 291
2025-09-11 21:10:27.041 +03:00 [INF] Executed DbCommand (6,743ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:27.041 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:27.049 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:27.052 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 7656.3986ms
2025-09-11 21:10:27.056 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:27.059 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:27.063 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 409 330 application/json; charset=utf-8 8170.5669ms
2025-09-11 21:10:27.134 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:27.148 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:27.157 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:27.239 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:27.246 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:27.322 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:27.332 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:27.335 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:27.342 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:27.563 +03:00 [INF] Received HTTP response headers after 219.189ms - 201
2025-09-11 21:10:27.568 +03:00 [INF] End processing HTTP request after 232.8674ms - 201
2025-09-11 21:10:27.573 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:27.664 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:27.677 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:27.762 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:27.772 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:27.775 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:27.986 +03:00 [INF] Received HTTP response headers after 208.4827ms - 201
2025-09-11 21:10:27.989 +03:00 [INF] End processing HTTP request after 217.8789ms - 201
2025-09-11 21:10:27.992 +03:00 [INF] Successfully created PayMob order: 384525834 for local order: ORD-20250911180822-8048
2025-09-11 21:10:27.994 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:28.078 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:28.089 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:28.094 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384525834, Amount: 1012226
2025-09-11 21:10:28.101 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:28.108 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:28.351 +03:00 [INF] Received HTTP response headers after 233.6376ms - 201
2025-09-11 21:10:28.358 +03:00 [INF] End processing HTTP request after 256.9319ms - 201
2025-09-11 21:10:28.364 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:28.371 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:28.382 +03:00 [INF] Payment key generated successfully for Order ID: 384525834
2025-09-11 21:10:28.385 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:28.389 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:28.466 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:28.473 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:28.475 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:28.477 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:28.480 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:28.482 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:28.651 +03:00 [ERR] Failed executing DbCommand (88ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:28.808 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:10:28.827 +03:00 [WRN] Unique constraint violation while creating payment. Order: ORD-20250911180822-8048, User: e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 291
2025-09-11 21:10:28.918 +03:00 [INF] Executed DbCommand (8,617ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:28.919 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:28.933 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:28.942 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 9549.4051ms
2025-09-11 21:10:28.948 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:28.956 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:28.971 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 409 330 application/json; charset=utf-8 10060.4397ms
2025-09-11 21:10:29.037 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:29.044 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:29.047 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:29.123 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:29.141 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:29.221 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:29.233 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:29.236 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:29.240 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:29.463 +03:00 [INF] Received HTTP response headers after 220.6569ms - 201
2025-09-11 21:10:29.481 +03:00 [INF] End processing HTTP request after 244.8386ms - 201
2025-09-11 21:10:29.490 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:29.570 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:29.614 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:29.697 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:29.708 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:29.710 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:29.922 +03:00 [INF] Received HTTP response headers after 208.631ms - 201
2025-09-11 21:10:29.926 +03:00 [INF] End processing HTTP request after 218.3458ms - 201
2025-09-11 21:10:29.929 +03:00 [INF] Successfully created PayMob order: 384525857 for local order: ORD-20250911180822-8048
2025-09-11 21:10:29.932 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:30.007 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:30.016 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:30.019 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384525857, Amount: 1012226
2025-09-11 21:10:30.023 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:30.025 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:30.257 +03:00 [INF] Received HTTP response headers after 229.4904ms - 201
2025-09-11 21:10:30.263 +03:00 [INF] End processing HTTP request after 240.0152ms - 201
2025-09-11 21:10:30.267 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:30.272 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:30.276 +03:00 [INF] Payment key generated successfully for Order ID: 384525857
2025-09-11 21:10:30.279 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:30.281 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:30.356 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:30.367 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:30.370 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:30.372 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:30.374 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:30.375 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:30.528 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:30.688 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:10:30.708 +03:00 [WRN] Unique constraint violation while creating payment. Order: ORD-20250911180822-8048, User: e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 291
2025-09-11 21:10:30.799 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:30.799 +03:00 [INF] Executed DbCommand (10,493ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:30.805 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 11349.88ms
2025-09-11 21:10:30.810 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:30.813 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:30.816 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:30.818 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 409 330 application/json; charset=utf-8 11903.268ms
2025-09-11 21:10:30.896 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:30.907 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:30.910 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:30.986 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:31.021 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:31.099 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:31.113 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:31.119 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:31.135 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:31.368 +03:00 [INF] Received HTTP response headers after 221.4544ms - 201
2025-09-11 21:10:31.373 +03:00 [INF] End processing HTTP request after 254.1148ms - 201
2025-09-11 21:10:31.377 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:31.456 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:31.464 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:31.547 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:31.568 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:31.581 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:31.815 +03:00 [INF] Received HTTP response headers after 227.4947ms - 201
2025-09-11 21:10:31.824 +03:00 [INF] End processing HTTP request after 255.4393ms - 201
2025-09-11 21:10:31.828 +03:00 [INF] Successfully created PayMob order: 384525878 for local order: ORD-20250911180822-8048
2025-09-11 21:10:31.831 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:31.908 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:31.920 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:31.927 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384525878, Amount: 1012226
2025-09-11 21:10:31.933 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:31.939 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:32.168 +03:00 [INF] Received HTTP response headers after 224.6235ms - 201
2025-09-11 21:10:32.180 +03:00 [INF] End processing HTTP request after 246.4375ms - 201
2025-09-11 21:10:32.192 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:32.201 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:32.211 +03:00 [INF] Payment key generated successfully for Order ID: 384525878
2025-09-11 21:10:32.217 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:32.222 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:32.299 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:32.310 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:32.314 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:32.315 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:32.317 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:32.320 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:32.475 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:32.647 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:10:32.677 +03:00 [WRN] Unique constraint violation while creating payment. Order: ORD-20250911180822-8048, User: e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 291
2025-09-11 21:10:32.765 +03:00 [INF] Executed DbCommand (12,455ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:32.766 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:32.774 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:32.777 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 13400.6505ms
2025-09-11 21:10:32.779 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:32.782 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:32.788 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 409 330 application/json; charset=utf-8 13896.4749ms
2025-09-11 21:10:32.859 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:32.868 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:32.871 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:32.947 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:32.956 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:33.031 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:33.041 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:33.044 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:33.047 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:33.268 +03:00 [INF] Received HTTP response headers after 217.6528ms - 201
2025-09-11 21:10:33.283 +03:00 [INF] End processing HTTP request after 238.5499ms - 201
2025-09-11 21:10:33.295 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:33.376 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:33.387 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:33.472 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:33.483 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:33.488 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:33.699 +03:00 [INF] Received HTTP response headers after 207.6455ms - 201
2025-09-11 21:10:33.707 +03:00 [INF] End processing HTTP request after 224.3275ms - 201
2025-09-11 21:10:33.714 +03:00 [INF] Successfully created PayMob order: 384525900 for local order: ORD-20250911180822-8048
2025-09-11 21:10:33.718 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:33.796 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:33.804 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:33.812 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384525900, Amount: 1012226
2025-09-11 21:10:33.831 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:33.860 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:34.092 +03:00 [INF] Received HTTP response headers after 230.1865ms - 201
2025-09-11 21:10:34.097 +03:00 [INF] End processing HTTP request after 265.2233ms - 201
2025-09-11 21:10:34.101 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:34.105 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:34.108 +03:00 [INF] Payment key generated successfully for Order ID: 384525900
2025-09-11 21:10:34.109 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:34.111 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:34.188 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:34.196 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:34.199 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:34.201 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:34.204 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:34.208 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:34.358 +03:00 [ERR] Failed executing DbCommand (76ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:34.508 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:10:34.522 +03:00 [WRN] Unique constraint violation while creating payment. Order: ORD-20250911180822-8048, User: e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 291
2025-09-11 21:10:34.606 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:34.606 +03:00 [INF] Executed DbCommand (14,293ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:34.609 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 15128.111ms
2025-09-11 21:10:34.613 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:34.615 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:34.616 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:34.618 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 409 330 application/json; charset=utf-8 15690.2452ms
2025-09-11 21:10:34.692 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:34.696 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:34.698 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:34.773 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:34.779 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:34.853 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:34.862 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:34.864 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:34.867 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:35.090 +03:00 [INF] Received HTTP response headers after 219.7749ms - 201
2025-09-11 21:10:35.108 +03:00 [INF] End processing HTTP request after 244.2523ms - 201
2025-09-11 21:10:35.122 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:35.201 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:35.209 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:35.291 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:35.302 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:35.307 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:35.537 +03:00 [INF] Received HTTP response headers after 213.2335ms - 201
2025-09-11 21:10:35.539 +03:00 [INF] End processing HTTP request after 237.2389ms - 201
2025-09-11 21:10:35.542 +03:00 [INF] Successfully created PayMob order: 384525933 for local order: ORD-20250911180822-8048
2025-09-11 21:10:35.544 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:35.619 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:35.627 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:35.630 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384525933, Amount: 1012226
2025-09-11 21:10:35.633 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:35.637 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:35.877 +03:00 [INF] Received HTTP response headers after 235.5378ms - 201
2025-09-11 21:10:35.882 +03:00 [INF] End processing HTTP request after 248.4034ms - 201
2025-09-11 21:10:35.887 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:35.890 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:35.895 +03:00 [INF] Payment key generated successfully for Order ID: 384525933
2025-09-11 21:10:35.898 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:35.901 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:35.978 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:35.990 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:35.993 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:35.995 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:35.996 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:35.998 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:36.154 +03:00 [ERR] Failed executing DbCommand (79ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:36.310 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:10:36.339 +03:00 [WRN] Unique constraint violation while creating payment. Order: ORD-20250911180822-8048, User: e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 291
2025-09-11 21:10:36.438 +03:00 [INF] Executed DbCommand (15,994ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:36.438 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:36.446 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:36.450 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 16937.2589ms
2025-09-11 21:10:36.452 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:36.457 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:36.461 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 409 330 application/json; charset=utf-8 17542.7218ms
2025-09-11 21:10:36.535 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:36.543 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:36.547 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:36.624 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:36.645 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:36.723 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:36.750 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:36.754 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:36.757 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:36.980 +03:00 [INF] Received HTTP response headers after 219.3069ms - 201
2025-09-11 21:10:36.984 +03:00 [INF] End processing HTTP request after 229.6854ms - 201
2025-09-11 21:10:36.990 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:37.069 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:37.093 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:37.182 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:37.194 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:37.199 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:37.417 +03:00 [INF] Received HTTP response headers after 213.3846ms - 201
2025-09-11 21:10:37.421 +03:00 [INF] End processing HTTP request after 226.5693ms - 201
2025-09-11 21:10:37.425 +03:00 [INF] Successfully created PayMob order: 384525953 for local order: ORD-20250911180822-8048
2025-09-11 21:10:37.430 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:37.506 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:37.514 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:37.518 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384525953, Amount: 1012226
2025-09-11 21:10:37.524 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:37.527 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:37.751 +03:00 [INF] Received HTTP response headers after 220.2095ms - 201
2025-09-11 21:10:37.755 +03:00 [INF] End processing HTTP request after 231.343ms - 201
2025-09-11 21:10:37.759 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:37.761 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:37.764 +03:00 [INF] Payment key generated successfully for Order ID: 384525953
2025-09-11 21:10:37.766 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:37.769 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:37.847 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:37.860 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:37.862 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:37.864 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:37.865 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:37.867 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:38.024 +03:00 [ERR] Failed executing DbCommand (78ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:38.214 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:10:38.232 +03:00 [WRN] Unique constraint violation while creating payment. Order: ORD-20250911180822-8048, User: e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 291
2025-09-11 21:10:38.324 +03:00 [INF] Executed DbCommand (17,872ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:38.326 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:38.332 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:38.334 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 18718.1506ms
2025-09-11 21:10:38.336 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:38.343 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:38.347 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 409 330 application/json; charset=utf-8 19413.9858ms
2025-09-11 21:10:38.420 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:38.427 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:38.430 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:38.506 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:38.516 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:38.591 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:38.599 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:38.600 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:38.605 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:38.829 +03:00 [INF] Received HTTP response headers after 219.4849ms - 201
2025-09-11 21:10:38.835 +03:00 [INF] End processing HTTP request after 234.218ms - 201
2025-09-11 21:10:38.840 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:38.918 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:38.936 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:39.024 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:39.034 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:39.039 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:39.255 +03:00 [INF] Received HTTP response headers after 212.6473ms - 201
2025-09-11 21:10:39.259 +03:00 [INF] End processing HTTP request after 225.2349ms - 201
2025-09-11 21:10:39.264 +03:00 [INF] Successfully created PayMob order: 384525977 for local order: ORD-20250911180822-8048
2025-09-11 21:10:39.268 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:39.345 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:39.352 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:39.357 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384525977, Amount: 1012226
2025-09-11 21:10:39.361 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:39.364 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:39.592 +03:00 [INF] Received HTTP response headers after 225.59ms - 201
2025-09-11 21:10:39.598 +03:00 [INF] End processing HTTP request after 236.8481ms - 201
2025-09-11 21:10:39.600 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:39.602 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:39.605 +03:00 [INF] Payment key generated successfully for Order ID: 384525977
2025-09-11 21:10:39.610 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:39.614 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:39.688 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:39.698 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:39.700 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:39.701 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:39.704 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:39.706 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:39.861 +03:00 [ERR] Failed executing DbCommand (79ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:40.030 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:10:40.072 +03:00 [WRN] Unique constraint violation while creating payment. Order: ORD-20250911180822-8048, User: e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 291
2025-09-11 21:10:40.166 +03:00 [INF] Executed DbCommand (19,709ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:40.167 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:40.177 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:40.181 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 20548.9718ms
2025-09-11 21:10:40.185 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:40.191 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:40.196 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 409 330 application/json; charset=utf-8 21264.4683ms
2025-09-11 21:10:40.265 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:40.274 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:40.276 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:40.351 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:40.361 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:40.437 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:40.446 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:40.448 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:40.451 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:40.678 +03:00 [INF] Received HTTP response headers after 222.4386ms - 201
2025-09-11 21:10:40.684 +03:00 [INF] End processing HTTP request after 236.0208ms - 201
2025-09-11 21:10:40.689 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:40.767 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:40.775 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:40.856 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:40.865 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:40.868 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:41.087 +03:00 [INF] Received HTTP response headers after 213.7912ms - 201
2025-09-11 21:10:41.090 +03:00 [INF] End processing HTTP request after 225.0417ms - 201
2025-09-11 21:10:41.093 +03:00 [INF] Successfully created PayMob order: 384525993 for local order: ORD-20250911180822-8048
2025-09-11 21:10:41.097 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:41.172 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:41.180 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:41.182 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384525993, Amount: 1012226
2025-09-11 21:10:41.185 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:41.189 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:41.419 +03:00 [INF] Received HTTP response headers after 225.9433ms - 201
2025-09-11 21:10:41.424 +03:00 [INF] End processing HTTP request after 238.6483ms - 201
2025-09-11 21:10:41.429 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:41.431 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:41.433 +03:00 [INF] Payment key generated successfully for Order ID: 384525993
2025-09-11 21:10:41.435 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:41.438 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:41.514 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:41.526 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:41.528 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:41.530 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:41.531 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:41.533 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:41.683 +03:00 [ERR] Failed executing DbCommand (76ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:41.840 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:10:41.860 +03:00 [WRN] Unique constraint violation while creating payment. Order: ORD-20250911180822-8048, User: e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 291
2025-09-11 21:10:41.946 +03:00 [INF] Executed DbCommand (21,487ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:41.947 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:41.955 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:41.958 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 22201.3945ms
2025-09-11 21:10:41.960 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:41.963 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:41.967 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 409 330 application/json; charset=utf-8 22858.0707ms
2025-09-11 21:10:42.038 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:42.048 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:42.051 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:42.127 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:42.139 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:42.215 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:42.236 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:42.240 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:42.246 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:42.473 +03:00 [INF] Received HTTP response headers after 222.5151ms - 201
2025-09-11 21:10:42.478 +03:00 [INF] End processing HTTP request after 237.77ms - 201
2025-09-11 21:10:42.480 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:42.558 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:42.563 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:42.644 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:42.652 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:42.658 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:42.870 +03:00 [INF] Received HTTP response headers after 208.6604ms - 201
2025-09-11 21:10:42.878 +03:00 [INF] End processing HTTP request after 225.0564ms - 201
2025-09-11 21:10:42.882 +03:00 [INF] Successfully created PayMob order: 384526017 for local order: ORD-20250911180822-8048
2025-09-11 21:10:42.885 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:42.962 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:42.971 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:42.974 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384526017, Amount: 1012226
2025-09-11 21:10:42.977 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:42.980 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:43.201 +03:00 [INF] Received HTTP response headers after 218.8257ms - 201
2025-09-11 21:10:43.207 +03:00 [INF] End processing HTTP request after 229.8787ms - 201
2025-09-11 21:10:43.212 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:43.214 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:43.216 +03:00 [INF] Payment key generated successfully for Order ID: 384526017
2025-09-11 21:10:43.217 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:43.220 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:43.299 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:43.308 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:43.311 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:43.312 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:43.314 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:43.315 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:43.468 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:43.637 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:10:43.664 +03:00 [WRN] Unique constraint violation while creating payment. Order: ORD-20250911180822-8048, User: e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 291
2025-09-11 21:10:43.797 +03:00 [INF] Executed DbCommand (23,334ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:43.797 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:43.804 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:43.809 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 24084.7545ms
2025-09-11 21:10:43.815 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:43.829 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:43.833 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 409 330 application/json; charset=utf-8 24746.5803ms
2025-09-11 21:10:43.905 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:43.909 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:43.912 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:43.988 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:44.000 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:44.077 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:44.085 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:44.094 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:44.099 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:44.324 +03:00 [INF] Received HTTP response headers after 222.6431ms - 201
2025-09-11 21:10:44.341 +03:00 [INF] End processing HTTP request after 246.3177ms - 201
2025-09-11 21:10:44.358 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:44.440 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:44.449 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:44.535 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:44.545 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:44.547 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:44.778 +03:00 [INF] Received HTTP response headers after 228.5563ms - 201
2025-09-11 21:10:44.783 +03:00 [INF] End processing HTTP request after 238.3048ms - 201
2025-09-11 21:10:44.789 +03:00 [INF] Successfully created PayMob order: 384526045 for local order: ORD-20250911180822-8048
2025-09-11 21:10:44.793 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:44.869 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:44.879 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:44.883 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384526045, Amount: 1012226
2025-09-11 21:10:44.886 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:44.892 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:45.118 +03:00 [INF] Received HTTP response headers after 223.3052ms - 201
2025-09-11 21:10:45.130 +03:00 [INF] End processing HTTP request after 244.191ms - 201
2025-09-11 21:10:45.136 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:45.143 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:45.147 +03:00 [INF] Payment key generated successfully for Order ID: 384526045
2025-09-11 21:10:45.150 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:45.152 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:45.231 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:45.242 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:45.250 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:45.252 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:45.255 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:45.257 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:45.410 +03:00 [ERR] Failed executing DbCommand (78ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:45.580 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:10:45.601 +03:00 [WRN] Unique constraint violation while creating payment. Order: ORD-20250911180822-8048, User: e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 291
2025-09-11 21:10:45.692 +03:00 [INF] Executed DbCommand (25,225ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:45.692 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:45.697 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:45.702 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 25903.6128ms
2025-09-11 21:10:45.704 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:45.708 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:45.712 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 409 330 application/json; charset=utf-8 26599.7338ms
2025-09-11 21:10:45.784 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:45.792 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:45.795 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:45.874 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:45.883 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:45.960 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:45.972 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:45.976 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:45.979 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:46.200 +03:00 [INF] Received HTTP response headers after 217.7485ms - 201
2025-09-11 21:10:46.206 +03:00 [INF] End processing HTTP request after 229.9014ms - 201
2025-09-11 21:10:46.212 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:46.291 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:46.299 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:46.385 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:46.395 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:46.398 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:46.615 +03:00 [INF] Received HTTP response headers after 211.0992ms - 201
2025-09-11 21:10:46.623 +03:00 [INF] End processing HTTP request after 227.6173ms - 201
2025-09-11 21:10:46.625 +03:00 [INF] Successfully created PayMob order: 384526067 for local order: ORD-20250911180822-8048
2025-09-11 21:10:46.628 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:46.705 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:46.711 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:46.714 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384526067, Amount: 1012226
2025-09-11 21:10:46.717 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:46.719 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:46.942 +03:00 [INF] Received HTTP response headers after 219.4666ms - 201
2025-09-11 21:10:46.948 +03:00 [INF] End processing HTTP request after 230.9096ms - 201
2025-09-11 21:10:46.952 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:46.956 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:46.958 +03:00 [INF] Payment key generated successfully for Order ID: 384526067
2025-09-11 21:10:46.960 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:46.962 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:47.039 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:47.047 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:47.049 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:47.051 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:47.054 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:47.060 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:47.216 +03:00 [ERR] Failed executing DbCommand (79ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:47.388 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:10:47.406 +03:00 [WRN] Unique constraint violation while creating payment. Order: ORD-20250911180822-8048, User: e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 291
2025-09-11 21:10:47.496 +03:00 [INF] Executed DbCommand (27,024ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:47.496 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:47.506 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:47.510 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 27686.3142ms
2025-09-11 21:10:47.512 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:47.515 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:47.522 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 409 330 application/json; charset=utf-8 28410.5525ms
2025-09-11 21:10:47.590 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:47.599 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:47.602 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:47.683 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:47.693 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:47.769 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:47.779 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:47.781 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:47.784 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:48.003 +03:00 [INF] Received HTTP response headers after 216.5379ms - 201
2025-09-11 21:10:48.027 +03:00 [INF] End processing HTTP request after 245.8914ms - 201
2025-09-11 21:10:48.032 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:48.118 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:48.124 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:48.208 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:48.222 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:48.225 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:48.437 +03:00 [INF] Received HTTP response headers after 208.2638ms - 201
2025-09-11 21:10:48.443 +03:00 [INF] End processing HTTP request after 220.5425ms - 201
2025-09-11 21:10:48.448 +03:00 [INF] Successfully created PayMob order: 384526087 for local order: ORD-20250911180822-8048
2025-09-11 21:10:48.450 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:48.527 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:48.536 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:48.540 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384526087, Amount: 1012226
2025-09-11 21:10:48.543 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:48.546 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:48.776 +03:00 [INF] Received HTTP response headers after 228.2446ms - 201
2025-09-11 21:10:48.782 +03:00 [INF] End processing HTTP request after 239.5344ms - 201
2025-09-11 21:10:48.788 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:48.792 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:48.794 +03:00 [INF] Payment key generated successfully for Order ID: 384526087
2025-09-11 21:10:48.796 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:48.797 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:48.873 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:48.881 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:48.884 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:48.887 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:48.889 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:48.891 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:49.049 +03:00 [ERR] Failed executing DbCommand (82ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:49.207 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:10:49.231 +03:00 [WRN] Unique constraint violation while creating payment. Order: ORD-20250911180822-8048, User: e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 291
2025-09-11 21:10:49.318 +03:00 [INF] Executed DbCommand (28,840ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:49.320 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:49.328 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:49.333 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 29505.1817ms
2025-09-11 21:10:49.335 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:49.344 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:49.351 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 409 330 application/json; charset=utf-8 30237.3564ms
2025-09-11 21:10:49.421 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:49.427 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:49.429 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:49.504 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:49.510 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:49.585 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:49.590 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:49.592 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:49.595 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:49.837 +03:00 [INF] Received HTTP response headers after 239.3596ms - 201
2025-09-11 21:10:49.844 +03:00 [INF] End processing HTTP request after 251.4971ms - 201
2025-09-11 21:10:49.850 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:49.929 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:49.939 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:50.025 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:50.037 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:50.040 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:50.248 +03:00 [INF] Received HTTP response headers after 204.9846ms - 201
2025-09-11 21:10:50.254 +03:00 [INF] End processing HTTP request after 217.035ms - 201
2025-09-11 21:10:50.259 +03:00 [INF] Successfully created PayMob order: 384526106 for local order: ORD-20250911180822-8048
2025-09-11 21:10:50.263 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:50.339 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:50.347 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:50.351 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384526106, Amount: 1012226
2025-09-11 21:10:50.355 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:50.359 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:50.579 +03:00 [INF] Received HTTP response headers after 218.2285ms - 201
2025-09-11 21:10:50.587 +03:00 [INF] End processing HTTP request after 231.939ms - 201
2025-09-11 21:10:50.593 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:50.594 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:50.596 +03:00 [INF] Payment key generated successfully for Order ID: 384526106
2025-09-11 21:10:50.598 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:50.601 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:50.675 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:50.687 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:50.697 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:50.699 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:50.707 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:50.709 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:50.865 +03:00 [ERR] Failed executing DbCommand (79ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:51.027 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:10:51.045 +03:00 [WRN] Unique constraint violation while creating payment. Order: ORD-20250911180822-8048, User: e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 291
2025-09-11 21:10:51.134 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:51.144 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 31251.4145ms
2025-09-11 21:10:51.149 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:51.152 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 409 330 application/json; charset=utf-8 32036.6007ms
2025-09-11 21:10:51.211 +03:00 [INF] Executed DbCommand (30,729ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:51.218 +03:00 [INF] Getting payment method ID for enum "Visa"
2025-09-11 21:10:51.222 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:51.297 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__methodEnum_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `PaymentMethods` AS `p`
WHERE ((`p`.`Method` = @__methodEnum_0) AND `p`.`IsActive`) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:51.306 +03:00 [INF] Found payment method ID 1 for enum "Visa"
2025-09-11 21:10:51.310 +03:00 [INF] Executing GetByIdAsync for entity PaymentMethod with ID: 1
2025-09-11 21:10:51.386 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IntegrationId`, `p`.`IsActive`, `p`.`Method`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`PaymentProviderId`
FROM `PaymentMethods` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-09-11 21:10:51.397 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:51.434 +03:00 [ERR] Failed executing DbCommand (30,840ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:51.443 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> MySqlConnector.MySqlException (0x80004005): Query execution was interrupted
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 124
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 21:10:51.471 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`PublicKey`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = 1
LIMIT 1
2025-09-11 21:10:51.478 +03:00 [INF] Executing GetTokenAsync
2025-09-11 21:10:51.480 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:51.482 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/auth/tokens
2025-09-11 21:10:51.705 +03:00 [INF] Received HTTP response headers after 220.5563ms - 201
2025-09-11 21:10:51.709 +03:00 [INF] End processing HTTP request after 229.0366ms - 201
2025-09-11 21:10:51.712 +03:00 [INF] Successfully retrieved PayMob token
2025-09-11 21:10:51.791 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-09-11 21:10:51.800 +03:00 [INF] Getting address by ID: 31
2025-09-11 21:10:51.883 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`Id` = @__addressId_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-09-11 21:10:51.898 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:51.901 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/ecommerce/orders
2025-09-11 21:10:51.958 +03:00 [ERR] Failed executing DbCommand (31,359ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:51.963 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> MySqlConnector.MySqlException (0x80004005): Query execution was interrupted
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 124
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 21:10:52.113 +03:00 [INF] Received HTTP response headers after 208.1425ms - 201
2025-09-11 21:10:52.135 +03:00 [INF] End processing HTTP request after 237.8412ms - 201
2025-09-11 21:10:52.150 +03:00 [INF] Successfully created PayMob order: 384526127 for local order: ORD-20250911180822-8048
2025-09-11 21:10:52.160 +03:00 [INF] Execute GetAll for entity PaymentMethod
2025-09-11 21:10:52.238 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__dto_PaymentMethod_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IntegrationId`
FROM `PaymentMethods` AS `p`
INNER JOIN `PaymentProviders` AS `p0` ON `p`.`PaymentProviderId` = `p0`.`Id`
WHERE ((`p`.`Method` = @__dto_PaymentMethod_0) AND `p`.`IsActive`) AND (`p0`.`Provider` = 1)
LIMIT 1
2025-09-11 21:10:52.250 +03:00 [INF] Using integration ID: 5221967 for payment method: "Visa"
2025-09-11 21:10:52.259 +03:00 [INF] Starting GeneratePaymentKeyAsync for Order ID: 384526127, Amount: 1012226
2025-09-11 21:10:52.262 +03:00 [INF] Start processing HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:52.265 +03:00 [INF] Sending HTTP request POST https://accept.paymob.com/api/acceptance/payment_keys
2025-09-11 21:10:52.437 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:52.440 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 32484.9557ms
2025-09-11 21:10:52.443 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:52.445 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 33320.3939ms
2025-09-11 21:10:52.490 +03:00 [INF] Received HTTP response headers after 220.6661ms - 201
2025-09-11 21:10:52.493 +03:00 [INF] End processing HTTP request after 230.8899ms - 201
2025-09-11 21:10:52.496 +03:00 [ERR] Failed executing DbCommand (31,841ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT Id FROM Orders WHERE Id = @p0 FOR UPDATE
2025-09-11 21:10:52.498 +03:00 [INF] Request sent to Paymob payment_keys endpoint
2025-09-11 21:10:52.502 +03:00 [ERR] Error occurred while creating payment for user e682f183-1c61-400b-aa5a-171750f446b5
MySqlConnector.MySqlException (0x80004005): The Command Timeout expired before the operation completed.
 ---> MySqlConnector.MySqlException (0x80004005): Query execution was interrupted
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 124
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteNonQueryAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.ExecuteSqlRawAsync(DatabaseFacade databaseFacade, String sql, IEnumerable`1 parameters, CancellationToken cancellationToken)
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 185
2025-09-11 21:10:52.506 +03:00 [INF] Received response from Paymob payment_keys endpoint
2025-09-11 21:10:52.517 +03:00 [INF] Payment key generated successfully for Order ID: 384526127
2025-09-11 21:10:52.519 +03:00 [INF] Successfully generated payment key for order: ORD-20250911180822-8048
2025-09-11 21:10:52.522 +03:00 [INF] Execute GetAll for entity PaymentProvider
2025-09-11 21:10:52.596 +03:00 [INF] Executed DbCommand (72ms) [Parameters=[@__paymentProvider_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IframeId`
FROM `PaymentProviders` AS `p`
WHERE `p`.`Provider` = @__paymentProvider_0
LIMIT 1
2025-09-11 21:10:52.601 +03:00 [INF] Executing CreateAsync for entity Payment
2025-09-11 21:10:52.603 +03:00 [INF] Payment added successfully (pending save)
2025-09-11 21:10:52.605 +03:00 [INF] Execute AddUserOpreationAsync
2025-09-11 21:10:52.607 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-09-11 21:10:52.608 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-09-11 21:10:52.760 +03:00 [ERR] Failed executing DbCommand (77ms) [Parameters=[@p0='?' (DbType = Decimal), @p1='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = DateTime), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int64), @p10='?' (DbType = Int32), @p11='?' (Size = 100), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime), @p19='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Payments` (`Amount`, `CreatedAt`, `CustomerId`, `DeletedAt`, `ModifiedAt`, `OrderId`, `PaymentDate`, `PaymentMethodId`, `PaymentProviderId`, `ProviderOrderId`, `Status`, `TransactionId`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
SELECT `Id`, `RowVersion`
FROM `Payments`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-09-11 21:10:52.917 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-11 21:10:52.934 +03:00 [WRN] Unique constraint violation while creating payment. Order: ORD-20250911180822-8048, User: e682f183-1c61-400b-aa5a-171750f446b5
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> MySqlConnector.MySqlException (0x80004005): Duplicate entry '132-1-1' for key 'Payments.IX_Payments_OrderId_Status_PaymentMethodId'
   at MySqlConnector.Core.ServerSession.ReceiveReplyAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/ServerSession.cs:line 894
   at MySqlConnector.Core.ResultSet.ReadResultSetHeaderAsync(IOBehavior ioBehavior) in /_/src/MySqlConnector/Core/ResultSet.cs:line 37
   at MySqlConnector.MySqlDataReader.ActivateResultSet(CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 130
   at MySqlConnector.MySqlDataReader.InitAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, IDictionary`2 cachedProcedures, IMySqlCommand command, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlDataReader.cs:line 483
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/Core/CommandExecutor.cs:line 56
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 357
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 65
   at E_Commerce.Services.PaymentServices.PaymentServices.CreatePaymentMethod(String ordernumber, CreatePaymentOfCustomer paymentdto, String userid) in D:\project_fashion\E-Commerce-API-main\Services\PaymentServices\PaymentServices.cs:line 291
2025-09-11 21:10:52.946 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:52.956 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 32996.4834ms
2025-09-11 21:10:52.961 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:52.963 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 33834.8207ms
2025-09-11 21:10:53.028 +03:00 [INF] Executing ConflictObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:53.035 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 33120.5242ms
2025-09-11 21:10:53.040 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:53.044 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 409 330 application/json; charset=utf-8 33926.6465ms
2025-09-11 21:10:53.474 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.PaymentDtos.PaymentResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-11 21:10:53.479 +03:00 [INF] Executed action E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce) in 33470.3778ms
2025-09-11 21:10:53.483 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.PaymentController.CreatePayment (E-Commerce)'
2025-09-11 21:10:53.489 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Payment - 500 206 application/json; charset=utf-8 34360.1871ms
2025-09-11 21:12:14.756 +03:00 [INF] 1 servers were removed due to timeout
2025-09-11 21:14:59.541 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:14:59.566 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:15:02.821 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 3280.3275ms
2025-09-11 21:15:05.461 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:15:05.470 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:15:07.182 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1720.5341ms
2025-09-11 21:15:09.282 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:15:09.288 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:15:10.849 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1566.8847ms
2025-09-11 21:15:13.297 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/hangfire/stats - application/x-www-form-urlencoded; charset=UTF-8 392
2025-09-11 21:15:13.315 +03:00 [INF] CORS policy execution successful.
2025-09-11 21:15:15.051 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/hangfire/stats - 200 null application/json 1753.9978ms
