2025-08-31 10:20:43.592 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 10:20:45.921 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 10:20:47.101 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 10:20:47.832 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 10:20:48.136 +03:00 [INF] Executed DbCommand (196ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 10:20:48.164 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 10:20:48.182 +03:00 [INF] Starting data seeding...
2025-08-31 10:20:48.224 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 10:20:48.930 +03:00 [INF] Executed DbCommand (136ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 10:20:49.010 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 10:20:49.187 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 10:20:49.195 +03:00 [INF] Role 'User' already exists.
2025-08-31 10:20:49.468 +03:00 [INF] Executed DbCommand (169ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 10:20:49.606 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 10:20:49.608 +03:00 [INF] Data seeding completed successfully.
2025-08-31 10:20:53.942 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 10:20:54.082 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 10:20:54.085 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 10:20:54.089 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 10:20:54.092 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 10:20:54.158 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 10:20:54.231 +03:00 [INF] Hosting environment: Development
2025-08-31 10:20:54.278 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 10:20:54.340 +03:00 [INF] Server mrrobot:6784:1609f3be successfully announced in 178.464 ms
2025-08-31 10:20:54.371 +03:00 [INF] Server mrrobot:6784:1609f3be is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 10:20:54.458 +03:00 [INF] Server mrrobot:6784:1609f3be all the dispatchers started
2025-08-31 10:20:57.291 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 10:20:57.954 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 721.6777ms
2025-08-31 10:20:58.034 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 10:20:58.034 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 10:20:58.068 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 10:20:58.105 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 70.1788ms
2025-08-31 10:20:58.116 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 81.4326ms
2025-08-31 10:20:58.284 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 216.6025ms
2025-08-31 10:20:58.427 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 10:20:58.824 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 397.2026ms
2025-08-31 10:21:06.842 +03:00 [ERR] Failed to send welcome email to Denim2004: The specified string is not in the form required for an e-mail address.
2025-08-31 10:21:07.479 +03:00 [WRN] Failed to process the job '701': an exception occurred. Retry attempt 9 of 10 will be performed in 01:10:10.
System.FormatException: The specified string is not in the form required for an e-mail address.
   at System.Net.Mail.MailAddressParser.TryReadCfwsAndThrowIfIncomplete(String data, Int32 index, Int32& outIndex, Boolean throwExceptionIfFail)
   at System.Net.Mail.MailAddressParser.TryParseDomain(String data, Int32& index, String& domain, Boolean throwExceptionIfFail)
   at System.Net.Mail.MailAddressParser.TryParseAddress(String data, Boolean expectMultipleAddresses, Int32& index, ParseAddressInfo& parseAddressInfo, Boolean throwExceptionIfFail)
   at System.Net.Mail.MailAddressParser.ParseMultipleAddresses(String data)
   at System.Net.Mail.MailAddressCollection.ParseValue(String addresses)
   at E_Commerce.Services.EmailServices.EmailSender.SendEmailAsync(String email, String subject, String htmlMessage) in D:\project_fashion\E-Commerce-API-main\Services\EmailServices\EmailSender.cs:line 37
   at E_Commerce.Services.EmailServices.AccountEmailService.SendWelcomeEmailAsync(String email, String username) in D:\project_fashion\E-Commerce-API-main\Services\EmailServices\AccountEmailService.cs:line 258
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-08-31 10:37:14.719 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 10:37:16.204 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 10:37:17.270 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 10:37:17.988 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 10:37:18.165 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 10:37:18.187 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 10:37:18.207 +03:00 [INF] Starting data seeding...
2025-08-31 10:37:18.232 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 10:37:18.758 +03:00 [INF] Executed DbCommand (120ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 10:37:18.828 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 10:37:18.993 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 10:37:18.998 +03:00 [INF] Role 'User' already exists.
2025-08-31 10:37:19.173 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 10:37:19.266 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 10:37:19.270 +03:00 [INF] Data seeding completed successfully.
2025-08-31 10:37:20.629 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 10:37:20.745 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 10:37:20.781 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 10:37:20.793 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 10:37:20.804 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 10:37:20.830 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 10:37:20.842 +03:00 [INF] Hosting environment: Development
2025-08-31 10:37:20.845 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 10:37:21.068 +03:00 [INF] Server mrrobot:24080:57fa0850 successfully announced in 227.8571 ms
2025-08-31 10:37:21.107 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 10:37:21.109 +03:00 [INF] Server mrrobot:24080:57fa0850 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 10:37:21.512 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 406.3823ms
2025-08-31 10:37:21.589 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 10:37:21.595 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 10:37:21.633 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 10:37:21.842 +03:00 [INF] Server mrrobot:24080:57fa0850 all the dispatchers started
2025-08-31 10:37:21.899 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 309.5566ms
2025-08-31 10:37:21.945 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 312.0179ms
2025-08-31 10:37:21.977 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 381.9422ms
2025-08-31 10:37:22.564 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 10:37:22.833 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 268.8267ms
2025-08-31 10:39:17.408 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 10:39:17.480 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 72.3059ms
2025-08-31 10:39:18.062 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 10:39:18.076 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 14.4995ms
2025-08-31 10:39:18.117 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 10:39:18.210 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 92.985ms
2025-08-31 10:39:18.268 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 10:39:18.283 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 14.9086ms
2025-08-31 10:39:21.425 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 10:39:21.664 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Conflicting method/path combination "GET api/Collection" for actions - E_Commerce.Controllers.CollectionController.GetCollections (E-Commerce), E_Commerce.Controllers.CollectionController.SearchCollections (E-Commerce). Actions require a unique method/path combination for Swagger/OpenAPI 2.0 and 3.0. Use ConflictingActionsResolver as a workaround or provide your own implementation of PathGroupSelector.
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.PrepareGenerateOperation(IGrouping`2 group)
   at System.Linq.Enumerable.IteratorSelectIterator`2.MoveNext()
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository, Func`3 operationsGenerator)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-31 10:39:22.178 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 753.1351ms
2025-08-31 10:40:38.089 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 10:40:38.181 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 91.9859ms
2025-08-31 10:40:42.284 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 10:40:42.301 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 17.0637ms
2025-08-31 10:40:42.332 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 10:40:42.338 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 10:40:42.364 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 32.0192ms
2025-08-31 10:40:42.382 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 44.3656ms
2025-08-31 10:40:42.673 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 10:40:42.745 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Conflicting method/path combination "GET api/Collection" for actions - E_Commerce.Controllers.CollectionController.GetCollections (E-Commerce), E_Commerce.Controllers.CollectionController.SearchCollections (E-Commerce). Actions require a unique method/path combination for Swagger/OpenAPI 2.0 and 3.0. Use ConflictingActionsResolver as a workaround or provide your own implementation of PathGroupSelector.
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.PrepareGenerateOperation(IGrouping`2 group)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository, Func`3 operationsGenerator)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-31 10:40:42.754 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 81.5303ms
2025-08-31 10:41:20.029 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 10:41:20.047 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 18.2712ms
2025-08-31 10:41:20.080 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 10:41:20.080 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 10:41:20.082 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 10:41:20.132 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 51.9417ms
2025-08-31 10:41:20.135 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 54.7104ms
2025-08-31 10:41:20.144 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 62.2258ms
2025-08-31 10:41:20.207 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 10:41:20.277 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Conflicting method/path combination "GET api/Collection" for actions - E_Commerce.Controllers.CollectionController.GetCollections (E-Commerce), E_Commerce.Controllers.CollectionController.SearchCollections (E-Commerce). Actions require a unique method/path combination for Swagger/OpenAPI 2.0 and 3.0. Use ConflictingActionsResolver as a workaround or provide your own implementation of PathGroupSelector.
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.PrepareGenerateOperation(IGrouping`2 group)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository, Func`3 operationsGenerator)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-31 10:41:20.285 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 77.4385ms
2025-08-31 10:41:51.154 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 10:41:52.687 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 10:41:53.752 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 10:41:54.457 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 10:41:54.637 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 10:41:54.662 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 10:41:54.675 +03:00 [INF] Starting data seeding...
2025-08-31 10:41:54.703 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 10:41:55.462 +03:00 [INF] Executed DbCommand (127ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 10:41:55.546 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 10:41:55.704 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 10:41:55.715 +03:00 [INF] Role 'User' already exists.
2025-08-31 10:41:55.895 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 10:41:56.006 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 10:41:56.008 +03:00 [INF] Data seeding completed successfully.
2025-08-31 10:41:57.514 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 10:41:57.739 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 10:41:57.863 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 10:41:57.970 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 10:41:58.090 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 10:41:58.156 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 10:41:58.216 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 10:41:58.238 +03:00 [INF] Hosting environment: Development
2025-08-31 10:41:58.270 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 10:41:58.399 +03:00 [INF] Server mrrobot:21944:180d81ef successfully announced in 164.9712 ms
2025-08-31 10:41:58.406 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 544.7275ms
2025-08-31 10:41:58.451 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 10:41:58.453 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 10:41:58.546 +03:00 [INF] Server mrrobot:21944:180d81ef is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 10:41:58.601 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 10:41:58.651 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 198.3843ms
2025-08-31 10:41:58.656 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 202.4554ms
2025-08-31 10:41:58.733 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 131.8754ms
2025-08-31 10:41:58.858 +03:00 [INF] 1 servers were removed due to timeout
2025-08-31 10:41:58.886 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 10:41:58.891 +03:00 [INF] Server mrrobot:21944:180d81ef all the dispatchers started
2025-08-31 10:41:59.284 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 398.3937ms
2025-08-31 10:46:59.078 +03:00 [INF] 1 servers were removed due to timeout
2025-08-31 13:49:24.674 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 13:49:26.310 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 13:49:27.342 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 13:49:28.061 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 13:49:28.753 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 13:49:29.022 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 13:49:29.066 +03:00 [INF] Starting data seeding...
2025-08-31 13:49:29.147 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 13:49:29.796 +03:00 [INF] Executed DbCommand (148ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 13:49:29.870 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 13:49:30.032 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 13:49:30.049 +03:00 [INF] Role 'User' already exists.
2025-08-31 13:49:30.241 +03:00 [INF] Executed DbCommand (91ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 13:49:30.385 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 13:49:30.387 +03:00 [INF] Data seeding completed successfully.
2025-08-31 13:49:32.420 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 13:49:32.524 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 13:49:32.532 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 13:49:32.549 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 13:49:32.570 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 13:49:32.616 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 13:49:32.637 +03:00 [INF] Hosting environment: Development
2025-08-31 13:49:32.653 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 13:49:32.816 +03:00 [INF] Server mrrobot:13744:46e5c5f0 successfully announced in 188.5771 ms
2025-08-31 13:49:33.484 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 13:49:33.578 +03:00 [INF] Server mrrobot:13744:46e5c5f0 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 13:49:33.896 +03:00 [INF] Server mrrobot:13744:46e5c5f0 all the dispatchers started
2025-08-31 13:49:34.106 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 616.3132ms
2025-08-31 13:49:34.280 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 13:49:34.300 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 13:49:34.359 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 13:49:34.391 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 90.584ms
2025-08-31 13:49:34.490 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 209.7883ms
2025-08-31 13:49:34.540 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 181.5813ms
2025-08-31 13:49:34.925 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 13:49:35.164 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 238.2427ms
2025-08-31 13:49:46.227 +03:00 [ERR] Failed to send welcome email to Denim2004: The specified string is not in the form required for an e-mail address.
2025-08-31 13:49:46.719 +03:00 [ERR] Failed to process the job '701': an exception occurred.
System.FormatException: The specified string is not in the form required for an e-mail address.
   at System.Net.Mail.MailAddressParser.TryReadCfwsAndThrowIfIncomplete(String data, Int32 index, Int32& outIndex, Boolean throwExceptionIfFail)
   at System.Net.Mail.MailAddressParser.TryParseDomain(String data, Int32& index, String& domain, Boolean throwExceptionIfFail)
   at System.Net.Mail.MailAddressParser.TryParseAddress(String data, Boolean expectMultipleAddresses, Int32& index, ParseAddressInfo& parseAddressInfo, Boolean throwExceptionIfFail)
   at System.Net.Mail.MailAddressParser.ParseMultipleAddresses(String data)
   at System.Net.Mail.MailAddressCollection.ParseValue(String addresses)
   at E_Commerce.Services.EmailServices.EmailSender.SendEmailAsync(String email, String subject, String htmlMessage) in D:\project_fashion\E-Commerce-API-main\Services\EmailServices\EmailSender.cs:line 37
   at E_Commerce.Services.EmailServices.AccountEmailService.SendWelcomeEmailAsync(String email, String username) in D:\project_fashion\E-Commerce-API-main\Services\EmailServices\AccountEmailService.cs:line 258
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-08-31 14:01:30.197 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Account/login - application/json-patch+json 70
2025-08-31 14:01:30.211 +03:00 [INF] CORS policy execution successful.
2025-08-31 14:01:30.229 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-31 14:01:31.459 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 14:01:31.479 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce)'
2025-08-31 14:01:31.523 +03:00 [INF] Route matched with {action = "LoginAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.TokenDtos.TokensDto]]] LoginAsync(E_Commerce.DtoModels.AccountDtos.LoginDTo) on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-31 14:01:31.969 +03:00 [INF] In LoginAsync Method 
2025-08-31 14:01:32.131 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 14:01:32.380 +03:00 [INF] 🔐 Generating Access Token for User ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 14:01:32.391 +03:00 [INF] 🔐 Generating Access Token for User ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 14:01:32.581 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-08-31 14:01:32.768 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 14:01:33.220 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p22='?' (Size = 255), @p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p23='?' (Size = 4000), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 256), @p6='?' (DbType = Boolean), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = DateTime), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTimeOffset), @p13='?' (Size = 4000), @p14='?' (Size = 256), @p15='?' (Size = 256), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = Boolean), @p19='?' (Size = 4000), @p20='?' (DbType = Boolean), @p21='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `AspNetUsers` SET `AccessFailedCount` = @p0, `Age` = @p1, `ConcurrencyStamp` = @p2, `CreateAt` = @p3, `DeletedAt` = @p4, `Email` = @p5, `EmailConfirmed` = @p6, `Gender` = @p7, `ImageId` = @p8, `ImageId1` = @p9, `LastVisit` = @p10, `LockoutEnabled` = @p11, `LockoutEnd` = @p12, `Name` = @p13, `NormalizedEmail` = @p14, `NormalizedUserName` = @p15, `PasswordHash` = @p16, `PhoneNumber` = @p17, `PhoneNumberConfirmed` = @p18, `SecurityStamp` = @p19, `TwoFactorEnabled` = @p20, `UserName` = @p21
WHERE `Id` = @p22 AND `ConcurrencyStamp` = @p23;
SELECT ROW_COUNT();
2025-08-31 14:01:33.582 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a0`.`Name`
FROM `AspNetUserRoles` AS `a`
INNER JOIN `AspNetRoles` AS `a0` ON `a`.`RoleId` = `a0`.`Id`
WHERE `a`.`UserId` = @__userId_0
2025-08-31 14:01:33.798 +03:00 [INF] ✅ Access Token generated successfully for User ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 14:01:33.807 +03:00 [INF] 🔑 Generating Refresh Token for User ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 14:01:34.053 +03:00 [INF] ✅ RefreshToken generated and stored for User ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 14:01:34.252 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.TokenDtos.TokensDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 14:01:34.289 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce) in 2748.4907ms
2025-08-31 14:01:34.294 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.LoginAsync (E-Commerce)'
2025-08-31 14:01:34.303 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Account/login - 200 1251 application/json; charset=utf-8 4105.711ms
2025-08-31 14:01:58.958 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Account - null null
2025-08-31 14:01:59.038 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 14:01:59.334 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 14:01:59.354 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.GetProfileAsync (E-Commerce)'
2025-08-31 14:01:59.371 +03:00 [INF] Route matched with {action = "GetProfileAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.AccountDtos.ProfileDto]]] GetProfileAsync() on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-31 14:01:59.391 +03:00 [INF] In GetProfileAsync Method 
2025-08-31 14:01:59.399 +03:00 [INF] Executing GetProfileAsync for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 14:01:59.589 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 14:01:59.612 +03:00 [INF] Getting addresses for customer: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 14:01:59.626 +03:00 [INF] Getting cache for key: customer_addresses_ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 14:01:59.852 +03:00 [WRN] Cache miss for key: customer_addresses_ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 14:01:59.877 +03:00 [INF] Getting addresses for customer: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 14:02:00.207 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@__customerId_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AdditionalNotes`, `c`.`AddressType`, `c`.`City`, `c`.`Country`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`IsDefault`, `c`.`ModifiedAt`, `c`.`PhoneNumber`, `c`.`PostalCode`, `c`.`State`, `c`.`StreetAddress`, `t`.`Id`, `t`.`AccessFailedCount`, `t`.`ConcurrencyStamp`, `t`.`Discriminator`, `t`.`Email`, `t`.`EmailConfirmed`, `t`.`LockoutEnabled`, `t`.`LockoutEnd`, `t`.`NormalizedEmail`, `t`.`NormalizedUserName`, `t`.`PasswordHash`, `t`.`PhoneNumber`, `t`.`PhoneNumberConfirmed`, `t`.`SecurityStamp`, `t`.`TwoFactorEnabled`, `t`.`UserName`, `t`.`Age`, `t`.`CreateAt`, `t`.`DeletedAt`, `t`.`Gender`, `t`.`ImageId`, `t`.`ImageId1`, `t`.`LastVisit`, `t`.`Name`
FROM `CustomerAddresses` AS `c`
INNER JOIN (
    SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
    FROM `AspNetUsers` AS `a`
    WHERE `a`.`Discriminator` = 'Customer'
) AS `t` ON `c`.`CustomerId` = `t`.`Id`
WHERE (`c`.`CustomerId` = @__customerId_0) AND `c`.`DeletedAt` IS NULL
ORDER BY `c`.`IsDefault` DESC, `c`.`CreatedAt`
2025-08-31 14:02:00.320 +03:00 [INF] Setting cache for key: customer_addresses_ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 14:02:00.679 +03:00 [INF] Cache set successfully for key: customer_addresses_ac03a6c3-9450-420a-9e6e-ea8902c018c5 with tags: [customer_address]
2025-08-31 14:02:00.688 +03:00 [INF] Successfully retrieved profile for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 14:02:00.697 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.AccountDtos.ProfileDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 14:02:00.742 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.GetProfileAsync (E-Commerce) in 1358.1014ms
2025-08-31 14:02:00.748 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.GetProfileAsync (E-Commerce)'
2025-08-31 14:02:00.754 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Account - 200 1223 application/json; charset=utf-8 1795.5679ms
2025-08-31 14:02:35.084 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/AdminOperation - null null
2025-08-31 14:02:35.095 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 14:02:35.253 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 14:02:35.265 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AdminOperationController.GetAllOperation (E-Commerce)'
2025-08-31 14:02:35.275 +03:00 [INF] Route matched with {action = "GetAllOperation", controller = "AdminOperation"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.ResponseDto]] GetAllOperation() on controller E_Commerce.Controllers.AdminOperationController (E-Commerce).
2025-08-31 14:02:35.289 +03:00 [INF] Execute GetAllOperation
2025-08-31 14:02:35.296 +03:00 [INF] Execute GetAllOpreationsAsync
2025-08-31 14:02:35.305 +03:00 [INF] Execute GetAll for entity AdminOperationsLog
2025-08-31 14:02:35.475 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `adminOperationsLogs` AS `a`)
2025-08-31 14:02:35.818 +03:00 [INF] Executed DbCommand (175ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Description`, CAST(`a`.`Id` AS char), `a`.`ItemId`, `t`.`Name`, `a`.`OperationType`, `a`.`Timestamp`
FROM `adminOperationsLogs` AS `a`
INNER JOIN (
    SELECT `a0`.`Id`, `a0`.`Name`
    FROM `AspNetUsers` AS `a0`
    WHERE `a0`.`Discriminator` = 'Customer'
) AS `t` ON `a`.`AdminId` = `t`.`Id`
2025-08-31 14:02:35.854 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.ResponseDto'.
2025-08-31 14:02:35.957 +03:00 [INF] Executed action E_Commerce.Controllers.AdminOperationController.GetAllOperation (E-Commerce) in 669.9119ms
2025-08-31 14:02:35.963 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AdminOperationController.GetAllOperation (E-Commerce)'
2025-08-31 14:02:35.971 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/AdminOperation - 200 33067 application/json; charset=utf-8 886.8413ms
2025-08-31 14:03:24.165 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/categories?page=1&pageSize=10 - null null
2025-08-31 14:03:24.176 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 14:03:24.394 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 14:03:24.418 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.GetCategories (E-Commerce)'
2025-08-31 14:03:24.447 +03:00 [INF] Route matched with {action = "GetCategories", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.DtoModels.CategoryDtos.CategoryDto]]]] GetCategories(System.String, System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-31 14:03:24.472 +03:00 [INF] Executing GetCategories with search: , isActive: , isDeleted: , page: 1
2025-08-31 14:03:24.478 +03:00 [INF] Executing FilterAsync with filters
2025-08-31 14:03:24.484 +03:00 [INF] Getting cache for key: category:list_active:_deleted:_search:
2025-08-31 14:03:24.746 +03:00 [WRN] Cache miss for key: category:list_active:_deleted:_search:
2025-08-31 14:03:24.777 +03:00 [INF] Execute GetAll for entity Category
2025-08-31 14:03:24.798 +03:00 [WRN] The query uses a row limiting operator ('Skip'/'Take') without an 'OrderBy' operator. This may lead to unpredictable results. If the 'Distinct' operator is used after 'OrderBy', then make sure to use the 'OrderBy' operator after 'Distinct' as the ordering would otherwise get erased.
2025-08-31 14:03:24.806 +03:00 [WRN] The query uses a row limiting operator ('Skip'/'Take') without an 'OrderBy' operator. This may lead to unpredictable results. If the 'Distinct' operator is used after 'OrderBy', then make sure to use the 'OrderBy' operator after 'Distinct' as the ordering would otherwise get erased.
2025-08-31 14:03:25.038 +03:00 [INF] Executed DbCommand (92ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Name`, `t`.`Description`, `t`.`IsActive`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`DisplayOrder`, `i`.`Id`, `i`.`Url`, `i`.`IsMain`
FROM (
    SELECT `c`.`Id`, `c`.`Name`, `c`.`Description`, `c`.`IsActive`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`DisplayOrder`
    FROM `Categories` AS `c`
    LIMIT @__p_1 OFFSET @__p_0
) AS `t`
LEFT JOIN `Images` AS `i` ON `t`.`Id` = `i`.`CategoryId`
ORDER BY `t`.`Id`
2025-08-31 14:03:25.084 +03:00 [INF] Setting cache for key: category:list_active:_deleted:_search:
2025-08-31 14:03:25.146 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.CategoryDtos.CategoryDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 14:03:25.173 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.GetCategories (E-Commerce) in 717.0921ms
2025-08-31 14:03:25.205 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.GetCategories (E-Commerce)'
2025-08-31 14:03:25.208 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/categories?page=1&pageSize=10 - 200 2315 application/json; charset=utf-8 1042.1121ms
2025-08-31 14:03:25.342 +03:00 [INF] Cache set successfully for key: category:list_active:_deleted:_search: with tags: [categorywithdata]
2025-08-31 14:03:45.925 +03:00 [INF] Request starting HTTP/1.1 DELETE http://localhost:5069/api/categories/1 - null null
2025-08-31 14:03:45.930 +03:00 [INF] CORS policy execution successful.
2025-08-31 14:03:45.933 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 14:03:46.092 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 14:03:46.123 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.DeleteAsync (E-Commerce)'
2025-08-31 14:03:46.142 +03:00 [INF] Route matched with {action = "DeleteAsync", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] DeleteAsync(Int32) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-31 14:03:46.168 +03:00 [INF] Executing DeleteAsync for id: 1
2025-08-31 14:03:46.192 +03:00 [INF] Executing DeleteAsync for id: 1
2025-08-31 14:03:46.467 +03:00 [INF] Execute GetAll for entity Category
2025-08-31 14:03:46.571 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`Description`, `c`.`DisplayOrder`, `c`.`IsActive`, `c`.`ModifiedAt`, `c`.`Name`, `c`.`DeletedAt` IS NOT NULL AS `IsDeleted`, EXISTS (
    SELECT 1
    FROM `SubCategories` AS `s`
    WHERE `c`.`Id` = `s`.`CategoryId`) AS `HasSubCategories`
FROM `Categories` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-08-31 14:03:46.710 +03:00 [WRN] Category 1 contains subcategories
2025-08-31 14:03:46.730 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 14:03:46.743 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.DeleteAsync (E-Commerce) in 582.7818ms
2025-08-31 14:03:46.751 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.DeleteAsync (E-Commerce)'
2025-08-31 14:03:46.759 +03:00 [INF] Request finished HTTP/1.1 DELETE http://localhost:5069/api/categories/1 - 400 418 application/json; charset=utf-8 833.7946ms
2025-08-31 14:04:16.958 +03:00 [INF] Request starting HTTP/1.1 DELETE http://localhost:5069/api/categories/5 - null null
2025-08-31 14:04:16.968 +03:00 [INF] CORS policy execution successful.
2025-08-31 14:04:16.970 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 14:04:17.125 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 14:04:17.135 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.DeleteAsync (E-Commerce)'
2025-08-31 14:04:17.141 +03:00 [INF] Route matched with {action = "DeleteAsync", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] DeleteAsync(Int32) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-31 14:04:17.172 +03:00 [INF] Executing DeleteAsync for id: 5
2025-08-31 14:04:17.175 +03:00 [INF] Executing DeleteAsync for id: 5
2025-08-31 14:04:17.414 +03:00 [INF] Execute GetAll for entity Category
2025-08-31 14:04:17.499 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`Description`, `c`.`DisplayOrder`, `c`.`IsActive`, `c`.`ModifiedAt`, `c`.`Name`, `c`.`DeletedAt` IS NOT NULL AS `IsDeleted`, EXISTS (
    SELECT 1
    FROM `SubCategories` AS `s`
    WHERE `c`.`Id` = `s`.`CategoryId`) AS `HasSubCategories`
FROM `Categories` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-08-31 14:04:17.534 +03:00 [INF] Execute SoftDeleteAsync for entity Category with ID: 5
2025-08-31 14:04:17.629 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`Description`, `c`.`DisplayOrder`, `c`.`IsActive`, `c`.`ModifiedAt`, `c`.`Name`
FROM `Categories` AS `c`
WHERE (`c`.`Id` = @__id_0) AND `c`.`DeletedAt` IS NULL
LIMIT 1
2025-08-31 14:04:17.663 +03:00 [INF] Category with ID: 5 soft deleted.
2025-08-31 14:04:17.679 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 14:04:17.698 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 14:04:17.895 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 14:04:18.167 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (Size = 50), @p3='?' (DbType = Int32), @p4='?' (DbType = Boolean), @p5='?' (DbType = DateTime), @p6='?' (Size = 20), @p8='?' (Size = 255), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Categories` SET `CreatedAt` = @p0, `DeletedAt` = @p1, `Description` = @p2, `DisplayOrder` = @p3, `IsActive` = @p4, `ModifiedAt` = @p5, `Name` = @p6
WHERE `Id` = @p7;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 14:04:19.451 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 14:04:19.467 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.DeleteAsync (E-Commerce) in 2316.9505ms
2025-08-31 14:04:19.497 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.DeleteAsync (E-Commerce)'
2025-08-31 14:04:19.510 +03:00 [INF] Request finished HTTP/1.1 DELETE http://localhost:5069/api/categories/5 - 200 297 application/json; charset=utf-8 2551.9467ms
2025-08-31 14:04:22.445 +03:00 [INF] Removing cache by tags: [category, categorywithdata]
2025-08-31 14:04:23.319 +03:00 [INF] Removed 1 cache entries for tags: [category, categorywithdata]
2025-08-31 14:04:35.361 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/categories?page=1&pageSize=10 - null null
2025-08-31 14:04:35.382 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 14:04:35.540 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 14:04:35.559 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CategoriesController.GetCategories (E-Commerce)'
2025-08-31 14:04:35.567 +03:00 [INF] Route matched with {action = "GetCategories", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Collections.Generic.List`1[E_Commerce.DtoModels.CategoryDtos.CategoryDto]]]] GetCategories(System.String, System.Nullable`1[System.Boolean], System.Nullable`1[System.Boolean], Int32, Int32) on controller E_Commerce.Controllers.CategoriesController (E-Commerce).
2025-08-31 14:04:35.592 +03:00 [INF] Executing GetCategories with search: , isActive: , isDeleted: , page: 1
2025-08-31 14:04:35.600 +03:00 [INF] Executing FilterAsync with filters
2025-08-31 14:04:35.608 +03:00 [INF] Getting cache for key: category:list_active:_deleted:_search:
2025-08-31 14:04:35.913 +03:00 [WRN] Cache miss for key: category:list_active:_deleted:_search:
2025-08-31 14:04:35.919 +03:00 [INF] Execute GetAll for entity Category
2025-08-31 14:04:36.086 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__p_1='?' (DbType = Int32), @__p_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Name`, `t`.`Description`, `t`.`IsActive`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`DisplayOrder`, `i`.`Id`, `i`.`Url`, `i`.`IsMain`
FROM (
    SELECT `c`.`Id`, `c`.`Name`, `c`.`Description`, `c`.`IsActive`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`DisplayOrder`
    FROM `Categories` AS `c`
    LIMIT @__p_1 OFFSET @__p_0
) AS `t`
LEFT JOIN `Images` AS `i` ON `t`.`Id` = `i`.`CategoryId`
ORDER BY `t`.`Id`
2025-08-31 14:04:36.115 +03:00 [INF] Setting cache for key: category:list_active:_deleted:_search:
2025-08-31 14:04:36.133 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Collections.Generic.List`1[[E_Commerce.DtoModels.CategoryDtos.CategoryDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 14:04:36.145 +03:00 [INF] Executed action E_Commerce.Controllers.CategoriesController.GetCategories (E-Commerce) in 559.9752ms
2025-08-31 14:04:36.160 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CategoriesController.GetCategories (E-Commerce)'
2025-08-31 14:04:36.166 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/categories?page=1&pageSize=10 - 200 2339 application/json; charset=utf-8 804.8139ms
2025-08-31 14:04:36.426 +03:00 [INF] Cache set successfully for key: category:list_active:_deleted:_search: with tags: [categorywithdata]
2025-08-31 14:05:48.668 +03:00 [INF] Request starting HTTP/1.1 DELETE http://localhost:5069/api/Products/1/Variants/1 - null null
2025-08-31 14:05:48.676 +03:00 [INF] CORS policy execution successful.
2025-08-31 14:05:48.682 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 14:05:48.853 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 14:05:48.864 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.DeleteVariant (E-Commerce)'
2025-08-31 14:05:48.877 +03:00 [INF] Route matched with {action = "DeleteVariant", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] DeleteVariant(Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 14:05:48.911 +03:00 [INF] Deleting variant: 1
2025-08-31 14:05:49.148 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-31 14:05:49.246 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-31 14:05:49.365 +03:00 [INF] Execute GetAll for entity OrderItem
2025-08-31 14:05:49.505 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `OrderItem` AS `o`
    INNER JOIN `Orders` AS `o0` ON `o`.`OrderId` = `o0`.`Id`
    WHERE (`o`.`ProductVariantId` = @__id_0) AND `o0`.`Status` NOT IN (9, 5, 10))
2025-08-31 14:05:49.614 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 14:05:49.631 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.DeleteVariant (E-Commerce) in 748.1804ms
2025-08-31 14:05:49.659 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.DeleteVariant (E-Commerce)'
2025-08-31 14:05:49.667 +03:00 [INF] Request finished HTTP/1.1 DELETE http://localhost:5069/api/Products/1/Variants/1 - 400 237 application/json; charset=utf-8 998.1273ms
2025-08-31 14:06:57.985 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/quantity/remove?quantity=1 - null null
2025-08-31 14:06:57.991 +03:00 [INF] CORS policy execution successful.
2025-08-31 14:06:58.000 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 14:06:58.157 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 14:06:58.183 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.RemoveVariantQuantity (E-Commerce)'
2025-08-31 14:06:58.200 +03:00 [INF] Route matched with {action = "RemoveVariantQuantity", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] RemoveVariantQuantity(Int32, Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 14:06:58.235 +03:00 [INF] Removing quantity for variant: 1
2025-08-31 14:06:58.482 +03:00 [INF] Removing 1 from variant: 1
2025-08-31 14:06:58.501 +03:00 [ERR] Error in RemoveVariantQuantityAsync for id: 1. Rolling back transaction.
System.InvalidOperationException: The connection is already in a transaction and cannot participate in another transaction.
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.EnsureNoTransactions()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.BeginTransactionAsync(IsolationLevel isolationLevel, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.BeginTransactionAsync(CancellationToken cancellationToken)
   at UnitOfWork.BeginTransactionAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 88
   at E_Commerce.Services.ProductServices.ProductVariantCommandService.RemoveQuntityAfterOrder(Int32 id, Int32 quantity) in D:\project_fashion\E-Commerce-API-main\Services\ProductServices\ProductVariantCommandService.cs:line 84
   at E_Commerce.Services.ProductServices.ProductVariantCommandService.RemoveVariantQuantityAsync(Int32 id, Int32 removeQuantity, String userId) in D:\project_fashion\E-Commerce-API-main\Services\ProductServices\ProductVariantCommandService.cs:line 624
2025-08-31 14:06:58.615 +03:00 [INF] Transaction rolled back for removing quantity from variant 1
2025-08-31 14:06:59.563 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 14:06:59.574 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.RemoveVariantQuantity (E-Commerce) in 1360.5246ms
2025-08-31 14:06:59.598 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.RemoveVariantQuantity (E-Commerce)'
2025-08-31 14:06:59.604 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/quantity/remove?quantity=1 - 500 209 application/json; charset=utf-8 1618.5859ms
2025-08-31 14:07:40.517 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/quantity/add?quantity=1 - null null
2025-08-31 14:07:40.524 +03:00 [INF] CORS policy execution successful.
2025-08-31 14:07:40.535 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 14:07:40.762 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 14:07:40.769 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce)'
2025-08-31 14:07:40.782 +03:00 [INF] Route matched with {action = "AddVariantQuantity", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddVariantQuantity(Int32, Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 14:07:40.848 +03:00 [INF] Adding quantity for variant: 1
2025-08-31 14:07:41.077 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-31 14:07:41.156 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-31 14:07:41.173 +03:00 [INF] Updating quantity for variant 1 to 20
2025-08-31 14:07:41.177 +03:00 [INF] Quantity updated for variant ID 1
2025-08-31 14:07:41.180 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 14:07:41.184 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 14:07:41.189 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 14:07:41.256 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 14:07:41.268 +03:00 [ERR] An error occurred using a transaction.
2025-08-31 14:07:41.273 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce) in 484.0692ms
2025-08-31 14:07:41.281 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce)'
2025-08-31 14:07:41.287 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: This MySqlConnection is already in use. See https://fl.vu/mysql-conn-reuse
   at MySqlConnector.Core.ServerSession.StartQuerying(ICancellableCommand command) in /_/src/MySqlConnector/Core/ServerSession.cs:line 289
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken)
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at MySqlConnector.MySqlTransaction.DoRollback(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlTransaction.cs:line 269
   at MySqlConnector.MySqlTransaction.RollbackAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlTransaction.cs:line 67
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.RollbackAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.RollbackAsync(CancellationToken cancellationToken)
   at E_Commerce.Services.ProductServices.ProductVariantCommandService.AddVariantQuantityAsync(Int32 id, Int32 addQuantity, String userId) in D:\project_fashion\E-Commerce-API-main\Services\ProductServices\ProductVariantCommandService.cs:line 611
   at E_Commerce.Services.ProductServices.ProductVariantService.AddVariantQuantityAsync(Int32 id, Int32 addQuantity, String userId) in D:\project_fashion\E-Commerce-API-main\Services\ProductServices\ProductVariantService.cs:line 73
   at E_Commerce.Controllers.ProductVariantController.AddVariantQuantity(Int32 productId, Int32 id, Int32 quantity) in D:\project_fashion\E-Commerce-API-main\Controllers\ProductVariantController.cs:line 148
   at lambda_method939(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.ResponseCaching.ResponseCachingMiddleware.Invoke(HttpContext httpContext)
   at SecurityStampMiddleware.Invoke(HttpContext context) in D:\project_fashion\E-Commerce-API-main\MiddleWares\SecurityStampMiddleware.cs:line 75
   at E_Commerce.Middleware.UserAuthenticationMiddleware.InvokeAsync(HttpContext context) in D:\project_fashion\E-Commerce-API-main\Middleware\UserAuthenticationMiddleware.cs:line 38
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.RateLimiting.RateLimitingMiddleware.InvokeInternal(HttpContext context, EnableRateLimitingAttribute enableRateLimitingAttribute)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-31 14:07:41.302 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-08-31 14:07:41.357 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/quantity/add?quantity=1 - 500 null text/plain; charset=utf-8 840.1338ms
2025-08-31 14:08:23.422 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/deactivate - null null
2025-08-31 14:08:23.430 +03:00 [INF] CORS policy execution successful.
2025-08-31 14:08:23.437 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 14:08:23.594 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 14:08:23.610 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.DeactivateVariant (E-Commerce)'
2025-08-31 14:08:23.627 +03:00 [INF] Route matched with {action = "DeactivateVariant", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] DeactivateVariant(Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 14:08:23.654 +03:00 [INF] Deactivating variant: 1
2025-08-31 14:08:23.893 +03:00 [INF] Execute GetAll for entity ProductVariant
2025-08-31 14:08:24.000 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Quantity` > 0 AS `hasquntity`, `p`.`DeletedAt` IS NOT NULL AS `isdeleted`, `p`.`Size` IS NOT NULL AS `hassize`, ((`p`.`Length` <> 0) OR `p`.`Length` IS NULL) AND ((`p`.`Waist` <> 0) OR `p`.`Waist` IS NULL) AS `haslengthandwaist`, `p`.`ProductId` AS `productid`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-31 14:08:24.010 +03:00 [INF] Attempting to deactivate variant 1
2025-08-31 14:08:24.097 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE (`p`.`Id` = @__id_0) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-31 14:08:24.106 +03:00 [INF] Successfully deactivated variant 1
2025-08-31 14:08:24.115 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 14:08:24.117 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 14:08:24.120 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 14:08:24.125 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 14:08:24.137 +03:00 [ERR] An error occurred using a transaction.
2025-08-31 14:08:24.141 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.DeactivateVariant (E-Commerce) in 499.6711ms
2025-08-31 14:08:24.154 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.DeactivateVariant (E-Commerce)'
2025-08-31 14:08:24.159 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: This MySqlConnection is already in use. See https://fl.vu/mysql-conn-reuse
   at MySqlConnector.Core.ServerSession.StartQuerying(ICancellableCommand command) in /_/src/MySqlConnector/Core/ServerSession.cs:line 289
   at MySqlConnector.Core.CommandExecutor.ExecuteReaderAsync(CommandListPosition commandListPosition, ICommandPayloadCreator payloadCreator, CommandBehavior behavior, Activity activity, IOBehavior ioBehavior, CancellationToken cancellationToken)
   at MySqlConnector.MySqlCommand.ExecuteNonQueryAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 309
   at MySqlConnector.MySqlTransaction.DoRollback(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlTransaction.cs:line 269
   at MySqlConnector.MySqlTransaction.RollbackAsync(IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlTransaction.cs:line 67
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.RollbackAsync(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.RollbackAsync(CancellationToken cancellationToken)
   at E_Commerce.Services.ProductServices.ProductVariantCommandService.DeactivateVariantAsync(Int32 id, String userId) in D:\project_fashion\E-Commerce-API-main\Services\ProductServices\ProductVariantCommandService.cs:line 563
   at E_Commerce.Services.ProductServices.ProductVariantService.DeactivateVariantAsync(Int32 id, String userId) in D:\project_fashion\E-Commerce-API-main\Services\ProductServices\ProductVariantService.cs:line 70
   at E_Commerce.Controllers.ProductVariantController.DeactivateVariant(Int32 productId, Int32 id) in D:\project_fashion\E-Commerce-API-main\Controllers\ProductVariantController.cs:line 193
   at lambda_method1020(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.ResponseCaching.ResponseCachingMiddleware.Invoke(HttpContext httpContext)
   at SecurityStampMiddleware.Invoke(HttpContext context) in D:\project_fashion\E-Commerce-API-main\MiddleWares\SecurityStampMiddleware.cs:line 75
   at E_Commerce.Middleware.UserAuthenticationMiddleware.InvokeAsync(HttpContext context) in D:\project_fashion\E-Commerce-API-main\Middleware\UserAuthenticationMiddleware.cs:line 38
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.RateLimiting.RateLimitingMiddleware.InvokeInternal(HttpContext context, EnableRateLimitingAttribute enableRateLimitingAttribute)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-31 14:08:24.193 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-08-31 14:08:24.207 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/deactivate - 500 null text/plain; charset=utf-8 784.5303ms
2025-08-31 14:08:24.219 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'E_Commerce.Context.AppDbContext'.
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'AppDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.Microsoft.EntityFrameworkCore.Internal.IDbContextDependencies.get_StateManager()
   at Microsoft.EntityFrameworkCore.Query.QueryContextDependencies.get_StateManager()
   at Microsoft.EntityFrameworkCore.Query.QueryContext.InitializeStateManager(Boolean standAlone)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'AppDbContext'.
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.Microsoft.EntityFrameworkCore.Internal.IDbContextDependencies.get_StateManager()
   at Microsoft.EntityFrameworkCore.Query.QueryContextDependencies.get_StateManager()
   at Microsoft.EntityFrameworkCore.Query.QueryContext.InitializeStateManager(Boolean standAlone)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
2025-08-31 14:08:46.534 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/subcategories/1/deactivate - null null
2025-08-31 14:08:46.650 +03:00 [INF] CORS policy execution successful.
2025-08-31 14:08:46.657 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 14:08:46.816 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 14:08:46.827 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.SubCategoryController.Deactivate (E-Commerce)'
2025-08-31 14:08:46.837 +03:00 [INF] Route matched with {action = "Deactivate", controller = "SubCategory"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] Deactivate(Int32) on controller E_Commerce.Controllers.SubCategoryController (E-Commerce).
2025-08-31 14:08:46.851 +03:00 [INF] Executing Deactivate for id: 1
2025-08-31 14:08:47.092 +03:00 [INF] Execute GetAll for entity SubCategory
2025-08-31 14:08:47.197 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__8__locals1_subCategoryId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `s`.`IsActive`, EXISTS (
    SELECT 1
    FROM `Products` AS `p`
    WHERE (`s`.`Id` = `p`.`SubCategoryId`) AND (`p`.`IsActive` AND (`p`.`DeletedAt` IS NULL))) AS `HasActiveSubCategories`, EXISTS (
    SELECT 1
    FROM `Images` AS `i`
    WHERE (`s`.`Id` = `i`.`SubCategoryId`) AND `i`.`DeletedAt` IS NULL) AS `HasImages`, `s`.`CategoryId`
FROM `SubCategories` AS `s`
WHERE (`s`.`Id` = @__8__locals1_subCategoryId_0) AND `s`.`DeletedAt` IS NULL
LIMIT 1
2025-08-31 14:08:47.206 +03:00 [INF] Deactivating subcategory 1
2025-08-31 14:08:47.210 +03:00 [INF] SubCategory 1 is already inactive. No action taken.
2025-08-31 14:08:47.291 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 14:08:47.297 +03:00 [INF] Executed action E_Commerce.Controllers.SubCategoryController.Deactivate (E-Commerce) in 448.4967ms
2025-08-31 14:08:47.302 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.SubCategoryController.Deactivate (E-Commerce)'
2025-08-31 14:08:47.307 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/subcategories/1/deactivate - 400 304 application/json; charset=utf-8 773.0852ms
2025-08-31 14:09:13.401 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Discount/1/deactivate - null null
2025-08-31 14:09:13.409 +03:00 [INF] CORS policy execution successful.
2025-08-31 14:09:13.414 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 14:09:13.577 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 14:09:13.591 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.DiscountController.DeactivateAsync (E-Commerce)'
2025-08-31 14:09:13.606 +03:00 [INF] Route matched with {action = "DeactivateAsync", controller = "Discount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] DeactivateAsync(Int32) on controller E_Commerce.Controllers.DiscountController (E-Commerce).
2025-08-31 14:09:13.627 +03:00 [INF] Executing DeactivateAsync for ID: 1
2025-08-31 14:09:13.639 +03:00 [INF] Deactivating discount: 1
2025-08-31 14:09:13.644 +03:00 [INF] Executing GetByIdAsync for entity Discount with ID: 1
2025-08-31 14:09:13.811 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `d`.`Id`, `d`.`CategoryId`, `d`.`CreatedAt`, `d`.`DeletedAt`, `d`.`Description`, `d`.`DiscountPercent`, `d`.`EndDate`, `d`.`IsActive`, `d`.`ModifiedAt`, `d`.`Name`, `d`.`StartDate`
FROM `Discount` AS `d`
WHERE `d`.`Id` = @__id_0
LIMIT 1
2025-08-31 14:09:14.101 +03:00 [INF] Execute Update for entity Discount
2025-08-31 14:09:14.107 +03:00 [INF] Discount marked for update (pending save)
2025-08-31 14:09:14.116 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 14:09:14.121 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 14:09:14.124 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 14:09:14.127 +03:00 [INF] Execute GetAll for entity Product
2025-08-31 14:09:14.226 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__8__locals1_id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`
FROM `Products` AS `p`
WHERE (`p`.`DiscountId` = @__8__locals1_id_0) AND `p`.`DeletedAt` IS NULL
2025-08-31 14:09:15.365 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p10='?' (DbType = Int32), @p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 50), @p4='?' (DbType = Decimal), @p5='?' (DbType = DateTime), @p6='?' (DbType = Boolean), @p7='?' (DbType = DateTime), @p8='?' (Size = 20), @p9='?' (DbType = DateTime), @p11='?' (Size = 255), @p12='?' (DbType = DateTime), @p13='?' (DbType = DateTime), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (DbType = DateTime), @p17='?' (DbType = Int32), @p18='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Discount` SET `CategoryId` = @p0, `CreatedAt` = @p1, `DeletedAt` = @p2, `Description` = @p3, `DiscountPercent` = @p4, `EndDate` = @p5, `IsActive` = @p6, `ModifiedAt` = @p7, `Name` = @p8, `StartDate` = @p9
WHERE `Id` = @p10;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 14:09:18.300 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 14:09:18.316 +03:00 [INF] Executed action E_Commerce.Controllers.DiscountController.DeactivateAsync (E-Commerce) in 4699.487ms
2025-08-31 14:09:18.331 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.DiscountController.DeactivateAsync (E-Commerce)'
2025-08-31 14:09:18.341 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Discount/1/deactivate - 200 136 application/json; charset=utf-8 4939.8193ms
2025-08-31 14:09:20.391 +03:00 [INF] Execute GetAll for entity CartItem
2025-08-31 14:09:20.636 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`, `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`
FROM `CartItems` AS `c`
INNER JOIN `Products` AS `p` ON `c`.`ProductId` = `p`.`Id`
WHERE FALSE
2025-08-31 14:09:20.661 +03:00 [INF] Execute Update for entity CartItem
2025-08-31 14:09:20.671 +03:00 [INF] CartItem marked for update (pending save)
2025-08-31 14:09:21.698 +03:00 [INF] Removing cache by tags: [subcategory, subcategorywithdata]
2025-08-31 14:09:21.698 +03:00 [INF] Removing cache by tags: [product_search, categorywithdata, productwithvariantdata]
2025-08-31 14:09:21.710 +03:00 [INF] Removing cache by tags: [collection, CollectionWithProduct]
2025-08-31 14:09:22.550 +03:00 [INF] Removed 1 cache entries for tags: [subcategory, subcategorywithdata]
2025-08-31 14:09:22.989 +03:00 [INF] Removed 3 cache entries for tags: [collection, CollectionWithProduct]
2025-08-31 14:09:24.217 +03:00 [INF] Removing cache by tag: cart
2025-08-31 14:09:24.244 +03:00 [INF] Removed 8 cache entries for tags: [product_search, categorywithdata, productwithvariantdata]
2025-08-31 14:09:25.070 +03:00 [INF] Removed 2 cache entries for tag: cart
2025-08-31 15:46:35.938 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 15:46:37.793 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 15:46:38.768 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 15:46:39.481 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 15:46:39.667 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 15:46:39.689 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 15:46:39.702 +03:00 [INF] Starting data seeding...
2025-08-31 15:46:39.733 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 15:46:40.270 +03:00 [INF] Executed DbCommand (114ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 15:46:40.343 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 15:46:40.502 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 15:46:40.508 +03:00 [INF] Role 'User' already exists.
2025-08-31 15:46:40.702 +03:00 [INF] Executed DbCommand (87ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 15:46:40.805 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 15:46:40.807 +03:00 [INF] Data seeding completed successfully.
2025-08-31 15:46:42.263 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 15:46:42.351 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 15:46:42.355 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 15:46:42.358 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 15:46:42.360 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 15:46:42.377 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 15:46:42.379 +03:00 [INF] Hosting environment: Development
2025-08-31 15:46:42.382 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 15:46:42.580 +03:00 [INF] Server mrrobot:17624:4dc0f929 successfully announced in 183.8092 ms
2025-08-31 15:46:42.599 +03:00 [INF] Server mrrobot:17624:4dc0f929 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 15:46:42.654 +03:00 [INF] Server mrrobot:17624:4dc0f929 all the dispatchers started
2025-08-31 15:46:42.761 +03:00 [INF] 1 servers were removed due to timeout
2025-08-31 15:46:43.565 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 15:46:44.750 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 1229.8086ms
2025-08-31 15:46:44.808 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 15:46:44.853 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 15:46:44.949 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 15:46:44.956 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 147.6747ms
2025-08-31 15:46:44.977 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 27.7352ms
2025-08-31 15:46:45.047 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 194.1266ms
2025-08-31 15:46:45.348 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 15:46:45.720 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 371.7564ms
2025-08-31 15:47:20.649 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/quantity/add?quantity=1 - null null
2025-08-31 15:47:20.660 +03:00 [INF] CORS policy execution successful.
2025-08-31 15:47:20.664 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-31 15:47:20.905 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 15:47:21.125 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 15:47:21.150 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce)'
2025-08-31 15:47:21.180 +03:00 [INF] Route matched with {action = "AddVariantQuantity", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddVariantQuantity(Int32, Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 15:47:21.504 +03:00 [INF] Adding quantity for variant: 1
2025-08-31 15:47:21.765 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-31 15:47:21.863 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-31 15:47:21.905 +03:00 [INF] Updating quantity for variant 1 to 20
2025-08-31 15:47:21.915 +03:00 [INF] Quantity updated for variant ID 1
2025-08-31 15:47:21.920 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 15:47:21.927 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 15:47:21.998 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 15:47:22.194 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-08-31 15:47:22.207 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'E_Commerce.Context.AppDbContext'.
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-08-31 15:47:22.298 +03:00 [ERR] Error in AddVariantQuantityAsync for id: 1
System.InvalidOperationException: A second operation was started on this context instance before a previous operation completed. This is usually caused by different threads concurrently using the same instance of DbContext. For more information on how to avoid threading issues with DbContext, see https://go.microsoft.com/fwlink/?linkid=2097913.
   at Microsoft.EntityFrameworkCore.Infrastructure.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at UnitOfWork.CommitAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 64
   at E_Commerce.Services.ProductServices.ProductVariantCommandService.AddVariantQuantityAsync(Int32 id, Int32 addQuantity, String userId) in D:\project_fashion\E-Commerce-API-main\Services\ProductServices\ProductVariantCommandService.cs:line 539
2025-08-31 15:47:23.449 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 15:47:23.482 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce) in 2289.8789ms
2025-08-31 15:47:23.488 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce)'
2025-08-31 15:47:23.497 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/quantity/add?quantity=1 - 500 205 application/json; charset=utf-8 2847.8906ms
2025-08-31 15:50:38.291 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 15:50:38.320 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 29.6482ms
2025-08-31 15:50:38.416 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 15:50:38.420 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 15:50:38.425 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 15:50:38.426 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 9.6697ms
2025-08-31 15:50:38.445 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 25.6624ms
2025-08-31 15:50:38.449 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 23.7902ms
2025-08-31 15:50:39.018 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 15:50:39.234 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 216.2208ms
2025-08-31 15:51:08.605 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 15:51:08.644 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 38.7101ms
2025-08-31 15:51:08.891 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 15:51:08.964 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 73.5871ms
2025-08-31 15:51:09.028 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 15:51:09.041 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 15:51:09.043 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 15.0036ms
2025-08-31 15:51:09.051 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 10.0121ms
2025-08-31 15:51:09.284 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 15:51:09.406 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 122.0356ms
2025-08-31 15:51:25.044 +03:00 [INF] Setting cache for key: advsearch__________False_1_100_True_False
2025-08-31 15:51:25.349 +03:00 [INF] Cache set successfully for key: advsearch__________False_1_100_True_False with tags: [product_search]
2025-08-31 15:52:41.469 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 15:52:42.673 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 15:52:43.715 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 15:52:45.219 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 15:52:45.421 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 15:52:45.443 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 15:52:45.457 +03:00 [INF] Starting data seeding...
2025-08-31 15:52:45.486 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 15:52:46.001 +03:00 [INF] Executed DbCommand (127ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 15:52:46.091 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 15:52:46.271 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 15:52:46.278 +03:00 [INF] Role 'User' already exists.
2025-08-31 15:52:46.456 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 15:52:46.566 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 15:52:46.568 +03:00 [INF] Data seeding completed successfully.
2025-08-31 15:52:47.880 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 15:52:47.963 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 15:52:47.967 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 15:52:47.969 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 15:52:47.971 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 15:52:47.995 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 15:52:48.015 +03:00 [INF] Hosting environment: Development
2025-08-31 15:52:48.019 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 15:52:48.188 +03:00 [INF] Server mrrobot:16136:ed31d7ad successfully announced in 175.9399 ms
2025-08-31 15:52:48.195 +03:00 [INF] Server mrrobot:16136:ed31d7ad is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 15:52:48.227 +03:00 [INF] Server mrrobot:16136:ed31d7ad all the dispatchers started
2025-08-31 15:52:48.346 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 15:52:48.635 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 15:52:48.639 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 15:52:48.645 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 296.803ms
2025-08-31 15:52:48.700 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 60.7182ms
2025-08-31 15:52:48.715 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 15:52:48.758 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 123.3798ms
2025-08-31 15:52:48.816 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 101.0409ms
2025-08-31 15:52:49.028 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 15:52:49.277 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 248.2997ms
2025-08-31 15:53:07.158 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/quantity/add?quantity=1 - null null
2025-08-31 15:53:07.171 +03:00 [INF] CORS policy execution successful.
2025-08-31 15:53:07.195 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-31 15:53:07.305 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 15:53:07.319 +03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Admin)
2025-08-31 15:53:07.326 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-08-31 15:53:07.330 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/quantity/add?quantity=1 - 401 0 null 171.7499ms
2025-08-31 15:53:19.446 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/quantity/add?quantity=1 - null null
2025-08-31 15:53:19.455 +03:00 [INF] CORS policy execution successful.
2025-08-31 15:53:19.547 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 15:53:19.767 +03:00 [INF] Executed DbCommand (87ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 15:53:19.783 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce)'
2025-08-31 15:53:19.820 +03:00 [INF] Route matched with {action = "AddVariantQuantity", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddVariantQuantity(Int32, Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 15:53:20.150 +03:00 [INF] Adding quantity for variant: 1
2025-08-31 15:53:20.449 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-31 15:53:20.574 +03:00 [INF] Executed DbCommand (107ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-31 15:53:20.623 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 15:53:20.628 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 15:53:20.689 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 15:53:20.972 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 15:53:23.108 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 15:53:23.131 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce) in 3298.0907ms
2025-08-31 15:53:23.136 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce)'
2025-08-31 15:53:23.144 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/quantity/add?quantity=1 - 200 130 application/json; charset=utf-8 3698.4161ms
2025-08-31 15:53:24.042 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-08-31 15:53:24.505 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-08-31 15:53:28.409 +03:00 [ERR] Failed executing DbCommand (2ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-08-31 15:53:28.458 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'E_Commerce.Context.AppDbContext'.
System.InvalidOperationException: Connection must be Open; current state is Closed
   at MySqlConnector.MySqlConnection.get_Session() in /_/src/MySqlConnector/MySqlConnection.cs:line 733
   at MySqlConnector.Core.ICancellableCommandExtensions.ResetCommandTimeout(ICancellableCommand command) in /_/src/MySqlConnector/Core/ICancellableCommand.cs:line 42
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 355
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: Connection must be Open; current state is Closed
   at MySqlConnector.MySqlConnection.get_Session() in /_/src/MySqlConnector/MySqlConnection.cs:line 733
   at MySqlConnector.Core.ICancellableCommandExtensions.ResetCommandTimeout(ICancellableCommand command) in /_/src/MySqlConnector/Core/ICancellableCommand.cs:line 42
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 355
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
2025-08-31 15:53:39.586 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - null null
2025-08-31 15:53:39.664 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 15:53:39.822 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 15:53:39.832 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 15:53:39.840 +03:00 [INF] Route matched with {action = "GetVariantById", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ProductDtos.ProductVariantDto]]] GetVariantById(Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 15:53:39.856 +03:00 [INF] Getting variant by id: 1
2025-08-31 15:53:39.860 +03:00 [INF] Getting cache for key: variant:1
2025-08-31 15:53:40.077 +03:00 [WRN] Cache miss for key: variant:1
2025-08-31 15:53:40.090 +03:00 [INF] Getting variant by ID: 1
2025-08-31 15:53:40.338 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE (`p`.`Id` = @__id_0) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-31 15:53:40.410 +03:00 [INF] Caching variant 1 data
2025-08-31 15:53:41.351 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ProductDtos.ProductVariantDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 15:53:41.369 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce) in 1521.7556ms
2025-08-31 15:53:41.391 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 15:53:41.399 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - 200 308 application/json; charset=utf-8 1813.1456ms
2025-08-31 15:53:42.794 +03:00 [INF] Setting cache for key: variant:1
2025-08-31 15:53:43.039 +03:00 [INF] Cache set successfully for key: variant:1 with tags: [product:1, variantdata]
2025-08-31 15:53:52.481 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/quantity/add?quantity=1 - null null
2025-08-31 15:53:52.491 +03:00 [INF] CORS policy execution successful.
2025-08-31 15:53:52.494 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 15:53:52.649 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 15:53:52.658 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce)'
2025-08-31 15:53:52.661 +03:00 [INF] Route matched with {action = "AddVariantQuantity", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddVariantQuantity(Int32, Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 15:53:52.706 +03:00 [INF] Adding quantity for variant: 1
2025-08-31 15:53:52.947 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-31 15:53:53.030 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-31 15:53:53.041 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 15:53:53.044 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 15:53:53.047 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 15:53:53.337 +03:00 [INF] Executed DbCommand (141ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 15:53:56.296 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 15:53:56.303 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce) in 3639.3236ms
2025-08-31 15:53:56.309 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce)'
2025-08-31 15:53:56.318 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/quantity/add?quantity=1 - 200 130 application/json; charset=utf-8 3836.3069ms
2025-08-31 15:53:58.002 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-08-31 15:53:58.869 +03:00 [INF] Removed 1 cache entries for tags: [variantlist, variantdata]
2025-08-31 15:54:01.677 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - null null
2025-08-31 15:54:01.684 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 15:54:01.851 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 15:54:01.861 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 15:54:01.867 +03:00 [INF] Route matched with {action = "GetVariantById", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ProductDtos.ProductVariantDto]]] GetVariantById(Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 15:54:01.874 +03:00 [INF] Getting variant by id: 1
2025-08-31 15:54:01.878 +03:00 [INF] Getting cache for key: variant:1
2025-08-31 15:54:02.093 +03:00 [WRN] Cache miss for key: variant:1
2025-08-31 15:54:02.096 +03:00 [INF] Getting variant by ID: 1
2025-08-31 15:54:02.256 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE (`p`.`Id` = @__id_0) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-31 15:54:02.264 +03:00 [INF] Caching variant 1 data
2025-08-31 15:54:02.634 +03:00 [ERR] Failed executing DbCommand (0ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-08-31 15:54:02.645 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'E_Commerce.Context.AppDbContext'.
System.InvalidOperationException: Connection must be Open; current state is Closed
   at MySqlConnector.MySqlConnection.get_Session() in /_/src/MySqlConnector/MySqlConnection.cs:line 733
   at MySqlConnector.Core.ICancellableCommandExtensions.ResetCommandTimeout(ICancellableCommand command) in /_/src/MySqlConnector/Core/ICancellableCommand.cs:line 42
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 355
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: Connection must be Open; current state is Closed
   at MySqlConnector.MySqlConnection.get_Session() in /_/src/MySqlConnector/MySqlConnection.cs:line 733
   at MySqlConnector.Core.ICancellableCommandExtensions.ResetCommandTimeout(ICancellableCommand command) in /_/src/MySqlConnector/Core/ICancellableCommand.cs:line 42
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 355
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
2025-08-31 15:54:03.363 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ProductDtos.ProductVariantDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 15:54:03.367 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce) in 1494.4058ms
2025-08-31 15:54:03.372 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 15:54:03.376 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - 200 308 application/json; charset=utf-8 1698.4612ms
2025-08-31 15:54:05.204 +03:00 [INF] Setting cache for key: variant:1
2025-08-31 15:54:05.422 +03:00 [INF] Cache set successfully for key: variant:1 with tags: [product:1, variantdata]
2025-08-31 15:54:29.864 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - null null
2025-08-31 15:54:29.875 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 15:54:30.036 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 15:54:30.044 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 15:54:30.048 +03:00 [INF] Route matched with {action = "GetVariantById", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ProductDtos.ProductVariantDto]]] GetVariantById(Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 15:54:30.053 +03:00 [INF] Getting variant by id: 1
2025-08-31 15:54:30.058 +03:00 [INF] Getting cache for key: variant:1
2025-08-31 15:54:30.274 +03:00 [INF] Cache hit for key: variant:1
2025-08-31 15:54:30.288 +03:00 [INF] Retrieved variant 1 from cache
2025-08-31 15:54:30.291 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ProductDtos.ProductVariantDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 15:54:30.296 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce) in 244.5011ms
2025-08-31 15:54:30.300 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 15:54:30.302 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - 200 306 application/json; charset=utf-8 438.2056ms
2025-08-31 15:54:42.885 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/quantity/add?quantity=1 - null null
2025-08-31 15:54:42.900 +03:00 [INF] CORS policy execution successful.
2025-08-31 15:54:42.902 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 15:54:43.067 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 15:54:43.078 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce)'
2025-08-31 15:54:43.080 +03:00 [INF] Route matched with {action = "AddVariantQuantity", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddVariantQuantity(Int32, Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 15:54:43.086 +03:00 [INF] Adding quantity for variant: 1
2025-08-31 15:54:43.330 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-31 15:54:43.409 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-31 15:54:43.417 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 15:54:43.420 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 15:54:43.426 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 15:54:43.645 +03:00 [INF] Executed DbCommand (141ms) [Parameters=[@p0='?' (Size = 255), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 15:54:45.963 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 15:54:45.969 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce) in 2883.834ms
2025-08-31 15:54:45.975 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce)'
2025-08-31 15:54:45.977 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/quantity/add?quantity=1 - 200 130 application/json; charset=utf-8 3092.3581ms
2025-08-31 15:54:47.015 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-08-31 15:54:47.865 +03:00 [INF] Removed 1 cache entries for tags: [variantlist, variantdata]
2025-08-31 15:55:11.753 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - null null
2025-08-31 15:55:11.762 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 15:55:11.922 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 15:55:11.929 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 15:55:11.932 +03:00 [INF] Route matched with {action = "GetVariantById", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ProductDtos.ProductVariantDto]]] GetVariantById(Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 15:55:11.937 +03:00 [INF] Getting variant by id: 1
2025-08-31 15:55:11.941 +03:00 [INF] Getting cache for key: variant:1
2025-08-31 15:55:12.156 +03:00 [WRN] Cache miss for key: variant:1
2025-08-31 15:55:12.158 +03:00 [INF] Getting variant by ID: 1
2025-08-31 15:55:12.324 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE (`p`.`Id` = @__id_0) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-31 15:55:12.334 +03:00 [INF] Caching variant 1 data
2025-08-31 15:55:13.282 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ProductDtos.ProductVariantDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 15:55:13.288 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce) in 1352.0582ms
2025-08-31 15:55:13.296 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 15:55:13.298 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - 200 308 application/json; charset=utf-8 1545.6508ms
2025-08-31 15:55:15.831 +03:00 [INF] Setting cache for key: variant:1
2025-08-31 15:55:16.061 +03:00 [INF] Cache set successfully for key: variant:1 with tags: [product:1, variantdata]
2025-08-31 15:56:06.461 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 15:56:06.501 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 39.3605ms
2025-08-31 15:56:06.605 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 15:56:06.615 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 10.1568ms
2025-08-31 15:56:06.627 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 15:56:06.628 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 15:56:06.644 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 15.705ms
2025-08-31 15:56:06.651 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 23.7465ms
2025-08-31 15:56:07.662 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 15:56:07.857 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 195.3462ms
2025-08-31 15:56:39.375 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/quantity/add?quantity=1 - null null
2025-08-31 15:56:39.383 +03:00 [INF] CORS policy execution successful.
2025-08-31 15:56:39.386 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 15:56:39.554 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 15:56:39.564 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce)'
2025-08-31 15:56:39.575 +03:00 [INF] Route matched with {action = "AddVariantQuantity", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddVariantQuantity(Int32, Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 15:56:39.589 +03:00 [INF] Adding quantity for variant: 1
2025-08-31 15:56:39.822 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-31 15:56:39.905 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-31 15:56:39.914 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 15:56:39.917 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 15:56:39.920 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 15:56:40.088 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `ProductVariants` SET `Quantity` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 15:56:42.112 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 15:56:42.120 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce) in 2537.8992ms
2025-08-31 15:56:42.125 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.AddVariantQuantity (E-Commerce)'
2025-08-31 15:56:42.131 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Products/1/Variants/1/quantity/add?quantity=1 - 200 130 application/json; charset=utf-8 2756.6079ms
2025-08-31 15:56:44.826 +03:00 [ERR] Failed executing DbCommand (0ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-08-31 15:56:44.835 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'E_Commerce.Context.AppDbContext'.
System.InvalidOperationException: Connection must be Open; current state is Closed
   at MySqlConnector.MySqlConnection.get_Session() in /_/src/MySqlConnector/MySqlConnection.cs:line 733
   at MySqlConnector.Core.ICancellableCommandExtensions.ResetCommandTimeout(ICancellableCommand command) in /_/src/MySqlConnector/Core/ICancellableCommand.cs:line 42
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 355
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: Connection must be Open; current state is Closed
   at MySqlConnector.MySqlConnection.get_Session() in /_/src/MySqlConnector/MySqlConnection.cs:line 733
   at MySqlConnector.Core.ICancellableCommandExtensions.ResetCommandTimeout(ICancellableCommand command) in /_/src/MySqlConnector/Core/ICancellableCommand.cs:line 42
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 355
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
2025-08-31 15:56:53.069 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - null null
2025-08-31 15:56:53.085 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 15:56:53.264 +03:00 [INF] Executed DbCommand (92ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 15:56:53.272 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 15:56:53.280 +03:00 [INF] Route matched with {action = "GetVariantById", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ProductDtos.ProductVariantDto]]] GetVariantById(Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 15:56:53.287 +03:00 [INF] Getting variant by id: 1
2025-08-31 15:56:53.289 +03:00 [INF] Getting cache for key: variant:1
2025-08-31 15:56:53.510 +03:00 [WRN] Cache miss for key: variant:1
2025-08-31 15:56:53.512 +03:00 [INF] Getting variant by ID: 1
2025-08-31 15:56:53.719 +03:00 [INF] Executed DbCommand (94ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE (`p`.`Id` = @__id_0) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-31 15:56:53.731 +03:00 [INF] Caching variant 1 data
2025-08-31 15:56:54.742 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ProductDtos.ProductVariantDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 15:56:54.749 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce) in 1462.3018ms
2025-08-31 15:56:54.754 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 15:56:54.756 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - 200 308 application/json; charset=utf-8 1687.6371ms
2025-08-31 15:56:56.433 +03:00 [INF] Setting cache for key: variant:1
2025-08-31 15:56:56.686 +03:00 [INF] Cache set successfully for key: variant:1 with tags: [product:1, variantdata]
2025-08-31 15:57:48.520 +03:00 [INF] 1 servers were removed due to timeout
2025-08-31 16:07:57.037 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 16:07:57.052 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 15.5404ms
2025-08-31 16:07:57.084 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 16:07:57.091 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 6.3741ms
2025-08-31 16:07:57.105 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 16:07:57.109 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 16:07:57.118 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 9.1483ms
2025-08-31 16:07:57.120 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 14.2899ms
2025-08-31 16:07:57.770 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 16:07:57.985 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 215.0563ms
2025-08-31 16:11:16.789 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 16:11:16.803 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 13.9868ms
2025-08-31 16:11:16.850 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 16:11:16.861 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 16:11:16.864 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 16.4659ms
2025-08-31 16:11:16.878 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 17.4193ms
2025-08-31 16:11:16.886 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 16:11:16.903 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 16.9746ms
2025-08-31 16:11:17.132 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 16:11:17.236 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 104.0954ms
2025-08-31 16:12:17.074 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 16:12:17.090 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 15.6158ms
2025-08-31 16:12:17.122 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 16:12:17.140 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 17.6993ms
2025-08-31 16:12:17.146 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 16:12:17.147 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 16:12:17.152 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.4073ms
2025-08-31 16:12:17.166 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 18.8527ms
2025-08-31 16:12:17.302 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 16:12:17.415 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 112.7317ms
2025-08-31 16:12:21.164 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 16:12:21.175 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 10.6454ms
2025-08-31 16:12:21.206 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 16:12:21.214 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 7.9907ms
2025-08-31 16:12:21.227 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 16:12:21.230 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 16:12:21.249 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 21.3456ms
2025-08-31 16:12:21.255 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 25.4248ms
2025-08-31 16:12:21.415 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 16:12:21.551 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 135.9304ms
2025-08-31 16:48:55.729 +03:00 [INF] Execution RecurringJobScheduler recovered from the Faulted state after 00:00:21.5489188 and is in the Running state now
2025-08-31 16:50:41.002 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 16:50:42.618 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 16:50:44.075 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 16:50:44.807 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 16:50:44.996 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 16:50:45.022 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 16:50:45.039 +03:00 [INF] Starting data seeding...
2025-08-31 16:50:45.070 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 16:50:45.683 +03:00 [INF] Executed DbCommand (131ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 16:50:45.763 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 16:50:45.924 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 16:50:45.937 +03:00 [INF] Role 'User' already exists.
2025-08-31 16:50:46.132 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 16:50:46.285 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 16:50:46.291 +03:00 [INF] Data seeding completed successfully.
2025-08-31 16:50:48.156 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 16:50:48.468 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 16:50:48.552 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 16:50:48.671 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 16:50:48.715 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 16:50:48.890 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 16:50:48.968 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 16:50:49.121 +03:00 [INF] Hosting environment: Development
2025-08-31 16:50:49.137 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 16:50:49.158 +03:00 [INF] Server mrrobot:13684:c4a2850a successfully announced in 183.3534 ms
2025-08-31 16:50:49.219 +03:00 [INF] Server mrrobot:13684:c4a2850a is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 16:50:49.318 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 16:50:49.324 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 16:50:49.386 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 896.3135ms
2025-08-31 16:50:49.639 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 320.6091ms
2025-08-31 16:50:49.676 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 351.9666ms
2025-08-31 16:50:49.704 +03:00 [INF] Server mrrobot:13684:c4a2850a all the dispatchers started
2025-08-31 16:50:49.756 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 16:50:50.074 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 320.049ms
2025-08-31 16:50:50.172 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 16:50:50.730 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 552.2772ms
2025-08-31 16:52:44.856 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 16:52:44.872 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 15.7497ms
2025-08-31 16:52:44.923 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 16:52:44.929 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 5.8234ms
2025-08-31 16:52:44.983 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 16:52:44.983 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 16:52:44.990 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.9055ms
2025-08-31 16:52:45.012 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 28.6653ms
2025-08-31 16:52:45.275 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 16:52:45.383 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Conflicting method/path combination "GET api/Discount" for actions - E_Commerce.Controllers.DiscountController.GetAllAsync (E-Commerce), E_Commerce.Controllers.DiscountController.FilterAsync (E-Commerce). Actions require a unique method/path combination for Swagger/OpenAPI 2.0 and 3.0. Use ConflictingActionsResolver as a workaround or provide your own implementation of PathGroupSelector.
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.PrepareGenerateOperation(IGrouping`2 group)
   at System.Linq.Enumerable.IteratorSelectIterator`2.MoveNext()
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository, Func`3 operationsGenerator)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-31 16:52:45.417 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 141.541ms
2025-08-31 16:53:33.608 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 16:53:33.621 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 12.0875ms
2025-08-31 16:53:33.644 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 16:53:33.647 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 16:53:33.652 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 16:53:33.656 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 11.9206ms
2025-08-31 16:53:33.666 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 19.5361ms
2025-08-31 16:53:33.672 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 19.9436ms
2025-08-31 16:53:34.150 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 16:53:34.207 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Conflicting method/path combination "GET api/Discount" for actions - E_Commerce.Controllers.DiscountController.GetAllAsync (E-Commerce), E_Commerce.Controllers.DiscountController.FilterAsync (E-Commerce). Actions require a unique method/path combination for Swagger/OpenAPI 2.0 and 3.0. Use ConflictingActionsResolver as a workaround or provide your own implementation of PathGroupSelector.
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.PrepareGenerateOperation(IGrouping`2 group)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository, Func`3 operationsGenerator)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-31 16:53:34.216 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 65.8043ms
2025-08-31 16:53:44.328 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 16:53:45.657 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 16:53:46.721 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 16:53:47.464 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 16:53:47.639 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 16:53:47.664 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 16:53:47.677 +03:00 [INF] Starting data seeding...
2025-08-31 16:53:47.703 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 16:53:48.234 +03:00 [INF] Executed DbCommand (118ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 16:53:48.301 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 16:53:48.459 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 16:53:48.466 +03:00 [INF] Role 'User' already exists.
2025-08-31 16:53:48.649 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 16:53:48.769 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 16:53:48.772 +03:00 [INF] Data seeding completed successfully.
2025-08-31 16:53:50.371 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 16:53:50.569 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 16:53:50.594 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 16:53:50.641 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 16:53:50.659 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 16:53:50.692 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 16:53:50.722 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 16:53:50.855 +03:00 [INF] Hosting environment: Development
2025-08-31 16:53:50.869 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 16:53:50.943 +03:00 [INF] Server mrrobot:12236:2dac65d4 successfully announced in 206.9499 ms
2025-08-31 16:53:50.954 +03:00 [INF] Server mrrobot:12236:2dac65d4 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 16:53:51.129 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 16:53:51.169 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 16:53:51.173 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 561.6077ms
2025-08-31 16:53:51.273 +03:00 [INF] Server mrrobot:12236:2dac65d4 all the dispatchers started
2025-08-31 16:53:51.370 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 241.2875ms
2025-08-31 16:53:51.403 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 234.7941ms
2025-08-31 16:53:51.426 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 16:53:51.697 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 271.5705ms
2025-08-31 16:53:51.982 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 16:53:52.498 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 511.9358ms
2025-08-31 16:57:52.677 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 16:57:52.692 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 14.7649ms
2025-08-31 16:57:52.740 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 16:57:52.749 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 9.4287ms
2025-08-31 16:57:52.768 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 16:57:52.770 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 16:57:52.781 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 11.4869ms
2025-08-31 16:57:52.786 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 18.0921ms
2025-08-31 16:57:52.978 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 16:57:53.177 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 199.4418ms
2025-08-31 16:58:39.086 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 16:58:39.097 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 11.7756ms
2025-08-31 16:58:39.212 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 16:58:39.220 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 16:58:39.220 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 7.8076ms
2025-08-31 16:58:39.232 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 12.1342ms
2025-08-31 16:58:39.239 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 16:58:39.275 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 35.5219ms
2025-08-31 16:58:40.054 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 16:58:40.142 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Conflicting method/path combination "GET api/Products" for actions - E_Commerce.Controllers.ProductController.GetProducts (E-Commerce), E_Commerce.Controllers.ProductController.GetProducts (E-Commerce). Actions require a unique method/path combination for Swagger/OpenAPI 2.0 and 3.0. Use ConflictingActionsResolver as a workaround or provide your own implementation of PathGroupSelector.
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.PrepareGenerateOperation(IGrouping`2 group)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository, Func`3 operationsGenerator)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-31 16:58:40.165 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 111.0529ms
2025-08-31 16:58:54.978 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 16:58:56.281 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 16:58:57.457 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 16:58:58.170 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 16:58:58.357 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 16:58:58.406 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 16:58:58.418 +03:00 [INF] Starting data seeding...
2025-08-31 16:58:58.444 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 16:58:58.973 +03:00 [INF] Executed DbCommand (115ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 16:58:59.037 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 16:58:59.199 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 16:58:59.225 +03:00 [INF] Role 'User' already exists.
2025-08-31 16:58:59.437 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 16:58:59.532 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 16:58:59.536 +03:00 [INF] Data seeding completed successfully.
2025-08-31 16:59:00.978 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 16:59:01.116 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 16:59:01.121 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 16:59:01.125 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 16:59:01.140 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 16:59:01.158 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 16:59:01.161 +03:00 [INF] Hosting environment: Development
2025-08-31 16:59:01.165 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 16:59:01.336 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 16:59:01.405 +03:00 [INF] Server mrrobot:10140:e86d6999 successfully announced in 234.9475 ms
2025-08-31 16:59:01.419 +03:00 [INF] Server mrrobot:10140:e86d6999 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 16:59:01.478 +03:00 [INF] Server mrrobot:10140:e86d6999 all the dispatchers started
2025-08-31 16:59:01.579 +03:00 [INF] 1 servers were removed due to timeout
2025-08-31 16:59:01.774 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 328.5948ms
2025-08-31 16:59:01.779 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 16:59:01.784 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 16:59:01.830 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 16:59:01.855 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 70.8902ms
2025-08-31 16:59:01.870 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 39.5563ms
2025-08-31 16:59:01.917 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 137.4218ms
2025-08-31 16:59:01.972 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 16:59:02.392 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 418.1555ms
2025-08-31 17:01:00.100 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 17:01:00.115 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 15.4811ms
2025-08-31 17:01:00.159 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 17:01:00.168 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 9.2437ms
2025-08-31 17:01:00.180 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 17:01:00.184 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 17:01:00.198 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 13.4523ms
2025-08-31 17:01:00.201 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 20.8513ms
2025-08-31 17:01:00.422 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 17:01:00.572 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Conflicting method/path combination "GET api/Products/{productId}/Variants" for actions - E_Commerce.Controllers.ProductVariantController.GetProductVariants (E-Commerce), E_Commerce.Controllers.ProductVariantController.SearchVariants (E-Commerce). Actions require a unique method/path combination for Swagger/OpenAPI 2.0 and 3.0. Use ConflictingActionsResolver as a workaround or provide your own implementation of PathGroupSelector.
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.PrepareGenerateOperation(IGrouping`2 group)
   at System.Linq.Enumerable.IteratorSelectIterator`2.MoveNext()
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperationsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository, Func`3 operationsGenerator)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePathsAsync(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-31 17:01:00.595 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 172.9329ms
2025-08-31 17:01:11.932 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 17:01:13.338 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 17:01:14.431 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 17:01:15.169 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 17:01:15.355 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 17:01:15.395 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 17:01:15.410 +03:00 [INF] Starting data seeding...
2025-08-31 17:01:15.451 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 17:01:16.015 +03:00 [INF] Executed DbCommand (109ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 17:01:16.086 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 17:01:16.246 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 17:01:16.255 +03:00 [INF] Role 'User' already exists.
2025-08-31 17:01:16.433 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 17:01:16.546 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 17:01:16.550 +03:00 [INF] Data seeding completed successfully.
2025-08-31 17:01:17.910 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 17:01:18.029 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 17:01:18.040 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 17:01:18.079 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 17:01:18.091 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 17:01:18.108 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 17:01:18.129 +03:00 [INF] Hosting environment: Development
2025-08-31 17:01:18.139 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 17:01:18.228 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 17:01:18.288 +03:00 [INF] Server mrrobot:9468:ef220af6 successfully announced in 173.1412 ms
2025-08-31 17:01:18.297 +03:00 [INF] Server mrrobot:9468:ef220af6 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 17:01:18.372 +03:00 [INF] Server mrrobot:9468:ef220af6 all the dispatchers started
2025-08-31 17:01:18.527 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 298.6791ms
2025-08-31 17:01:18.587 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 17:01:18.587 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 17:01:18.680 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 17:01:18.711 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 123.9737ms
2025-08-31 17:01:18.743 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 62.8226ms
2025-08-31 17:01:18.796 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 208.4524ms
2025-08-31 17:01:18.842 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 17:01:19.218 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 376.4155ms
2025-08-31 17:01:45.999 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json-patch+json 62
2025-08-31 17:01:46.008 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:01:46.012 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-31 17:01:46.154 +03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenMalformedException: IDX14100: JWT is not well formed, there are no dots (.).
The token needs to be in JWS or JWE Compact Serialization Format. (JWS): 'EncodedHeader.EndcodedPayload.EncodedSignature'. (JWE): 'EncodedProtectedHeader.EncodedEncryptedKey.EncodedInitializationVector.EncodedCiphertext.EncodedAuthenticationTag'.
 ---> Microsoft.IdentityModel.Tokens.SecurityTokenMalformedException: IDX14100: JWT is not well formed, there are no dots (.).
The token needs to be in JWS or JWE Compact Serialization Format. (JWS): 'EncodedHeader.EndcodedPayload.EncodedSignature'. (JWE): 'EncodedProtectedHeader.EncodedEncryptedKey.EncodedInitializationVector.EncodedCiphertext.EncodedAuthenticationTag'.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebToken.ReadToken(String encodedJson)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebToken..ctor(String jwtEncodedString)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ReadToken(String token, TokenValidationParameters validationParameters)
   --- End of inner exception stack trace ---
2025-08-31 17:01:46.185 +03:00 [INF] Bearer was not authenticated. Failure message: IDX14100: JWT is not well formed, there are no dots (.).
The token needs to be in JWS or JWE Compact Serialization Format. (JWS): 'EncodedHeader.EndcodedPayload.EncodedSignature'. (JWE): 'EncodedProtectedHeader.EncodedEncryptedKey.EncodedInitializationVector.EncodedCiphertext.EncodedAuthenticationTag'.
2025-08-31 17:01:46.194 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:01:46.214 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-08-31 17:01:46.227 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-08-31 17:01:46.234 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 401 0 null 233.9893ms
2025-08-31 17:02:06.286 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json-patch+json 62
2025-08-31 17:02:06.292 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:02:06.440 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:02:06.668 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:02:06.717 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:02:06.766 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:02:06.996 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-31 17:02:07.015 +03:00 [INF] Adding item to cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5, product: 1
2025-08-31 17:02:07.433 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:02:07.444 +03:00 [INF] Execute GetAll for entity Product
2025-08-31 17:02:07.768 +03:00 [INF] Executed DbCommand (163ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-08-31 17:02:07.913 +03:00 [INF] Executing NotFoundObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:02:07.994 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 1201.3357ms
2025-08-31 17:02:08.009 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:02:08.023 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 404 227 application/json; charset=utf-8 1736.2191ms
2025-08-31 17:02:32.084 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Products/1/activate - null null
2025-08-31 17:02:32.091 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:02:32.097 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:02:32.274 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:02:32.287 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductController.ActiveProduct (E-Commerce)'
2025-08-31 17:02:32.306 +03:00 [INF] Route matched with {action = "ActiveProduct", controller = "Product"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] ActiveProduct(Int32) on controller E_Commerce.Controllers.ProductController (E-Commerce).
2025-08-31 17:02:32.858 +03:00 [INF] Execute GetAll for entity Product
2025-08-31 17:02:32.970 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IsActive`, `p`.`DeletedAt` IS NOT NULL AS `isdeleted`, EXISTS (
    SELECT 1
    FROM `Images` AS `i`
    WHERE (`p`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL) AS `HasImages`, EXISTS (
    SELECT 1
    FROM `ProductVariants` AS `p0`
    WHERE (`p`.`Id` = `p0`.`ProductId`) AND (`p0`.`IsActive` AND (`p0`.`DeletedAt` IS NULL))) AS `HasActiveVariants`
FROM `Products` AS `p`
WHERE `p`.`Id` = @__productId_0
LIMIT 1
2025-08-31 17:02:33.063 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:02:33.069 +03:00 [INF] Executed action E_Commerce.Controllers.ProductController.ActiveProduct (E-Commerce) in 754.3473ms
2025-08-31 17:02:33.075 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductController.ActiveProduct (E-Commerce)'
2025-08-31 17:02:33.085 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Products/1/activate - 400 233 application/json; charset=utf-8 1000.7569ms
2025-08-31 17:02:54.425 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Products/1/restore - null null
2025-08-31 17:02:54.435 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:02:54.439 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:02:54.599 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:02:54.620 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductController.RestoreProductAsync (E-Commerce)'
2025-08-31 17:02:54.655 +03:00 [INF] Route matched with {action = "RestoreProduct", controller = "Product"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] RestoreProductAsync(Int32) on controller E_Commerce.Controllers.ProductController (E-Commerce).
2025-08-31 17:02:54.700 +03:00 [INF] Restoring product: 1
2025-08-31 17:02:55.053 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`
FROM `Products` AS `p`
WHERE (`p`.`Id` = @__productId_0) AND `p`.`DeletedAt` IS NOT NULL
LIMIT 1
2025-08-31 17:02:55.181 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 17:02:55.189 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 17:02:55.282 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 17:02:57.773 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `DeletedAt` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:02:57.996 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:02:58.003 +03:00 [INF] Executed action E_Commerce.Controllers.ProductController.RestoreProductAsync (E-Commerce) in 3332.3323ms
2025-08-31 17:02:58.007 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductController.RestoreProductAsync (E-Commerce)'
2025-08-31 17:02:58.011 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Products/1/restore - 200 132 application/json; charset=utf-8 3585.7565ms
2025-08-31 17:03:05.045 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Products/1/activate - null null
2025-08-31 17:03:05.053 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:03:05.057 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:03:05.258 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:03:05.267 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductController.ActiveProduct (E-Commerce)'
2025-08-31 17:03:05.270 +03:00 [INF] Route matched with {action = "ActiveProduct", controller = "Product"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] ActiveProduct(Int32) on controller E_Commerce.Controllers.ProductController (E-Commerce).
2025-08-31 17:03:05.550 +03:00 [INF] Execute GetAll for entity Product
2025-08-31 17:03:05.632 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`IsActive`, `p`.`DeletedAt` IS NOT NULL AS `isdeleted`, EXISTS (
    SELECT 1
    FROM `Images` AS `i`
    WHERE (`p`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL) AS `HasImages`, EXISTS (
    SELECT 1
    FROM `ProductVariants` AS `p0`
    WHERE (`p`.`Id` = `p0`.`ProductId`) AND (`p0`.`IsActive` AND (`p0`.`DeletedAt` IS NULL))) AS `HasActiveVariants`
FROM `Products` AS `p`
WHERE `p`.`Id` = @__productId_0
LIMIT 1
2025-08-31 17:03:05.726 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`
FROM `Products` AS `p`
WHERE ((`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL) AND NOT (`p`.`IsActive`)
LIMIT 1
2025-08-31 17:03:05.734 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 17:03:05.738 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 17:03:05.743 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 17:03:05.903 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Boolean), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `IsActive` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:03:07.878 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:03:07.892 +03:00 [INF] Executed action E_Commerce.Controllers.ProductController.ActiveProduct (E-Commerce) in 2614.8339ms
2025-08-31 17:03:07.928 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductController.ActiveProduct (E-Commerce)'
2025-08-31 17:03:07.937 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Products/1/activate - 200 133 application/json; charset=utf-8 2891.9052ms
2025-08-31 17:03:18.050 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json-patch+json 62
2025-08-31 17:03:18.070 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:03:18.072 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:03:18.230 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:03:18.252 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:03:18.258 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:03:18.278 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-31 17:03:18.286 +03:00 [INF] Adding item to cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5, product: 1
2025-08-31 17:03:18.599 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:03:18.624 +03:00 [INF] Execute GetAll for entity Product
2025-08-31 17:03:18.715 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-08-31 17:03:18.748 +03:00 [INF] Retrieving cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:03:18.928 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-31 17:03:18.979 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-08-31 17:03:19.028 +03:00 [INF] CartItem added successfully (pending save)
2025-08-31 17:03:19.059 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-31 17:03:19.100 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-31 17:03:19.131 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-31 17:03:19.212 +03:00 [ERR] Error adding item to cart for user ac03a6c3-9450-420a-9e6e-ea8902c018c5: Only public methods can be invoked in the background. Ensure your method has the `public` access modifier, and you aren't using explicit interface implementation.
2025-08-31 17:03:20.279 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:03:20.289 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 2015.991ms
2025-08-31 17:03:20.301 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:03:20.306 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 500 249 application/json; charset=utf-8 2255.2108ms
2025-08-31 17:05:19.365 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 17:05:21.610 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 17:05:23.028 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 17:05:23.747 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 17:05:23.983 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 17:05:24.028 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 17:05:24.070 +03:00 [INF] Starting data seeding...
2025-08-31 17:05:24.145 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 17:05:24.745 +03:00 [INF] Executed DbCommand (128ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 17:05:24.878 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 17:05:25.044 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 17:05:25.077 +03:00 [INF] Role 'User' already exists.
2025-08-31 17:05:25.268 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 17:05:25.410 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 17:05:25.415 +03:00 [INF] Data seeding completed successfully.
2025-08-31 17:05:27.379 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 17:05:27.508 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 17:05:27.528 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 17:05:27.542 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 17:05:27.545 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 17:05:27.652 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 17:05:27.676 +03:00 [INF] Hosting environment: Development
2025-08-31 17:05:27.679 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 17:05:27.848 +03:00 [INF] Server mrrobot:13420:1674da19 successfully announced in 172.139 ms
2025-08-31 17:05:27.904 +03:00 [INF] Server mrrobot:13420:1674da19 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 17:05:28.088 +03:00 [INF] 1 servers were removed due to timeout
2025-08-31 17:05:28.730 +03:00 [INF] Server mrrobot:13420:1674da19 all the dispatchers started
2025-08-31 17:05:29.209 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 17:05:29.757 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 580.5166ms
2025-08-31 17:05:29.810 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 17:05:29.909 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 17:05:29.859 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 17:05:29.946 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 136.5848ms
2025-08-31 17:05:29.956 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 46.6793ms
2025-08-31 17:05:30.077 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 218.4068ms
2025-08-31 17:05:30.154 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 17:05:30.468 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 313.9778ms
2025-08-31 17:06:14.273 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json-patch+json 62
2025-08-31 17:06:14.297 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:06:14.313 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-31 17:06:14.776 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:06:15.006 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:06:15.123 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:06:15.243 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:06:15.530 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-31 17:06:15.559 +03:00 [INF] Adding item to cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5, product: 1
2025-08-31 17:06:15.947 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:06:15.958 +03:00 [INF] Execute GetAll for entity Product
2025-08-31 17:06:16.222 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-08-31 17:06:16.247 +03:00 [INF] Retrieving cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:06:16.437 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-31 17:06:16.526 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-08-31 17:06:16.653 +03:00 [INF] CartItem added successfully (pending save)
2025-08-31 17:06:16.660 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-31 17:06:16.663 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-31 17:06:16.720 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-31 17:07:17.936 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 17:07:20.685 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 17:07:21.999 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 17:07:22.743 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 17:07:22.933 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 17:07:22.993 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 17:07:23.021 +03:00 [INF] Starting data seeding...
2025-08-31 17:07:23.061 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 17:07:23.730 +03:00 [INF] Executed DbCommand (164ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 17:07:23.911 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 17:07:24.079 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 17:07:24.092 +03:00 [INF] Role 'User' already exists.
2025-08-31 17:07:24.279 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 17:07:24.443 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 17:07:24.448 +03:00 [INF] Data seeding completed successfully.
2025-08-31 17:07:26.276 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 17:07:26.395 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 17:07:26.618 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 17:07:27.285 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 17:07:27.287 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 17:07:27.402 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 17:07:27.413 +03:00 [INF] Hosting environment: Development
2025-08-31 17:07:27.415 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 17:07:27.583 +03:00 [INF] Server mrrobot:6640:3199d5fc successfully announced in 180.1263 ms
2025-08-31 17:07:28.049 +03:00 [INF] Server mrrobot:6640:3199d5fc is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 17:07:28.051 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 17:07:29.096 +03:00 [INF] Server mrrobot:6640:3199d5fc all the dispatchers started
2025-08-31 17:07:29.459 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 1346.2606ms
2025-08-31 17:07:29.483 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 17:07:29.485 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 17:07:29.647 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 17:07:29.671 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 187.7272ms
2025-08-31 17:07:29.683 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 197.6081ms
2025-08-31 17:07:29.821 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 177.7155ms
2025-08-31 17:07:29.993 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 17:07:30.345 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 352.2966ms
2025-08-31 17:07:54.617 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json-patch+json 61
2025-08-31 17:07:54.645 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:07:54.652 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-31 17:07:54.954 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:07:55.003 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2025-08-31 17:07:55.016 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-08-31 17:07:55.026 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 401 0 null 413.0658ms
2025-08-31 17:08:14.873 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json-patch+json 61
2025-08-31 17:08:14.884 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:08:15.166 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:08:15.385 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:08:15.436 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:08:15.529 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:08:15.844 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-31 17:08:15.866 +03:00 [INF] Adding item to cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5, product: 1
2025-08-31 17:08:16.252 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:08:16.267 +03:00 [INF] Execute GetAll for entity Product
2025-08-31 17:08:16.542 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-08-31 17:08:16.563 +03:00 [INF] Retrieving cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:08:16.742 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-31 17:08:16.817 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-08-31 17:08:16.963 +03:00 [INF] CartItem added successfully (pending save)
2025-08-31 17:08:16.979 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-31 17:08:16.986 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-31 17:08:17.045 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-31 17:08:21.084 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (DbType = Int32), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:08:21.350 +03:00 [INF] Removing cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:08:21.845 +03:00 [INF] Cache removed successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:08:21.848 +03:00 [INF] Item added to cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5, product: 1
2025-08-31 17:08:21.888 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:08:21.935 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 6383.606ms
2025-08-31 17:08:21.944 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:08:21.969 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 7095.6585ms
2025-08-31 17:08:29.212 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart - null null
2025-08-31 17:08:29.231 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:08:29.459 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:08:29.485 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-31 17:08:29.498 +03:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CartDtos.CartDto]]] GetCart() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:08:29.507 +03:00 [INF] Executing GetCart
2025-08-31 17:08:29.517 +03:00 [INF] Getting cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:08:29.522 +03:00 [INF] Getting cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:08:29.827 +03:00 [WRN] Cache miss for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:08:29.994 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:08:30.009 +03:00 [INF] Execute GetAll for entity Cart
2025-08-31 17:08:30.311 +03:00 [INF] Executed DbCommand (93ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-08-31 17:08:30.428 +03:00 [INF] Setting cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:08:30.747 +03:00 [INF] Cache set successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5 with tags: [cart]
2025-08-31 17:08:30.767 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CartDtos.CartDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:08:30.795 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.GetCart (E-Commerce) in 1292.3028ms
2025-08-31 17:08:30.802 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-31 17:08:30.806 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart - 200 1004 application/json; charset=utf-8 1594.1291ms
2025-08-31 17:08:48.564 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json-patch+json 61
2025-08-31 17:08:48.604 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:08:48.607 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:08:48.767 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:08:48.777 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:08:48.782 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:08:48.822 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-31 17:08:48.827 +03:00 [INF] Adding item to cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5, product: 1
2025-08-31 17:08:49.147 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:08:49.162 +03:00 [INF] Execute GetAll for entity Product
2025-08-31 17:08:49.247 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-08-31 17:08:49.257 +03:00 [INF] Retrieving cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:08:49.349 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-31 17:08:49.372 +03:00 [INF] Execute Update for entity CartItem
2025-08-31 17:08:49.378 +03:00 [INF] CartItem marked for update (pending save)
2025-08-31 17:08:49.383 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-31 17:08:49.387 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-31 17:08:49.390 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-31 17:08:53.518 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (Size = 4000), @p13='?' (DbType = Int32), @p14='?' (DbType = DateTime), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
UPDATE `CartItems` SET `AddedAt` = @p0, `CartId` = @p1, `CreatedAt` = @p2, `DeletedAt` = @p3, `ModifiedAt` = @p4, `ProductId` = @p5, `ProductVariantId` = @p6, `Quantity` = @p7, `UnitPrice` = @p8
WHERE `Id` = @p9;
SELECT ROW_COUNT();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:08:53.697 +03:00 [INF] Removing cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:08:54.132 +03:00 [INF] Cache removed successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:08:54.148 +03:00 [INF] Item added to cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5, product: 1
2025-08-31 17:08:54.154 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:08:54.165 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 5376.2311ms
2025-08-31 17:08:54.173 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:08:54.205 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 5640.4731ms
2025-08-31 17:08:54.780 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 1
2025-08-31 17:08:54.938 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:08:55.123 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-31 17:08:59.347 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart - null null
2025-08-31 17:08:59.404 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:08:59.571 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:08:59.582 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-31 17:08:59.586 +03:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CartDtos.CartDto]]] GetCart() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:08:59.605 +03:00 [INF] Executing GetCart
2025-08-31 17:08:59.617 +03:00 [INF] Getting cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:08:59.622 +03:00 [INF] Getting cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:08:59.930 +03:00 [WRN] Cache miss for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:09:00.092 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:09:00.103 +03:00 [INF] Execute GetAll for entity Cart
2025-08-31 17:09:00.278 +03:00 [INF] Executed DbCommand (89ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-08-31 17:09:00.314 +03:00 [INF] Setting cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:09:00.544 +03:00 [INF] Cache set successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5 with tags: [cart]
2025-08-31 17:09:00.548 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CartDtos.CartDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:09:00.553 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.GetCart (E-Commerce) in 950.7915ms
2025-08-31 17:09:00.563 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-31 17:09:00.566 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart - 200 980 application/json; charset=utf-8 1218.8912ms
2025-08-31 17:09:21.006 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json-patch+json 61
2025-08-31 17:09:21.022 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:09:21.030 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:09:21.202 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:09:21.214 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:09:21.216 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:09:21.228 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-31 17:09:21.229 +03:00 [INF] Adding item to cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5, product: 1
2025-08-31 17:09:21.546 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:09:21.558 +03:00 [INF] Execute GetAll for entity Product
2025-08-31 17:09:21.644 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-08-31 17:09:21.654 +03:00 [INF] Retrieving cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:09:21.737 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-31 17:09:21.745 +03:00 [INF] Execute Update for entity CartItem
2025-08-31 17:09:21.749 +03:00 [INF] CartItem marked for update (pending save)
2025-08-31 17:09:21.751 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-31 17:09:21.755 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-31 17:09:21.759 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-31 17:09:22.851 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (Size = 4000), @p13='?' (DbType = Int32), @p14='?' (DbType = DateTime), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
UPDATE `CartItems` SET `AddedAt` = @p0, `CartId` = @p1, `CreatedAt` = @p2, `DeletedAt` = @p3, `ModifiedAt` = @p4, `ProductId` = @p5, `ProductVariantId` = @p6, `Quantity` = @p7, `UnitPrice` = @p8
WHERE `Id` = @p9;
SELECT ROW_COUNT();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:09:23.020 +03:00 [INF] Removing cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:09:23.583 +03:00 [INF] Cache removed successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:09:23.603 +03:00 [INF] Item added to cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5, product: 1
2025-08-31 17:09:23.614 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:09:23.631 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 2405.8606ms
2025-08-31 17:09:23.679 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:09:23.698 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 2692.6203ms
2025-08-31 17:09:25.172 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 1
2025-08-31 17:09:25.330 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:09:29.248 +03:00 [INF] Removing cache by tag: cart
2025-08-31 17:09:29.527 +03:00 [WRN] No cache entries found for tag: cart
2025-08-31 17:09:34.323 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json-patch+json 61
2025-08-31 17:09:34.331 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:09:34.334 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:09:34.514 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:09:34.525 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:09:34.532 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:09:34.545 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-31 17:09:34.549 +03:00 [INF] Adding item to cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5, product: 1
2025-08-31 17:09:34.863 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:09:34.897 +03:00 [INF] Execute GetAll for entity Product
2025-08-31 17:09:34.981 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-08-31 17:09:35.001 +03:00 [INF] Retrieving cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:09:35.088 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-31 17:09:35.102 +03:00 [INF] Execute Update for entity CartItem
2025-08-31 17:09:35.106 +03:00 [INF] CartItem marked for update (pending save)
2025-08-31 17:09:35.111 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-31 17:09:35.114 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-31 17:09:35.117 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-31 17:09:36.207 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (Size = 4000), @p13='?' (DbType = Int32), @p14='?' (DbType = DateTime), @p15='?' (DbType = Int32), @p16='?' (DbType = DateTime), @p17='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
UPDATE `CartItems` SET `AddedAt` = @p0, `CartId` = @p1, `CreatedAt` = @p2, `DeletedAt` = @p3, `ModifiedAt` = @p4, `ProductId` = @p5, `ProductVariantId` = @p6, `Quantity` = @p7, `UnitPrice` = @p8
WHERE `Id` = @p9;
SELECT ROW_COUNT();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:09:36.379 +03:00 [INF] Removing cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:09:37.000 +03:00 [INF] Cache removed successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:09:37.017 +03:00 [INF] Item added to cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5, product: 1
2025-08-31 17:09:37.020 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:09:37.029 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 2487.8524ms
2025-08-31 17:09:37.036 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:09:37.040 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 2716.8832ms
2025-08-31 17:09:40.325 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 1
2025-08-31 17:09:40.495 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:09:42.835 +03:00 [INF] Removing cache by tag: cart
2025-08-31 17:09:43.055 +03:00 [WRN] No cache entries found for tag: cart
2025-08-31 17:09:51.775 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart - null null
2025-08-31 17:09:51.793 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:09:52.056 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:09:52.069 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-31 17:09:52.075 +03:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CartDtos.CartDto]]] GetCart() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:09:52.084 +03:00 [INF] Executing GetCart
2025-08-31 17:09:52.087 +03:00 [INF] Getting cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:09:52.092 +03:00 [INF] Getting cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:09:52.312 +03:00 [WRN] Cache miss for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:09:52.472 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:09:52.481 +03:00 [INF] Execute GetAll for entity Cart
2025-08-31 17:09:52.649 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-08-31 17:09:52.664 +03:00 [INF] Setting cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:09:52.977 +03:00 [INF] Cache set successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5 with tags: [cart]
2025-08-31 17:09:52.992 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CartDtos.CartDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:09:53.006 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.GetCart (E-Commerce) in 924.8456ms
2025-08-31 17:09:53.040 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-31 17:09:53.073 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart - 200 980 application/json; charset=utf-8 1298.646ms
2025-08-31 17:10:30.813 +03:00 [INF] Request starting HTTP/1.1 DELETE http://localhost:5069/api/Cart/items/clear - null null
2025-08-31 17:10:30.828 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:10:30.830 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:10:31.194 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:10:31.210 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.ClearCart (E-Commerce)'
2025-08-31 17:10:31.233 +03:00 [INF] Route matched with {action = "ClearCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] ClearCart() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:10:31.267 +03:00 [INF] Executing ClearCart
2025-08-31 17:10:31.281 +03:00 [INF] Clearing cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:10:31.515 +03:00 [INF] Retrieving cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:10:31.600 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-31 17:10:31.609 +03:00 [INF] Clearing cart: 1
2025-08-31 17:10:31.708 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-31 17:10:31.732 +03:00 [INF] Cart 1 cleared successfully
2025-08-31 17:10:31.745 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-31 17:10:31.747 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-31 17:10:31.749 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-31 17:10:32.838 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (Size = 4000), @p4='?' (DbType = Int32), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int32), @p7='?' (DbType = DateTime), @p8='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:10:33.026 +03:00 [INF] Removing cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:10:33.629 +03:00 [INF] Cache removed successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:10:33.644 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:10:33.664 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.ClearCart (E-Commerce) in 2399.9049ms
2025-08-31 17:10:33.681 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.ClearCart (E-Commerce)'
2025-08-31 17:10:33.692 +03:00 [INF] Request finished HTTP/1.1 DELETE http://localhost:5069/api/Cart/items/clear - 200 128 application/json; charset=utf-8 2879.2561ms
2025-08-31 17:10:37.915 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Cart - null null
2025-08-31 17:10:37.935 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:10:38.120 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:10:38.136 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-31 17:10:38.144 +03:00 [INF] Route matched with {action = "GetCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.CartDtos.CartDto]]] GetCart() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:10:38.150 +03:00 [INF] Executing GetCart
2025-08-31 17:10:38.156 +03:00 [INF] Getting cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:10:38.158 +03:00 [INF] Getting cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:10:38.439 +03:00 [WRN] Cache miss for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:10:38.596 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:10:38.609 +03:00 [INF] Execute GetAll for entity Cart
2025-08-31 17:10:38.778 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-08-31 17:10:38.793 +03:00 [INF] Setting cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:10:39.054 +03:00 [INF] Cache set successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5 with tags: [cart]
2025-08-31 17:10:39.062 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.CartDtos.CartDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:10:39.067 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.GetCart (E-Commerce) in 917.6243ms
2025-08-31 17:10:39.073 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.GetCart (E-Commerce)'
2025-08-31 17:10:39.077 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Cart - 200 336 application/json; charset=utf-8 1161.9377ms
2025-08-31 17:11:04.317 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json-patch+json 61
2025-08-31 17:11:04.331 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:11:04.334 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:11:04.567 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:11:04.592 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:11:04.610 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:11:04.638 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-31 17:11:04.650 +03:00 [INF] Adding item to cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5, product: 1
2025-08-31 17:11:04.974 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:11:05.002 +03:00 [INF] Execute GetAll for entity Product
2025-08-31 17:11:05.087 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-08-31 17:11:05.104 +03:00 [INF] Retrieving cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:05.188 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-31 17:11:05.199 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-08-31 17:11:05.203 +03:00 [INF] CartItem added successfully (pending save)
2025-08-31 17:11:05.206 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-31 17:11:05.211 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-31 17:11:05.217 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-31 17:11:06.297 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (DbType = Int32), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:11:06.499 +03:00 [INF] Removing cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:06.944 +03:00 [INF] Cache removed successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:06.959 +03:00 [INF] Item added to cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5, product: 1
2025-08-31 17:11:06.975 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:11:06.999 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 2363.9807ms
2025-08-31 17:11:07.009 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:11:07.019 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 2702.3171ms
2025-08-31 17:11:15.347 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - null 0
2025-08-31 17:11:15.369 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:11:15.375 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:11:15.537 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:11:15.548 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-31 17:11:15.556 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:11:15.574 +03:00 [INF] Executing CheckOut
2025-08-31 17:11:15.585 +03:00 [INF] Checkout of cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:15.592 +03:00 [INF] Retrieving cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:15.764 +03:00 [INF] Executed DbCommand (91ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-31 17:11:15.951 +03:00 [INF] Executed DbCommand (103ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-31 17:11:15.961 +03:00 [INF] Removing cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:15.967 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:11:15.972 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 399.8392ms
2025-08-31 17:11:15.976 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-31 17:11:15.984 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - 200 122 application/json; charset=utf-8 636.3922ms
2025-08-31 17:11:16.401 +03:00 [INF] Cache removed successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:27.632 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 1
2025-08-31 17:11:27.789 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:11:27.952 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-31 17:11:28.867 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 1
2025-08-31 17:11:28.868 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 1
2025-08-31 17:11:29.026 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:11:29.028 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:11:31.848 +03:00 [INF] Removing cache by tag: cart
2025-08-31 17:11:32.099 +03:00 [WRN] No cache entries found for tag: cart
2025-08-31 17:11:36.066 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json-patch+json 41
2025-08-31 17:11:36.087 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:11:36.089 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:11:36.250 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:11:36.261 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-08-31 17:11:36.276 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-31 17:11:36.758 +03:00 [INF] Executing CreateOrder
2025-08-31 17:11:36.774 +03:00 [INF] Creating order from cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:37.100 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:11:37.216 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:11:37.234 +03:00 [INF] Checking if address 1 exists for customer: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:37.322 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:11:37.330 +03:00 [INF] Getting cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:37.332 +03:00 [INF] Getting cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:37.554 +03:00 [WRN] Cache miss for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:37.647 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:11:37.666 +03:00 [INF] Execute GetAll for entity Cart
2025-08-31 17:11:37.763 +03:00 [INF] Executed DbCommand (89ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-08-31 17:11:37.777 +03:00 [INF] Setting cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:38.001 +03:00 [INF] Cache set successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5 with tags: [cart]
2025-08-31 17:11:38.101 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:11:38.111 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 1825.5275ms
2025-08-31 17:11:38.118 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-08-31 17:11:38.123 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 400 236 application/json; charset=utf-8 2057.3593ms
2025-08-31 17:11:48.461 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - null 0
2025-08-31 17:11:48.476 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:11:48.481 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:11:48.649 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:11:48.666 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-31 17:11:48.668 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:11:48.674 +03:00 [INF] Executing CheckOut
2025-08-31 17:11:48.677 +03:00 [INF] Checkout of cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:48.682 +03:00 [INF] Retrieving cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:48.840 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-31 17:11:49.008 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-31 17:11:49.035 +03:00 [INF] Removing cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:49.050 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:11:49.074 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 400.7692ms
2025-08-31 17:11:49.141 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-31 17:11:49.144 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - 200 122 application/json; charset=utf-8 682.7943ms
2025-08-31 17:11:49.608 +03:00 [INF] Cache removed successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:54.952 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json-patch+json 41
2025-08-31 17:11:54.974 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:11:54.977 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:11:55.153 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:11:55.187 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-08-31 17:11:55.194 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-31 17:11:55.204 +03:00 [INF] Executing CreateOrder
2025-08-31 17:11:55.218 +03:00 [INF] Creating order from cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:55.543 +03:00 [INF] Executed DbCommand (89ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:11:55.647 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:11:55.662 +03:00 [INF] Checking if address 1 exists for customer: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:55.744 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:11:55.755 +03:00 [INF] Getting cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:55.768 +03:00 [INF] Getting cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:56.059 +03:00 [WRN] Cache miss for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:56.170 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:11:56.182 +03:00 [INF] Execute GetAll for entity Cart
2025-08-31 17:11:56.271 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-08-31 17:11:56.283 +03:00 [INF] Setting cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:11:56.570 +03:00 [INF] Cache set successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5 with tags: [cart]
2025-08-31 17:11:56.581 +03:00 [INF] Execute GetAll for entity ProductVariant
2025-08-31 17:11:56.692 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = 1
2025-08-31 17:11:56.833 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-31 17:11:56.846 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-31 17:11:56.934 +03:00 [INF] Order added successfully (pending save)
2025-08-31 17:11:57.147 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = Decimal), @p13='?' (DbType = Int32), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal), @p16='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `RestockedAt`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:11:57.244 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-31 17:11:57.289 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-31 17:11:57.303 +03:00 [INF] Removing 1 from variant: 1
2025-08-31 17:11:57.312 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-31 17:11:57.399 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:11:59.424 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = Decimal), @p11='?' (DbType = Int32), @p10='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

UPDATE `ProductVariants` SET `Quantity` = @p10
WHERE `Id` = @p11;
SELECT ROW_COUNT();
2025-08-31 17:11:59.516 +03:00 [INF] Clearing cart: 1
2025-08-31 17:11:59.599 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-31 17:11:59.614 +03:00 [INF] Cart 1 cleared successfully
2025-08-31 17:11:59.772 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();
2025-08-31 17:11:59.936 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-31 17:11:59.940 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-31 17:11:59.945 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-31 17:11:59.945 +03:00 [ERR] Failed executing DbCommand (7ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-08-31 17:11:59.956 +03:00 [INF] Execute GetAll for entity Order
2025-08-31 17:12:00.157 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'E_Commerce.Context.AppDbContext'.
System.InvalidOperationException: Connection must be Open; current state is Closed
   at MySqlConnector.MySqlConnection.get_Session() in /_/src/MySqlConnector/MySqlConnection.cs:line 733
   at MySqlConnector.Core.ICancellableCommandExtensions.ResetCommandTimeout(ICancellableCommand command) in /_/src/MySqlConnector/Core/ICancellableCommand.cs:line 42
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 355
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: Connection must be Open; current state is Closed
   at MySqlConnector.MySqlConnection.get_Session() in /_/src/MySqlConnector/MySqlConnection.cs:line 733
   at MySqlConnector.Core.ICancellableCommandExtensions.ResetCommandTimeout(ICancellableCommand command) in /_/src/MySqlConnector/Core/ICancellableCommand.cs:line 42
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 355
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
2025-08-31 17:12:00.821 +03:00 [INF] Executed DbCommand (102ms) [Parameters=[@__createdOrder_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`DeletedAt`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`DeletedAt`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    WHERE `o`.`Id` = @__createdOrder_Id_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, `p`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`))
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p0`.`Color`, COALESCE(`p0`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p0`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p0`.`Size`, `p0`.`DeletedAt`, COALESCE(`p0`.`Length`, 0) AS `Length`, COALESCE(`p0`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p0`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p` ON `o0`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p0` ON `o0`.`ProductVariantId` = `p0`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-08-31 17:12:01.025 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-08-31 17:12:01.896 +03:00 [INF] Removed 1 cache entries for tags: [variantlist, variantdata]
2025-08-31 17:12:02.701 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:12:02.754 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 7551.1999ms
2025-08-31 17:12:02.764 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-08-31 17:12:10.223 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No route matches the supplied values.
   at Microsoft.AspNetCore.Mvc.CreatedAtActionResult.OnFormatting(ActionContext context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsyncCore(ActionContext context, ObjectResult result, Type objectType, Object value)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsync(ActionContext context, ObjectResult result)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeNextResultFilterAsync[TFilter,TFilterAsync]()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.ResponseCaching.ResponseCachingMiddleware.Invoke(HttpContext httpContext)
   at SecurityStampMiddleware.Invoke(HttpContext context) in D:\project_fashion\E-Commerce-API-main\MiddleWares\SecurityStampMiddleware.cs:line 75
   at E_Commerce.Middleware.UserAuthenticationMiddleware.InvokeAsync(HttpContext context) in D:\project_fashion\E-Commerce-API-main\Middleware\UserAuthenticationMiddleware.cs:line 38
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.RateLimiting.RateLimitingMiddleware.InvokeInternal(HttpContext context, EnableRateLimitingAttribute enableRateLimitingAttribute)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-31 17:12:10.357 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 500 null text/plain; charset=utf-8 15405.2209ms
2025-08-31 17:12:13.666 +03:00 [INF] Setting cache for key: category_all__True_False_1_10
2025-08-31 17:12:13.979 +03:00 [INF] Cache set successfully for key: category_all__True_False_1_10 with tags: [category]
2025-08-31 17:12:14.700 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json-patch+json 41
2025-08-31 17:12:14.723 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:12:14.727 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:12:14.894 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:12:14.934 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-08-31 17:12:14.937 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-31 17:12:14.982 +03:00 [INF] Executing CreateOrder
2025-08-31 17:12:14.991 +03:00 [INF] Creating order from cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:12:15.303 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:12:15.399 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:12:15.411 +03:00 [INF] Checking if address 1 exists for customer: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:12:15.498 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:12:15.506 +03:00 [INF] Getting cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:12:15.509 +03:00 [INF] Getting cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:12:15.727 +03:00 [INF] Cache hit for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:12:15.757 +03:00 [INF] Cache hit for cart user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:12:15.761 +03:00 [INF] Execute GetAll for entity ProductVariant
2025-08-31 17:12:15.844 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = 1
2025-08-31 17:12:15.934 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-31 17:12:15.961 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-31 17:12:15.972 +03:00 [INF] Order added successfully (pending save)
2025-08-31 17:12:16.145 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = Decimal), @p13='?' (DbType = Int32), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal), @p16='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `RestockedAt`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:12:16.262 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-31 17:12:16.294 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-31 17:12:16.301 +03:00 [INF] Removing 1 from variant: 1
2025-08-31 17:12:16.307 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-31 17:12:16.390 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:12:18.404 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = Decimal), @p11='?' (DbType = Int32), @p10='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

UPDATE `ProductVariants` SET `Quantity` = @p10
WHERE `Id` = @p11;
SELECT ROW_COUNT();
2025-08-31 17:12:18.493 +03:00 [INF] Clearing cart: 1
2025-08-31 17:12:18.584 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-31 17:12:18.612 +03:00 [INF] No items to clear for cart 1
2025-08-31 17:12:18.704 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-31 17:12:18.712 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-31 17:12:18.725 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-31 17:12:18.740 +03:00 [INF] Execute GetAll for entity Order
2025-08-31 17:12:18.922 +03:00 [INF] Executed DbCommand (89ms) [Parameters=[@__createdOrder_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`DeletedAt`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`DeletedAt`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    WHERE `o`.`Id` = @__createdOrder_Id_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, `p`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`))
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p0`.`Color`, COALESCE(`p0`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p0`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p0`.`Size`, `p0`.`DeletedAt`, COALESCE(`p0`.`Length`, 0) AS `Length`, COALESCE(`p0`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p0`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p` ON `o0`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p0` ON `o0`.`ProductVariantId` = `p0`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-08-31 17:12:20.781 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:12:20.793 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 5847.1667ms
2025-08-31 17:12:20.799 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-08-31 17:12:31.326 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No route matches the supplied values.
   at Microsoft.AspNetCore.Mvc.CreatedAtActionResult.OnFormatting(ActionContext context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsyncCore(ActionContext context, ObjectResult result, Type objectType, Object value)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ObjectResultExecutor.ExecuteAsync(ActionContext context, ObjectResult result)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeNextResultFilterAsync[TFilter,TFilterAsync]()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.ResponseCaching.ResponseCachingMiddleware.Invoke(HttpContext httpContext)
   at SecurityStampMiddleware.Invoke(HttpContext context) in D:\project_fashion\E-Commerce-API-main\MiddleWares\SecurityStampMiddleware.cs:line 75
   at E_Commerce.Middleware.UserAuthenticationMiddleware.InvokeAsync(HttpContext context) in D:\project_fashion\E-Commerce-API-main\Middleware\UserAuthenticationMiddleware.cs:line 38
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.RateLimiting.RateLimitingMiddleware.InvokeInternal(HttpContext context, EnableRateLimitingAttribute enableRateLimitingAttribute)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-08-31 17:12:31.344 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 500 null text/plain; charset=utf-8 16644.9135ms
2025-08-31 17:12:31.858 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-08-31 17:12:32.322 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-08-31 17:12:35.462 +03:00 [INF] Removing cache by tags: [order]
2025-08-31 17:12:36.405 +03:00 [INF] Removed 1 cache entries for tags: [order]
2025-08-31 17:14:32.568 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 17:14:34.507 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 17:14:35.678 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 17:14:36.399 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 17:14:36.598 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 17:14:36.637 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 17:14:36.660 +03:00 [INF] Starting data seeding...
2025-08-31 17:14:36.704 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 17:14:37.499 +03:00 [INF] Executed DbCommand (142ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 17:14:37.632 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 17:14:37.825 +03:00 [INF] Executed DbCommand (104ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 17:14:38.118 +03:00 [INF] Role 'User' already exists.
2025-08-31 17:14:38.334 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 17:14:38.681 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 17:14:38.709 +03:00 [INF] Data seeding completed successfully.
2025-08-31 17:14:40.521 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 17:14:40.808 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 17:14:40.948 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 17:14:41.247 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 17:14:41.332 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 17:14:41.334 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 17:14:41.533 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 17:14:41.561 +03:00 [INF] Hosting environment: Development
2025-08-31 17:14:41.565 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 17:14:41.727 +03:00 [INF] Server mrrobot:15488:490d5bf3 successfully announced in 178.6935 ms
2025-08-31 17:14:41.747 +03:00 [INF] Server mrrobot:15488:490d5bf3 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 17:14:41.945 +03:00 [INF] Server mrrobot:15488:490d5bf3 all the dispatchers started
2025-08-31 17:14:42.503 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 17:14:42.566 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 1210.1774ms
2025-08-31 17:14:42.596 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 17:14:42.596 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 17:14:42.678 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 174.6174ms
2025-08-31 17:14:42.780 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 184.3924ms
2025-08-31 17:14:42.897 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 300.4196ms
2025-08-31 17:14:43.043 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 17:14:43.960 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 916.8112ms
2025-08-31 17:15:34.294 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json-patch+json 41
2025-08-31 17:15:34.319 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:15:34.330 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-31 17:15:34.464 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:15:34.497 +03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Customer|Admin)
2025-08-31 17:15:34.505 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2025-08-31 17:15:34.510 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 401 0 null 216.027ms
2025-08-31 17:15:48.971 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json-patch+json 41
2025-08-31 17:15:48.987 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:15:49.114 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:15:49.345 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:15:49.372 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-08-31 17:15:49.424 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-31 17:15:50.053 +03:00 [INF] Executing CreateOrder
2025-08-31 17:15:50.071 +03:00 [INF] Creating order from cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:15:50.449 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:15:50.553 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:15:50.569 +03:00 [INF] Checking if address 1 exists for customer: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:15:50.656 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:15:50.674 +03:00 [INF] Getting cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:15:50.682 +03:00 [INF] Getting cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:15:50.908 +03:00 [INF] Cache hit for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:15:50.969 +03:00 [INF] Cache hit for cart user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:15:50.982 +03:00 [INF] Execute GetAll for entity ProductVariant
2025-08-31 17:15:51.117 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = 1
2025-08-31 17:15:51.274 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-31 17:15:51.304 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-31 17:15:51.523 +03:00 [INF] Order added successfully (pending save)
2025-08-31 17:15:51.956 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = Decimal), @p13='?' (DbType = Int32), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal), @p16='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `RestockedAt`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:15:52.139 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-31 17:15:52.205 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-31 17:15:52.215 +03:00 [INF] Removing 1 from variant: 1
2025-08-31 17:15:52.219 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-31 17:15:52.317 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:15:54.371 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = Decimal), @p11='?' (DbType = Int32), @p10='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

UPDATE `ProductVariants` SET `Quantity` = @p10
WHERE `Id` = @p11;
SELECT ROW_COUNT();
2025-08-31 17:15:54.493 +03:00 [INF] Clearing cart: 1
2025-08-31 17:15:54.593 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-31 17:15:54.608 +03:00 [INF] No items to clear for cart 1
2025-08-31 17:15:54.703 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-31 17:15:54.709 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-31 17:15:54.854 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-31 17:15:54.863 +03:00 [INF] Execute GetAll for entity Order
2025-08-31 17:15:55.251 +03:00 [INF] Executed DbCommand (87ms) [Parameters=[@__createdOrder_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`DeletedAt`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`DeletedAt`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    WHERE `o`.`Id` = @__createdOrder_Id_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, `p`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`))
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p0`.`Color`, COALESCE(`p0`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p0`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p0`.`Size`, `p0`.`DeletedAt`, COALESCE(`p0`.`Length`, 0) AS `Length`, COALESCE(`p0`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p0`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p` ON `o0`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p0` ON `o0`.`ProductVariantId` = `p0`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-08-31 17:15:56.463 +03:00 [INF] Removing cache by tags: [variantlist, variantdata]
2025-08-31 17:15:56.530 +03:00 [ERR] Failed executing DbCommand (3ms) [Parameters=[@__productid_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CreatedAt`, `t`.`DeletedAt`, `t`.`Description`, `t`.`DiscountId`, `t`.`Gender`, `t`.`IsActive`, `t`.`ModifiedAt`, `t`.`Name`, `t`.`Price`, `t`.`Quantity`, `t`.`SubCategoryId`, `t`.`fitType`, `p0`.`Id`, `p0`.`Color`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`IsActive`, `p0`.`Length`, `p0`.`ModifiedAt`, `p0`.`ProductId`, `p0`.`Quantity`, `p0`.`Size`, `p0`.`Waist`
FROM (
    SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__productid_0) AND `p`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN `ProductVariants` AS `p0` ON `t`.`Id` = `p0`.`ProductId`
ORDER BY `t`.`Id`
2025-08-31 17:15:56.593 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'E_Commerce.Context.AppDbContext'.
System.InvalidOperationException: Connection must be Open; current state is Closed
   at MySqlConnector.MySqlConnection.get_Session() in /_/src/MySqlConnector/MySqlConnection.cs:line 733
   at MySqlConnector.Core.ICancellableCommandExtensions.ResetCommandTimeout(ICancellableCommand command) in /_/src/MySqlConnector/Core/ICancellableCommand.cs:line 42
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 355
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: Connection must be Open; current state is Closed
   at MySqlConnector.MySqlConnection.get_Session() in /_/src/MySqlConnector/MySqlConnection.cs:line 733
   at MySqlConnector.Core.ICancellableCommandExtensions.ResetCommandTimeout(ICancellableCommand command) in /_/src/MySqlConnector/Core/ICancellableCommand.cs:line 42
   at MySqlConnector.MySqlCommand.ExecuteReaderAsync(CommandBehavior behavior, IOBehavior ioBehavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 355
   at MySqlConnector.MySqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken) in /_/src/MySqlConnector/MySqlCommand.cs:line 350
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Pomelo.EntityFrameworkCore.MySql.Storage.Internal.MySqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
2025-08-31 17:15:56.893 +03:00 [WRN] No cache entries found for tags: [variantlist, variantdata]
2025-08-31 17:15:57.157 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:15:57.287 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 7833.6032ms
2025-08-31 17:15:57.302 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-08-31 17:15:57.316 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 201 1439 application/json; charset=utf-8 8345.2622ms
2025-08-31 17:16:10.237 +03:00 [INF] Setting cache for key: advsearch__________False_1_100_True_False
2025-08-31 17:16:10.534 +03:00 [INF] Cache set successfully for key: advsearch__________False_1_100_True_False with tags: [product_search]
2025-08-31 17:17:36.815 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - null null
2025-08-31 17:17:36.887 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:17:37.059 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:17:37.086 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 17:17:37.113 +03:00 [INF] Route matched with {action = "GetVariantById", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ProductDtos.ProductVariantDto]]] GetVariantById(Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 17:17:37.136 +03:00 [INF] Getting variant by id: 1
2025-08-31 17:17:37.139 +03:00 [INF] Getting cache for key: variant:1
2025-08-31 17:17:37.463 +03:00 [WRN] Cache miss for key: variant:1
2025-08-31 17:17:37.491 +03:00 [INF] Getting variant by ID: 1
2025-08-31 17:17:37.672 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE (`p`.`Id` = @__id_0) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-31 17:17:37.793 +03:00 [INF] Caching variant 1 data
2025-08-31 17:17:38.731 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ProductDtos.ProductVariantDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:17:38.746 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce) in 1626.8441ms
2025-08-31 17:17:38.753 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 17:17:38.762 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - 200 308 application/json; charset=utf-8 1947.1483ms
2025-08-31 17:17:40.122 +03:00 [INF] Setting cache for key: variant:1
2025-08-31 17:17:40.432 +03:00 [INF] Cache set successfully for key: variant:1 with tags: [product:1, variantdata]
2025-08-31 17:18:24.486 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/Order/10/status?status=0 - application/json-patch+json 23
2025-08-31 17:18:24.500 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:18:24.502 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:18:24.659 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:18:24.678 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce)'
2025-08-31 17:18:24.698 +03:00 [INF] Route matched with {action = "UpdateOrderStatus", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdateOrderStatus(Int32, E_Commerce.DtoModels.OrderDtos.OrderStatusNoteDto, E_Commerce.Enums.OrderStatus) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-31 17:18:24.773 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:18:24.798 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce) in 79.9796ms
2025-08-31 17:18:24.811 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce)'
2025-08-31 17:18:24.817 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/Order/10/status?status=0 - 400 237 application/json; charset=utf-8 331.6669ms
2025-08-31 17:18:42.892 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/Order/10/status?status=1 - application/json-patch+json 23
2025-08-31 17:18:43.004 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:18:43.007 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:18:43.172 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:18:43.187 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce)'
2025-08-31 17:18:43.196 +03:00 [INF] Route matched with {action = "UpdateOrderStatus", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdateOrderStatus(Int32, E_Commerce.DtoModels.OrderDtos.OrderStatusNoteDto, E_Commerce.Enums.OrderStatus) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-31 17:18:43.557 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 10
2025-08-31 17:18:43.662 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:18:43.681 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 17:18:43.688 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 17:18:43.732 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 17:18:43.920 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:18:45.005 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:18:45.020 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce) in 1815.7736ms
2025-08-31 17:18:45.032 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce)'
2025-08-31 17:18:45.043 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/Order/10/status?status=1 - 200 118 application/json; charset=utf-8 2150.0906ms
2025-08-31 17:18:54.351 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/Order/10/status?status=2 - application/json-patch+json 23
2025-08-31 17:18:54.366 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:18:54.368 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:18:54.532 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:18:54.557 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce)'
2025-08-31 17:18:54.565 +03:00 [INF] Route matched with {action = "UpdateOrderStatus", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdateOrderStatus(Int32, E_Commerce.DtoModels.OrderDtos.OrderStatusNoteDto, E_Commerce.Enums.OrderStatus) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-31 17:18:54.824 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 10
2025-08-31 17:18:54.909 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:18:54.924 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 17:18:54.926 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 17:18:54.929 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 17:18:55.089 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Orders` SET `Status` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:18:56.193 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:18:56.206 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce) in 1624.5341ms
2025-08-31 17:18:56.215 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce)'
2025-08-31 17:18:56.223 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/Order/10/status?status=2 - 200 126 application/json; charset=utf-8 1871.2066ms
2025-08-31 17:19:01.138 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/Order/10/status?status=10 - application/json-patch+json 23
2025-08-31 17:19:01.158 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:19:01.161 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:19:01.421 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:19:01.464 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce)'
2025-08-31 17:19:01.470 +03:00 [INF] Route matched with {action = "UpdateOrderStatus", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdateOrderStatus(Int32, E_Commerce.DtoModels.OrderDtos.OrderStatusNoteDto, E_Commerce.Enums.OrderStatus) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-31 17:19:01.730 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 10
2025-08-31 17:19:01.823 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:19:01.931 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:19:01.942 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce) in 445.407ms
2025-08-31 17:19:01.948 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce)'
2025-08-31 17:19:01.959 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/Order/10/status?status=10 - 400 213 application/json; charset=utf-8 819.2451ms
2025-08-31 17:19:07.334 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/Order/10/status?status=9 - application/json-patch+json 23
2025-08-31 17:19:07.356 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:19:07.367 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:19:07.680 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:19:07.710 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce)'
2025-08-31 17:19:07.713 +03:00 [INF] Route matched with {action = "UpdateOrderStatus", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdateOrderStatus(Int32, E_Commerce.DtoModels.OrderDtos.OrderStatusNoteDto, E_Commerce.Enums.OrderStatus) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-31 17:19:07.981 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 10
2025-08-31 17:19:08.063 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:19:08.233 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Orders` SET `CancelledAt` = @p0, `Status` = @p1
WHERE `Id` = @p2;
SELECT ROW_COUNT();
2025-08-31 17:19:08.401 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 17:19:08.423 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 17:19:08.436 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 17:19:10.264 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:19:10.277 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce) in 2535.8683ms
2025-08-31 17:19:10.289 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce)'
2025-08-31 17:19:10.300 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/Order/10/status?status=9 - 200 127 application/json; charset=utf-8 2966.3484ms
2025-08-31 17:19:12.831 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 10
2025-08-31 17:19:12.917 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:19:12.929 +03:00 [INF] Execute GetAll for entity OrderItem
2025-08-31 17:19:13.016 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-08-31 17:19:13.044 +03:00 [INF] Adding quantity for variant: 1
2025-08-31 17:19:13.135 +03:00 [ERR] Error while restocking inventory for order 10
System.InvalidOperationException: The connection is already in a transaction and cannot participate in another transaction.
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.EnsureNoTransactions()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.BeginTransactionAsync(IsolationLevel isolationLevel, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.BeginTransactionAsync(CancellationToken cancellationToken)
   at UnitOfWork.BeginTransactionAsync() in D:\project_fashion\E-Commerce-API-main\UOW\UnitOfWork.cs:line 88
   at E_Commerce.Services.ProductServices.ProductVariantCommandService.AddQuntityAfterRestoreOrder(Int32 id, Int32 addQuantity) in D:\project_fashion\E-Commerce-API-main\Services\ProductServices\ProductVariantCommandService.cs:line 50
   at E_Commerce.Services.Order.OrderCommandService.RestockOrderItemsInBackground(Int32 orderId) in D:\project_fashion\E-Commerce-API-main\Services\OrderServices\OrderCommandService.cs:line 641
2025-08-31 17:19:42.104 +03:00 [INF] 1 servers were removed due to timeout
2025-08-31 17:19:45.057 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - null null
2025-08-31 17:19:45.081 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:19:45.481 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:19:45.512 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 17:19:45.523 +03:00 [INF] Route matched with {action = "GetVariantById", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ProductDtos.ProductVariantDto]]] GetVariantById(Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 17:19:45.537 +03:00 [INF] Getting variant by id: 1
2025-08-31 17:19:45.548 +03:00 [INF] Getting cache for key: variant:1
2025-08-31 17:19:45.771 +03:00 [INF] Cache hit for key: variant:1
2025-08-31 17:19:45.784 +03:00 [INF] Retrieved variant 1 from cache
2025-08-31 17:19:45.794 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ProductDtos.ProductVariantDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:19:45.807 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce) in 275.9326ms
2025-08-31 17:19:45.831 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 17:19:45.837 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - 200 306 application/json; charset=utf-8 779.6877ms
2025-08-31 17:19:53.113 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - null null
2025-08-31 17:19:53.134 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:19:53.439 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:19:53.454 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 17:19:53.456 +03:00 [INF] Route matched with {action = "GetVariantById", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ProductDtos.ProductVariantDto]]] GetVariantById(Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 17:19:53.472 +03:00 [INF] Getting variant by id: 1
2025-08-31 17:19:53.474 +03:00 [INF] Getting cache for key: variant:1
2025-08-31 17:19:53.758 +03:00 [INF] Cache hit for key: variant:1
2025-08-31 17:19:53.768 +03:00 [INF] Retrieved variant 1 from cache
2025-08-31 17:19:53.777 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ProductDtos.ProductVariantDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:19:53.795 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce) in 331.3659ms
2025-08-31 17:19:53.838 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 17:19:53.851 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - 200 306 application/json; charset=utf-8 738.1323ms
2025-08-31 17:19:55.695 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - null null
2025-08-31 17:19:55.712 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:19:55.873 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:19:55.893 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 17:19:55.910 +03:00 [INF] Route matched with {action = "GetVariantById", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ProductDtos.ProductVariantDto]]] GetVariantById(Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 17:19:55.926 +03:00 [INF] Getting variant by id: 1
2025-08-31 17:19:55.930 +03:00 [INF] Getting cache for key: variant:1
2025-08-31 17:19:56.148 +03:00 [INF] Cache hit for key: variant:1
2025-08-31 17:19:56.160 +03:00 [INF] Retrieved variant 1 from cache
2025-08-31 17:19:56.173 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ProductDtos.ProductVariantDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:19:56.186 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce) in 261.5844ms
2025-08-31 17:19:56.202 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 17:19:56.207 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - 200 306 application/json; charset=utf-8 512.0761ms
2025-08-31 17:21:50.455 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 17:21:52.272 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 17:21:53.481 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 17:21:54.212 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 17:21:54.413 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 17:21:54.483 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 17:21:54.524 +03:00 [INF] Starting data seeding...
2025-08-31 17:21:54.625 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 17:21:55.852 +03:00 [INF] Executed DbCommand (185ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 17:21:56.074 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 17:21:56.269 +03:00 [INF] Executed DbCommand (96ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 17:21:56.329 +03:00 [INF] Role 'User' already exists.
2025-08-31 17:21:56.602 +03:00 [INF] Executed DbCommand (100ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 17:21:57.167 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 17:21:57.239 +03:00 [INF] Data seeding completed successfully.
2025-08-31 17:21:59.218 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 17:21:59.454 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 17:21:59.536 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 17:21:59.593 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 17:21:59.934 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 17:22:00.173 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 17:22:00.199 +03:00 [INF] Hosting environment: Development
2025-08-31 17:22:00.206 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 17:22:00.372 +03:00 [INF] Server mrrobot:23100:2f8ea7aa successfully announced in 181.295 ms
2025-08-31 17:22:00.394 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 17:22:00.449 +03:00 [INF] Server mrrobot:23100:2f8ea7aa is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 17:22:00.722 +03:00 [INF] Server mrrobot:23100:2f8ea7aa all the dispatchers started
2025-08-31 17:22:01.464 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 1078.3648ms
2025-08-31 17:22:01.885 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 17:22:01.909 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 17:22:01.910 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 25.044ms
2025-08-31 17:22:01.944 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 34.5881ms
2025-08-31 17:22:02.188 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 17:22:02.326 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 138.6091ms
2025-08-31 17:22:03.159 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 17:22:03.574 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 415.2707ms
2025-08-31 17:23:55.676 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/items - application/json-patch+json 62
2025-08-31 17:23:55.894 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:23:55.909 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-31 17:23:56.490 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:23:57.157 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:23:57.242 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:23:57.324 +03:00 [INF] Route matched with {action = "AddItemToCart", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddItemToCart(E_Commerce.DtoModels.CartDtos.CreateCartItemDto) on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:23:57.727 +03:00 [INF] Executing AddItemToCart for product ID: 1
2025-08-31 17:23:57.754 +03:00 [INF] Adding item to cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5, product: 1
2025-08-31 17:23:58.148 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:23:58.174 +03:00 [INF] Execute GetAll for entity Product
2025-08-31 17:23:58.700 +03:00 [INF] Executed DbCommand (117ms) [Parameters=[@__8__locals1_itemDto_ProductId_0='?' (DbType = Int32), @__8__locals1_itemDto_ProductVariantId_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`Price`, `t`.`c`, `t`.`EndDate`, `t`.`StartDate`, `t`.`DiscountPercent`, `t`.`DeletedAt`, `t`.`IsActive`, `t0`.`Id`, `t0`.`Quantity`, `t0`.`c`
FROM (
    SELECT `p`.`Id`, `p`.`Price`, `d`.`Id` IS NOT NULL AS `c`, `d`.`EndDate`, `d`.`StartDate`, `d`.`DiscountPercent`, `d`.`DeletedAt`, `d`.`IsActive`
    FROM `Products` AS `p`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    WHERE ((`p`.`Id` = @__8__locals1_itemDto_ProductId_0) AND `p`.`DeletedAt` IS NULL) AND `p`.`IsActive`
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `t1`.`Id`, `t1`.`Quantity`, `t1`.`c`, `t1`.`ProductId`
    FROM (
        SELECT `p0`.`Id`, `p0`.`Quantity`, 1 AS `c`, `p0`.`ProductId`, ROW_NUMBER() OVER(PARTITION BY `p0`.`ProductId` ORDER BY `p0`.`Id`) AS `row`
        FROM `ProductVariants` AS `p0`
        WHERE (`p0`.`Id` = @__8__locals1_itemDto_ProductVariantId_1) AND `p0`.`IsActive`
    ) AS `t1`
    WHERE `t1`.`row` <= 1
) AS `t0` ON `t`.`Id` = `t0`.`ProductId`
2025-08-31 17:23:58.939 +03:00 [INF] Retrieving cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:23:59.335 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-31 17:24:00.207 +03:00 [INF] Executing CreateAsync for entity CartItem
2025-08-31 17:24:00.448 +03:00 [INF] CartItem added successfully (pending save)
2025-08-31 17:24:00.462 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-31 17:24:00.479 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-31 17:24:00.612 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-31 17:24:03.561 +03:00 [INF] Executed DbCommand (103ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = DateTime), @p10='?' (DbType = DateTime), @p11='?' (Size = 4000), @p12='?' (DbType = Int32), @p13='?' (DbType = DateTime), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `CartItems` (`AddedAt`, `CartId`, `CreatedAt`, `DeletedAt`, `ModifiedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
SELECT `Id`
FROM `CartItems`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:24:04.630 +03:00 [INF] Removing cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:24:05.236 +03:00 [INF] Cache removed successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:24:05.299 +03:00 [INF] Item added to cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5, product: 1
2025-08-31 17:24:05.384 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:24:05.486 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce) in 8115.271ms
2025-08-31 17:24:05.657 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.AddItemToCart (E-Commerce)'
2025-08-31 17:24:05.709 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/items - 200 134 application/json; charset=utf-8 10033.0675ms
2025-08-31 17:24:06.554 +03:00 [INF] Executing GetByIdAsync for entity Cart with ID: 1
2025-08-31 17:24:06.748 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
FROM `Cart` AS `c`
WHERE `c`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:24:06.939 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-31 17:24:11.025 +03:00 [INF] Removing cache by tag: cart
2025-08-31 17:24:12.984 +03:00 [INF] Removed 1 cache entries for tag: cart
2025-08-31 17:24:19.807 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - null 0
2025-08-31 17:24:20.223 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:24:20.280 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:24:20.505 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:24:20.677 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-31 17:24:20.716 +03:00 [INF] Route matched with {action = "CheckOut", controller = "Cart"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] CheckOut() on controller E_Commerce.Controllers.CartController (E-Commerce).
2025-08-31 17:24:20.745 +03:00 [INF] Executing CheckOut
2025-08-31 17:24:20.763 +03:00 [INF] Checkout of cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:24:20.776 +03:00 [INF] Retrieving cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:24:20.945 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t`.`CustomerId`, `t`.`DeletedAt`, `t`.`ModifiedAt`, `t`.`UserId`, `t0`.`Id`, `t0`.`AddedAt`, `t0`.`CartId`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`ProductId`, `t0`.`ProductVariantId`, `t0`.`Quantity`, `t0`.`UnitPrice`
FROM (
    SELECT `c`.`Id`, `c`.`CheckoutDate`, `c`.`CreatedAt`, `c`.`CustomerId`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`UserId`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c0`.`Id`, `c0`.`AddedAt`, `c0`.`CartId`, `c0`.`CreatedAt`, `c0`.`DeletedAt`, `c0`.`ModifiedAt`, `c0`.`ProductId`, `c0`.`ProductVariantId`, `c0`.`Quantity`, `c0`.`UnitPrice`
    FROM `CartItems` AS `c0`
    WHERE `c0`.`DeletedAt` IS NULL
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`
2025-08-31 17:24:21.139 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Cart` SET `CheckoutDate` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-31 17:24:21.193 +03:00 [INF] Removing cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:24:21.207 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:24:21.222 +03:00 [INF] Executed action E_Commerce.Controllers.CartController.CheckOut (E-Commerce) in 485.882ms
2025-08-31 17:24:21.240 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.CartController.CheckOut (E-Commerce)'
2025-08-31 17:24:21.249 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Cart/checkout - 200 122 application/json; charset=utf-8 1441.8995ms
2025-08-31 17:24:21.766 +03:00 [INF] Cache removed successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:24:35.793 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Order - application/json-patch+json 41
2025-08-31 17:24:36.258 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:24:36.292 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:24:36.492 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:24:36.541 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-08-31 17:24:36.567 +03:00 [INF] Route matched with {action = "CreateOrder", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto]]] CreateOrder(E_Commerce.DtoModels.OrderDtos.CreateOrderDto) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-31 17:24:37.584 +03:00 [INF] Executing CreateOrder
2025-08-31 17:24:37.657 +03:00 [INF] Creating order from cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:24:38.025 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:24:38.142 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:24:38.179 +03:00 [INF] Checking if address 1 exists for customer: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:24:38.276 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__addressId_0='?' (DbType = Int32), @__customerId_1='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `CustomerAddresses` AS `c`
    WHERE ((`c`.`Id` = @__addressId_0) AND (`c`.`CustomerId` = @__customerId_1)) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:24:38.318 +03:00 [INF] Getting cart for user: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:24:38.337 +03:00 [INF] Getting cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:24:38.644 +03:00 [WRN] Cache miss for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:24:38.742 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userid_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userid_0) AND `c`.`DeletedAt` IS NULL)
2025-08-31 17:24:38.772 +03:00 [INF] Execute GetAll for entity Cart
2025-08-31 17:24:39.253 +03:00 [INF] Executed DbCommand (189ms) [Parameters=[@__userId_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT `t`.`Id`, `t`.`UserId`, `t`.`c`, `t`.`CheckoutDate`, `t`.`CreatedAt`, `t0`.`Id`, `t0`.`ProductId`, `t0`.`Quantity`, `t0`.`AddedAt`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Price`, `t0`.`FinalPrice`, `t0`.`DiscountName`, `t0`.`DiscountPrecentage`, `t0`.`MainImageUrl`, `t0`.`IsActive`, `t0`.`Color`, `t0`.`Id1`, `t0`.`CreatedAt`, `t0`.`DeletedAt`, `t0`.`ModifiedAt`, `t0`.`Size`, `t0`.`Waist`, `t0`.`Length`, `t0`.`Quantity0`, `t0`.`UnitPrice`, `t0`.`Id2`
FROM (
    SELECT `c`.`Id`, `c`.`UserId`, (
        SELECT COUNT(*)
        FROM `CartItems` AS `c0`
        WHERE `c`.`Id` = `c0`.`CartId`) AS `c`, `c`.`CheckoutDate`, `c`.`CreatedAt`
    FROM `Cart` AS `c`
    WHERE (`c`.`UserId` = @__userId_0) AND `c`.`DeletedAt` IS NULL
    LIMIT 1
) AS `t`
LEFT JOIN (
    SELECT `c1`.`Id`, `c1`.`ProductId`, `c1`.`Quantity`, `c1`.`AddedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`)
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`Name`
        ELSE NULL
    END AS `DiscountName`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND (`i`.`IsMain` AND (`i`.`DeletedAt` IS NULL))
        LIMIT 1), (
        SELECT `i0`.`Url`
        FROM `Images` AS `i0`
        WHERE (`p`.`Id` = `i0`.`ProductId`) AND `i0`.`DeletedAt` IS NULL
        LIMIT 1)) AS `MainImageUrl`, `p`.`IsActive`, `p0`.`Color`, `p0`.`Id` AS `Id1`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`ModifiedAt`, `p0`.`Size`, `p0`.`Waist`, `p0`.`Length`, `p0`.`Quantity` AS `Quantity0`, `c1`.`UnitPrice`, `d`.`Id` AS `Id2`, `c1`.`CartId`
    FROM `CartItems` AS `c1`
    INNER JOIN `Products` AS `p` ON `c1`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    LEFT JOIN `ProductVariants` AS `p0` ON `c1`.`ProductVariantId` = `p0`.`Id`
    WHERE `p`.`IsActive` AND (`p`.`DeletedAt` IS NULL)
) AS `t0` ON `t`.`Id` = `t0`.`CartId`
ORDER BY `t`.`Id`, `t0`.`Id`, `t0`.`Id0`, `t0`.`Id2`
2025-08-31 17:24:39.328 +03:00 [INF] Setting cache for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:24:39.713 +03:00 [INF] Cache set successfully for key: cart:user:ac03a6c3-9450-420a-9e6e-ea8902c018c5 with tags: [cart]
2025-08-31 17:24:39.743 +03:00 [INF] Execute GetAll for entity ProductVariant
2025-08-31 17:24:39.894 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = 1
2025-08-31 17:24:40.113 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__orderNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Orders` AS `o`
    WHERE `o`.`OrderNumber` = @__orderNumber_0)
2025-08-31 17:24:40.234 +03:00 [INF] Executing CreateAsync for entity Order
2025-08-31 17:24:40.410 +03:00 [INF] Order added successfully (pending save)
2025-08-31 17:24:40.690 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (DbType = Decimal), @p7='?' (DbType = DateTime), @p8='?' (Size = 500), @p9='?' (Size = 50), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = Decimal), @p13='?' (DbType = Int32), @p14='?' (DbType = Decimal), @p15='?' (DbType = Decimal), @p16='?' (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Orders` (`CancelledAt`, `CreatedAt`, `CustomerAddressId`, `CustomerId`, `DeletedAt`, `DeliveredAt`, `DiscountAmount`, `ModifiedAt`, `Notes`, `OrderNumber`, `RestockedAt`, `ShippedAt`, `ShippingCost`, `Status`, `Subtotal`, `TaxAmount`, `Total`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16);
SELECT `Id`
FROM `Orders`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:24:40.914 +03:00 [INF] Executing CreateRangeAsync for entity OrderItem
2025-08-31 17:24:41.016 +03:00 [INF] 1 OrderItem entities added successfully (pending save)
2025-08-31 17:24:41.039 +03:00 [INF] Removing 1 from variant: 1
2025-08-31 17:24:41.046 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-31 17:24:41.148 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:24:43.181 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (DbType = DateTime), @p1='?' (DbType = DateTime), @p2='?' (DbType = DateTime), @p3='?' (DbType = Int32), @p4='?' (DbType = DateTime), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Decimal), @p9='?' (DbType = Decimal), @p11='?' (DbType = Int32), @p10='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `OrderItem` (`CreatedAt`, `DeletedAt`, `ModifiedAt`, `OrderId`, `OrderedAt`, `ProductId`, `ProductVariantId`, `Quantity`, `TotalPrice`, `UnitPrice`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
SELECT `Id`
FROM `OrderItem`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

UPDATE `ProductVariants` SET `Quantity` = @p10
WHERE `Id` = @p11;
SELECT ROW_COUNT();
2025-08-31 17:24:43.300 +03:00 [INF] Clearing cart: 1
2025-08-31 17:24:43.408 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__cartId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `c`.`Id`, `c`.`AddedAt`, `c`.`CartId`, `c`.`CreatedAt`, `c`.`DeletedAt`, `c`.`ModifiedAt`, `c`.`ProductId`, `c`.`ProductVariantId`, `c`.`Quantity`, `c`.`UnitPrice`
FROM `CartItems` AS `c`
WHERE `c`.`CartId` = @__cartId_0
2025-08-31 17:24:43.441 +03:00 [INF] Cart 1 cleared successfully
2025-08-31 17:24:43.615 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
DELETE FROM `CartItems`
WHERE `Id` = @p0;
SELECT ROW_COUNT();
2025-08-31 17:24:43.813 +03:00 [INF] Execute AddUserOpreationAsync
2025-08-31 17:24:43.825 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-31 17:24:43.834 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-31 17:24:43.843 +03:00 [INF] Execute GetAll for entity Order
2025-08-31 17:24:44.161 +03:00 [INF] Executed DbCommand (90ms) [Parameters=[@__createdOrder_Id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `t0`.`Id`, `t0`.`CreatedAt`, `t0`.`ModifiedAt`, `t0`.`OrderNumber`, `t0`.`Status`, `t0`.`Subtotal`, `t0`.`TaxAmount`, `t0`.`ShippingCost`, `t0`.`DiscountAmount`, `t0`.`Total`, `t0`.`Notes`, `t0`.`DeletedAt`, `t0`.`ShippedAt`, `t0`.`DeliveredAt`, `t0`.`CancelledAt`, `t0`.`c`, `t0`.`Id0`, `t0`.`Name`, `t0`.`Email`, `t0`.`PhoneNumber`, `t1`.`Id`, `t1`.`CreatedAt`, `t1`.`ModifiedAt`, `t1`.`Quantity`, `t1`.`UnitPrice`, `t1`.`TotalPrice`, `t1`.`OrderedAt`, `t1`.`Id0`, `t1`.`Name`, `t1`.`Price`, `t1`.`IsActive`, `t1`.`FinalPrice`, `t1`.`DiscountPrecentage`, `t1`.`MainImageUrl`, `t1`.`Id1`, `t1`.`Color`, `t1`.`CreatedAt0`, `t1`.`ModifiedAt0`, `t1`.`Size`, `t1`.`DeletedAt`, `t1`.`Length`, `t1`.`Waist`, `t1`.`Id2`, `t1`.`Id3`
FROM (
    SELECT `o`.`Id`, `o`.`CreatedAt`, `o`.`ModifiedAt`, `o`.`OrderNumber`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`ShippingCost`, `o`.`DiscountAmount`, `o`.`Total`, `o`.`Notes`, `o`.`DeletedAt`, `o`.`ShippedAt`, `o`.`DeliveredAt`, `o`.`CancelledAt`, FALSE AS `c`, `t`.`Id` AS `Id0`, `t`.`Name`, `t`.`Email`, `t`.`PhoneNumber`
    FROM `Orders` AS `o`
    INNER JOIN (
        SELECT `a`.`Id`, `a`.`Email`, `a`.`PhoneNumber`, `a`.`Name`
        FROM `AspNetUsers` AS `a`
        WHERE `a`.`Discriminator` = 'Customer'
    ) AS `t` ON `o`.`CustomerId` = `t`.`Id`
    WHERE `o`.`Id` = @__createdOrder_Id_0
    LIMIT 1
) AS `t0`
LEFT JOIN (
    SELECT `o0`.`Id`, `o0`.`CreatedAt`, `o0`.`ModifiedAt`, `o0`.`Quantity`, `o0`.`UnitPrice`, `o0`.`TotalPrice`, `o0`.`OrderedAt`, `p`.`Id` AS `Id0`, `p`.`Name`, `p`.`Price`, `p`.`IsActive`, CASE
        WHEN ((`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND `d`.`DeletedAt` IS NULL) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN ROUND(`p`.`Price` - ((`d`.`DiscountPercent` / 100.0) * `p`.`Price`))
        ELSE `p`.`Price`
    END AS `FinalPrice`, CASE
        WHEN (`d`.`Id` IS NOT NULL AND `d`.`IsActive`) AND (`d`.`EndDate` > UTC_TIMESTAMP()) THEN `d`.`DiscountPercent`
        ELSE 0.0
    END AS `DiscountPrecentage`, COALESCE((
        SELECT `i`.`Url`
        FROM `Images` AS `i`
        WHERE (`p`.`Id` = `i`.`ProductId`) AND `i`.`DeletedAt` IS NULL
        LIMIT 1), '') AS `MainImageUrl`, `o0`.`ProductVariantId` AS `Id1`, `p0`.`Color`, COALESCE(`p0`.`CreatedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `CreatedAt0`, COALESCE(`p0`.`ModifiedAt`, TIMESTAMP '0001-01-01 00:00:00') AS `ModifiedAt0`, `p0`.`Size`, `p0`.`DeletedAt`, COALESCE(`p0`.`Length`, 0) AS `Length`, COALESCE(`p0`.`Waist`, 0) AS `Waist`, `d`.`Id` AS `Id2`, `p0`.`Id` AS `Id3`, `o0`.`OrderId`
    FROM `OrderItem` AS `o0`
    INNER JOIN `Products` AS `p` ON `o0`.`ProductId` = `p`.`Id`
    LEFT JOIN `Discount` AS `d` ON `p`.`DiscountId` = `d`.`Id`
    INNER JOIN `ProductVariants` AS `p0` ON `o0`.`ProductVariantId` = `p0`.`Id`
) AS `t1` ON `t0`.`Id` = `t1`.`OrderId`
ORDER BY `t0`.`Id`, `t0`.`Id0`, `t1`.`Id`, `t1`.`Id0`, `t1`.`Id2`
2025-08-31 17:24:46.119 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.OrderDtos.OrderWithPaymentDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:24:46.308 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce) in 9709.8679ms
2025-08-31 17:24:46.330 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.CreateOrder (E-Commerce)'
2025-08-31 17:24:46.361 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Order - 201 1439 application/json; charset=utf-8 10568.6385ms
2025-08-31 17:25:18.023 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - null null
2025-08-31 17:25:18.056 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:25:18.225 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:25:18.258 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 17:25:18.304 +03:00 [INF] Route matched with {action = "GetVariantById", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ProductDtos.ProductVariantDto]]] GetVariantById(Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 17:25:18.376 +03:00 [INF] Getting variant by id: 1
2025-08-31 17:25:18.412 +03:00 [INF] Getting cache for key: variant:1
2025-08-31 17:25:18.650 +03:00 [WRN] Cache miss for key: variant:1
2025-08-31 17:25:18.719 +03:00 [INF] Getting variant by ID: 1
2025-08-31 17:25:18.921 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE (`p`.`Id` = @__id_0) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-31 17:25:19.165 +03:00 [INF] Caching variant 1 data
2025-08-31 17:25:20.125 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ProductDtos.ProductVariantDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:25:20.161 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce) in 1833.6658ms
2025-08-31 17:25:20.262 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 17:25:20.309 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - 200 308 application/json; charset=utf-8 2285.9074ms
2025-08-31 17:25:22.090 +03:00 [INF] Setting cache for key: variant:1
2025-08-31 17:25:22.325 +03:00 [INF] Cache set successfully for key: variant:1 with tags: [product:1, variantdata]
2025-08-31 17:26:07.039 +03:00 [INF] Request starting HTTP/1.1 PUT http://localhost:5069/api/Order/11/status?status=9 - application/json-patch+json 23
2025-08-31 17:26:07.068 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:26:07.079 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:26:07.364 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:26:07.427 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce)'
2025-08-31 17:26:07.448 +03:00 [INF] Route matched with {action = "UpdateOrderStatus", controller = "Order"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] UpdateOrderStatus(Int32, E_Commerce.DtoModels.OrderDtos.OrderStatusNoteDto, E_Commerce.Enums.OrderStatus) on controller E_Commerce.Controllers.OrderController (E-Commerce).
2025-08-31 17:26:07.733 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 11
2025-08-31 17:26:07.839 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:26:08.046 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime), @p1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Orders` SET `CancelledAt` = @p0, `Status` = @p1
WHERE `Id` = @p2;
SELECT ROW_COUNT();
2025-08-31 17:26:08.239 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 17:26:08.244 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 17:26:08.274 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 17:26:10.115 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:26:10.139 +03:00 [INF] Executed action E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce) in 2675.8938ms
2025-08-31 17:26:10.183 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.OrderController.UpdateOrderStatus (E-Commerce)'
2025-08-31 17:26:10.206 +03:00 [INF] Request finished HTTP/1.1 PUT http://localhost:5069/api/Order/11/status?status=9 - 200 127 application/json; charset=utf-8 3167.4378ms
2025-08-31 17:26:24.896 +03:00 [INF] Executing GetByIdAsync for entity Order with ID: 11
2025-08-31 17:26:25.081 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`Id`, `o`.`CancelledAt`, `o`.`CreatedAt`, `o`.`CustomerAddressId`, `o`.`CustomerId`, `o`.`DeletedAt`, `o`.`DeliveredAt`, `o`.`DiscountAmount`, `o`.`ModifiedAt`, `o`.`Notes`, `o`.`OrderNumber`, `o`.`RestockedAt`, `o`.`ShippedAt`, `o`.`ShippingCost`, `o`.`Status`, `o`.`Subtotal`, `o`.`TaxAmount`, `o`.`Total`
FROM `Orders` AS `o`
WHERE `o`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:26:25.095 +03:00 [INF] Execute GetAll for entity OrderItem
2025-08-31 17:26:25.272 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__orderId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `o`.`ProductVariantId`, `o`.`Quantity`
FROM `OrderItem` AS `o`
WHERE `o`.`OrderId` = @__orderId_0
2025-08-31 17:26:25.297 +03:00 [INF] Adding quantity for variant: 1
2025-08-31 17:26:25.532 +03:00 [INF] Executing GetByIdAsync for entity ProductVariant with ID: 1
2025-08-31 17:26:25.615 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`
FROM `ProductVariants` AS `p`
WHERE `p`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:26:25.790 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `ProductVariants` SET `Quantity` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-31 17:26:26.905 +03:00 [INF] Quantity for variant 1 restored to 17
2025-08-31 17:26:27.070 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `Orders` SET `RestockedAt` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();
2025-08-31 17:26:28.004 +03:00 [INF] Restocked inventory for order 11
2025-08-31 17:27:00.775 +03:00 [INF] 1 servers were removed due to timeout
2025-08-31 17:27:14.537 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - null null
2025-08-31 17:27:15.209 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:27:15.437 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:27:15.496 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 17:27:15.503 +03:00 [INF] Route matched with {action = "GetVariantById", controller = "ProductVariant"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.ProductDtos.ProductVariantDto]]] GetVariantById(Int32, Int32) on controller E_Commerce.Controllers.ProductVariantController (E-Commerce).
2025-08-31 17:27:15.553 +03:00 [INF] Getting variant by id: 1
2025-08-31 17:27:15.579 +03:00 [INF] Getting cache for key: variant:1
2025-08-31 17:27:15.924 +03:00 [WRN] Cache miss for key: variant:1
2025-08-31 17:27:15.960 +03:00 [INF] Getting variant by ID: 1
2025-08-31 17:27:16.121 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`Color`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`IsActive`, `p`.`Length`, `p`.`ModifiedAt`, `p`.`ProductId`, `p`.`Quantity`, `p`.`Size`, `p`.`Waist`, `p0`.`Id`, `p0`.`CreatedAt`, `p0`.`DeletedAt`, `p0`.`Description`, `p0`.`DiscountId`, `p0`.`Gender`, `p0`.`IsActive`, `p0`.`ModifiedAt`, `p0`.`Name`, `p0`.`Price`, `p0`.`Quantity`, `p0`.`SubCategoryId`, `p0`.`fitType`
FROM `ProductVariants` AS `p`
INNER JOIN `Products` AS `p0` ON `p`.`ProductId` = `p0`.`Id`
WHERE (`p`.`Id` = @__id_0) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-31 17:27:16.141 +03:00 [INF] Caching variant 1 data
2025-08-31 17:27:17.068 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.ProductDtos.ProductVariantDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:27:17.082 +03:00 [INF] Executed action E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce) in 1533.8802ms
2025-08-31 17:27:17.097 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductVariantController.GetVariantById (E-Commerce)'
2025-08-31 17:27:17.104 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/api/Products/1/Variants/1 - 200 308 application/json; charset=utf-8 2566.2548ms
2025-08-31 17:27:47.100 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - multipart/form-data; boundary=----WebKitFormBoundaryifdIn3WZdXZh7f55 341501
2025-08-31 17:27:47.132 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:27:47.147 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:27:47.314 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:27:47.336 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce)'
2025-08-31 17:27:47.394 +03:00 [INF] Route matched with {action = "UploadPhotoAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.AccountDtos.UploadPhotoResponseDto]]] UploadPhotoAsync(E_Commerce.DtoModels.AccountDtos.UploadPhotoDto) on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-31 17:27:47.536 +03:00 [INF] Executing UploadPhotoAsync
2025-08-31 17:27:47.552 +03:00 [INF] Executing UploadPhotoAsync for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:27:47.569 +03:00 [INF] 📥 Saving image to CustomerPhotos
2025-08-31 17:27:50.555 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-31 17:27:50.737 +03:00 [INF] Image added successfully (pending save)
2025-08-31 17:27:51.103 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:27:51.224 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 17:27:51.234 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 17:27:51.244 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 17:27:51.253 +03:00 [INF] ✅ Image saved: https://res.cloudinary.com/dud4kxeix/image/upload/v1756650470/CustomerPhotos/652f3d43-e539-49c5-8b0a-6dacaa21a7dd.jpg
2025-08-31 17:27:51.572 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:27:51.727 +03:00 [ERR] Unexpected error in UploadPhotoAsync for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
Hangfire.BackgroundJobClientException: Background job creation failed. See inner exception for details.
 ---> Newtonsoft.Json.JsonSerializationException: Self referencing loop detected for property 'Admin' with type 'E_Commerce.Models.Customer'. Path 'adminOperationsLogs[0]'.
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference(JsonWriter writer, Object value, JsonProperty property, JsonContract contract, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CalculatePropertyValues(JsonWriter writer, Object value, JsonContainerContract contract, JsonProperty member, JsonProperty property, JsonContract& memberContract, Object& memberValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeList(JsonWriter writer, IEnumerable values, JsonArrayContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.SerializeInternal(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonConvert.SerializeObjectInternal(Object value, Type type, JsonSerializer jsonSerializer)
   at Hangfire.Common.SerializationHelper.Serialize(Object value, Type type, SerializationOption option) in C:\projects\hangfire-525\src\Hangfire.Core\Common\SerializationHelper.cs:line 123
   at Hangfire.Storage.InvocationData.SerializeArguments(MethodInfo methodInfo, IReadOnlyList`1 arguments) in C:\projects\hangfire-525\src\Hangfire.Core\Storage\InvocationData.cs:line 257
   at Hangfire.Storage.InvocationData.SerializeJob(Job job) in C:\projects\hangfire-525\src\Hangfire.Core\Storage\InvocationData.cs:line 132
   at Hangfire.Storage.InvocationData.Serialize(Job job) in C:\projects\hangfire-525\src\Hangfire.Core\Storage\InvocationData.cs:line 91
   at Hangfire.MySql.MySqlStorageConnection.CreateExpiredJob(Job job, IDictionary`2 parameters, DateTime createdAt, TimeSpan expireIn)
   at Hangfire.Client.CoreBackgroundJobFactory.<>c.<CreateBackgroundJobTwoSteps>b__15_0(Int32 _, JobCreateContext ctx) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 89
   at Hangfire.Client.CoreBackgroundJobFactory.RetryOnException[TContext,TResult](Int32& attemptsLeft, Func`3 action, TContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 167
--- End of stack trace from previous location ---
   at Hangfire.Client.CoreBackgroundJobFactory.RetryOnException[TContext,TResult](Int32& attemptsLeft, Func`3 action, TContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 179
   at Hangfire.Client.CoreBackgroundJobFactory.CreateBackgroundJobTwoSteps(CreateContext context, Dictionary`2 parameters, DateTime createdAt, TimeSpan expireIn) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 87
   at Hangfire.Client.CoreBackgroundJobFactory.Create(CreateContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 73
   at Hangfire.Client.BackgroundJobFactory.InvokeNextClientFilter(Enumerator& enumerator, IBackgroundJobFactory innerFactory, CreateContext context, CreatingContext preContext) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 131
   at Hangfire.Client.BackgroundJobFactory.InvokeClientFilter(Enumerator& enumerator, IBackgroundJobFactory innerFactory, CreateContext context, CreatingContext preContext) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 157
   at Hangfire.Client.BackgroundJobFactory.InvokeNextClientFilter(Enumerator& enumerator, IBackgroundJobFactory innerFactory, CreateContext context, CreatingContext preContext) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 128
   at Hangfire.Client.BackgroundJobFactory.CreateWithFilters(CreateContext context, FilterCollection`1 filters) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 117
   at Hangfire.Client.BackgroundJobFactory.Create(CreateContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 84
   at Hangfire.BackgroundJobClient.Create(Job job, IState state, IDictionary`2 parameters) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClient.cs:line 156
   --- End of inner exception stack trace ---
   at Hangfire.BackgroundJobClient.Create(Job job, IState state, IDictionary`2 parameters) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClient.cs:line 163
   at Hangfire.BackgroundJobClient.Create(Job job, IState state) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClient.cs:line 143
   at Hangfire.BackgroundJobClientExtensions.Create[T](IBackgroundJobClient client, Expression`1 methodCall, IState state) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClientExtensions.cs:line 621
   at Hangfire.BackgroundJobClientExtensions.Enqueue[T](IBackgroundJobClient client, Expression`1 methodCall) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClientExtensions.cs:line 165
   at Hangfire.BackgroundJob.Enqueue[T](Expression`1 methodCall) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJob.cs:line 196
   at E_Commerce.Services.AccountServices.Profile.ProfileService.UploadPhotoAsync(IFormFile image, String id) in D:\project_fashion\E-Commerce-API-main\Services\AccountServices\Profile\ProfileService.cs:line 142
   at E_Commerce.Services.AccountServices.Profile.ProfileService.UploadPhotoAsync(IFormFile image, String id) in D:\project_fashion\E-Commerce-API-main\Services\AccountServices\Profile\ProfileService.cs:line 153
2025-08-31 17:27:52.865 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.AccountDtos.UploadPhotoResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:27:52.896 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce) in 5482.3303ms
2025-08-31 17:27:52.915 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce)'
2025-08-31 17:27:52.932 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - 500 714 application/json; charset=utf-8 5832.5127ms
2025-08-31 17:28:15.933 +03:00 [INF] Password reset email sent successfully to ziad@gmail.com
2025-08-31 17:28:49.132 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5069/api/Products/1/Discount - application/json-patch+json 1
2025-08-31 17:28:49.166 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:28:49.174 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:28:49.339 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:28:49.369 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.ProductController.AddDiscountToProduct (E-Commerce)'
2025-08-31 17:28:49.398 +03:00 [INF] Route matched with {action = "AddDiscountToProduct", controller = "Product"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[System.Boolean]]] AddDiscountToProduct(Int32, Int32) on controller E_Commerce.Controllers.ProductController (E-Commerce).
2025-08-31 17:28:49.446 +03:00 [INF] Adding discount to product: 1 with discount: 1
2025-08-31 17:28:49.773 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `Products` AS `p`
    WHERE (`p`.`Id` = @__id_0) AND `p`.`DeletedAt` IS NULL)
2025-08-31 17:28:49.805 +03:00 [INF] Executing GetByIdAsync for entity Discount with ID: 1
2025-08-31 17:28:49.915 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `d`.`Id`, `d`.`CategoryId`, `d`.`CreatedAt`, `d`.`DeletedAt`, `d`.`Description`, `d`.`DiscountPercent`, `d`.`EndDate`, `d`.`IsActive`, `d`.`ModifiedAt`, `d`.`Name`, `d`.`StartDate`
FROM `Discount` AS `d`
WHERE `d`.`Id` = @__id_0
LIMIT 1
2025-08-31 17:28:50.018 +03:00 [INF] Discount 1 active status: False (IsActive: False, StartDate: 8/27/2025 9:06:41 AM, EndDate: 9/27/2025 9:06:41 AM, DeletedAt: )
2025-08-31 17:28:50.119 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__productId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT `p`.`Id`, `p`.`CreatedAt`, `p`.`DeletedAt`, `p`.`Description`, `p`.`DiscountId`, `p`.`Gender`, `p`.`IsActive`, `p`.`ModifiedAt`, `p`.`Name`, `p`.`Price`, `p`.`Quantity`, `p`.`SubCategoryId`, `p`.`fitType`
FROM `Products` AS `p`
WHERE (`p`.`Id` = @__productId_0) AND `p`.`DeletedAt` IS NULL
LIMIT 1
2025-08-31 17:28:50.152 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 17:28:50.164 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 17:28:50.172 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 17:28:50.465 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Int32), @p2='?' (Size = 255), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (DbType = DateTime), @p8='?' (DbType = Int32), @p9='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
UPDATE `Products` SET `DiscountId` = @p0
WHERE `Id` = @p1;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:28:50.646 +03:00 [INF] Discount 1 is not active. Skipping cart and order price updates for product: 1
2025-08-31 17:28:51.399 +03:00 [INF] Validation email sent successfully to aom630619@gmail.com
2025-08-31 17:28:51.580 +03:00 [INF] Successfully added discount 1 to product 1. Active: False
2025-08-31 17:28:51.587 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-08-31 17:28:51.599 +03:00 [INF] Executed action E_Commerce.Controllers.ProductController.AddDiscountToProduct (E-Commerce) in 2182.0067ms
2025-08-31 17:28:51.606 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.ProductController.AddDiscountToProduct (E-Commerce)'
2025-08-31 17:28:51.614 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5069/api/Products/1/Discount - 201 165 application/json; charset=utf-8 2481.5018ms
2025-08-31 17:30:38.237 +03:00 [INF] Setting cache for key: advsearch__________False_1_100_True_False
2025-08-31 17:30:38.474 +03:00 [INF] Cache set successfully for key: advsearch__________False_1_100_True_False with tags: [product_search]
2025-08-31 17:30:46.661 +03:00 [INF] Password reset email sent successfully to aom630619@gmail.com
2025-08-31 17:31:20.022 +03:00 [INF] Setting cache for key: advsearch__________False_1_100_True_False
2025-08-31 17:31:20.257 +03:00 [INF] Cache set successfully for key: advsearch__________False_1_100_True_False with tags: [product_search]
2025-08-31 17:31:44.122 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - multipart/form-data; boundary=----WebKitFormBoundaryIXfxAA93cw2CYpG2 341501
2025-08-31 17:31:44.138 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:31:44.145 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:31:44.315 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:31:44.321 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce)'
2025-08-31 17:31:44.323 +03:00 [INF] Route matched with {action = "UploadPhotoAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.AccountDtos.UploadPhotoResponseDto]]] UploadPhotoAsync(E_Commerce.DtoModels.AccountDtos.UploadPhotoDto) on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-31 17:31:44.342 +03:00 [INF] Executing UploadPhotoAsync
2025-08-31 17:31:44.345 +03:00 [INF] Executing UploadPhotoAsync for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:31:44.350 +03:00 [INF] 📥 Saving image to CustomerPhotos
2025-08-31 17:31:46.629 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-31 17:31:46.638 +03:00 [INF] Image added successfully (pending save)
2025-08-31 17:31:46.954 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:31:47.038 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 17:31:47.041 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 17:31:47.045 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 17:31:47.048 +03:00 [INF] ✅ Image saved: https://res.cloudinary.com/dud4kxeix/image/upload/v1756650706/CustomerPhotos/3d770570-ed69-4ca2-bcd5-a702053d3fd3.jpg
2025-08-31 17:31:47.499 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:31:47.604 +03:00 [ERR] Unexpected error in UploadPhotoAsync for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
Hangfire.BackgroundJobClientException: Background job creation failed. See inner exception for details.
 ---> Newtonsoft.Json.JsonSerializationException: Self referencing loop detected for property 'Admin' with type 'E_Commerce.Models.Customer'. Path 'adminOperationsLogs[0]'.
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference(JsonWriter writer, Object value, JsonProperty property, JsonContract contract, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeList(JsonWriter writer, IEnumerable values, JsonArrayContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.SerializeInternal(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonConvert.SerializeObjectInternal(Object value, Type type, JsonSerializer jsonSerializer)
   at Hangfire.Common.SerializationHelper.Serialize(Object value, Type type, SerializationOption option) in C:\projects\hangfire-525\src\Hangfire.Core\Common\SerializationHelper.cs:line 123
   at Hangfire.Storage.InvocationData.SerializeArguments(MethodInfo methodInfo, IReadOnlyList`1 arguments) in C:\projects\hangfire-525\src\Hangfire.Core\Storage\InvocationData.cs:line 257
   at Hangfire.Storage.InvocationData.SerializeJob(Job job) in C:\projects\hangfire-525\src\Hangfire.Core\Storage\InvocationData.cs:line 132
   at Hangfire.Storage.InvocationData.Serialize(Job job) in C:\projects\hangfire-525\src\Hangfire.Core\Storage\InvocationData.cs:line 91
   at Hangfire.MySql.MySqlStorageConnection.CreateExpiredJob(Job job, IDictionary`2 parameters, DateTime createdAt, TimeSpan expireIn)
   at Hangfire.Client.CoreBackgroundJobFactory.<>c.<CreateBackgroundJobTwoSteps>b__15_0(Int32 _, JobCreateContext ctx) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 89
   at Hangfire.Client.CoreBackgroundJobFactory.RetryOnException[TContext,TResult](Int32& attemptsLeft, Func`3 action, TContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 167
--- End of stack trace from previous location ---
   at Hangfire.Client.CoreBackgroundJobFactory.RetryOnException[TContext,TResult](Int32& attemptsLeft, Func`3 action, TContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 179
   at Hangfire.Client.CoreBackgroundJobFactory.CreateBackgroundJobTwoSteps(CreateContext context, Dictionary`2 parameters, DateTime createdAt, TimeSpan expireIn) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 87
   at Hangfire.Client.CoreBackgroundJobFactory.Create(CreateContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 73
   at Hangfire.Client.BackgroundJobFactory.InvokeNextClientFilter(Enumerator& enumerator, IBackgroundJobFactory innerFactory, CreateContext context, CreatingContext preContext) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 131
   at Hangfire.Client.BackgroundJobFactory.InvokeClientFilter(Enumerator& enumerator, IBackgroundJobFactory innerFactory, CreateContext context, CreatingContext preContext) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 157
   at Hangfire.Client.BackgroundJobFactory.InvokeNextClientFilter(Enumerator& enumerator, IBackgroundJobFactory innerFactory, CreateContext context, CreatingContext preContext) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 128
   at Hangfire.Client.BackgroundJobFactory.CreateWithFilters(CreateContext context, FilterCollection`1 filters) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 117
   at Hangfire.Client.BackgroundJobFactory.Create(CreateContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 84
   at Hangfire.BackgroundJobClient.Create(Job job, IState state, IDictionary`2 parameters) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClient.cs:line 156
   --- End of inner exception stack trace ---
   at Hangfire.BackgroundJobClient.Create(Job job, IState state, IDictionary`2 parameters) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClient.cs:line 163
   at Hangfire.BackgroundJobClient.Create(Job job, IState state) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClient.cs:line 143
   at Hangfire.BackgroundJobClientExtensions.Create[T](IBackgroundJobClient client, Expression`1 methodCall, IState state) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClientExtensions.cs:line 621
   at Hangfire.BackgroundJobClientExtensions.Enqueue[T](IBackgroundJobClient client, Expression`1 methodCall) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClientExtensions.cs:line 165
   at Hangfire.BackgroundJob.Enqueue[T](Expression`1 methodCall) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJob.cs:line 196
   at E_Commerce.Services.AccountServices.Profile.ProfileService.UploadPhotoAsync(IFormFile image, String id) in D:\project_fashion\E-Commerce-API-main\Services\AccountServices\Profile\ProfileService.cs:line 142
   at E_Commerce.Services.AccountServices.Profile.ProfileService.UploadPhotoAsync(IFormFile image, String id) in D:\project_fashion\E-Commerce-API-main\Services\AccountServices\Profile\ProfileService.cs:line 153
2025-08-31 17:31:48.559 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.AccountDtos.UploadPhotoResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:31:48.568 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce) in 4239.8505ms
2025-08-31 17:31:48.574 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce)'
2025-08-31 17:31:48.577 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - 500 714 application/json; charset=utf-8 4454.9494ms
2025-08-31 17:33:32.860 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 17:33:34.826 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 17:33:35.867 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 17:33:36.577 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 17:33:36.765 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 17:33:36.806 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 17:33:36.851 +03:00 [INF] Starting data seeding...
2025-08-31 17:33:36.897 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 17:33:37.485 +03:00 [INF] Executed DbCommand (123ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 17:33:37.561 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 17:33:37.728 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 17:33:37.744 +03:00 [INF] Role 'User' already exists.
2025-08-31 17:33:37.936 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 17:33:38.165 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 17:33:38.168 +03:00 [INF] Data seeding completed successfully.
2025-08-31 17:33:39.827 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 17:33:39.931 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 17:33:39.938 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 17:33:39.940 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 17:33:39.943 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 17:33:40.016 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 17:33:40.070 +03:00 [INF] Hosting environment: Development
2025-08-31 17:33:40.094 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 17:33:40.204 +03:00 [INF] Server mrrobot:20024:199b5c28 successfully announced in 164.4713 ms
2025-08-31 17:33:40.229 +03:00 [INF] Server mrrobot:20024:199b5c28 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 17:33:40.807 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 17:33:41.171 +03:00 [INF] Server mrrobot:20024:199b5c28 all the dispatchers started
2025-08-31 17:33:41.529 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 840.6706ms
2025-08-31 17:33:41.627 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 17:33:41.627 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 17:33:41.828 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 17:33:41.846 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 219.5595ms
2025-08-31 17:33:41.927 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 98.9267ms
2025-08-31 17:33:41.963 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 335.7421ms
2025-08-31 17:33:42.038 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 17:33:42.357 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 318.8902ms
2025-08-31 17:34:11.420 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - multipart/form-data; boundary=----WebKitFormBoundary3QfNABLaQiORWQWI 56853
2025-08-31 17:34:11.433 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:34:11.440 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-31 17:34:11.755 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:34:12.038 +03:00 [INF] Executed DbCommand (127ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:34:12.078 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce)'
2025-08-31 17:34:12.124 +03:00 [INF] Route matched with {action = "UploadPhotoAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.AccountDtos.UploadPhotoResponseDto]]] UploadPhotoAsync(E_Commerce.DtoModels.AccountDtos.UploadPhotoDto) on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-31 17:34:12.595 +03:00 [INF] Executing UploadPhotoAsync
2025-08-31 17:34:12.606 +03:00 [INF] Executing UploadPhotoAsync for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:34:12.613 +03:00 [INF] 📥 Saving image to CustomerPhotos
2025-08-31 17:34:20.394 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-31 17:34:20.499 +03:00 [INF] Image added successfully (pending save)
2025-08-31 17:34:26.480 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:34:26.621 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 17:34:26.626 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 17:34:26.656 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 17:34:26.658 +03:00 [INF] ✅ Image saved: https://res.cloudinary.com/dud4kxeix/image/upload/v1756650860/CustomerPhotos/21d0438f-3fb8-4695-94dd-11cf39e401d0.png
2025-08-31 17:34:27.023 +03:00 [INF] Executed DbCommand (91ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:34:33.491 +03:00 [ERR] Unexpected error in UploadPhotoAsync for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
Hangfire.BackgroundJobClientException: Background job creation failed. See inner exception for details.
 ---> Newtonsoft.Json.JsonSerializationException: Self referencing loop detected for property 'Admin' with type 'E_Commerce.Models.Customer'. Path 'adminOperationsLogs[0]'.
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference(JsonWriter writer, Object value, JsonProperty property, JsonContract contract, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CalculatePropertyValues(JsonWriter writer, Object value, JsonContainerContract contract, JsonProperty member, JsonProperty property, JsonContract& memberContract, Object& memberValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeList(JsonWriter writer, IEnumerable values, JsonArrayContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.SerializeInternal(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonConvert.SerializeObjectInternal(Object value, Type type, JsonSerializer jsonSerializer)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value, Type type, Formatting formatting, JsonSerializerSettings settings)
   at Hangfire.Common.SerializationHelper.Serialize(Object value, Type type, SerializationOption option) in C:\projects\hangfire-525\src\Hangfire.Core\Common\SerializationHelper.cs:line 123
   at Hangfire.Storage.InvocationData.SerializeArguments(MethodInfo methodInfo, IReadOnlyList`1 arguments) in C:\projects\hangfire-525\src\Hangfire.Core\Storage\InvocationData.cs:line 257
   at Hangfire.Storage.InvocationData.SerializeJob(Job job) in C:\projects\hangfire-525\src\Hangfire.Core\Storage\InvocationData.cs:line 132
   at Hangfire.Storage.InvocationData.Serialize(Job job) in C:\projects\hangfire-525\src\Hangfire.Core\Storage\InvocationData.cs:line 91
   at Hangfire.MySql.MySqlStorageConnection.CreateExpiredJob(Job job, IDictionary`2 parameters, DateTime createdAt, TimeSpan expireIn)
   at Hangfire.Client.CoreBackgroundJobFactory.<>c.<CreateBackgroundJobTwoSteps>b__15_0(Int32 _, JobCreateContext ctx) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 89
   at Hangfire.Client.CoreBackgroundJobFactory.RetryOnException[TContext,TResult](Int32& attemptsLeft, Func`3 action, TContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 167
--- End of stack trace from previous location ---
   at Hangfire.Client.CoreBackgroundJobFactory.RetryOnException[TContext,TResult](Int32& attemptsLeft, Func`3 action, TContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 179
   at Hangfire.Client.CoreBackgroundJobFactory.CreateBackgroundJobTwoSteps(CreateContext context, Dictionary`2 parameters, DateTime createdAt, TimeSpan expireIn) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 87
   at Hangfire.Client.CoreBackgroundJobFactory.Create(CreateContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 73
   at Hangfire.Client.BackgroundJobFactory.InvokeNextClientFilter(Enumerator& enumerator, IBackgroundJobFactory innerFactory, CreateContext context, CreatingContext preContext) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 131
   at Hangfire.Client.BackgroundJobFactory.InvokeClientFilter(Enumerator& enumerator, IBackgroundJobFactory innerFactory, CreateContext context, CreatingContext preContext) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 157
   at Hangfire.Client.BackgroundJobFactory.InvokeNextClientFilter(Enumerator& enumerator, IBackgroundJobFactory innerFactory, CreateContext context, CreatingContext preContext) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 128
   at Hangfire.Client.BackgroundJobFactory.CreateWithFilters(CreateContext context, FilterCollection`1 filters) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 117
   at Hangfire.Client.BackgroundJobFactory.Create(CreateContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 84
   at Hangfire.BackgroundJobClient.Create(Job job, IState state, IDictionary`2 parameters) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClient.cs:line 156
   --- End of inner exception stack trace ---
   at Hangfire.BackgroundJobClient.Create(Job job, IState state, IDictionary`2 parameters) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClient.cs:line 163
   at Hangfire.BackgroundJobClient.Create(Job job, IState state) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClient.cs:line 143
   at Hangfire.BackgroundJobClientExtensions.Create[T](IBackgroundJobClient client, Expression`1 methodCall, IState state) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClientExtensions.cs:line 621
   at Hangfire.BackgroundJobClientExtensions.Enqueue[T](IBackgroundJobClient client, Expression`1 methodCall) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClientExtensions.cs:line 165
   at Hangfire.BackgroundJob.Enqueue[T](Expression`1 methodCall) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJob.cs:line 196
   at E_Commerce.Services.AccountServices.Profile.ProfileService.UploadPhotoAsync(IFormFile image, String id) in D:\project_fashion\E-Commerce-API-main\Services\AccountServices\Profile\ProfileService.cs:line 142
   at E_Commerce.Services.AccountServices.Profile.ProfileService.UploadPhotoAsync(IFormFile image, String id) in D:\project_fashion\E-Commerce-API-main\Services\AccountServices\Profile\ProfileService.cs:line 153
2025-08-31 17:34:35.363 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.AccountDtos.UploadPhotoResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:34:35.403 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce) in 23267.8488ms
2025-08-31 17:34:35.408 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce)'
2025-08-31 17:34:35.420 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - 500 714 application/json; charset=utf-8 23999.8993ms
2025-08-31 17:34:43.432 +03:00 [INF] Setting cache for key: advsearch__________False_1_100_True_False
2025-08-31 17:34:43.741 +03:00 [INF] Cache set successfully for key: advsearch__________False_1_100_True_False with tags: [product_search]
2025-08-31 17:34:45.025 +03:00 [INF] Password reset email sent successfully to aom630619@gmail.com
2025-08-31 17:35:34.562 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - multipart/form-data; boundary=----WebKitFormBoundary0oqvTQJrG8UvB2C1 56853
2025-08-31 17:35:34.570 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:35:34.583 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:35:34.757 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:35:34.765 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce)'
2025-08-31 17:35:34.767 +03:00 [INF] Route matched with {action = "UploadPhotoAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.AccountDtos.UploadPhotoResponseDto]]] UploadPhotoAsync(E_Commerce.DtoModels.AccountDtos.UploadPhotoDto) on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-31 17:35:34.798 +03:00 [INF] Executing UploadPhotoAsync
2025-08-31 17:35:34.800 +03:00 [INF] Executing UploadPhotoAsync for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:35:34.804 +03:00 [INF] 📥 Saving image to CustomerPhotos
2025-08-31 17:35:36.168 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-31 17:35:36.174 +03:00 [INF] Image added successfully (pending save)
2025-08-31 17:35:36.483 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:35:36.566 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 17:35:36.573 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 17:35:36.577 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 17:35:36.580 +03:00 [INF] ✅ Image saved: https://res.cloudinary.com/dud4kxeix/image/upload/v1756650935/CustomerPhotos/58684a38-8ac5-4d7c-a4ab-22d40383aa4f.png
2025-08-31 17:35:36.892 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:35:41.149 +03:00 [ERR] Unexpected error in UploadPhotoAsync for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
Hangfire.BackgroundJobClientException: Background job creation failed. See inner exception for details.
 ---> Newtonsoft.Json.JsonSerializationException: Self referencing loop detected for property 'Admin' with type 'E_Commerce.Models.Customer'. Path 'adminOperationsLogs[0]'.
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference(JsonWriter writer, Object value, JsonProperty property, JsonContract contract, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CalculatePropertyValues(JsonWriter writer, Object value, JsonContainerContract contract, JsonProperty member, JsonProperty property, JsonContract& memberContract, Object& memberValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeList(JsonWriter writer, IEnumerable values, JsonArrayContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.SerializeInternal(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonConvert.SerializeObjectInternal(Object value, Type type, JsonSerializer jsonSerializer)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value, Type type, Formatting formatting, JsonSerializerSettings settings)
   at Hangfire.Common.SerializationHelper.Serialize(Object value, Type type, SerializationOption option) in C:\projects\hangfire-525\src\Hangfire.Core\Common\SerializationHelper.cs:line 123
   at Hangfire.Storage.InvocationData.SerializeArguments(MethodInfo methodInfo, IReadOnlyList`1 arguments) in C:\projects\hangfire-525\src\Hangfire.Core\Storage\InvocationData.cs:line 257
   at Hangfire.Storage.InvocationData.SerializeJob(Job job) in C:\projects\hangfire-525\src\Hangfire.Core\Storage\InvocationData.cs:line 132
   at Hangfire.Storage.InvocationData.Serialize(Job job) in C:\projects\hangfire-525\src\Hangfire.Core\Storage\InvocationData.cs:line 91
   at Hangfire.MySql.MySqlStorageConnection.CreateExpiredJob(Job job, IDictionary`2 parameters, DateTime createdAt, TimeSpan expireIn)
   at Hangfire.Client.CoreBackgroundJobFactory.<>c.<CreateBackgroundJobTwoSteps>b__15_0(Int32 _, JobCreateContext ctx) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 89
   at Hangfire.Client.CoreBackgroundJobFactory.RetryOnException[TContext,TResult](Int32& attemptsLeft, Func`3 action, TContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 167
--- End of stack trace from previous location ---
   at Hangfire.Client.CoreBackgroundJobFactory.RetryOnException[TContext,TResult](Int32& attemptsLeft, Func`3 action, TContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 179
   at Hangfire.Client.CoreBackgroundJobFactory.CreateBackgroundJobTwoSteps(CreateContext context, Dictionary`2 parameters, DateTime createdAt, TimeSpan expireIn) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 87
   at Hangfire.Client.CoreBackgroundJobFactory.Create(CreateContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 73
   at Hangfire.Client.BackgroundJobFactory.InvokeNextClientFilter(Enumerator& enumerator, IBackgroundJobFactory innerFactory, CreateContext context, CreatingContext preContext) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 131
   at Hangfire.Client.BackgroundJobFactory.InvokeClientFilter(Enumerator& enumerator, IBackgroundJobFactory innerFactory, CreateContext context, CreatingContext preContext) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 157
   at Hangfire.Client.BackgroundJobFactory.InvokeNextClientFilter(Enumerator& enumerator, IBackgroundJobFactory innerFactory, CreateContext context, CreatingContext preContext) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 128
   at Hangfire.Client.BackgroundJobFactory.CreateWithFilters(CreateContext context, FilterCollection`1 filters) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 117
   at Hangfire.Client.BackgroundJobFactory.Create(CreateContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 84
   at Hangfire.BackgroundJobClient.Create(Job job, IState state, IDictionary`2 parameters) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClient.cs:line 156
   --- End of inner exception stack trace ---
   at Hangfire.BackgroundJobClient.Create(Job job, IState state, IDictionary`2 parameters) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClient.cs:line 163
   at Hangfire.BackgroundJobClient.Create(Job job, IState state) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClient.cs:line 143
   at Hangfire.BackgroundJobClientExtensions.Create[T](IBackgroundJobClient client, Expression`1 methodCall, IState state) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClientExtensions.cs:line 621
   at Hangfire.BackgroundJobClientExtensions.Enqueue[T](IBackgroundJobClient client, Expression`1 methodCall) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClientExtensions.cs:line 165
   at Hangfire.BackgroundJob.Enqueue[T](Expression`1 methodCall) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJob.cs:line 196
   at E_Commerce.Services.AccountServices.Profile.ProfileService.UploadPhotoAsync(IFormFile image, String id) in D:\project_fashion\E-Commerce-API-main\Services\AccountServices\Profile\ProfileService.cs:line 142
   at E_Commerce.Services.AccountServices.Profile.ProfileService.UploadPhotoAsync(IFormFile image, String id) in D:\project_fashion\E-Commerce-API-main\Services\AccountServices\Profile\ProfileService.cs:line 153
2025-08-31 17:35:42.079 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.AccountDtos.UploadPhotoResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:35:42.084 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce) in 7305.5863ms
2025-08-31 17:35:42.088 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce)'
2025-08-31 17:35:42.090 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - 500 714 application/json; charset=utf-8 7528.5171ms
2025-08-31 17:36:32.456 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - multipart/form-data; boundary=----WebKitFormBoundaryZ0GMetlONiFak3KG 56853
2025-08-31 17:36:32.462 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:36:39.231 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:36:39.397 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:36:39.414 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce)'
2025-08-31 17:36:39.420 +03:00 [INF] Route matched with {action = "UploadPhotoAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.AccountDtos.UploadPhotoResponseDto]]] UploadPhotoAsync(E_Commerce.DtoModels.AccountDtos.UploadPhotoDto) on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-31 17:36:39.465 +03:00 [INF] Executing UploadPhotoAsync
2025-08-31 17:36:39.467 +03:00 [INF] Executing UploadPhotoAsync for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:36:39.475 +03:00 [INF] 📥 Saving image to CustomerPhotos
2025-08-31 17:36:40.893 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-31 17:36:40.895 +03:00 [INF] Image added successfully (pending save)
2025-08-31 17:36:41.207 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:36:41.373 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 17:36:41.375 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 17:36:41.378 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 17:36:41.380 +03:00 [INF] ✅ Image saved: https://res.cloudinary.com/dud4kxeix/image/upload/v1756651000/CustomerPhotos/5d7e7dc1-a894-4ac2-8263-0cac939083e5.png
2025-08-31 17:36:41.696 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:36:42.047 +03:00 [ERR] Unexpected error in UploadPhotoAsync for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
Hangfire.BackgroundJobClientException: Background job creation failed. See inner exception for details.
 ---> Newtonsoft.Json.JsonSerializationException: Self referencing loop detected for property 'Admin' with type 'E_Commerce.Models.Customer'. Path 'adminOperationsLogs[0]'.
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CheckForCircularReference(JsonWriter writer, Object value, JsonProperty property, JsonContract contract, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.CalculatePropertyValues(JsonWriter writer, Object value, JsonContainerContract contract, JsonProperty member, JsonProperty property, JsonContract& memberContract, Object& memberValue)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeList(JsonWriter writer, IEnumerable values, JsonArrayContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeObject(JsonWriter writer, Object value, JsonObjectContract contract, JsonProperty member, JsonContainerContract collectionContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.SerializeValue(JsonWriter writer, Object value, JsonContract valueContract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerProperty)
   at Newtonsoft.Json.Serialization.JsonSerializerInternalWriter.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.SerializeInternal(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonSerializer.Serialize(JsonWriter jsonWriter, Object value, Type objectType)
   at Newtonsoft.Json.JsonConvert.SerializeObjectInternal(Object value, Type type, JsonSerializer jsonSerializer)
   at Newtonsoft.Json.JsonConvert.SerializeObject(Object value, Type type, Formatting formatting, JsonSerializerSettings settings)
   at Hangfire.Common.SerializationHelper.Serialize(Object value, Type type, SerializationOption option) in C:\projects\hangfire-525\src\Hangfire.Core\Common\SerializationHelper.cs:line 123
   at Hangfire.Storage.InvocationData.SerializeArguments(MethodInfo methodInfo, IReadOnlyList`1 arguments) in C:\projects\hangfire-525\src\Hangfire.Core\Storage\InvocationData.cs:line 257
   at Hangfire.Storage.InvocationData.SerializeJob(Job job) in C:\projects\hangfire-525\src\Hangfire.Core\Storage\InvocationData.cs:line 132
   at Hangfire.Storage.InvocationData.Serialize(Job job) in C:\projects\hangfire-525\src\Hangfire.Core\Storage\InvocationData.cs:line 91
   at Hangfire.MySql.MySqlStorageConnection.CreateExpiredJob(Job job, IDictionary`2 parameters, DateTime createdAt, TimeSpan expireIn)
   at Hangfire.Client.CoreBackgroundJobFactory.<>c.<CreateBackgroundJobTwoSteps>b__15_0(Int32 _, JobCreateContext ctx) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 89
   at Hangfire.Client.CoreBackgroundJobFactory.RetryOnException[TContext,TResult](Int32& attemptsLeft, Func`3 action, TContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 167
--- End of stack trace from previous location ---
   at Hangfire.Client.CoreBackgroundJobFactory.RetryOnException[TContext,TResult](Int32& attemptsLeft, Func`3 action, TContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 179
   at Hangfire.Client.CoreBackgroundJobFactory.CreateBackgroundJobTwoSteps(CreateContext context, Dictionary`2 parameters, DateTime createdAt, TimeSpan expireIn) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 87
   at Hangfire.Client.CoreBackgroundJobFactory.Create(CreateContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\CoreBackgroundJobFactory.cs:line 73
   at Hangfire.Client.BackgroundJobFactory.InvokeNextClientFilter(Enumerator& enumerator, IBackgroundJobFactory innerFactory, CreateContext context, CreatingContext preContext) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 131
   at Hangfire.Client.BackgroundJobFactory.InvokeClientFilter(Enumerator& enumerator, IBackgroundJobFactory innerFactory, CreateContext context, CreatingContext preContext) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 157
   at Hangfire.Client.BackgroundJobFactory.InvokeNextClientFilter(Enumerator& enumerator, IBackgroundJobFactory innerFactory, CreateContext context, CreatingContext preContext) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 128
   at Hangfire.Client.BackgroundJobFactory.CreateWithFilters(CreateContext context, FilterCollection`1 filters) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 117
   at Hangfire.Client.BackgroundJobFactory.Create(CreateContext context) in C:\projects\hangfire-525\src\Hangfire.Core\Client\BackgroundJobFactory.cs:line 84
   at Hangfire.BackgroundJobClient.Create(Job job, IState state, IDictionary`2 parameters) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClient.cs:line 156
   --- End of inner exception stack trace ---
   at Hangfire.BackgroundJobClient.Create(Job job, IState state, IDictionary`2 parameters) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClient.cs:line 163
   at Hangfire.BackgroundJobClient.Create(Job job, IState state) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClient.cs:line 143
   at Hangfire.BackgroundJobClientExtensions.Create[T](IBackgroundJobClient client, Expression`1 methodCall, IState state) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClientExtensions.cs:line 621
   at Hangfire.BackgroundJobClientExtensions.Enqueue[T](IBackgroundJobClient client, Expression`1 methodCall) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClientExtensions.cs:line 165
   at Hangfire.BackgroundJob.Enqueue[T](Expression`1 methodCall) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJob.cs:line 196
   at E_Commerce.Services.AccountServices.Profile.ProfileService.UploadPhotoAsync(IFormFile image, String id) in D:\project_fashion\E-Commerce-API-main\Services\AccountServices\Profile\ProfileService.cs:line 142
   at E_Commerce.Services.AccountServices.Profile.ProfileService.UploadPhotoAsync(IFormFile image, String id) in D:\project_fashion\E-Commerce-API-main\Services\AccountServices\Profile\ProfileService.cs:line 153
2025-08-31 17:36:42.986 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.AccountDtos.UploadPhotoResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:36:42.995 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce) in 3569.3755ms
2025-08-31 17:36:42.999 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce)'
2025-08-31 17:36:43.002 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - 500 714 application/json; charset=utf-8 10545.4309ms
2025-08-31 17:37:13.388 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 17:37:14.907 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 17:37:15.924 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 17:37:16.635 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 17:37:16.815 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 17:37:16.848 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 17:37:16.870 +03:00 [INF] Starting data seeding...
2025-08-31 17:37:16.903 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 17:37:17.450 +03:00 [INF] Executed DbCommand (122ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 17:37:17.544 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 17:37:17.704 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 17:37:17.711 +03:00 [INF] Role 'User' already exists.
2025-08-31 17:37:17.889 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 17:37:18.046 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 17:37:18.060 +03:00 [INF] Data seeding completed successfully.
2025-08-31 17:37:20.009 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 17:37:20.163 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 17:37:20.251 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 17:37:20.809 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 17:37:20.919 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 17:37:20.961 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 17:37:21.053 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 17:37:21.068 +03:00 [INF] Hosting environment: Development
2025-08-31 17:37:21.071 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 17:37:21.233 +03:00 [INF] Server mrrobot:11908:20a08b37 successfully announced in 163.1767 ms
2025-08-31 17:37:21.268 +03:00 [INF] Server mrrobot:11908:20a08b37 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 17:37:21.280 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 485.4263ms
2025-08-31 17:37:21.346 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 17:37:21.345 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 17:37:21.677 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 330.397ms
2025-08-31 17:37:21.888 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 543.9734ms
2025-08-31 17:37:21.347 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 17:37:22.319 +03:00 [INF] Server mrrobot:11908:20a08b37 all the dispatchers started
2025-08-31 17:37:22.434 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 1087.3015ms
2025-08-31 17:37:22.860 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 17:37:23.130 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 270.4885ms
2025-08-31 17:37:50.138 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - multipart/form-data; boundary=----WebKitFormBoundaryBkk5nKtIT4q9YMpH 341501
2025-08-31 17:37:50.154 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:37:50.165 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-31 17:37:50.467 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:37:50.691 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:37:50.722 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce)'
2025-08-31 17:37:50.770 +03:00 [INF] Route matched with {action = "UploadPhotoAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.AccountDtos.UploadPhotoResponseDto]]] UploadPhotoAsync(E_Commerce.DtoModels.AccountDtos.UploadPhotoDto) on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-31 17:37:51.167 +03:00 [INF] Executing UploadPhotoAsync
2025-08-31 17:37:51.176 +03:00 [INF] Executing UploadPhotoAsync for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:37:51.184 +03:00 [INF] 📥 Saving image to CustomerPhotos
2025-08-31 17:37:54.121 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-31 17:37:54.213 +03:00 [INF] Image added successfully (pending save)
2025-08-31 17:37:54.824 +03:00 [INF] Executed DbCommand (124ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:37:55.063 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 17:37:55.067 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 17:37:55.105 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 17:37:55.110 +03:00 [INF] ✅ Image saved: https://res.cloudinary.com/dud4kxeix/image/upload/v1756651073/CustomerPhotos/35e31733-7001-4598-8abd-30ea7e94f1da.jpg
2025-08-31 17:37:55.454 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:37:59.734 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-31 17:37:59.762 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-31 17:38:00.017 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@p1='?' (Size = 255), @p2='?' (Size = 4000), @p0='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = DateTime), @p9='?' (DbType = Int32), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = DateTime), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (DbType = Int32), @p17='?' (DbType = DateTime), @p18='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
UPDATE `AspNetUsers` SET `ImageId1` = @p0
WHERE `Id` = @p1 AND `ConcurrencyStamp` = @p2;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:38:00.227 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-08-31 17:38:00.318 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 17:38:00.495 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p22='?' (Size = 255), @p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p23='?' (Size = 4000), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 256), @p6='?' (DbType = Boolean), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = DateTime), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTimeOffset), @p13='?' (Size = 4000), @p14='?' (Size = 256), @p15='?' (Size = 256), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = Boolean), @p19='?' (Size = 4000), @p20='?' (DbType = Boolean), @p21='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `AspNetUsers` SET `AccessFailedCount` = @p0, `Age` = @p1, `ConcurrencyStamp` = @p2, `CreateAt` = @p3, `DeletedAt` = @p4, `Email` = @p5, `EmailConfirmed` = @p6, `Gender` = @p7, `ImageId` = @p8, `ImageId1` = @p9, `LastVisit` = @p10, `LockoutEnabled` = @p11, `LockoutEnd` = @p12, `Name` = @p13, `NormalizedEmail` = @p14, `NormalizedUserName` = @p15, `PasswordHash` = @p16, `PhoneNumber` = @p17, `PhoneNumberConfirmed` = @p18, `SecurityStamp` = @p19, `TwoFactorEnabled` = @p20, `UserName` = @p21
WHERE `Id` = @p22 AND `ConcurrencyStamp` = @p23;
SELECT ROW_COUNT();
2025-08-31 17:38:01.083 +03:00 [ERR] Unexpected error in UploadPhotoAsync for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
System.NotSupportedException: Only public methods can be invoked in the background. Ensure your method has the `public` access modifier, and you aren't using explicit interface implementation.
   at Hangfire.Common.Job.Validate(Type type, String typeParameterName, MethodInfo method, String methodParameterName, Int32 argumentCount, String argumentParameterName) in C:\projects\hangfire-525\src\Hangfire.Core\Common\Job.cs:line 477
   at Hangfire.Common.Job..ctor(Type type, MethodInfo method, IReadOnlyList`1 args, String queue) in C:\projects\hangfire-525\src\Hangfire.Core\Common\Job.cs:line 204
   at Hangfire.Common.Job.FromExpression(LambdaExpression methodCall, Type explicitType, String queue) in C:\projects\hangfire-525\src\Hangfire.Core\Common\Job.cs:line 457
   at Hangfire.Common.Job.FromExpression[TType](Expression`1 methodCall, String queue) in C:\projects\hangfire-525\src\Hangfire.Core\Common\Job.cs:line 417
   at Hangfire.Common.Job.FromExpression[TType](Expression`1 methodCall) in C:\projects\hangfire-525\src\Hangfire.Core\Common\Job.cs:line 412
   at Hangfire.BackgroundJobClientExtensions.Create[T](IBackgroundJobClient client, Expression`1 methodCall, IState state) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClientExtensions.cs:line 621
   at Hangfire.BackgroundJobClientExtensions.Enqueue[T](IBackgroundJobClient client, Expression`1 methodCall) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClientExtensions.cs:line 165
   at Hangfire.BackgroundJob.Enqueue[T](Expression`1 methodCall) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJob.cs:line 196
   at E_Commerce.Services.AccountServices.Profile.ProfileService.UploadPhotoAsync(IFormFile image, String id) in D:\project_fashion\E-Commerce-API-main\Services\AccountServices\Profile\ProfileService.cs:line 150
   at E_Commerce.Services.AccountServices.Profile.ProfileService.UploadPhotoAsync(IFormFile image, String id) in D:\project_fashion\E-Commerce-API-main\Services\AccountServices\Profile\ProfileService.cs:line 153
2025-08-31 17:38:02.248 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.AccountDtos.UploadPhotoResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:38:02.284 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce) in 11501.511ms
2025-08-31 17:38:02.288 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce)'
2025-08-31 17:38:02.302 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - 500 714 application/json; charset=utf-8 12165.533ms
2025-08-31 17:39:13.117 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - multipart/form-data; boundary=----WebKitFormBoundaryOCueoxSOhFRj3KoZ 341501
2025-08-31 17:39:13.125 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:39:13.134 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:39:13.294 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:39:13.301 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce)'
2025-08-31 17:39:13.306 +03:00 [INF] Route matched with {action = "UploadPhotoAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.AccountDtos.UploadPhotoResponseDto]]] UploadPhotoAsync(E_Commerce.DtoModels.AccountDtos.UploadPhotoDto) on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-31 17:39:13.338 +03:00 [INF] Executing UploadPhotoAsync
2025-08-31 17:39:13.341 +03:00 [INF] Executing UploadPhotoAsync for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:39:13.346 +03:00 [INF] 📥 Saving image to CustomerPhotos
2025-08-31 17:39:15.655 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-31 17:39:15.661 +03:00 [INF] Image added successfully (pending save)
2025-08-31 17:39:15.985 +03:00 [INF] Executed DbCommand (93ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:39:16.091 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 17:39:16.095 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 17:39:16.100 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 17:39:16.101 +03:00 [INF] ✅ Image saved: https://res.cloudinary.com/dud4kxeix/image/upload/v1756651155/CustomerPhotos/3e64cae7-06e8-4e26-8161-7bafb92b79f6.jpg
2025-08-31 17:39:16.411 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:39:16.418 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-31 17:39:16.420 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-31 17:39:16.576 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p1='?' (Size = 255), @p2='?' (Size = 4000), @p0='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = DateTime), @p9='?' (DbType = Int32), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = DateTime), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (DbType = Int32), @p17='?' (DbType = DateTime), @p18='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
UPDATE `AspNetUsers` SET `ImageId1` = @p0
WHERE `Id` = @p1 AND `ConcurrencyStamp` = @p2;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:39:16.746 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-08-31 17:39:16.830 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 17:39:16.994 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p22='?' (Size = 255), @p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p23='?' (Size = 4000), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 256), @p6='?' (DbType = Boolean), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = DateTime), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTimeOffset), @p13='?' (Size = 4000), @p14='?' (Size = 256), @p15='?' (Size = 256), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = Boolean), @p19='?' (Size = 4000), @p20='?' (DbType = Boolean), @p21='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `AspNetUsers` SET `AccessFailedCount` = @p0, `Age` = @p1, `ConcurrencyStamp` = @p2, `CreateAt` = @p3, `DeletedAt` = @p4, `Email` = @p5, `EmailConfirmed` = @p6, `Gender` = @p7, `ImageId` = @p8, `ImageId1` = @p9, `LastVisit` = @p10, `LockoutEnabled` = @p11, `LockoutEnd` = @p12, `Name` = @p13, `NormalizedEmail` = @p14, `NormalizedUserName` = @p15, `PasswordHash` = @p16, `PhoneNumber` = @p17, `PhoneNumberConfirmed` = @p18, `SecurityStamp` = @p19, `TwoFactorEnabled` = @p20, `UserName` = @p21
WHERE `Id` = @p22 AND `ConcurrencyStamp` = @p23;
SELECT ROW_COUNT();
2025-08-31 17:39:17.380 +03:00 [ERR] Unexpected error in UploadPhotoAsync for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
System.NotSupportedException: Only public methods can be invoked in the background. Ensure your method has the `public` access modifier, and you aren't using explicit interface implementation.
   at Hangfire.Common.Job.Validate(Type type, String typeParameterName, MethodInfo method, String methodParameterName, Int32 argumentCount, String argumentParameterName) in C:\projects\hangfire-525\src\Hangfire.Core\Common\Job.cs:line 477
   at Hangfire.Common.Job..ctor(Type type, MethodInfo method, IReadOnlyList`1 args, String queue) in C:\projects\hangfire-525\src\Hangfire.Core\Common\Job.cs:line 204
   at Hangfire.Common.Job.FromExpression(LambdaExpression methodCall, Type explicitType, String queue) in C:\projects\hangfire-525\src\Hangfire.Core\Common\Job.cs:line 457
   at Hangfire.Common.Job.FromExpression[TType](Expression`1 methodCall, String queue) in C:\projects\hangfire-525\src\Hangfire.Core\Common\Job.cs:line 417
   at Hangfire.Common.Job.FromExpression[TType](Expression`1 methodCall) in C:\projects\hangfire-525\src\Hangfire.Core\Common\Job.cs:line 412
   at Hangfire.BackgroundJobClientExtensions.Create[T](IBackgroundJobClient client, Expression`1 methodCall, IState state) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClientExtensions.cs:line 621
   at Hangfire.BackgroundJobClientExtensions.Enqueue[T](IBackgroundJobClient client, Expression`1 methodCall) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJobClientExtensions.cs:line 165
   at Hangfire.BackgroundJob.Enqueue[T](Expression`1 methodCall) in C:\projects\hangfire-525\src\Hangfire.Core\BackgroundJob.cs:line 196
   at E_Commerce.Services.AccountServices.Profile.ProfileService.UploadPhotoAsync(IFormFile image, String id) in D:\project_fashion\E-Commerce-API-main\Services\AccountServices\Profile\ProfileService.cs:line 150
   at E_Commerce.Services.AccountServices.Profile.ProfileService.UploadPhotoAsync(IFormFile image, String id) in D:\project_fashion\E-Commerce-API-main\Services\AccountServices\Profile\ProfileService.cs:line 153
2025-08-31 17:39:18.361 +03:00 [INF] Executing ObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.AccountDtos.UploadPhotoResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:39:18.366 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce) in 5049.6133ms
2025-08-31 17:39:18.369 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce)'
2025-08-31 17:39:18.372 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - 500 714 application/json; charset=utf-8 5254.3544ms
2025-08-31 17:40:05.035 +03:00 [INF] DB tables already exist. Exit install
2025-08-31 17:40:06.148 +03:00 [WRN] The foreign key property 'Customer.ImageId1' was created in shadow state because a conflicting property with the simple name 'ImageId' exists in the entity type, but is either not mapped, is already used for another relationship, or is incompatible with the associated primary key type. See https://aka.ms/efcore-relationships for information on mapping relationships in EF Core.
2025-08-31 17:40:07.099 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 17:40:07.842 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='Fashion_Site' AND TABLE_NAME='__EFMigrationsHistory';
2025-08-31 17:40:08.022 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT `MigrationId`, `ProductVersion`
FROM `__EFMigrationsHistory`
ORDER BY `MigrationId`;
2025-08-31 17:40:08.046 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-08-31 17:40:08.057 +03:00 [INF] Starting data seeding...
2025-08-31 17:40:08.082 +03:00 [INF] User profile is available. Using 'C:\Users\DELL\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-08-31 17:40:08.524 +03:00 [INF] Executed DbCommand (108ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 17:40:08.602 +03:00 [INF] Role 'Admin' already exists.
2025-08-31 17:40:08.760 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__normalizedName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`ConcurrencyStamp`, `a`.`Name`, `a`.`NormalizedName`
FROM `AspNetRoles` AS `a`
WHERE `a`.`NormalizedName` = @__normalizedName_0
LIMIT 1
2025-08-31 17:40:08.767 +03:00 [INF] Role 'User' already exists.
2025-08-31 17:40:08.941 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 17:40:09.047 +03:00 [INF] Admin user already exists. Skipping provider/method creation.
2025-08-31 17:40:09.052 +03:00 [INF] Data seeding completed successfully.
2025-08-31 17:40:10.243 +03:00 [INF] Now listening on: http://localhost:5069
2025-08-31 17:40:10.316 +03:00 [INF] Starting Hangfire Server using job storage: 'Server: mysql-3581f657-omargamal1132004-b0c1.b.aivencloud.com@Fashion_Site'
2025-08-31 17:40:10.319 +03:00 [INF] Using the following options for SQL Server job storage:
2025-08-31 17:40:10.321 +03:00 [INF]     Queue poll interval: 00:00:10.
2025-08-31 17:40:10.323 +03:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-08-31 17:40:10.338 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-08-31 17:40:10.341 +03:00 [INF] Hosting environment: Development
2025-08-31 17:40:10.347 +03:00 [INF] Content root path: D:\project_fashion\E-Commerce-API-main
2025-08-31 17:40:10.531 +03:00 [INF] Server mrrobot:10876:3e9fc2ed successfully announced in 187.6908 ms
2025-08-31 17:40:10.601 +03:00 [INF] Server mrrobot:10876:3e9fc2ed is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-08-31 17:40:10.775 +03:00 [INF] 1 servers were removed due to timeout
2025-08-31 17:40:10.848 +03:00 [INF] Server mrrobot:10876:3e9fc2ed all the dispatchers started
2025-08-31 17:40:10.963 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.html - null null
2025-08-31 17:40:11.181 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.html - 200 null text/html;charset=utf-8 218.3125ms
2025-08-31 17:40:11.304 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/index.js - null null
2025-08-31 17:40:11.331 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/index.js - 200 null application/javascript;charset=utf-8 26.9927ms
2025-08-31 17:40:11.468 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - null null
2025-08-31 17:40:11.496 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 28.1101ms
2025-08-31 17:40:11.589 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/_vs/browserLink - null null
2025-08-31 17:40:11.664 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/_vs/browserLink - 200 null text/javascript; charset=UTF-8 74.7742ms
2025-08-31 17:40:12.655 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - null null
2025-08-31 17:40:12.815 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5069/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 159.2501ms
2025-08-31 17:43:10.275 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - multipart/form-data; boundary=----WebKitFormBoundaryudvhGNoSM0t9jLnU 341501
2025-08-31 17:43:10.285 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:43:10.291 +03:00 [WRN] Failed to determine the https port for redirect.
2025-08-31 17:43:10.381 +03:00 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenException: IDX10612: Decryption failed. Header.Enc is null or empty, it must be specified.
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.DecryptToken(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWEAsync(JsonWebToken jwtToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-08-31 17:43:10.403 +03:00 [INF] Bearer was not authenticated. Failure message: IDX10612: Decryption failed. Header.Enc is null or empty, it must be specified.
2025-08-31 17:43:10.408 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:43:10.434 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - 401 null application/json 159.0828ms
2025-08-31 17:43:34.219 +03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - multipart/form-data; boundary=----WebKitFormBoundaryDBMbHO5QJVEBiJip 341501
2025-08-31 17:43:34.227 +03:00 [INF] CORS policy execution successful.
2025-08-31 17:43:34.303 +03:00 [INF] Executing UserAuthenticationMiddleware
2025-08-31 17:43:34.502 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__userId_0='?' (Size = 255), @__tokenSecurityStamp_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM `AspNetUsers` AS `a`
    WHERE (`a`.`Discriminator` = 'Customer') AND ((`a`.`Id` = @__userId_0) AND (`a`.`SecurityStamp` = @__tokenSecurityStamp_1)))
2025-08-31 17:43:34.524 +03:00 [INF] Executing endpoint 'E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce)'
2025-08-31 17:43:34.554 +03:00 [INF] Route matched with {action = "UploadPhotoAsync", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[E_Commerce.DtoModels.Responses.ApiResponse`1[E_Commerce.DtoModels.AccountDtos.UploadPhotoResponseDto]]] UploadPhotoAsync(E_Commerce.DtoModels.AccountDtos.UploadPhotoDto) on controller E_Commerce.Controllers.AccountController (E-Commerce).
2025-08-31 17:43:34.879 +03:00 [INF] Executing UploadPhotoAsync
2025-08-31 17:43:34.888 +03:00 [INF] Executing UploadPhotoAsync for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:43:34.896 +03:00 [INF] 📥 Saving image to CustomerPhotos
2025-08-31 17:43:37.319 +03:00 [INF] Executing CreateAsync for entity Image
2025-08-31 17:43:37.457 +03:00 [INF] Image added successfully (pending save)
2025-08-31 17:43:37.879 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = DateTime), @p4='?' (Size = 4000), @p5='?' (DbType = DateTime), @p6='?' (DbType = Int64), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = Int32), @p10='?' (DbType = Boolean), @p11='?' (DbType = DateTime), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32), @p14='?' (Size = 4000), @p15='?' (DbType = DateTime), @p16='?' (Size = 4000), @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO `Images` (`AltText`, `CategoryId`, `CollectionId`, `CreatedAt`, `CustomerId`, `DeletedAt`, `FileSize`, `FileType`, `Folder`, `Height`, `IsMain`, `ModifiedAt`, `ProductId`, `SubCategoryId`, `Title`, `UploadDate`, `Url`, `Width`)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
SELECT `Id`
FROM `Images`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:43:38.021 +03:00 [INF] Execute AddAdminOpreationAsync
2025-08-31 17:43:38.026 +03:00 [INF] Executing CreateAsync for entity AdminOperationsLog
2025-08-31 17:43:38.047 +03:00 [INF] AdminOperationsLog added successfully (pending save)
2025-08-31 17:43:38.052 +03:00 [INF] ✅ Image saved: https://res.cloudinary.com/dud4kxeix/image/upload/v1756651416/CustomerPhotos/6d0a3a34-9b92-43d0-a2f6-ea121b9f0e9a.jpg
2025-08-31 17:43:38.385 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__p_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`Id` = @__p_0)
LIMIT 1
2025-08-31 17:43:38.437 +03:00 [INF] Executing CreateAsync for entity UserOperationsLog
2025-08-31 17:43:38.483 +03:00 [INF] UserOperationsLog added successfully (pending save)
2025-08-31 17:43:38.708 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p1='?' (Size = 255), @p2='?' (Size = 4000), @p0='?' (DbType = Int32), @p3='?' (Size = 255), @p4='?' (DbType = DateTime), @p5='?' (DbType = DateTime), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = DateTime), @p9='?' (DbType = Int32), @p10='?' (DbType = DateTime), @p11='?' (DbType = DateTime), @p12='?' (DbType = DateTime), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (DbType = DateTime), @p16='?' (DbType = Int32), @p17='?' (DbType = DateTime), @p18='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
UPDATE `AspNetUsers` SET `ImageId1` = @p0
WHERE `Id` = @p1 AND `ConcurrencyStamp` = @p2;
SELECT ROW_COUNT();

INSERT INTO `adminOperationsLogs` (`AdminId`, `CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`)
VALUES (@p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
SELECT `Id`
FROM `adminOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();

INSERT INTO `userOperationsLogs` (`CreatedAt`, `DeletedAt`, `Description`, `ItemId`, `ModifiedAt`, `OperationType`, `Timestamp`, `UserId`)
VALUES (@p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
SELECT `Id`
FROM `userOperationsLogs`
WHERE ROW_COUNT() = 1 AND `Id` = LAST_INSERT_ID();
2025-08-31 17:43:38.947 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedUserName` = @__normalizedUserName_0)
LIMIT 1
2025-08-31 17:43:39.061 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT `a`.`Id`, `a`.`AccessFailedCount`, `a`.`ConcurrencyStamp`, `a`.`Discriminator`, `a`.`Email`, `a`.`EmailConfirmed`, `a`.`LockoutEnabled`, `a`.`LockoutEnd`, `a`.`NormalizedEmail`, `a`.`NormalizedUserName`, `a`.`PasswordHash`, `a`.`PhoneNumber`, `a`.`PhoneNumberConfirmed`, `a`.`SecurityStamp`, `a`.`TwoFactorEnabled`, `a`.`UserName`, `a`.`Age`, `a`.`CreateAt`, `a`.`DeletedAt`, `a`.`Gender`, `a`.`ImageId`, `a`.`ImageId1`, `a`.`LastVisit`, `a`.`Name`
FROM `AspNetUsers` AS `a`
WHERE (`a`.`Discriminator` = 'Customer') AND (`a`.`NormalizedEmail` = @__normalizedEmail_0)
LIMIT 2
2025-08-31 17:43:39.253 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@p22='?' (Size = 255), @p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p23='?' (Size = 4000), @p3='?' (DbType = DateTime), @p4='?' (DbType = DateTime), @p5='?' (Size = 256), @p6='?' (DbType = Boolean), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32), @p9='?' (DbType = Int32), @p10='?' (DbType = DateTime), @p11='?' (DbType = Boolean), @p12='?' (DbType = DateTimeOffset), @p13='?' (Size = 4000), @p14='?' (Size = 256), @p15='?' (Size = 256), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = Boolean), @p19='?' (Size = 4000), @p20='?' (DbType = Boolean), @p21='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SET AUTOCOMMIT = 1;
UPDATE `AspNetUsers` SET `AccessFailedCount` = @p0, `Age` = @p1, `ConcurrencyStamp` = @p2, `CreateAt` = @p3, `DeletedAt` = @p4, `Email` = @p5, `EmailConfirmed` = @p6, `Gender` = @p7, `ImageId` = @p8, `ImageId1` = @p9, `LastVisit` = @p10, `LockoutEnabled` = @p11, `LockoutEnd` = @p12, `Name` = @p13, `NormalizedEmail` = @p14, `NormalizedUserName` = @p15, `PasswordHash` = @p16, `PhoneNumber` = @p17, `PhoneNumberConfirmed` = @p18, `SecurityStamp` = @p19, `TwoFactorEnabled` = @p20, `UserName` = @p21
WHERE `Id` = @p22 AND `ConcurrencyStamp` = @p23;
SELECT ROW_COUNT();
2025-08-31 17:43:39.438 +03:00 [INF] Successfully uploaded photo for user ID: ac03a6c3-9450-420a-9e6e-ea8902c018c5
2025-08-31 17:43:39.467 +03:00 [INF] Executing OkObjectResult, writing value of type 'E_Commerce.DtoModels.Responses.ApiResponse`1[[E_Commerce.DtoModels.AccountDtos.UploadPhotoResponseDto, E-Commerce, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-08-31 17:43:39.497 +03:00 [INF] Executed action E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce) in 4929.2666ms
2025-08-31 17:43:39.508 +03:00 [INF] Executed endpoint 'E_Commerce.Controllers.AccountController.UploadPhotoAsync (E-Commerce)'
2025-08-31 17:43:39.518 +03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5069/api/Account/upload-photo - 200 762 application/json; charset=utf-8 5299.3536ms
